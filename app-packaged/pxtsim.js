var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim;!function(t){var e,n;(e=t.accessibility||(t.accessibility={})).makeFocusable=function(t){t.setAttribute("focusable","true"),t.setAttribute("tabindex","0")},e.enableKeyboardInteraction=function(t,n,r){n&&t.addEventListener("keydown",function(t){var e="number"==typeof t.which?t.which:t.keyCode;32!==e&&13!==e||n()}),r&&t.addEventListener("keyup",function(t){var e="number"==typeof t.which?t.which:t.keyCode;32!==e&&13!==e||r()})},e.setAria=function(t,e,n){e&&!t.hasAttribute("role")&&t.setAttribute("role",e),n&&!t.hasAttribute("aria-label")&&t.setAttribute("aria-label",n)},e.setLiveContent=function(t){n||((n=document.createElement("div")).setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-hidden","false"),n.setAttribute("style","position: absolute !important;display: block;visibility: visible;overflow: hidden;width: 1px;height: 1px;margin: -1px;border: 0;padding: 0;clip: rect(0 0 0 0);"),document.body.appendChild(n)),n.textContent!==t&&(n.textContent=t)}}(pxsim||(pxsim={})),function(v){var c="blue",p="red";var d=function(t){return 0<t.reduce(function(t,e){return t+(e?1:0)},0)};function m(t,e){var n={};for(var r in t)n[r]=t[r];for(var i in e)n[i]=e[i];return n}function h(t){v.U.assert(!!t,"Invalid pin: "+t);var e=/^(\w+)\.\s*(?:[a-z]*)?([A-Z][A-Z\d_]+)$/.exec(t);return e?e[2]:void 0}function f(t){return"-Z"===t.orientation&&"male"===t.style}v.readPin=h;var e=function(){function t(t){this.availablePowerPins={top:{threeVolt:v.mkRange(26,51).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),ground:v.mkRange(26,51).map(function(t){return{type:"breadboard",row:"-",col:""+t}})},bottom:{threeVolt:v.mkRange(1,26).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),ground:v.mkRange(1,26).map(function(t){return{type:"breadboard",row:"-",col:""+t}})}},this.opts=t}return t.prototype.allocPartIRs=function(n,r,g){var e=this,i=[],a=function(t,e,n,r){for(var i=[],o=0;o<t.numberOfPins;o++){var s=t.pinDefinitions[o],a=void 0;if("string"==typeof s.target)a=s.target;else{var u=s.target.pinInstantiationIdx;v.U.assert(!!n&&void 0!==n[u],"No pin found for PinInstantiationIdx: "+u+'. (Is the part missing an ArgumentRole or "trackArgs=" annotations?)'),a=n[u]}var l=t.visual.pinLocations[o],c=g.yOffset+l.y,p=Math.round(c/t.visual.pinDistance),d=c-p*t.visual.pinDistance,h=g.xOffset+l.x,f=Math.round(h/t.visual.pinDistance),m={partRelativeRowIdx:p,partRelativeColIdx:f,xOffset:h-f*t.visual.pinDistance,yOffset:d};i.push({def:s,loc:l,target:a,bbFit:m})}return{name:e,def:t,pins:i,partParams:r||{},bbFit:g}};if("singleton"===n.instantiation.kind)i.push(a(n,r));else if("function"===n.instantiation.kind){var u=n.instantiation,l=u.fullyQualifiedName.split(","),o={};l.forEach(function(t){e.opts.fnArgs[t]&&e.opts.fnArgs[t].forEach(function(t){o[t]=1})});var t=Object.keys(o);v.U.assert(!!t&&!!t.length,"Failed to read pin(s) from callsite for: "+l),t.forEach(function(t){var e=t.split(",");v.U.assert(e.length===u.argumentRoles.length,"Mismatch between number of arguments at callsite (function name: "+l+") vs number of argument roles in part definition (part: "+r+").");var o=[],s={};e.forEach(function(t,e){var n=u.argumentRoles[e];if(void 0!==n.partParameter&&(s[n.partParameter]=t),void 0!==n.pinInstantiationIdx){var r=n.pinInstantiationIdx,i=h(t);o[r]=i}}),i.push(a(n,r,o,s))})}return i},t.prototype.computePartDimensions=function(t,e){var n=t.visual.pinLocations,o=t.pinDefinitions,r=t.numberOfPins;v.U.assert(n.length===r,'Mismatch between "numberOfPins" and length of "visual.pinLocations" for "'+e+'"'),v.U.assert(o.length===r,'Mismatch between "numberOfPins" and length of "pinDefinitions" for "'+e+'"'),v.U.assert(0<r,'Part "'+e+'" has no pins');var i,s,a,u,l=n.map(function(t,e){return n={idx:e},r=t,i=o[e],m(m(n,r),i);var n,r,i}).filter(function(t){return"-Z"===t.orientation}),c=0<l.length,p=t.visual.pinDistance;if(c){var d=l[0],h=Math.ceil(d.x/p),f=Math.ceil(d.y/p);i=h*p-d.x,s=f*p-d.y,a=Math.ceil((i+t.visual.width)/p)+1,u=Math.ceil((s+t.visual.height)/p)+1}else a=Math.ceil(t.visual.width/p),u=Math.ceil(t.visual.height/p),i=a*p-t.visual.width,s=u*p-t.visual.height;return{xOffset:i,yOffset:s,rowCount:u,colCount:a}},t.prototype.allocColumns=function(t){var e=t.length,n=v.visuals.BREADBOARD_MID_COLS-t.map(function(t){return t.colCount}).reduce(function(t,e){return t+e},0);n<=0&&console.log("Not enough breadboard space!");var r=Math.floor(n/(e-1+2)),i=n-r*(e-1),o=Math.floor(i/2),s=(Math.ceil(i/2),1+o);return t.map(function(t){var e=s;return s+=t.colCount+r,e})},t.prototype.placeParts=function(t){var r=v.visuals.BREADBOARD_MID_ROWS+2,i=this.allocColumns(t.map(function(t){return t.bbFit})),o=t.map(function(t){var e=r-t.bbFit.rowCount,n=Math.floor(e/2);return 4<n&&(n=4),n<1&&(n=1),n});return t.map(function(t,e){var n=o[e];return m({startColumnIdx:i[e],startRowIdx:n},t)})},t.prototype.nextColor=function(){return(!this.availableWireColors||this.availableWireColors.length<=0)&&(this.availableWireColors=v.visuals.GPIO_WIRE_COLORS.map(function(t){return t})),this.availableWireColors.pop()},t.prototype.allocWireIRs=function(a){var u=this,l=[],t=a.pins.map(function(t,e){var n,r=t.target,i=a.startColumnIdx+t.bbFit.partRelativeColIdx,o=v.visuals.getColumnName(i),s=a.startRowIdx+t.bbFit.partRelativeRowIdx;(7<=s&&(s-=2),f(t.def))?n={type:"breadboard",row:s<5?"j":"a",col:o,style:t.def.style}:n={type:"breadboard",row:v.visuals.getRowName(s),col:o,xOffset:t.bbFit.xOffset/a.def.visual.pinDistance,yOffset:t.bbFit.yOffset/a.def.visual.pinDistance,style:t.def.style};return{start:n,end:r,color:"ground"===r?c:"threeVolt"===r?p:"number"==typeof t.def.colorGroup?l[t.def.colorGroup]?l[t.def.colorGroup]:l[t.def.colorGroup]=u.nextColor():u.nextColor(),pinIdx:e}});return m(a,{wires:t})},t.prototype.allocLocation=function(t,e){var n=this;if("ground"===t||"threeVolt"===t){if("ground"===t&&this.powerUsage.singleGround)return{type:"dalboard",pin:this.getBoardGroundPin()};if("threeVolt"===t&&this.powerUsage.singleThreeVolt)return{type:"dalboard",pin:this.getBoardThreeVoltPin()};v.U.assert(!!e.referenceBBPin);var r=this.opts.getBBCoord(e.referenceBBPin),i=[this.availablePowerPins.top.ground[0]||this.availablePowerPins.top.threeVolt[0],this.availablePowerPins.bottom.ground[0]||this.availablePowerPins.bottom.threeVolt[0]].map(function(t){return n.opts.getBBCoord(t)});i[0]&&i[1]||console.debug('No more available "'+t+'" locations!');var o=0==v.visuals.findClosestCoordIdx(r,i),s=void 0;o?"ground"===t?s=this.availablePowerPins.top.ground:"threeVolt"===t&&(s=this.availablePowerPins.top.threeVolt):"ground"===t?s=this.availablePowerPins.bottom.ground:"threeVolt"===t&&(s=this.availablePowerPins.bottom.threeVolt);var a=s.map(function(t){return n.opts.getBBCoord(t)}),u=v.visuals.findClosestCoordIdx(r,a),l=s[u];return o?(this.availablePowerPins.top.ground.splice(u,1),this.availablePowerPins.top.threeVolt.splice(u,1)):(this.availablePowerPins.bottom.ground.splice(u,1),this.availablePowerPins.bottom.threeVolt.splice(u,1)),l}if("breadboard"===t.type)return t;if("MOSI"===t||"MISO"===t||"SCK"===t)return this.opts.boardDef.spiPins||console.debug("No SPI pin mappings found!"),{type:"dalboard",pin:l=this.opts.boardDef.spiPins[t]};if("SDA"===t||"SCL"===t)return this.opts.boardDef.i2cPins||console.debug("No I2C pin mappings found!"),{type:"dalboard",pin:l=this.opts.boardDef.i2cPins[t]};v.U.assert("string"==typeof t,"Unknown location type: "+t);var c=t,p=this.opts.boardDef.gpioPinMap[c];return p?{type:"dalboard",pin:p}:void 0},t.prototype.getBoardGroundPin=function(){var t=this.opts.boardDef.groundPins[0]||null;return t||console.log("No available ground pin on board!"),t},t.prototype.getBoardThreeVoltPin=function(){var t=this.opts.boardDef.threeVoltPins[0]||null;return t||console.log("No available 3.3V pin on board!"),t},t.prototype.allocPowerWires=function(t){var e,n,r=this.getBoardGroundPin(),i=this.getBoardThreeVoltPin();this.opts.boardDef.attachPowerOnRight?(e={type:"breadboard",row:"-",col:"50"},n={type:"breadboard",row:"-",col:"25"}):(e={type:"breadboard",row:"-",col:"26"},n={type:"breadboard",row:"-",col:"1"});var o=[],s=[];t.bottomGround&&t.topGround&&o.push({start:this.allocLocation("ground",{referenceBBPin:e}),end:this.allocLocation("ground",{referenceBBPin:n}),color:c}),t.topGround?o.push({start:this.allocLocation("ground",{referenceBBPin:e}),end:{type:"dalboard",pin:r},color:c}):t.bottomGround&&o.push({start:this.allocLocation("ground",{referenceBBPin:n}),end:{type:"dalboard",pin:r},color:c}),t.bottomThreeVolt&&t.bottomGround&&s.push({start:this.allocLocation("threeVolt",{referenceBBPin:e}),end:this.allocLocation("threeVolt",{referenceBBPin:n}),color:p}),t.topThreeVolt?s.push({start:this.allocLocation("threeVolt",{referenceBBPin:e}),end:{type:"dalboard",pin:i},color:p}):t.bottomThreeVolt&&s.push({start:this.allocLocation("threeVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:i},color:p});var a=[];0<o.length&&a.push({wireIndices:o.map(function(t,e){return e})});var u=o.length;return 0<s.length&&a.push({wireIndices:s.map(function(t,e){return e+u})}),{wires:o.concat(s),assembly:a}},t.prototype.allocWire=function(t){var r=this,i=[t.start,t.end],n=i.map(function(t){return"ground"===t||"threeVolt"===t}),o=i.map(function(t,e){return n[e]?void 0:r.allocLocation(t,{})});if((o=o.map(function(t,e){if(t)return t;var n=o[1-e];return r.allocLocation(i[e],{referenceBBPin:n})}))[0]&&o[1])return{start:o[0],end:o[1],color:t.color}},t.prototype.allocPart=function(i){var t=i.pins.filter(function(t){return f(t.def)}).map(function(t){var e=i.startRowIdx+t.bbFit.partRelativeRowIdx;7<=e&&(e-=2);var n=v.visuals.getRowName(e),r=i.startColumnIdx+t.bbFit.partRelativeColIdx;return{type:"breadboard",row:n,col:v.visuals.getColumnName(r)}});return{name:i.name,visual:i.def.visual,bbFit:i.bbFit,startColumnIdx:i.startColumnIdx,startRowIdx:i.startRowIdx,breadboardConnections:t,params:i.partParams,simulationBehavior:i.def.simulationBehavior}},t.prototype.allocAll=function(){var t,o=this,e=this.opts.partsList.map(function(t){return{name:t,def:o.opts.partDefs[t]}}).filter(function(t){return!!t.def});if(0<e.length){e.map(function(t){return t.name}),e.map(function(t){return t.def});var i=e.map(function(t){return o.computePartDimensions(t.def,t.name)}),s=[];e.forEach(function(t,e){var n=i[e],r=o.allocPartIRs(t.def,t.name,n);s=s.concat(r)});var n=this.placeParts(s).map(function(t){return o.allocWireIRs(t)}),r=n.map(function(t){return t.wires}).reduce(function(t,e){return t.concat(e)},[]).map(function(t){return n=[(e=t).start,e.end],r=n.map(function(t){return"ground"===t}),i=n.map(function(t){return"threeVolt"===t}),o=n.map(function(t){return function(t){var e=!1;if("string"!=typeof t&&"breadboard"===t.type){var n=t.row;e=0<=["a","b","c","d","e"].indexOf(n)}return e}(t)}),s=d(r),a=d(i),u=d(o),{topGround:s&&!u,topThreeVolt:a&&!u,bottomGround:s&&u,bottomThreeVolt:a&&u,singleGround:s,singleThreeVolt:a};var e,n,r,i,o,s,a,u});this.powerUsage=((t=r.reduce(function(t,e){return{topGround:t.topGround||e.topGround,topThreeVolt:t.topThreeVolt||e.topThreeVolt,bottomGround:t.bottomGround||e.bottomGround,bottomThreeVolt:t.bottomThreeVolt||e.bottomThreeVolt,singleGround:e.singleGround?null===t.singleGround:t.singleGround,singleThreeVolt:e.singleThreeVolt?null===t.singleThreeVolt:t.singleThreeVolt}},{topGround:!1,topThreeVolt:!1,bottomGround:!1,bottomThreeVolt:!1,singleGround:null,singleThreeVolt:null})).singleGround&&(t.topGround=t.bottomGround=!1),t.singleThreeVolt&&(t.topThreeVolt=t.bottomThreeVolt=!1),t);var a=this.allocPowerWires(this.powerUsage),u=n.map(function(t,e){var n=o.allocPart(t),r=t.wires.map(function(t){return o.allocWire(t)});if(!r.some(function(t){return!t})){var i=[];return t.wires.forEach(function(t,e){i[t.pinIdx]=e}),{part:n,wires:r,assembly:t.def.assembly.map(function(t){return{part:t.part,wireIndices:(t.pinIndices||[]).map(function(t){return i[t]})}})}}}).filter(function(t){return!!t}),l=[a].concat(u);return{partsAndWires:l,requiresBreadboard:l.some(function(t){return t.part&&t.part.breadboardConnections&&0<t.part.breadboardConnections.length||t.wires&&t.wires.some(function(t){return"breadboard"==t.end.type&&"croc"!=t.end.style||"breadboard"==t.start.type&&"croc"!=t.start.style})})}}return{partsAndWires:[]}},t}();v.allocateDefinitions=function(t){return new e(t).allocAll()}}(pxsim||(pxsim={})),function(t){!function(a){var t=function(t){this.seq=0,this.type=t},e=function(r){function t(t,e){var n=r.call(this,"response")||this;return n.request_seq=t.seq,n.command=t.command,e?(n.success=!1,n.message=e):n.success=!0,n}return __extends(t,r),t}(a.Message=t);a.Response=e;var n=function(r){function t(t,e){var n=r.call(this,"event")||this;return n.event=t,e&&(n.body=e),n}return __extends(t,r),t}(t);a.Event=n;var r=function(t,e,n,r,i){void 0===n&&(n=0),this.name=t,this.path=e,this.sourceReference=n,r&&(this.origin=r),i&&(this.adapterData=i)};a.Source=r;var i=function(t,e,n){void 0===n&&(n=!1),this.name=t,this.variablesReference=e,this.expensive=n};a.Scope=i;var o=function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this.id=t,this.source=n,this.line=r,this.column=i,this.name=e};a.StackFrame=o;var s=function(t,e){this.id=t,this.name=e||"Thread #"+t};a.Thread=s;var u=function(t,e,n,r,i){void 0===n&&(n=0),this.name=t,this.value=e,this.variablesReference=n,"number"==typeof i&&(this.namedVariables=i),"number"==typeof r&&(this.indexedVariables=r)};a.Variable=u;var l=function(t,e,n,r){this.verified=t,"number"==typeof e&&(this.line=e),"number"==typeof n&&(this.column=n),r&&(this.source=r)};a.Breakpoint=l;var c=function(t,e){this.id=t,this.name=e};a.Module=c;var p=function(t,e,n){void 0===n&&(n=0),this.label=t,this.start=e,this.length=n};a.CompletionItem=p;var d=function(i){function t(t,e,n){void 0===n&&(n=null);var r=i.call(this,"stopped")||this;(r.body={reason:t,threadId:e},n)&&(r.body.text=n);return r}return __extends(t,i),t}(n);a.StoppedEvent=d;var h=function(r){function t(t,e){var n=r.call(this,"continued")||this;return n.body={threadId:t},"boolean"==typeof e&&(n.body.allThreadsContinued=e),n}return __extends(t,r),t}(n);a.ContinuedEvent=h;var f=function(t){function e(){return t.call(this,"initialized")||this}return __extends(e,t),e}(n);a.InitializedEvent=f;var m=function(n){function t(t){var e=n.call(this,"terminated")||this;"boolean"==typeof t&&(e.body={restart:t});return e}return __extends(t,n),t}(n);a.TerminatedEvent=m;var g=function(i){function t(t,e,n){void 0===e&&(e="console");var r=i.call(this,"output")||this;return r.body={category:e,output:t},void 0!==n&&(r.body.data=n),r}return __extends(t,i),t}(n);a.OutputEvent=g;var v=function(r){function t(t,e){var n=r.call(this,"thread")||this;return n.body={reason:t,threadId:e},n}return __extends(t,r),t}(n);a.ThreadEvent=v;var b=function(r){function t(t,e){var n=r.call(this,"breakpoint")||this;return n.body={reason:t,breakpoint:e},n}return __extends(t,r),t}(n);a.BreakpointEvent=b;var y=function(r){function t(t,e){var n=r.call(this,"module")||this;return n.body={reason:t,module:e},n}return __extends(t,r),t}(n);a.ModuleEvent=y;var w=function(){function t(){this._pendingRequests={}}return t.prototype.start=function(t){var r=this;this._sequence=1,this.host=t,this.host.onData(function(t){if("request"===t.type)r.dispatchRequest(t);else if("response"===t.type){var e=t,n=r._pendingRequests[e.seq];n&&(delete r._pendingRequests[e.seq],n(e))}})},t.prototype.stop=function(){this.host&&this.host.close()},t.prototype.sendEvent=function(t){this.send("event",t)},t.prototype.sendResponse=function(t){0<t.seq?console.error("attempt to send more than one response for command "+t.command):this.send("response",t)},t.prototype.sendRequest=function(t,e,n,r){var i=this,o={command:t};if(e&&0<Object.keys(e).length&&(o.arguments=e),this.send("request",o),r){this._pendingRequests[o.seq]=r;var s=setTimeout(function(){clearTimeout(s);var t=i._pendingRequests[o.seq];t&&(delete i._pendingRequests[o.seq],t(new a.Response(o,"timeout")))},n)}},t.prototype.send=function(t,e){if(e.type=t,e.seq=this._sequence++,this.host){var n=JSON.stringify(e);this.host.send(n)}},t.prototype.dispatchRequest=function(t){},t}(),x=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t._debuggerLinesStartAt1=!1,t._debuggerColumnsStartAt1=!1,t._clientLinesStartAt1=!0,t._clientColumnsStartAt1=!0,t}return __extends(o,e),o.prototype.shutdown=function(){},o.prototype.dispatchRequest=function(t){var e=new a.Response(t);try{if("initialize"===t.command){var n=t.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(e,2018,"debug adapter only supports native paths",null);else{var r=e;r.body={},this.initializeRequest(r,n)}}else"launch"===t.command?this.launchRequest(e,t.arguments):"attach"===t.command?this.attachRequest(e,t.arguments):"disconnect"===t.command?this.disconnectRequest(e,t.arguments):"setBreakpoints"===t.command?this.setBreakPointsRequest(e,t.arguments):"setFunctionBreakpoints"===t.command?this.setFunctionBreakPointsRequest(e,t.arguments):"setExceptionBreakpoints"===t.command?this.setExceptionBreakPointsRequest(e,t.arguments):"configurationDone"===t.command?this.configurationDoneRequest(e,t.arguments):"continue"===t.command?this.continueRequest(e,t.arguments):"next"===t.command?this.nextRequest(e,t.arguments):"stepIn"===t.command?this.stepInRequest(e,t.arguments):"stepOut"===t.command?this.stepOutRequest(e,t.arguments):"stepBack"===t.command?this.stepBackRequest(e,t.arguments):"restartFrame"===t.command?this.restartFrameRequest(e,t.arguments):"goto"===t.command?this.gotoRequest(e,t.arguments):"pause"===t.command?this.pauseRequest(e,t.arguments):"stackTrace"===t.command?this.stackTraceRequest(e,t.arguments):"scopes"===t.command?this.scopesRequest(e,t.arguments):"variables"===t.command?this.variablesRequest(e,t.arguments):"setVariable"===t.command?this.setVariableRequest(e,t.arguments):"source"===t.command?this.sourceRequest(e,t.arguments):"threads"===t.command?this.threadsRequest(e):"evaluate"===t.command?this.evaluateRequest(e,t.arguments):"stepInTargets"===t.command?this.stepInTargetsRequest(e,t.arguments):"gotoTargets"===t.command?this.gotoTargetsRequest(e,t.arguments):"completions"===t.command?this.completionsRequest(e,t.arguments):this.customRequest(t.command,e,t.arguments)}catch(t){this.sendErrorResponse(e,1104,"{_stack}",{_exception:t.message,_stack:t.stack})}},o.prototype.initializeRequest=function(t,e){t.body.supportsConditionalBreakpoints=!1,t.body.supportsHitConditionalBreakpoints=!1,t.body.supportsFunctionBreakpoints=!1,t.body.supportsConfigurationDoneRequest=!0,t.body.supportsEvaluateForHovers=!1,t.body.supportsStepBack=!1,t.body.supportsSetVariable=!1,t.body.supportsRestartFrame=!1,t.body.supportsStepInTargetsRequest=!1,t.body.supportsGotoTargetsRequest=!1,t.body.supportsCompletionsRequest=!1,this.sendResponse(t)},o.prototype.disconnectRequest=function(t,e){this.sendResponse(t),this.shutdown()},o.prototype.launchRequest=function(t,e){this.sendResponse(t)},o.prototype.attachRequest=function(t,e){this.sendResponse(t)},o.prototype.setBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.setFunctionBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.setExceptionBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.configurationDoneRequest=function(t,e){this.sendResponse(t)},o.prototype.continueRequest=function(t,e){this.sendResponse(t)},o.prototype.nextRequest=function(t,e){this.sendResponse(t)},o.prototype.stepInRequest=function(t,e){this.sendResponse(t)},o.prototype.stepOutRequest=function(t,e){this.sendResponse(t)},o.prototype.stepBackRequest=function(t,e){this.sendResponse(t)},o.prototype.restartFrameRequest=function(t,e){this.sendResponse(t)},o.prototype.gotoRequest=function(t,e){this.sendResponse(t)},o.prototype.pauseRequest=function(t,e){this.sendResponse(t)},o.prototype.sourceRequest=function(t,e){this.sendResponse(t)},o.prototype.threadsRequest=function(t){this.sendResponse(t)},o.prototype.stackTraceRequest=function(t,e){this.sendResponse(t)},o.prototype.scopesRequest=function(t,e){this.sendResponse(t)},o.prototype.variablesRequest=function(t,e){this.sendResponse(t)},o.prototype.setVariableRequest=function(t,e){this.sendResponse(t)},o.prototype.evaluateRequest=function(t,e){this.sendResponse(t)},o.prototype.stepInTargetsRequest=function(t,e){this.sendResponse(t)},o.prototype.gotoTargetsRequest=function(t,e){this.sendResponse(t)},o.prototype.completionsRequest=function(t,e){this.sendResponse(t)},o.prototype.customRequest=function(t,e,n){this.sendErrorResponse(e,1014,"unrecognized request",null)},o.prototype.sendErrorResponse=function(t,e,n,r){var i;"number"==typeof e?(i={id:e,format:n},r&&(i.variables=r),i.showUser=!0):i=e,t.success=!1,o.formatPII(i.format,!0,i.variables),t.body||(t.body={}),t.body.error=i,this.sendResponse(t)},o.prototype.convertClientLineToDebugger=function(t){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?t:t+1:this._clientLinesStartAt1?t-1:t},o.prototype.convertDebuggerLineToClient=function(t){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?t:t-1:this._clientLinesStartAt1?t+1:t},o.prototype.convertClientColumnToDebugger=function(t){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?t:t+1:this._clientColumnsStartAt1?t-1:t},o.prototype.convertDebuggerColumnToClient=function(t){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?t:t-1:this._clientColumnsStartAt1?t+1:t},o.prototype.convertClientPathToDebugger=function(t){return this._clientPathsAreURIs!=this._debuggerPathsAreURIs?this._clientPathsAreURIs?o.uri2path(t):o.path2uri(t):t},o.prototype.convertDebuggerPathToClient=function(t){return this._debuggerPathsAreURIs!=this._clientPathsAreURIs?this._debuggerPathsAreURIs?o.uri2path(t):o.path2uri(t):t},o.path2uri=function(t){var e=t.replace(/\\/g,"/");return"/"!==e[0]&&(e="/"+e),encodeURI("file://"+e)},o.uri2path=function(t){return t},o.formatPII=function(t,n,r){return t.replace(o._formatPIIRegexp,function(t,e){return n&&0<e.length&&"_"!==e[0]?t:r[e]&&r.hasOwnProperty(e)?r[e]:t})},o._formatPIIRegexp=/{([^}]+)}/g,o}(a.ProtocolServer=w);a.DebugSession=x}(t.protocol||(t.protocol={}))}(pxsim||(pxsim={})),function(t){!function(t){t.injectPolyphils=function(){Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{writable:!0,enumerable:!0,value:function(t){if(null==this)throw new TypeError("this is null or not defined");for(var e=Object(this),n=e.length>>>0,r=arguments[1]>>0,i=r<0?Math.max(n+r,0):Math.min(r,n),o=arguments[2],s=void 0===o?n:o>>0,a=s<0?Math.max(n+s,0):Math.min(s,n);i<a;)e[i]=t,i++;return e}}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint16Array.prototype.slice||Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint32Array.prototype.slice||Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint8Array.prototype.fill||Object.defineProperty(Uint8Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint16Array.prototype.fill||Object.defineProperty(Uint16Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint32Array.prototype.fill||Object.defineProperty(Uint32Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0})};var e=function(){function t(t){this._func=t,this._evaluated=!1}return Object.defineProperty(t.prototype,"value",{get:function(){return this._evaluated||(this._value=this._func(),this._evaluated=!0),this._value},enumerable:!0,configurable:!0}),t}();function u(t){t=t.replace(/\\/g,"/");var e=[];return t.split("/").forEach(function(t){".."===t&&e.length?e.pop():t&&"."!==t&&e.push(t)}),e}t.Lazy=e,t.getNormalizedParts=u,t.normalizePath=function(t){return u(t).join("/")},t.relativePath=function(t,e){for(var n=u(t),r=u(e),i=0;n[i]===r[i]&&++i!==n.length&&i!==r.length;);for(var o=n.slice(i),s=r.slice(i),a=0;a<o.length;a++)s.unshift("..");return s.join("/")},t.pathJoin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";return t.forEach(function(t){t.replace(/\\/g,"/"),t.lastIndexOf("/")===t.length-1&&(t=t.slice(0,t.length-1)),n+="/"+t}),n},t.toArray=function(t){if(Array.isArray(t))return t;for(var e=[],n=0;n<t.length;++n)e.push(t[n]);return e}}(t.util||(t.util={}))}(pxsim||(pxsim={})),function(u){u.getWarningMessage=function(t){for(var e={type:"debugger",subtype:"warning",breakpointIds:[],message:t},n=u.runtime.currFrame;null!=n;)e.breakpointIds.push(n.lastBrkId),n=n.parent;return e};var t=function(){function t(t){var r=this;for(var e in this.fileMap={},this.idMap={},t.forEach(function(t){var e=t[0],n=t[1];r.fileMap[n.source.path]||(r.fileMap[n.source.path]=[]),r.fileMap[n.source.path].push(t),r.idMap[e]=n}),this.fileMap){var n=this.fileMap[e];this.fileMap[e]=n.sort(function(t,e){var n=t[1],r=e[1];return n.line===r.line?r.endLine===n.endLine?n.column-r.column:r.endLine-n.endLine:n.line-r.line})}}return t.prototype.getById=function(t){return this.idMap[t]},t.prototype.verifyBreakpoint=function(t,e){var n,r=this.fileMap[t];if(r)for(var i=0,o=r;i<o.length;i++){var s=o[i],a=s[0],u=s[1];u.line<=e.line&&u.endLine>=e.line&&(n=[a,u])}return n?(n[1].verified=!0,n):[-1,{verified:!1}]},t}();function o(t,e){function o(t){switch(typeof t){case"string":case"number":case"boolean":return t;case"function":return{text:"(function)"};case"undefined":return null;case"object":return t?t instanceof u.RefObject?{id:(e[t.id]=t).id,preview:u.RefObject.toDebugString(t)}:{text:"(object)"}:null;default:throw new Error}}return function(t){for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];!/^__/.test(i)&&/___\d+$/.test(i)&&(e[i.replace(/___\d+$/,"")]=o(t[i]))}return e}(t)}u.BreakpointMap=t,u.dumpHeap=o,u.getBreakpointMsg=function(t,e){for(var n={},r={type:"debugger",subtype:"breakpoint",breakpointId:e,globals:o(u.runtime.globals,n),stackframes:[]};null!=t;){var i=t.fn?t.fn.info:null;i&&r.stackframes.push({locals:o(t,n),funcInfo:i,breakpointId:t.lastBrkId}),t=t.parent}return{msg:r,heap:n}};var e=function(r){function n(t){var e=r.call(this)||this,n={onDebuggerBreakpoint:function(t){return e.onDebuggerBreakpoint(t)},onDebuggerWarning:function(t){return e.onDebuggerWarning(t)},onDebuggerResume:function(){return e.onDebuggerResume()},onStateChanged:function(t){return e.onStateChanged(t)}};return e.driver=new u.SimulatorDriver(t,n),e}return __extends(n,r),n.prototype.runCode=function(t,e,n,r,i){this.breakpoints=r,this.projectDir&&this.fixBreakpoints(),this.sendEvent(new u.protocol.InitializedEvent),this.driver.run(t,{parts:e,fnArgs:n,boardDefinition:i})},n.prototype.stopSimulator=function(t){void 0===t&&(t=!1),this.driver.stop(t)},n.prototype.initializeRequest=function(t,e){t.body.supportsConditionalBreakpoints=!1,t.body.supportsHitConditionalBreakpoints=!1,t.body.supportsFunctionBreakpoints=!1,t.body.supportsEvaluateForHovers=!1,t.body.supportsStepBack=!1,t.body.supportsSetVariable=!1,t.body.supportsRestartFrame=!1,t.body.supportsStepInTargetsRequest=!1,t.body.supportsGotoTargetsRequest=!1,t.body.supportsCompletionsRequest=!1,t.body.supportsConfigurationDoneRequest=!0,this.sendResponse(t)},n.prototype.disconnectRequest=function(t,e){this.sendResponse(t),this.shutdown()},n.prototype.launchRequest=function(t,e){this.projectDir||(this.projectDir=u.util.normalizePath(e.projectDir),this.breakpoints&&this.fixBreakpoints()),this.sendResponse(t)},n.prototype.setBreakPointsRequest=function(i,o){var s=this;i.body={breakpoints:[]};var a=[];o.breakpoints.forEach(function(t){if(s.breakpoints){var e=s.breakpoints.verifyBreakpoint(u.util.relativePath(s.projectDir,o.source.path),t),n=e[0],r=e[1];i.body.breakpoints.push(r),r.verified&&a.push(n)}else i.body.breakpoints.push({verified:!1})}),this.driver.setBreakpoints(a),this.sendResponse(i)},n.prototype.continueRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.Resume),this.sendResponse(t)},n.prototype.nextRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepOver),this.sendResponse(t)},n.prototype.stepInRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepInto),this.sendResponse(t)},n.prototype.stepOutRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepOut),this.sendResponse(t)},n.prototype.pauseRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.Pause),this.sendResponse(t)},n.prototype.threadsRequest=function(t){t.body={threads:[{id:n.THREAD_ID,name:"main"}]},this.sendResponse(t)},n.prototype.stackTraceRequest=function(t,e){if(this.lastBreak){var n=this.state.getFrames();t.body={stackFrames:n}}this.sendResponse(t)},n.prototype.scopesRequest=function(t,e){this.state&&(t.body={scopes:this.state.getScopes(e.frameId)}),this.sendResponse(t)},n.prototype.variablesRequest=function(t,e){this.state&&(t.body={variables:this.state.getVariables(e.variablesReference)}),this.sendResponse(t)},n.prototype.onDebuggerBreakpoint=function(t){if(this.lastBreak=t,this.state=new i(this.lastBreak,this.breakpoints,this.projectDir),t.exceptionMessage){var e=t.exceptionMessage.replace(/___\d+/g,"");this.sendEvent(new u.protocol.StoppedEvent("exception",n.THREAD_ID,e))}else this.sendEvent(new u.protocol.StoppedEvent("breakpoint",n.THREAD_ID))},n.prototype.onDebuggerWarning=function(t){},n.prototype.onDebuggerResume=function(){this.sendEvent(new u.protocol.ContinuedEvent(n.THREAD_ID,!0))},n.prototype.onStateChanged=function(t){switch(t){case u.SimulatorState.Paused:break;case u.SimulatorState.Running:this.sendEvent(new u.protocol.ContinuedEvent(n.THREAD_ID,!0));break;case u.SimulatorState.Stopped:this.sendEvent(new u.protocol.TerminatedEvent);break;case u.SimulatorState.Unloaded:}},n.prototype.fixBreakpoints=function(){for(var t in this.breakpoints.idMap){var e=this.breakpoints.idMap[t];e.source.path=u.util.pathJoin(this.projectDir,e.source.path),e.line=this.convertDebuggerLineToClient(e.line),e.endLine=this.convertDebuggerLineToClient(e.endLine),e.column=this.convertDebuggerColumnToClient(e.column),e.endColumn=this.convertDebuggerColumnToClient(e.endColumn)}},n.THREAD_ID=1,n}(u.protocol.DebugSession);u.SimDebugSession=e;var i=function(){function t(t,e,n){this._message=t,this._map=e,this._dir=n,this._currentId=1,this._frames={},this._vars={};var r=this.nextId();this._vars[r]=this.getVariableValues(this._message.globals),this._globalScope={name:"Globals",variablesReference:r,expensive:!1}}return t.prototype.getFrames=function(){var r=this;return this._message.stackframes.map(function(t,e){var n=r._map.getById(t.breakpointId);if(n)return{id:(r._frames[t.breakpointId]=t).breakpointId,name:t.funcInfo?t.funcInfo.functionName:0===e?"main":"anonymous",line:n.line,column:n.column,endLine:n.endLine,endColumn:n.endLine,source:n.source}}).filter(function(t){return!!t})},t.prototype.getScopes=function(t){var e=this._frames[t];if(e){var n=this.nextId();return this._vars[n]=this.getVariableValues(e.locals),[{name:"Locals",variablesReference:n,expensive:!1},this._globalScope]}return[this._globalScope]},t.prototype.getVariables=function(t){var e=this._vars[t];return e&&e.value||[]},t.prototype.getVariableValues=function(s){var a=this;return new u.util.Lazy(function(){var t=[];for(var e in s){var n=s[e],r=void 0,i=0;null===n?r="null":void 0===n?r="undefined":"object"==typeof n?(r="(object)",i=a.nextId(),a._vars[i]=a.getVariableValues(n)):r=n.toString();var o=e.substr(0,e.lastIndexOf("___"));t.push({name:o,value:r,variablesReference:i})}return t})},t.prototype.nextId=function(){return this._currentId++},t}()}(pxsim||(pxsim={})),function(a){function u(t){function e(){try{window.print()}catch(t){}}void 0===t&&(t=0),t?setTimeout(e,t):e()}function r(t){"undefined"!=typeof window&&window.parent&&window.parent!==window&&window.parent.postMessage(t,"*")}function n(){setInterval(function(){a.Runtime.postMessage({type:"simulator",command:"reload"})},500)}a.print=u,function(t){function e(t){t.origin;var e=t.data||{},n=e.type||"";if(n)switch(n||""){case"run":o(e);break;case"instructions":a.instructions.renderInstructions(e);break;case"stop":i();break;case"mute":s(e.mute);break;case"print":u();break;case"custom":a.handleCustomMessage&&a.handleCustomMessage(e);break;case"pxteditor":break;case"debugger":r&&r.handleDebuggerMsg(e);break;default:!function(t){if(!r||r.dead)return;r.board.receiveMessage(t)}(e)}}var r;function i(){r&&(r.kill(),r.board&&r.board.kill())}function o(t){i(),t.mute&&s(t.mute),t.localizedStrings&&a.localization.setLocalizedStrings(t.localizedStrings),(r=new a.Runtime(t)).board.initAsync(t).done(function(){r.run(function(t){a.dumpLivePointers(),a.Runtime.postMessage({type:"toplevelcodefinished"})})})}function s(t){a.AudioContextManager.mute(t)}t.start=function(){window.addEventListener("message",e,!1);var t=window.location.hash.slice(1);"undefined"!=typeof window&&(window.applicationCache.status===window.applicationCache.UPDATEREADY&&n(),window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status===window.applicationCache.UPDATEREADY&&n()})),a.Runtime.postMessage({type:"ready",frameid:t})},t.stop=i,t.run=o}(a.Embed||(a.Embed={})),a.tickEvent=function(t,e){r({type:"pxtsim",action:"event",tick:t,data:e})},a.reportError=function(t,e,n){r({type:"pxtsim",action:"event",tick:"error",category:t,message:e,data:n})},a.reload=n}(pxsim||(pxsim={})),pxsim.util.injectPolyphils(),"undefined"!=typeof window&&window.addEventListener("load",function(t){pxsim.Embed.start()}),function(q){!function(t){var l=10,r=30,s=function(t){return t+"x"},a=20,M=3,T=5,L=5,c=40,p=50,d=1.5,e=[816*.95,1056*.95],n=[1,1],i=n[0],o=n[1],u=(e[0]-86.4)/o-48*o,h=465,f=400,O=1.7,m=.17,g=.25,v=.3,b=.23,y=u-36,w="\n            .instr-panel {\n                margin: 20px;\n                padding: 24px;\n                border-width: 4px;\n                border-color: gray;\n                border-style: solid;\n                border-radius: 20px;\n                display: inline-block;\n                width: "+u+"px;\n                height: "+((e[1]-86.4)/i-48*i)+"px;\n                position: relative;\n                overflow: hidden;\n                page-break-inside: avoid;\n            }\n            .board-svg {\n                margin: 0 auto;\n                display: block;\n                position: absolute;\n                bottom: 24px;\n                left: "+((u-h)/2+24)+"px;\n            }\n            .panel-num-outer {\n                position: absolute;\n                left: "+-4+"px;\n                top: "+-4+"px;\n                width: 120px;\n                height: 120px;\n                border-width: 4px;\n                border-style: solid;\n                border-color: gray;\n                border-radius: 20px 0 20px 0;\n            }\n            .panel-num {\n                margin: 10px 0;\n                text-align: center;\n                font-size: 80px;\n            }\n            .cmp-div {\n                display: inline-block;\n            }\n            .reqs-div {\n                margin-left: 144px;\n                margin-top: 5px;\n            }\n            .partslist-wire,\n            .partslist-cmp {\n                margin: 10px;\n            }\n            .partslist-wire {\n                display: inline-block;\n            }\n            ";function x(t,e){t.classList?t.classList.add(e):t.className.indexOf(e)<0&&(t.className+=" "+e)}function C(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r={l:0,t:0,w:0,h:0},i=document.createElementNS("http://www.w3.org/2000/svg","svg");n.appendChild(i),i.appendChild(t.el);var o={viewBox:t.x+" "+t.y+" "+t.w+" "+t.h,preserveAspectRatio:"xMidYMid"};r.w=t.w,r.h=t.h;var s=function(t){r.h*=t,r.w*=t,o.width=r.w,o.height=r.h};e.cmpScale&&s(e.cmpScale),e.cmpWidth&&e.cmpWidth<r.w?s(e.cmpWidth/r.w):e.cmpHeight&&e.cmpHeight<r.h&&s(e.cmpHeight/r.h),q.svg.hydrate(i,o);var a=r.l,u=r.t,l=r.w,c=r.h,p=function(t){if(t<r.l){var e=r.l-t;r.l=t,r.w+=e}},d=function(t){var e=r.l+r.w;if(e<t){var n=t-e;r.w+=n}},h=function(t){if(t<r.t){var e=r.t-t;r.t=t,r.h+=e}},f=function(t){var e=r.t+r.h;if(e<t){var n=t-e;r.h+=n}},m=[-.3,.3],g=m[0],v=m[1],b=[1.4,1];if(e&&e.top){var y=(S=e.topSize)/b[0],w=[a+l/2,u-M-(D=S/b[1])/2],x=w[0],C=w[1],R=q.visuals.mkTxt(x,C,S,0,e.top,g,v);q.svg.addClass(R,"cmp-lbl"),n.appendChild(R);var k=y*e.top.length;h(C-D/2),p(x-k/2),d(x+k/2)}if(e&&e.bot){y=(S=e.botSize)/b[0];var E=[a+l/2,u+c+M+(D=S/b[1])/2];x=E[0],C=E[1],R=q.visuals.mkTxt(x,C,S,0,e.bot,g,v);q.svg.addClass(R,"cmp-lbl"),n.appendChild(R);k=y*e.bot.length;f(C+D/2),p(x-k/2),d(x+k/2)}if(e&&e.right){var D=(S=e.rightSize)/b[1],I=(k=(y=S/b[0])*e.right.length,[a+l+T+k/2,u+c/2]),_=(x=I[0],I[1]);R=q.visuals.mkTxt(x,_,S,0,e.right,g,v);q.svg.addClass(R,"cmp-lbl"),n.appendChild(R),h(_-D/2),d(x+k/2),f(_+D/2)}if(e&&e.left){D=(S=e.leftSize)/b[1],k=(y=S/b[0])*e.left.length;var S,B=[a-L-k/2,u+c/2];x=B[0],_=B[1],R=q.visuals.mkTxt(x,_,S,0,e.left,g,v);q.svg.addClass(R,"cmp-lbl"),n.appendChild(R),h(_-D/2),p(x-k/2),f(_+D/2)}var P={viewBox:r.l+" "+r.t+" "+r.w+" "+r.h,width:r.w*O,height:r.h*O,preserveAspectRatio:"xMidYMid"};q.svg.hydrate(n,P);var A=document.createElement("div");return A.appendChild(n),A}function R(t,e){var n,r=q.runtime.board;if("wire"==t)n=q.visuals.mkWirePart([0,0],e.wireClr||"red",e.crocClips);else{var i=t;if("string"==typeof i.builtIn)n=(0,r.builtinPartVisuals[i.builtIn])([0,0]);else n=q.visuals.mkGenericPartSVG(i)}return C(n,e)}function k(t,e,n){void 0===n&&(n=!1);var r={state:q.runtime.board,boardDef:t.boardDef,forceBreadboardLayout:!0,forceBreadboardRender:t.allAlloc.requiresBreadboard,partDefs:t.cmpDefs,maxWidth:e+"px",fnArgs:t.fnArgs,wireframe:n,partsList:[]},i=new q.visuals.BoardHost(q.visuals.mkBoardView({visual:r.boardDef.visual,wireframe:r.wireframe}),r),o=i.getView();return q.svg.addClass(o,"board-svg"),i}function E(){var t=document.createElement("div");return x(t,"instr-panel"),t}function D(i){var t,o=E(),e=C((t=i.boardDef.visual,q.visuals.mkBoardView({visual:t}).getView()),{left:s(1),leftSize:r,cmpScale:m});o.appendChild(e);var n=C(new q.visuals.Breadboard({}).getSVGAndSize(),{left:s(1),leftSize:r,cmpScale:g});return o.appendChild(n),i.allCmps.forEach(function(t){var e=1;"buttonpair"===t.visual.builtIn&&(e=2);var n=R(t.visual,{left:s(e),leftSize:r,cmpScale:v});x(n,"partslist-cmp"),o.appendChild(n)}),i.allWireColors.forEach(function(t){var e=i.colorToWires[t].length,n=i.boardDef.pinStyles[t]||"female",r=R("wire",{left:s(e),leftSize:a,wireClr:t,cmpScale:b,crocClips:"croc"==n});x(r,"partslist-wire"),o.appendChild(r)}),o}function I(t,r){var e=E(),n=k(r,h,!0);!function(r,i,o){var t=r.getView();0<i&&q.svg.addClass(t,"grayed");for(var e=function(n){var t=o.stepToCmps[n];t&&t.forEach(function(t){var e=r.addPart(t);n===i&&(t.breadboardConnections.forEach(function(t){return r.highlightBreadboardPin(t)}),q.svg.addClass(e.element,"notgrayed"))});var e=o.stepToWires[n];e&&e.forEach(function(t){var e=r.addWire(t);n===i&&("breadboard"==t.start.type?r.highlightBreadboardPin(t.start):r.highlightBoardPin(t.start.pin),"breadboard"==t.end.type?r.highlightBreadboardPin(t.end):r.highlightBoardPin(t.end.pin),r.highlightWire(e))})},n=0;n<=i;n++)e(n)}(n,t,r),e.appendChild(n.getView());var i=document.createElement("div");x(i,"panel-num-outer"),x(i,"noselect"),e.appendChild(i);var o=document.createElement("div");x(o,"panel-num"),o.textContent=t+1+"",i.appendChild(o);var s=document.createElement("div");x(s,"reqs-div"),e.appendChild(s);var a=r.stepToWires[t]||[],u=function(t){if("breadboard"===t.type){var e=t;return"("+e.row+","+e.col+")"}return t.pin};return a.forEach(function(t){var e=!1;"dalboard"==t.end.type&&(e="croc"==r.boardDef.pinStyles[t.end.pin]);var n=R("wire",{top:u(t.end),topSize:l,bot:u(t.start),botSize:l,wireClr:t.color,cmpHeight:c,crocClips:e});x(n,"cmp-div"),s.appendChild(n)}),(r.stepToCmps[t]||[]).forEach(function(o){("buttonpair"===o.visual.builtIn?[o.breadboardConnections[0],o.breadboardConnections[2]]:[o.breadboardConnections[0]]).forEach(function(t,e){var n;t?n="("+t.row+","+t.col+")":n="";var r=d;"buttonpair"===o.visual.builtIn&&(r*=.5);var i=R(o.visual,{top:n,topSize:l,cmpHeight:p,cmpScale:r});x(i,"cmp-div"),s.appendChild(i)})}),e}function _(t,e){e.boardDef.pinStyles||(e.boardDef.pinStyles={}),e.configData&&q.setConfigData(e.configData.cfg,e.configData.cfgKey);var n={type:"run",code:"",boardDefinition:e.boardDef,partDefinitions:e.partDefinitions};q.runtime=new q.Runtime(n),q.runtime.board=null,q.initCurrentRuntime(n);var r=document.createElement("style");r.textContent+=w,document.head.appendChild(r);var i,o,s,a=e.partDefinitions,u=new q.visuals.Breadboard({}),l=function(t){var e=q.allocateDefinitions(t),i=[],o=[],s=1;e.partsAndWires.forEach(function(t){var n=t.part,r=t.wires;t.assembly.forEach(function(t,e){t.part&&n&&(o[s+e]=[n]),t.wireIndices&&0<t.wireIndices.length&&r&&(i[s+e]=t.wireIndices.map(function(t){return r[t]}))}),s+=t.assembly.length});var n=s-1,r=e.partsAndWires.map(function(t){return t.part}).filter(function(t){return!!t}),a=e.partsAndWires.map(function(t){return t.wires||[]}).reduce(function(t,e){return t.concat(e)},[]),u={},l=[];return a.forEach(function(t){u[t.color]||(u[t.color]=[],l.push(t.color)),u[t.color].push(t)}),{boardDef:t.boardDef,cmpDefs:t.partDefs,fnArgs:t.fnArgs,allAlloc:e,stepToWires:i,stepToCmps:o,allWires:a,allCmps:r,lastStep:n,colorToWires:u,allWireColors:l}}({boardDef:e.boardDef,partDefs:a,partsList:e.parts,fnArgs:e.fnArgs,getBBCoord:u.getCoord.bind(u)}),c=(i=l,o=document.getElementById("front-panel"),(s=k(i,f,!1)).addAll(i.allAlloc),o.appendChild(s.getView()),D(l));t.appendChild(c);for(var p=0;p<=l.lastStep;p++){var d=I(p,l);t.appendChild(d)}var h=function(t){var e=E();x(e,"back-panel");var n=k(t,y,!1);return n.addAll(t.allAlloc),e.appendChild(n.getView()),e}(l);t.appendChild(h)}t.renderParts=_,t.renderInstructions=function(t){document.getElementById("proj-title").innerText=t.options.name||"",_(document.body,t.options)}}(q.instructions||(q.instructions={}))}(pxsim||(pxsim={})),function(s){function a(t,e){if(void 0===e&&(e="sim: check failed"),!t)throw new Error(e)}s.quiet=!1,s.check=a,s.floatingPoint=!1,s.refCounting=!0,s.title="";var n={},r={};s.noRefCounting=function(){s.refCounting=!1,s.runtime&&(s.runtime.refCounting=!1)},s.getConfig=function(t){return r.hasOwnProperty(t+"")?r[t+""]:null},s.getConfigKey=function(t){return n.hasOwnProperty(t)?n[t]:null},s.getAllConfigKeys=function(){return Object.keys(n)},s.setConfig=function(t,e){r[t]=e},s.setConfigData=function(t,e){r=t,n=e},s.getConfigData=function(){return{cfg:r,cfgKey:n}},s.enableFloatingPoint=function(){s.floatingPoint=!0},s.setTitle=function(t){s.title=t};var i=function(){function t(){this.refcnt=1,s.runtime?this.id=s.runtime.registerLiveObject(this):this.id=0}return t.prototype.destroy=function(){},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefObject id:"+this.id+" refs:"+this.refcnt)},t.prototype.toDebugString=function(){return"(object)"},t.toAny=function(t){return t&&t.toAny?t.toAny():t},t.toDebugString=function(t){return null===t?"null":void 0===t?"undefined;":t.toDebugString?t.toDebugString():"string"==typeof t?JSON.stringify(t):t.toString()},t}();s.RefObject=i;var o=function(t,e,n,r,i,o){this.func=t,this.caps=e,this.a0=n,this.a1=r,this.a2=i,this.cb=o};s.FnWrapper=o;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.destroy=function(){for(var t=this.vtable.refmask,e=0;e<t.length;++e)t[e]&&v(this.fields[e]);this.fields=null,this.vtable=null},t.prototype.isRef=function(t){return a(0<=t&&t<this.fields.length),!!this.vtable.refmask[t]},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefRecord id:"+this.id+" ("+this.vtable.name+") len:"+this.fields.length)},t}(i);s.RefRecord=u;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.isRef=function(t){return a(0<=t&&t<this.fields.length),t<this.reflen},t.prototype.ldclo=function(t){return a(0<=(t>>=2)&&t<this.fields.length),this.fields[t]},t.prototype.destroy=function(){for(var t=0;t<this.reflen;++t)v(this.fields[t]);this.fields=null,this.func=null},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefAction id:"+this.id+" refs:"+this.refcnt+" len:"+this.fields.length)},t}(i);s.RefAction=l,function(t){function r(t,e,n,r){var i=s.getResume();t instanceof l?(h.incr(t),i(new o(t.func,t.fields,e,n,r,function(){h.decr(t)}))):i(new o(t,null,e,n,r,null))}t.mkAction=function(t,e,n){var r=new l;r.reflen=t,r.func=n;for(var i=0;i<e;++i)r.fields.push(null);return r},t.runAction3=r,t.runAction2=function(t,e,n){r(t,e,n,null)},t.runAction1=function(t,e){r(t,e,null,null)},t.runAction0=function(t){r(t,null,null,null)}}(s.pxtcore||(s.pxtcore={}));var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.v=0,t}return __extends(t,e),t.prototype.print=function(){},t}(i);s.RefLocal=t;var e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.v=null,t}return __extends(t,e),t.prototype.destroy=function(){v(this.v)},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefRefLocal id:"+this.id+" refs:"+this.refcnt+" v:"+this.v)},t}(i);s.RefRefLocal=e;var c,p,d,h,f,m,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vtable=42,t.data=[],t}return __extends(t,e),t.prototype.findIdx=function(t){for(var e=0;e<this.data.length;++e)if(this.data[e].key>>1==t)return e;return-1},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.data.length;++t)1&this.data[t].key&&v(this.data[t].val),this.data[t].val=0;this.data=[]},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefMap id:"+this.id+" refs:"+this.refcnt+" size:"+this.data.length)},t.prototype.toAny=function(){var e={};return this.data.forEach(function(t){e[t.keyName]=i.toAny(t.val)}),e},t}(i);function v(t){if(s.runtime&&s.runtime.refCounting&&t instanceof i){var e=t;a(0<e.refcnt),0==--e.refcnt&&(s.runtime.unregisterLiveObject(e),e.destroy())}}function b(t){return t}function y(t){if(!s.runtime||!s.runtime.refCounting)return t;if(t instanceof i){var e=t;a(0<e.refcnt),e.refcnt++}return t}function w(){s.runtime&&s.runtime.dumpLivePointers()}s.RefMap=g,s.decr=v,s.initString=b,s.incr=y,s.dumpLivePointers=w,(c=s.numops||(s.numops={})).toString=function(t){return null===t?"null":void 0===t?"undefined":b(t.toString())},c.toBoolDecr=function(t){return v(t),!!t},c.toBool=function(t){return!!t},(p=s.langsupp||(s.langsupp={})).toInt=function(t){return 0|t},p.toFloat=function(t){return t},p.ignore=function(t){return t},p.ptreqDecr=function(t,e){return s.Number_.eqDecr(t,e)},(d=s.pxtcore||(s.pxtcore={})).incr=s.incr,d.decr=s.decr,d.ptrOfLiteral=function(t){return t},d.debugMemLeaks=function(){w()},d.allocate=function(){s.U.userError("allocate() called in simulator")},d.templateHash=function(){return 0},d.programHash=function(){return 0},d.programSize=function(){return 0},d.afterProgramPage=function(){return 0},d.getConfig=function(t,e){var n=s.getConfig(t);return null==n?e:n},d.toInt=function(t){return t>>0},d.toUInt=function(t){return t>>>0},d.toDouble=function(t){return t},d.toFloat=function(t){return t},d.fromInt=function(t){return t},d.fromUInt=function(t){return t},d.fromDouble=function(t){return t},d.fromFloat=function(t){return t},d.fromBool=function(t){return!!t},function(o){function i(t){null==t&&s.U.userError("Dereferencing null/undefined value.")}o.incr=s.incr,o.decr=s.decr,o.toInt8=function(t){return(255&t)<<24>>24},o.toInt16=function(t){return(65535&t)<<16>>16},o.toInt32=function(t){return 0|t},o.toUInt32=function(t){return t>>>0},o.toUInt8=function(t){return 255&t},o.toUInt16=function(t){return 65535&t},o.nullFix=function(t){return null==t||!1===t?0:!0===t?1:t},o.nullCheck=i,o.panic=function(t){s.U.userError("PANIC! Code "+t)},o.stringToBool=function(t){return o.decr(t),t?1:0},o.ptrToBool=function(t){return o.decr(t),t?1:0},o.emptyToNull=function(t){return""==t?0:t},o.ldfld=function(t,e){i(t),a(!t.isRef(e));var n,r=(n=t.fields[e],s.floatingPoint||void 0!==n?n:0);return o.decr(t),r},o.stfld=function(t,e,n){i(t),a(!t.isRef(e)),t.fields[e]=n,o.decr(t)},o.ldfldRef=function(t,e){i(t),a(t.isRef(e));var n,r=o.incr(void 0===(n=t.fields[e])?null:n);return o.decr(t),r},o.stfldRef=function(t,e,n){i(t),a(t.isRef(e)),o.decr(t.fields[e]),t.fields[e]=n,o.decr(t)},o.ldloc=function(t){return t.v},o.ldlocRef=function(t){return o.incr(t.v)},o.stloc=function(t,e){t.v=e},o.stlocRef=function(t,e){o.decr(t.v),t.v=e},o.mkloc=function(){return new t},o.mklocRef=function(){return new e},o.stclo=function(t,e,n){return a(0<=e&&e<t.fields.length),a(null===t.fields[e]),t.fields[e]=n,t},o.runtimeWarning=function(t){s.Runtime.postMessage(s.getWarningMessage(t))},o.mkMap=function(){return new g},o.mapGet=function(t,e){var n=t.findIdx(e);if(n<0)return o.decr(t),0;var r=t.data[n].val;return o.decr(t),r},o.mapGetRef=function(t,e){var n=t.findIdx(e);if(n<0)return o.decr(t),0;var r=o.incr(t.data[n].val);return o.decr(t),r},o.mapSet=function(t,e,n,r){var i=t.findIdx(e);i<0?t.data.push({key:e<<1,val:n,keyName:r}):(1&t.data[i].key&&(o.decr(t.data[i].val),t.data[i].key=e<<1),t.data[i].val=n,t.data[i].keyName=r),o.decr(t)},o.mapSetRef=function(t,e,n,r){var i=t.findIdx(e);i<0?t.data.push({key:e<<1|1,val:n,keyName:r}):(1&t.data[i].key?o.decr(t.data[i].val):t.data[i].key=e<<1|1,t.data[i].val=n,t.data[i].keyName=r),o.decr(t)}}(h=s.pxtrt||(s.pxtrt={})),(f=s.pxtcore||(s.pxtcore={})).mkClassInstance=function(t){a(!!t.methods),a(!!t.refmask);for(var e=new u,n=(e.vtable=t).refmask.length,r=0;r<n;++r)e.fields.push(s.floatingPoint?void 0:0);return e},f.switch_eq=function(t,e){return t==e&&(f.decr(e),!0)},(m=s.thread||(s.thread={})).panic=h.panic,m.pause=function(t){var e=s.getResume();setTimeout(function(){e()},t)},m.runInBackground=function(t){s.runtime.runFiberAsync(t).done()},m.forever=function(e){h.nullCheck(e),y(e),function t(){s.runtime.runFiberAsync(e).then(function(){return Promise.delay(20)}).then(t).done()}()}}(pxsim||(pxsim={})),function(u){var t,e,n,r,o=function(e){function t(){var t=e.call(this)||this;return t.data=[],t}return __extends(t,e),t.prototype.toArray=function(){return this.data.slice(0)},t.prototype.toAny=function(){return this.data.map(function(t){return u.RefObject.toAny(t)})},t.prototype.toDebugString=function(){for(var t="[",e=0;e<this.data.length;++e)if(0<e&&(t+=","),15<(t+=u.RefObject.toDebugString(this.data[e])).length){t+="...";break}return t+="]"},t.prototype.destroy=function(){for(var t=this.data,e=0;e<t.length;++e)u.decr(t[e]),t[e]=0;this.data=[]},t.prototype.isValidIndex=function(t){return 0<=t&&t<this.data.length},t.prototype.push=function(t){this.data.push(t)},t.prototype.pop=function(){var t=this.data.pop();return null==t?0:t},t.prototype.getLength=function(){return this.data.length},t.prototype.setLength=function(t){this.data.length=t},t.prototype.getAt=function(t){return null!=this.data[t]?this.data[t]:0},t.prototype.setAt=function(t,e){this.data[t]=e},t.prototype.insertAt=function(t,e){this.data.splice(t,0,e)},t.prototype.removeAt=function(t){var e=this.data.splice(t,1);return null==e[0]?0:e[0]},t.prototype.indexOf=function(t,e){if(0!=t)return this.data.indexOf(t,e);for(var n=this.data.indexOf(t,e),r=-1,i=e;i<this.data.length;i++)if(null==this.data[i]){r=i;break}return n<r||-1==r?n:r},t.prototype.print=function(){},t}(u.RefObject);function i(t,e){var n=65535&t,r=65535&e;return n*r+((t>>>16&65535)*r+n*(e>>>16&65535)<<16>>>0)|0}u.RefCollection=o,function(t){function r(t,e){if(u.pxtrt.nullCheck(t),t.isValidIndex(e))return t.removeAt(e)}function i(t,e,n){return u.pxtrt.nullCheck(t),t.indexOf(e,n)}t.mk=function(){return new o},t.length=function(t){return u.pxtrt.nullCheck(t),t.getLength()},t.setLength=function(t,e){u.pxtrt.nullCheck(t),t.setLength(e)},t.push=function(t,e){u.pxtrt.nullCheck(t),u.incr(e),t.push(e)},t.pop=function(t,e){return u.pxtrt.nullCheck(t),t.pop()},t.getAt=function(t,e){u.pxtrt.nullCheck(t);var n=t.getAt(e);return u.incr(n),n},t.removeAt=r,t.insertAt=function(t,e,n){u.pxtrt.nullCheck(t),u.incr(n),t.insertAt(e,n)},t.setAt=function(t,e,n){u.pxtrt.nullCheck(t),t.isValidIndex(e)&&u.decr(t.getAt(e)),u.incr(n),t.setAt(e,n)},t.indexOf=i,t.removeElement=function(t,e){u.pxtrt.nullCheck(t);var n=i(t,e,0);return 0<=n?(r(t,n),1):0}}(u.Array_||(u.Array_={})),(t=u.Math_||(u.Math_={})).imul=function(t,e){return i(t,e)},t.idiv=function(t,e){return t/e>>0},t.round=function(t){return Math.round(t)},t.ceil=function(t){return Math.ceil(t)},t.floor=function(t){return Math.floor(t)},t.sqrt=function(t){return Math.sqrt(t)},t.pow=function(t,e){return u.floatingPoint?Math.pow(t,e):0|Math.pow(t,e)},t.clz32=function(t){return Math.clz32(t)},t.log=function(t){return Math.log(t)},t.log10=function(t){return Math.log10(t)},t.log2=function(t){return Math.log2(t)},t.exp=function(t){return Math.exp(t)},t.sin=function(t){return Math.sin(t)},t.sinh=function(t){return Math.sinh(t)},t.cos=function(t){return Math.cos(t)},t.cosh=function(t){return Math.cosh(t)},t.tan=function(t){return Math.tan(t)},t.tanh=function(t){return Math.tanh(t)},t.asin=function(t){return Math.asin(t)},t.asinh=function(t){return Math.asinh(t)},t.acos=function(t){return Math.acos(t)},t.acosh=function(t){return Math.acosh(t)},t.atan=function(t){return Math.atan(t)},t.atanh=function(t){return Math.atanh(t)},t.atan2=function(t,e){return Math.atan2(t,e)},t.trunc=function(t){return 0<t?Math.floor(t):Math.ceil(t)},t.random=function(){return Math.random()},t.randomRange=function(t,e){if(t==e)return t;if(e<t){var n=t;t=e,e=n}return Math.floor(t)==t&&Math.floor(e)==e?t+Math.floor(Math.random()*(e-t+1)):t+Math.random()*(e-t)},function(t){function n(t,e){return u.pxtrt.nullFix(t)==u.pxtrt.nullFix(e)}t.lt=function(t,e){return t<e},t.le=function(t,e){return t<=e},t.neq=function(t,e){return!n(t,e)},t.eq=n,t.eqDecr=function(t,e){return u.pxtrt.nullFix(t)==u.pxtrt.nullFix(e)&&(u.decr(e),!0)},t.gt=function(t,e){return e<t},t.ge=function(t,e){return e<=t},t.div=function(t,e){return 0|Math.floor(t/e)},t.mod=function(t,e){return t%e},t.bnot=function(t){return~t},t.toString=function(t){return u.initString(t+"")}}(u.Number_||(u.Number_={})),(e=u.thumb||(u.thumb={})).adds=function(t,e){return t+e|0},e.subs=function(t,e){return t-e|0},e.divs=function(t,e){return 0|Math.floor(t/e)},e.muls=function(t,e){return i(t,e)},e.ands=function(t,e){return t&e},e.orrs=function(t,e){return t|e},e.eors=function(t,e){return t^e},e.lsls=function(t,e){return t<<e},e.lsrs=function(t,e){return t>>>e},e.asrs=function(t,e){return t>>e},e.bnot=function(t){return~t},e.ignore=function(t){return t},function(t){function n(t){return t<<16>>16}t.adds=function(t,e){return n(t+e)},t.subs=function(t,e){return n(t-e)},t.divs=function(t,e){return n(Math.floor(t/e))},t.muls=function(t,e){return n(i(t,e))},t.ands=function(t,e){return n(t&e)},t.orrs=function(t,e){return n(t|e)},t.eors=function(t,e){return n(t^e)},t.lsls=function(t,e){return n(t<<e)},t.lsrs=function(t,e){return(65535&t)>>>e},t.asrs=function(t,e){return n(t>>e)},t.bnot=function(t){return~t},t.ignore=function(t){return t}}(u.avr||(u.avr={})),(n=u.String_||(u.String_={})).mkEmpty=function(){return""},n.fromCharCode=function(t){return u.initString(String.fromCharCode(t))},n.toNumber=function(t){return parseInt(t)},n.concat=function(t,e){return u.initString(t+e)},n.substring=function(t,e,n){return u.pxtrt.nullCheck(t),u.initString(t.slice(e,e+n))},n.equals=function(t,e){return t==e},n.compare=function(t,e){return t==e?0:t<e?-1:1},n.compareDecr=function(t,e){return t==e?(u.decr(e),0):t<e?-1:1},n.length=function(t){return t.length},n.isEmpty=function(t){return null==t||0==t.length},n.substr=function(t,e,n){return u.initString(t.substr(e,n))},n.charAt=function(t,e){return u.initString(t.charAt(e))},n.charCodeAt=function(t,e){return u.pxtrt.nullCheck(t),n=t,r=e,u.pxtrt.nullCheck(n),0<=r&&r<n.length?t.charCodeAt(e):0;var n,r},(r=u.Boolean_||(u.Boolean_={})).toString=function(t){return t?"true":"false"},r.bang=function(t){return!t};var p=function(n){function t(t){var e=n.call(this)||this;return e.data=t,e}return __extends(t,n),t.prototype.print=function(){},t}(u.RefObject);u.RefBuffer=p,function(t){var i,e;function l(t){var e=function(t){switch(t){case i.Int8LE:return-1;case i.UInt8LE:return 1;case i.Int16LE:return-2;case i.UInt16LE:return 2;case i.Int32LE:return-4;case i.UInt32LE:return 4;case i.Int8BE:return-10;case i.UInt8BE:return 10;case i.Int16BE:return-20;case i.UInt16BE:return 20;case i.Int32BE:return-40;case i.UInt32BE:return 40;case i.Float32LE:return 4;case i.Float32BE:return 40;case i.Float64LE:return 8;case i.Float64BE:return 80;default:throw u.U.userError("bad format")}}(t),n=!1;e<0&&(n=!0,e=-e);var r=!1;return 10<=e&&(r=!0,e/=10),{size:e,signed:n,swap:r,isFloat:t>=i.Float32LE}}function r(t){return new p(new Uint8Array(t))}function o(t,e){return 0<=e&&e<t.data.length}function s(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=-1),n<0||n>t.data.length||(r<0&&(r=t.data.length),r=Math.min(r,t.data.length-n),t.data.fill(e,n,n+r))}function a(t,e,n,r,i){if(n.buffer===t.buffer)a(t,e,n.slice(r,r+i),0,i);else for(var o=0;o<i;++o)t[e+o]=n[r+o]}(e=i=t.NumberFormat||(t.NumberFormat={}))[e.Int8LE=1]="Int8LE",e[e.UInt8LE=2]="UInt8LE",e[e.Int16LE=3]="Int16LE",e[e.UInt16LE=4]="UInt16LE",e[e.Int32LE=5]="Int32LE",e[e.Int8BE=6]="Int8BE",e[e.UInt8BE=7]="UInt8BE",e[e.Int16BE=8]="Int16BE",e[e.UInt16BE=9]="UInt16BE",e[e.Int32BE=10]="Int32BE",e[e.UInt32LE=11]="UInt32LE",e[e.UInt32BE=12]="UInt32BE",e[e.Float32LE=13]="Float32LE",e[e.Float64LE=14]="Float64LE",e[e.Float32BE=15]="Float32BE",e[e.Float64BE=16]="Float64BE",t.getNumber=function(t,e,n){var r=l(e);if(r.isFloat){var i=t.data.buffer.slice(n,n+r.size);return r.swap&&new Uint8Array(i).reverse(),4==r.size?new Float32Array(i)[0]:new Float64Array(i)[0]}for(var o=0,s=0;s<r.size;++s){o<<=8;var a=r.swap?n+s:n+r.size-s-1;o|=t.data[a]}if(r.signed){var u=32-8*r.size;o=o<<u>>u}else o>>>=0;return o},t.setNumber=function(t,e,n,r){var i=l(e);if(i.isFloat){var o=new Uint8Array(i.size);4==i.size?new Float32Array(o.buffer)[0]=r:new Float64Array(o.buffer)[0]=r,i.swap&&o.reverse();for(var s=0;s<i.size;++s)t.data[n+s]=o[s]}else for(s=0;s<i.size;++s){var a=i.swap?n+i.size-s-1:n+s;t.data[a]=255&r,r>>=8}},t.createBuffer=r,t.createBufferFromHex=function(t){for(var e=r(t.length>>1),n=0;n<t.length;n+=2)e.data[n>>1]=parseInt(t.slice(n,n+2),16);return e},t.getBytes=function(t){return t.data},t.getByte=function(t,e){return o(t,e)?t.data[e]:0},t.setByte=function(t,e,n){o(t,e)&&(t.data[e]=n)},t.length=function(t){return t.data.length},t.fill=s,t.slice=function(t,e,n){return e=Math.min(t.data.length,e),n<0&&(n=t.data.length),n=Math.min(n,t.data.length-e),new p(t.data.slice(e,e+n))},t.toHex=function(t){for(var e="0123456789abcdef",n="",r=0;r<t.data.length;++r)n+=e[t.data[r]>>4],n+=e[15&t.data[r]];return n};var c=-2147483648;t.shift=function(t,e,n,r){r<0&&(r=t.data.length-n),n<0||n+r>t.data.length||n+r<n||0==r||0==e||e==c||0!=r&&0!=e&&e!=c&&(e<=-r||r<=e?s(t,0):e<0?(e=-e,a(t.data,n+e,t.data,n,r-e),t.data.fill(0,n,n+e)):(r-=e,a(t.data,n,t.data,n+e,r),t.data.fill(0,n+r,n+r+e)))},t.rotate=function(t,e,n,r){if(r<0&&(r=t.data.length-n),!(n<0||n+r>t.data.length||n+r<n||0==r||0==e||e==c)){e<0&&(e+=r<<8),(e%=r)<0&&(e+=r);for(var i=t.data,o=e,s=0,a=o,u=r;s!=a;){var l=i[s+n];i[s+++n]=i[a+n],i[a+++n]=l,a==u?a=o:s==o&&(o=a)}}},t.write=function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=-1),i<0&&(i=n.data.length),r<0||e<0||e>t.data.length||(i=Math.min(n.data.length-r,t.data.length-e))<0||a(t.data,e,n.data,r,i)}}(u.BufferMethods||(u.BufferMethods={}))}(pxsim||(pxsim={})),function(t){var e,n;e=t.localization||(t.localization={}),n={},e.setLocalizedStrings=function(t){n=t||{}},e.lf=function(t){return n[t]||t}}(pxsim||(pxsim={})),function(pxsim){var U;function getResume(){return pxsim.runtime.getResume()}!function(t){function e(t){for(;t.firstChild;)t.removeChild(t.firstChild)}t.addClass=function(r,t){r&&t&&0!=t.length&&t.split(" ").forEach(function(t){var e,n;n=t,(e=r).classList?e.classList.add(n):e.className.indexOf(n)<0&&(e.className+=" "+n)})},t.removeClass=function(r,t){r&&t&&0!=t.length&&t.split(" ").forEach(function(t){var e,n;n=t,(e=r).classList?e.classList.remove(n):e.className=e.className.replace(n,"").replace(/\s{2,}/," ")})},t.remove=function(t){t.parentElement.removeChild(t)},t.removeChildren=e,t.clear=function(t){e(t)},t.assert=function(t,e){if(void 0===e&&(e="Assertion failed"),!t)throw new Error(e)},t.repeatMap=function(t,e){t=t||0;for(var n=[],r=0;r<t;++r)n.push(e(r));return n},t.userError=function(t){var e=new Error(t);throw e.isUserError=!0,e},t.now=function(){return Date.now()},t.nextTick=function(t){Promise._async._schedule(t)}}(U=pxsim.U||(pxsim.U={})),pxsim.getResume=getResume;var SERIAL_BUFFER_LENGTH=16,BaseBoard=function(){function t(){this.serialOutBuffer=""}return t.prototype.updateView=function(){},t.prototype.receiveMessage=function(t){},t.prototype.initAsync=function(t){return this.runOptions=t,Promise.resolve()},t.prototype.kill=function(){},t.prototype.writeSerial=function(t){t&&(this.serialOutBuffer+=t,(/\n/.test(this.serialOutBuffer)||this.serialOutBuffer.length>SERIAL_BUFFER_LENGTH)&&(Runtime.postMessage({type:"serial",data:this.serialOutBuffer,id:pxsim.runtime.id,sim:!0}),this.serialOutBuffer=""))},t}();pxsim.BaseBoard=BaseBoard;var CoreBoard=function(e){function t(){var t=e.call(this)||this;return t.id="b"+Math.round(2147483647*Math.random()),t.bus=new pxsim.EventBus(pxsim.runtime),t.updateSubscribers=[],t.updateView=function(){t.updateSubscribers.forEach(function(t){return t()})},t.builtinParts={},t.builtinVisuals={},t.builtinPartVisuals={},t}return __extends(t,e),t.prototype.kill=function(){e.prototype.kill.call(this),pxsim.AudioContextManager.stop()},t}(BaseBoard);pxsim.CoreBoard=CoreBoard;var BareBoard=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(BaseBoard);function initBareRuntime(){pxsim.runtime.board=new BareBoard;var t=pxsim;t.basic={pause:pxsim.thread.pause,showNumber:function(t){var e=getResume();console.log("SHOW NUMBER:",t),U.nextTick(e)}},t.serial={writeString:function(t){return pxsim.runtime.board.writeSerial(t)}},t.pins={createBuffer:pxsim.BufferMethods.createBuffer},t.control={inBackground:pxsim.thread.runInBackground}}pxsim.initBareRuntime=initBareRuntime;var EventQueue=function(){function t(t,e){this.runtime=t,this.valueToArgs=e,this.max=5,this.events=[],this.awaiters=[]}return t.prototype.push=function(t,e){if(0<this.awaiters.length)if(e){var n=this.awaiters.shift();n&&n()}else{var r=this.awaiters.slice();this.awaiters=[],r.forEach(function(t){return t()})}!this.handler||this.events.length>this.max||(this.events.push(t),1!=this.events.length||this.lock||this.poke())},t.prototype.poke=function(){var t=this;this.lock=!0;var e,n=this.events.shift();(e=this.runtime).runFiberAsync.apply(e,[this.handler].concat(this.valueToArgs?this.valueToArgs(n):[n])).done(function(){0<t.events.length?t.poke():t.lock=!1})},Object.defineProperty(t.prototype,"handler",{get:function(){return this._handler},set:function(t){this._handler&&pxsim.pxtcore.decr(this._handler),this._handler=t,this._handler&&pxsim.pxtcore.incr(this._handler)},enumerable:!0,configurable:!0}),t.prototype.addAwaiter=function(t){this.awaiters.push(t)},t}();function _leave(t,e){return t.parent.retval=e,t.finalCallback&&t.finalCallback(e),t.parent}function syntheticRefAction(e){return pxsim.pxtcore.mkAction(0,0,function(t){return _leave(t,e(t))})}pxsim.EventQueue=EventQueue,pxsim.initCurrentRuntime=void 0,pxsim.handleCustomMessage=void 0,pxsim.syntheticRefAction=syntheticRefAction;var Runtime=function(){function Runtime(msg){var _this=this;this.numGlobals=1e3,this.dead=!1,this.running=!1,this.startTime=0,this.globals={},this.loopLock=null,this.loopLockWaitList=[],this.refCountingDebug=!1,this.refCounting=!0,this.refObjId=1,this.liveRefObjs={},this.stringRefCounts={},this.numDisplayUpdates=0,U.assert(!!pxsim.initCurrentRuntime),this.id=msg.id,this.refCountingDebug=!!msg.refCountingDebug;var yieldMaxSteps=100,entryPoint,pxtrt=pxsim.pxtrt,breakpoints=null,breakAlways=!1,globals=this.globals,yieldSteps=yieldMaxSteps,currResume,dbgHeap,dbgResume,breakFrame=null,lastYield=Date.now(),__this=this,tracePauseMs=0;function oops(t){throw new Error("sim error: "+t)}function doNothing(t){return t.pc=-1,leave(t,t.parent.retval)}function flushLoopLock(){for(;0<__this.loopLockWaitList.length&&!__this.loopLock;){__this.loopLockWaitList.shift()()}}function maybeYield(t,e,n){yieldSteps=yieldMaxSteps;var r=Date.now();if(20<=r-lastYield){lastYield=r,t.pc=e,t.r0=n;var i=new Object;__this.loopLock=i;return setTimeout(function(){__this.dead||(U.assert(t.pc==e),U.assert(__this.loopLock===i),__this.loopLock=null,loop(t),flushLoopLock())},5),!0}return!1}function setupDebugger(t){breakpoints=new Uint8Array(t)}function isBreakFrame(t){if(!breakFrame)return!0;for(var e=breakFrame;e;e=e.parent)if(e==t)return!0;return!1}function breakpoint(e,n,t,r){U.assert(!dbgResume),U.assert(!dbgHeap),e.pc=n,e.r0=r;var i=pxsim.getBreakpointMsg(e,t),o=i.msg,s=i.heap;return dbgHeap=s,Runtime.postMessage(o),dbgResume=function(t){if(dbgHeap=dbgResume=null,!__this.dead){switch(pxsim.runtime=__this,U.assert(e.pc==n),breakAlways=!1,breakFrame=null,t.subtype){case"resume":break;case"stepover":breakAlways=!0,breakFrame=e;break;case"stepinto":breakAlways=!0;break;case"stepout":breakAlways=!0,breakFrame=e.parent||e}return loop(e)}},null}function trace(t,e,n,r){setupResume(e,n),"<main>"===r.functionName||"main.ts"===r.fileName?(Runtime.postMessage({type:"debugger",subtype:"trace",breakpointId:t}),pxsim.thread.pause(tracePauseMs)):pxsim.thread.pause(0),checkResumeConsumed()}function handleDebuggerMsg(t){switch(t.subtype){case"config":var e=t;if(e.setBreakpoints){breakpoints.fill(0);for(var n=0,r=e.setBreakpoints;n<r.length;n++){var i=r[n];breakpoints[i]=1}}break;case"traceConfig":tracePauseMs=t.interval;break;case"pause":breakAlways=!0,breakFrame=null;break;case"resume":case"stepover":case"stepinto":case"stepout":dbgResume&&dbgResume(t);break;case"variables":var o=void 0;if(dbgHeap){var s=dbgHeap[t.variablesReference];void 0!==s&&(o=pxsim.dumpHeap(s,dbgHeap))}Runtime.postMessage({type:"debugger",subtype:"variables",req_seq:t.seq,variables:o})}}function loop(e){if(__this.dead)console.log("Runtime terminated");else{U.assert(!__this.loopLock);try{for(pxsim.runtime=__this;e;)__this.currFrame=e,__this.currFrame.overwrittenPC=!1,e=e.fn(e),__this.maybeUpdateDisplay(),__this.currFrame.overwrittenPC&&(e=__this.currFrame)}catch(t){if(__this.errorHandler)__this.errorHandler(t);else{console.error("Simulator crashed, no error handler",t.stack);var n=pxsim.getBreakpointMsg(e,e.lastBrkId).msg;n.exceptionMessage=t.message,n.exceptionStack=t.stack,Runtime.postMessage(n),__this.postError&&__this.postError(t)}}}}function actionCall(t,e){return e&&(t.finalCallback=e),t.depth=t.parent.depth+1,1e3<t.depth&&U.userError("Stack overflow"),t.pc=0,t}var leave=_leave;function setupTop(t){var e=setupTopCore(t);return setupResume(e,0),e}function setupTopCore(t){var e={parent:null,pc:0,depth:0,fn:function(){return t&&t(e.retval),null}};return e}function topCall(t,e){U.assert(!!__this.board),U.assert(!__this.running),__this.setRunning(!0),loop(actionCall({parent:setupTopCore(e),fn:t,depth:0,pc:0}))}function checkResumeConsumed(){currResume&&oops("getResume() not called")}function setupResume(t,e){currResume=buildResume(t,e)}function buildResume(o,s){currResume&&oops("already has resume"),o.pc=s;var a=Date.now(),u=function(t){if(!__this.dead){if(!__this.loopLock){pxsim.runtime=__this;var e=Date.now();if(3<e-a&&(lastYield=e),U.assert(o.pc==s),t instanceof pxsim.FnWrapper){var n=t,r={parent:o,fn:n.func,lambdaArgs:[n.a0,n.a1,n.a2],pc:0,caps:n.caps,depth:o.depth+1,finalCallback:n.cb},i={};return __this.loopLock=i,U.nextTick(function(){U.assert(__this.loopLock===i),__this.loopLock=null,loop(actionCall(r)),flushLoopLock()})}return o.retval=t,loop(o)}__this.loopLockWaitList.push(function(){return u(t)})}};return u}eval(msg.code),this.refCounting=pxsim.refCounting,this.run=function(t){return topCall(entryPoint,t)},this.getResume=function(){currResume||oops("noresume");var t=currResume;return currResume=null,t},this.setupTop=setupTop,this.handleDebuggerMsg=handleDebuggerMsg,this.entry=entryPoint,this.overwriteResume=function(t){currResume=null,0<=t&&(_this.currFrame.pc=t),_this.currFrame.overwrittenPC=!0},pxsim.runtime=this,pxsim.initCurrentRuntime(msg)}return Runtime.prototype.registerLiveObject=function(t){var e=this.refObjId++;return this.refCounting&&(this.liveRefObjs[e+""]=t),e},Runtime.prototype.unregisterLiveObject=function(t,e){e||U.assert(0==t.refcnt,"ref count is not 0"),delete this.liveRefObjs[t.id+""]},Runtime.prototype.runningTime=function(){return U.now()-this.startTime},Runtime.prototype.runFiberAsync=function(n,r,i,o){var s=this;return pxsim.incr(n),new Promise(function(t,e){return U.nextTick(function(){(pxsim.runtime=s).setupTop(t),pxsim.pxtcore.runAction3(n,r,i,o),pxsim.decr(n)})})},Runtime.postMessage=function(t){t&&("undefined"!=typeof window&&window.parent&&window.parent.postMessage&&window.parent.postMessage(t,"*"),Runtime.messagePosted&&Runtime.messagePosted(t))},Runtime.prototype.kill=function(){this.dead=!0,this.setRunning(!1)},Runtime.prototype.updateDisplay=function(){this.board.updateView()},Runtime.prototype.queueDisplayUpdate=function(){this.numDisplayUpdates++},Runtime.prototype.maybeUpdateDisplay=function(){this.numDisplayUpdates&&(this.numDisplayUpdates=0,this.updateDisplay())},Runtime.prototype.setRunning=function(t){this.running!=t&&(this.running=t,this.running?(this.startTime=U.now(),Runtime.postMessage({type:"status",runtimeid:this.id,state:"running"})):Runtime.postMessage({type:"status",runtimeid:this.id,state:"killed"}),this.stateChanged&&this.stateChanged())},Runtime.prototype.dumpLivePointers=function(){var n=this;if(this.refCounting&&this.refCountingDebug){var t=Object.keys(this.liveRefObjs),e=Object.keys(this.stringRefCounts);console.log("Live objects: "+t.length+" objects, "+e.length+" strings"),t.forEach(function(t){return n.liveRefObjs[t].print()}),e.forEach(function(t){var e=n.stringRefCounts[t];console.log("Live String:",JSON.stringify(t),"refcnt=",e)})}},Runtime}();pxsim.Runtime=Runtime}(pxsim||(pxsim={})),function(i){var o,t,n,e;(t=o=i.SimulatorState||(i.SimulatorState={}))[t.Unloaded=0]="Unloaded",t[t.Stopped=1]="Stopped",t[t.Running=2]="Running",t[t.Paused=3]="Paused",(e=n=i.SimulatorDebuggerCommand||(i.SimulatorDebuggerCommand={}))[e.StepInto=0]="StepInto",e[e.StepOver=1]="StepOver",e[e.StepOut=2]="StepOut",e[e.Resume=3]="Resume",e[e.Pause=4]="Pause";var r=function(){function t(t,e){void 0===e&&(e={}),this.container=t,this.options=e,this.themes=["blue","red","green","yellow"],this.runId="",this.nextFrameId=0,this.frameCounter=0,this.traceInterval=0,this.runOptions={},this.state=o.Unloaded,this.frameCleanupTimeout=0,this.debuggerSeq=1,this.debuggerResolvers={}}return t.prototype.setHwDebugger=function(t){t?(this.hwdbg=t,this.setState(o.Running),this.container.style.opacity="0.3"):(delete this.container.style.opacity,this.hwdbg=null,this.setState(o.Running),this.stop())},t.prototype.handleHwDebuggerMsg=function(t){this.hwdbg&&this.handleMessage(t)},t.prototype.setThemes=function(t){i.U.assert(t&&0<t.length),this.themes=t},t.prototype.setState=function(t){this.state!=t&&(this.state=t,this.freeze(this.state==o.Paused),this.options.onStateChanged&&this.options.onStateChanged(this.state))},t.prototype.freeze=function(t){var n="pause-overlay";t?i.util.toArray(this.container.querySelectorAll("div.simframe")).forEach(function(t){if(!t.querySelector("div."+n)){var e=document.createElement("div");e.className=n,e.onclick=function(t){return t.preventDefault(),!1},t.appendChild(e)}}):i.util.toArray(this.container.querySelectorAll("div.simframe div."+n)).forEach(function(t){return t.parentElement.removeChild(t)})},t.prototype.postMessage=function(t,e){if(this.hwdbg)this.hwdbg.postMessage(t);else{var n=this.container.getElementsByTagName("iframe");!e||"eventbus"!==t.type&&"radiopacket"!=t.type&&"irpacket"!=t.type||(n.length<2?(this.container.appendChild(this.createFrame()),n=this.container.getElementsByTagName("iframe")):n[1].dataset.runid!=this.runId&&this.startFrame(n[1]));for(var r=0;r<n.length;++r){var i=n[r];e&&i.contentWindow==e||i.contentWindow.postMessage(t,"*")}}},t.prototype.createFrame=function(t){var e=document.createElement("div");e.className="simframe";var n=document.createElement("iframe");n.id="sim-frame-"+this.nextId(),n.allowFullscreen=!0,n.setAttribute("allow","autoplay"),n.setAttribute("sandbox","allow-same-origin allow-scripts"),n.sandbox.value="allow-scripts allow-same-origin";var r=this.options.simUrl||(window.pxtConfig||{}).simUrl||"/sim/simulator.html";return n.className="no-select",this.runOptions.aspectRatio&&(e.style.paddingBottom=100/this.runOptions.aspectRatio+"%"),n.src=r+"#"+n.id,n.frameBorder="0",n.dataset.runid=this.runId,e.appendChild(n),e},t.prototype.stop=function(t){if(void 0===t&&(t=!1),this.clearDebugger(),this.postMessage({type:"stop"}),this.setState(o.Stopped),t)this.unload();else{for(var e=this.container.getElementsByTagName("iframe"),n=0;n<e.length;++n){var r=e[n];i.U.addClass(r,this.getStoppedClass())}this.scheduleFrameCleanup()}},t.prototype.unload=function(){this.cancelFrameCleanup(),i.U.removeChildren(this.container),this.setState(o.Unloaded)},t.prototype.mute=function(t){this.postMessage({type:"mute",mute:t})},t.prototype.cancelFrameCleanup=function(){this.frameCleanupTimeout&&(clearTimeout(this.frameCleanupTimeout),this.frameCleanupTimeout=0)},t.prototype.scheduleFrameCleanup=function(){var t=this;this.cancelFrameCleanup(),this.frameCleanupTimeout=setTimeout(function(){t.frameCleanupTimeout=0,t.cleanupFrames()},5e3)},t.prototype.applyAspectRatio=function(){for(var t=this.container.getElementsByTagName("iframe"),e=0;e<t.length;++e)t[e].parentElement.style.paddingBottom=100/this.runOptions.aspectRatio+"%"},t.prototype.cleanupFrames=function(){for(var t=this.container.getElementsByTagName("iframe"),e=1;e<t.length;++e){var n=t[e];this.state!=o.Stopped&&n.dataset.runid==this.runId||(this.options.removeElement?this.options.removeElement(n.parentElement):n.parentElement.remove())}},t.prototype.hide=function(t){if(this.options.removeElement){for(var e=this.container.getElementsByTagName("iframe"),n=0;n<e.length;++n){var r=e[n];this.options.removeElement(r.parentElement,t)}0==e.length&&t&&t()}},t.prototype.unhide=function(){if(this.options.unhideElement)for(var t=this.container.getElementsByTagName("iframe"),e=0;e<t.length;++e){var n=t[e];this.options.unhideElement(n.parentElement)}},t.prototype.run=function(t,e){void 0===e&&(e={}),this.clearDebugger(),this.runOptions=e,this.runId=this.nextId(),this.addEventListeners(),this.currentRuntime={type:"run",boardDefinition:e.boardDefinition,parts:e.parts,fnArgs:e.fnArgs,code:t,partDefinitions:e.partDefinitions,mute:e.mute,highContrast:e.highContrast,light:e.light,cdnUrl:e.cdnUrl,localizedStrings:e.localizedStrings,refCountingDebug:e.refCountingDebug,version:e.version},this.applyAspectRatio(),this.scheduleFrameCleanup();var n=this.container.getElementsByTagName("iframe").item(0);if(n)this.startFrame(n);else{var r=this.createFrame(e.light);this.container.appendChild(r),n=r.firstElementChild}this.setState(o.Running),this.setTraceInterval(this.traceInterval)},t.prototype.startFrame=function(t){var e=JSON.parse(JSON.stringify(this.currentRuntime)),n="",r=/player=([A-Za-z0-9]+)/i.exec(window.location.href);r&&(n=r[1]),e.frameCounter=++this.frameCounter,e.options={theme:this.themes[this.nextFrameId++%this.themes.length],player:n},e.id=e.options.theme+"-"+this.nextId(),t.dataset.runid=this.runId,t.contentWindow.postMessage(e,"*"),i.U.removeClass(t,this.getStoppedClass())},t.prototype.removeEventListeners=function(){this.listener&&(window.removeEventListener("message",this.listener,!1),this.listener=void 0)},t.prototype.handleMessage=function(t,e){switch(t.type||""){case"ready":var n=t.frameid,r=document.getElementById(n);r&&(this.startFrame(r),this.options.revealElement&&this.options.revealElement(r));break;case"simulator":this.handleSimulatorCommand(t);break;case"serial":break;case"pxteditor":case"custom":break;case"debugger":this.handleDebuggerMessage(t);break;case"toplevelcodefinished":this.options.onTopLevelCodeEnd&&this.options.onTopLevelCodeEnd();break;default:"radiopacket"==t.type&&(t.rssi=10),this.postMessage(t,e)}},t.prototype.addEventListeners=function(){var e=this;this.listener||(this.listener=function(t){e.hwdbg||e.handleMessage(t.data,t.source)},window.addEventListener("message",this.listener,!1))},t.prototype.resume=function(t){var e;switch(t){case n.Resume:e="resume",this.setState(o.Running);break;case n.StepInto:e="stepinto",this.setState(o.Running);break;case n.StepOut:e="stepout",this.setState(o.Running);break;case n.StepOver:e="stepover",this.setState(o.Running);break;case n.Pause:e="pause";break;default:return void console.debug("unknown command")}this.postMessage({type:"debugger",subtype:e})},t.prototype.setBreakpoints=function(t){this.postDebuggerMessage("config",{setBreakpoints:t})},t.prototype.setTraceInterval=function(t){this.traceInterval=t,this.postDebuggerMessage("traceConfig",{interval:t})},t.prototype.variablesAsync=function(t){return this.postDebuggerMessageAsync("variables",{variablesReference:t}).then(function(t){return t},function(t){})},t.prototype.handleSimulatorCommand=function(t){this.options.onSimulatorCommand&&this.options.onSimulatorCommand(t)},t.prototype.clearDebugger=function(){var e=this,n=new Error("Debugging cancelled");Object.keys(this.debuggerResolvers).forEach(function(t){(0,e.debuggerResolvers[t].reject)(n)}),this.debuggerResolvers={},this.debuggerSeq++},t.prototype.handleDebuggerMessage=function(t){("trace"!==t.subtype&&console.log("DBG-MSG",t.subtype,t),t.seq)&&((n=this.debuggerResolvers[t.seq].resolve)&&n(t));switch(t.subtype){case"warning":this.options.onDebuggerWarning&&this.options.onDebuggerWarning(t);break;case"breakpoint":var e=t;this.state==o.Running?(e.exceptionMessage?this.stop():this.setState(o.Paused),this.options.onDebuggerBreakpoint&&this.options.onDebuggerBreakpoint(e)):console.error("debugger: trying to pause from "+this.state);break;case"trace":this.options.onTraceMessage&&this.options.onTraceMessage(t);break;default:var n,r=t.req_seq;if(r)(n=this.debuggerResolvers[r].resolve)&&(delete this.debuggerResolvers[r],n(t))}},t.prototype.postDebuggerMessageAsync=function(r,i){var o=this;return void 0===i&&(i={}),new Promise(function(t,e){var n=o.debuggerSeq++;o.debuggerResolvers[n.toString()]={resolve:t,reject:e},o.postDebuggerMessage(r,i,n)})},t.prototype.postDebuggerMessage=function(t,e,n){void 0===e&&(e={});var r=JSON.parse(JSON.stringify(e));r.type="debugger",r.subtype=t,n&&(r.seq=n),this.postMessage(r)},t.prototype.nextId=function(){return this.nextFrameId+++(Math.random()+""+Math.random()).replace(/[^\d]/,"")},t.prototype.getStoppedClass=function(){return this.options&&this.options.stoppedClass?this.options.stoppedClass:"grayscale"},t}();i.SimulatorDriver=r}(pxsim||(pxsim={})),function(o){o.mkRange=function(t,e){for(var n=[];t<e;t++)n.push(t);return n};var t=function(){function t(t,e){this.runtime=t,this.valueToArgs=e,this.queues={},this.nextNotifyEvent=1024}return t.prototype.setNotify=function(t,e){this.notifyID=t,this.notifyOneID=e},t.prototype.start=function(t,e,n){var r=t+":"+e,i=this.queues[r];return i||(i=this.queues[r]=new o.EventQueue(this.runtime,this.valueToArgs)),i},t.prototype.listen=function(t,e,n){this.start(t,e,!0).handler=n},t.prototype.queue=function(t,e,n){void 0===n&&(n=null);var r=this.notifyID&&this.notifyOneID&&t==this.notifyOneID;r&&(t=this.notifyID);var i=this.start(t,e,!1);i&&i.push(n,r)},t.prototype.wait=function(t,e,n){this.start(t,e,!0).addAwaiter(n)},t}(),e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o.EventBusGeneric=t);o.EventBus=e;var n=function(){function t(n){var r=this;this.runtime=n,this.queue=[],this.process=function(){var t=r.queue[0];if(t&&!r.runtime.dead){n=r.runtime;var e=t.frame();n.queueDisplayUpdate(),n.maybeUpdateDisplay(),!1===e?(r.queue.shift(),r.queue[0]&&(r.queue[0].setTimeoutHandle=setTimeout(r.process,r.queue[0].interval)),t.whenDone(!1)):t.setTimeoutHandle=setTimeout(r.process,t.interval)}}}return t.prototype.cancelAll=function(){var t=this.queue;this.queue=[];for(var e=0,n=t;e<n.length;e++){var r=n[e];r.whenDone(!0),r.setTimeoutHandle&&clearTimeout(r.setTimeoutHandle)}},t.prototype.cancelCurrent=function(){var t=this.queue[0];t&&(this.queue.shift(),t.whenDone(!0),t.setTimeoutHandle&&clearTimeout(t.setTimeoutHandle))},t.prototype.enqueue=function(t){t.whenDone||(t.whenDone=function(){}),this.queue.push(t),1==this.queue.length&&this.process()},t.prototype.executeAsync=function(n){var r=this;return o.U.assert(!n.whenDone),new Promise(function(t,e){n.whenDone=t,r.enqueue(n)})},t}();function r(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function i(){return"undefined"!=typeof window&&!!window.PointerEvent}o.AnimationQueue=n,function(t){var e,r,i,o,s=0,a=!1;function u(){return e||(e=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(t){}return}()),e}function n(){i&&(i.gain.value=0),s=0,o&&o.pause()}t.mute=function(t){a=t,n()},t.stop=n,t.frequency=function(){return s},t.tone=function(t,e){if(!(a||t<=0)){s=t;var n=u();if(n){r&&(r.stop(),r.disconnect(),r=void 0),e=Math.max(0,Math.min(1,e));try{r=n.createOscillator(),i=n.createGain(),r.type="triangle",r.connect(i),i.connect(n.destination),i.gain.value=e,r.start(0)}catch(t){return void(i=r=void 0)}r.frequency.value=t,i.gain.value=e}}},t.playBufferAsync=function(r){return r?new Promise(function(t){function e(){t&&t(),t=void 0}var n="data:audio/wav;base64,"+window.btoa(function(t){for(var e=t.length,n="",r=0;r<e;++r)n+=String.fromCharCode(t[r]);return n}(r.data));o=new Audio(n),a&&(o.volume=0),o.onended=function(){return e()},o.onpause=function(){return e()},o.onerror=function(){return e()},o.play()}):Promise.resolve()}}(o.AudioContextManager||(o.AudioContextManager={})),o.isTouchEnabled=r,o.hasPointerEvents=i,o.pointerEvents=i()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:r()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"}}(pxsim||(pxsim={})),function(P){!function(e){function o(e,n){return function(t){return t*(n/e)}}function n(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}e.translateEl=function(t,e){P.svg.hydrate(t,{transform:"translate("+e[0]+" "+e[1]+")"})},e.composeSVG=function(t){var e=[t.el1,t.el2],n=e[0],r=e[1];P.U.assert(0==n.x&&0==n.y&&0==r.x&&0==r.y,"el1 and el2 x,y offsets not supported");var i=function(t,e,n){return P.svg.hydrate(t,{x:e,y:n})},o=function(t,e,n){return P.svg.hydrate(t,{width:e+"px",height:n+"px"})},s=t.scaleUnit2,a=t.scaleUnit2/t.scaleUnit1,u=n.w*a,l=n.h*a;o(n.el,u,l);var c=1*r.w,p=1*r.h;o(r.el,c,p);var d=t.margin,h=d[0],f=d[1],m=d[2],g=d[3],v=t.middleMargin,b=Math.max(u,c),y=f+(b-u)/2,w=h;i(n.el,y,w);var x=f+(b-c)/2,C=w+l+v;i(r.el,x,C);var R,k,E,D=[w,w+l,C,C+p],I=f+b+g,_=h+l+v+p+m,S=P.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+I+" "+_,class:"sim-bb"});R=S,k=t.maxWidth,E=t.maxHeight,k&&P.svg.hydrate(R,{width:k}),E&&P.svg.hydrate(R,{height:E}),i(S,0,0);var B=P.svg.child(S,"g");return S.appendChild(n.el),S.appendChild(r.el),{under:B,over:P.svg.child(S,"g"),host:S,edges:D,scaleUnit:s,toHostCoord1:function(t){var e=t[0],n=t[1];return[e*a+y,n*a+w]},toHostCoord2:function(t){var e=t[0],n=t[1];return[1*e+x,1*n+C]}}},e.mkScaleFn=o,e.mkImageSVG=function(t){var e=o(t.imageUnitDist,t.targetUnitDist),n=e(t.width),r=e(t.height),i=P.svg.elt("image",{width:n,height:r});return i.setAttributeNS("http://www.w3.org/1999/xlink","href",""+t.image),{el:i,w:n,h:r,x:0,y:0}},e.findDistSqrd=n,e.findClosestCoordIdx=function(e,t){return t.map(function(t){return n(e,t)}).reduce(function(t,e,n,r){return e<r[t]?n:t},0)},e.mkTxt=function(t,e,n,r,i,o,s){var a=P.svg.elt("text");s=s||.3;var u=(o=o||-.33333)*n*i.length,l=s*n;return P.svg.hydrate(a,{style:"font-size:"+n+"px;",transform:"translate("+t+" "+e+") rotate("+r+") translate("+u+" "+l+")"}),P.svg.addClass(a,"noselect"),a.textContent=i,a},e.GPIO_WIRE_COLORS=["pink","orange","yellow","green","purple"],e.WIRE_COLOR_MAP={black:"#514f4d",white:"#fcfdfc",gray:"#acabab",purple:"#a772a1",blue:"#01a6e8",green:"#3cce73",yellow:"#ece600",orange:"#fdb262",red:"#f44f43",brown:"#c89764",pink:"#ff80fa"},e.mapWireColor=function(t){return e.WIRE_COLOR_MAP[t]||t},e.PIN_DIST=15,e.rgbToHsl=function(t){var e,n,r,i=[t[0]/255,t[1]/255,t[2]/255],o=i[0],s=i[1],a=i[2],u=Math.min(o,s,a),l=Math.max(o,s,a),c=l-u,p=l+u;return r=p/2*100,0===c?n=e=0:(l===o?e=(s-a)/c%6*60:l===s?e=60*((a-o)/c+2):l===a&&(e=60*((o-s)/c+4)),n=50<r?c/(2-p)*100:c/p*100),[Math.floor(e),Math.floor(n),Math.floor(r)]}}(P.visuals||(P.visuals={}))}(pxsim||(pxsim={})),function(a){var s;!function(t){function o(t,e,n){var r={class:t,d:e};n&&(r.title=n);var i=s.elt("path");return s.hydrate(i,r),i}function i(t,e){void 0===e&&(e=!1);var n=s.elt("linearGradient");s.hydrate(n,{id:t,x1:"0%",y1:"0%",x2:e?"100%":"0%",y2:e?"0%":"100%"});s.child(n,"stop",{offset:"0%"}),s.child(n,"stop",{offset:"100%"}),s.child(n,"stop",{offset:"100%"}),s.child(n,"stop",{offset:"100%"});return n}function r(t){var e=s.elt("title");return e.textContent=t,e}t.parseString=function(t){return(new DOMParser).parseFromString(t,"image/svg+xml").getElementsByTagName("svg").item(0)},t.toDataUri=function(t){return"data:image/svg+xml,"+encodeURI(t)},t.cursorPoint=function(t,e,n){return t.x=n.clientX,t.y=n.clientY,t.matrixTransform(e.getScreenCTM().inverse())},t.rotateElement=function(t,e,n,r){t.setAttribute("transform","translate("+e+","+n+") rotate("+(r+90)+") translate("+-e+","+-n+")")},t.hasClass=function(t,e){return t.classList?t.classList.contains(e):-1<t.className.baseVal.indexOf(e)},t.addClass=function(t,e){t.classList?t.classList.add(e):t.className.baseVal.indexOf(e)<0&&(t.className.baseVal+=" "+e)},t.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className.baseVal=t.className.baseVal.replace(e,"").replace(/\s{2,}/," ")},t.hydrate=function(t,e){for(var n in e)"title"==n?s.title(t,e[n]):t.setAttributeNS(null,n,e[n])},t.elt=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&s.hydrate(n,e),n},t.child=function(t,e,n){var r=s.elt(e,n);return t.appendChild(r),r},t.mkPath=o,t.path=function(t,e,n,r){var i=o(e,n,r);return t.appendChild(i),i},t.fill=function(t,e){t.style.fill=e},t.filter=function(t,e){t.style.filter=e},t.fills=function(t,e){t.forEach(function(t){return t.style.fill=e})},t.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},t.onClick=function(e,n){var r=!1;a.pointerEvents.down.forEach(function(t){return e.addEventListener(t,function(t){return r=!0},!1)}),e.addEventListener(a.pointerEvents.up,function(t){return!r||(r=!1,n(t),t.preventDefault(),!1)},!1)},t.buttonEvents=function(e,n,r,i,o){var s=!1;a.pointerEvents.down.forEach(function(t){return e.addEventListener(t,function(t){return s=!0,r&&r(t),!0},!1)}),e.addEventListener(a.pointerEvents.move,function(t){return!s||(n&&n(t),t.preventDefault(),!1)},!1),e.addEventListener(a.pointerEvents.up,function(t){s=!1,i&&i(t)},!1),e.addEventListener(a.pointerEvents.leave,function(t){s=!1,i&&i(t)},!1),e.addEventListener("keydown",function(t){s=!1,o&&o(t)})},t.mkLinearGradient=i,t.linearGradient=function(t,e,n){void 0===n&&(n=!1);var r=i(e,n);return t.appendChild(r),r},t.setGradientColors=function(t,e,n){t&&(t.childNodes[0].style.stopColor=e,t.childNodes[1].style.stopColor=e,t.childNodes[2].style.stopColor=n,t.childNodes[3].style.stopColor=n)},t.setGradientValue=function(t,e){t.childNodes[1].getAttribute("offset")!=e&&(t.childNodes[1].setAttribute("offset",e),t.childNodes[2].setAttribute("offset",e))},t.animate=function(t,e){s.addClass(t,e);var n=t.parentElement;n&&(n.removeChild(t),n.appendChild(t))},t.mkTitle=r,t.title=function(t,e){var n=r(e);return t.appendChild(n),n},t.toHtmlColor=function(t){return"rgba("+(t>>16&255)+", "+(t>>8&255)+", "+(255&t)+", "+(t>>24&1)+")"}}(s=a.svg||(a.svg={}))}(pxsim||(pxsim={})),function(t){var e=function(t){this.id=t};t.Button=e;var n=function(t){this.props=t,this.usesButtonAB=!1,this.aBtn=new e(this.props.ID_BUTTON_A),this.bBtn=new e(this.props.ID_BUTTON_B),this.abBtn=new e(this.props.ID_BUTTON_AB),this.abBtn.virtual=!0};t.ButtonPairState=n}(pxsim||(pxsim={})),function(t){var e=function(){this.usesHeading=!1,this.heading=90};(pxsim||(pxsim={})).CompassState=e}(),function(t){var e=function(){function t(){this.files={}}return t.prototype.append=function(t,e){this.files[t]=(this.files[t]||"")+e},t.prototype.remove=function(t){delete this.files[t]},t}();t.FileSystemState=e}(pxsim||(pxsim={})),function(t){var e=function(){this.usesLightLevel=!1,this.lightLevel=128};(pxsim||(pxsim={})).LightSensorState=e}(),function(t){var p,e;(e=p=t.NeoPixelMode||(t.NeoPixelMode={}))[e.RGB=0]="RGB",e[e.RGBW=1]="RGBW";var n=function(){function t(){this.buffers={},this.colors={},this.dirty={}}return t.prototype.updateBuffer=function(t,e){this.buffers[e]=t,this.dirty[e]=!0},t.prototype.getColors=function(t,e){var n=this.colors[t]||(this.colors[t]=[]);if(this.dirty[t]){var r=this.buffers[t]||(this.buffers[t]=new Uint8Array([]));this.readNeoPixelBuffer(r,n,e),this.dirty[t]=!1}return n},t.prototype.readNeoPixelBuffer=function(t,e,n){for(var r=t,i=n===p.RGBW?4:3,o=Math.floor(r.length/i),s=0;s<o;s++){var a=r[s*i+1],u=r[s*i+0],l=r[s*i+2],c=0;4===i&&(c=r[s*i+3]),e[s]=[a,u,l,c]}},t}();t.NeoPixelState=n}(pxsim||(pxsim={})),function(h){!function(d){d.mkBoardView=function(t){var e=t.visual;return new d.GenericBoardSvg({visualDef:e,wireframe:t.wireframe})};var t=function(){function t(t,e){var n=this;this.parts=[],this.boardView=t,(this.opts=e).boardDef.pinStyles||(e.boardDef.pinStyles={}),this.state=e.state;var r=e.partsList;if(0<r.length||e.forceBreadboardLayout){this.breadboard=new d.Breadboard({wireframe:e.wireframe});var i=e.boardDef.marginWhenBreadboarding||[0,0,40,0],o=d.composeSVG({el1:this.boardView.getView(),scaleUnit1:this.boardView.getPinDist(),el2:this.breadboard.getSVGAndSize(),scaleUnit2:this.breadboard.getPinDist(),margin:[i[0],i[1],20,i[3]],middleMargin:i[2],maxWidth:e.maxWidth,maxHeight:e.maxHeight}),s=o.under,a=o.over;this.view=o.host;var u=o.edges;this.fromMBCoord=o.toHostCoord1,this.fromBBCoord=o.toHostCoord2;o.scaleUnit;this.partGroup=a,this.partOverGroup=h.svg.child(this.view,"g"),this.style=h.svg.child(this.view,"style",{}),this.defs=h.svg.child(this.view,"defs",{}),this.wireFactory=new d.WireFactory(s,a,u,this.style,this.getLocCoord.bind(this),this.getPinStyle.bind(this));var l=h.allocateDefinitions({boardDef:e.boardDef,partDefs:e.partDefs,fnArgs:e.fnArgs,getBBCoord:this.breadboard.getCoord.bind(this.breadboard),partsList:r});this.addAll(l),l.requiresBreadboard||e.forceBreadboardRender||this.breadboard.hide()}else{var c=this.boardView.getView().el;this.view=c,this.partGroup=h.svg.child(this.view,"g"),this.partOverGroup=h.svg.child(this.view,"g"),e.maxWidth&&h.svg.hydrate(this.view,{width:e.maxWidth}),e.maxHeight&&h.svg.hydrate(this.view,{height:e.maxHeight})}this.state.updateSubscribers.push(function(){return n.updateState()})}return t.prototype.highlightBoardPin=function(t){this.boardView.highlightPin(t)},t.prototype.highlightBreadboardPin=function(t){this.breadboard.highlightLoc(t)},t.prototype.highlightWire=function(t){t.wires.forEach(function(t){h.svg.addClass(t,"highlight"),t.style.visibility="visible"}),h.svg.addClass(t.endG,"highlight")},t.prototype.getView=function(){return this.view},t.prototype.updateState=function(){this.parts.forEach(function(t){return t.updateState()})},t.prototype.getBBCoord=function(t){var e=this.breadboard.getCoord(t);return this.fromBBCoord(e)},t.prototype.getPinCoord=function(t){var e=this.boardView.getCoord(t);return h.U.assert(!!e,"Unable to find coord for pin: "+t),this.fromMBCoord(e)},t.prototype.getLocCoord=function(t){var e;if("breadboard"===t.type){var n=t;e=this.getBBCoord(n)}else{var r=t.pin;e=this.getPinCoord(r)}return e||(console.error("Unknown location: "+name),[0,0])},t.prototype.getPinStyle=function(t){return"breadboard"==t.type?"female":this.opts.boardDef.pinStyles[t.pin]||"female"},t.prototype.addPart=function(t){var e=this,n=null;if(t.simulationBehavior){var r=t.simulationBehavior,i=this.state.builtinVisuals[r],o=this.state.builtinParts[r];(n=i()).init(this.state.bus,o,this.view,t.params)}else{var s=t.visual;n=new d.GenericPart(s)}this.parts.push(n),this.partGroup.appendChild(n.element),n.overElement&&this.partOverGroup.appendChild(n.overElement),n.defs&&n.defs.forEach(function(t){return e.defs.appendChild(t)}),this.style.textContent+=n.style||"";var a=t.startColumnIdx,u=t.startRowIdx,l={type:"breadboard",row:d.getRowName(u),col:d.getColumnName(a),xOffset:t.bbFit.xOffset/t.visual.pinDistance,yOffset:t.bbFit.yOffset/t.visual.pinDistance},c=this.getBBCoord(l);n.moveToCoord(c);var p="sim-"+t.name+"-cmp";return h.svg.addClass(n.element,p),h.svg.addClass(n.element,"sim-cmp"),n.updateTheme(),n.updateState(),n},t.prototype.addWire=function(t){return this.wireFactory.addWire(t.start,t.end,t.color)},t.prototype.addAll=function(t){var r=this;t.partsAndWires.forEach(function(t){var e=t.part;e&&r.addPart(e);var n=t.wires;n&&n.forEach(function(t){return r.addWire(t)})})},t}();d.BoardHost=t}(h.visuals||(h.visuals={}))}(pxsim||(pxsim={})),function(Z){!function(B){B.BREADBOARD_MID_ROWS=10,B.BREADBOARD_MID_COLS=30;var P=[4,4],t=B.BREADBOARD_MID_ROWS+P.length,A=[4,9,14,19],e=25+A.length,M=15*(B.BREADBOARD_MID_COLS+3),T=15*(t+4+5.5),L=T*(2/3),O=T*(.5*(1-2/3)),n=15*(B.BREADBOARD_MID_COLS-1),q=(M-n)/2,N=O+(L-15*(t-1))/2,F=15*(e-1),U=(M-F)/2,V=(O-15)/2,W=U,G=V+O+L,r=1.3,i=6,o=2,l=1.3,j=-90,s="abcdefghij".split("").reverse();function H(t){return""+(t+1)}function z(t){return s[t]}function J(f){for(var m=f.xOffset||0,r=f.yOffset||0,g=[],v=Z.svg.elt("g"),b=f.colStartIdx||0,i=f.rowStartIdx||0,o=function(t){return t?t.slice(0,t.length):[]},y=function(t,e){for(var n,r=0;0<=(n=t.indexOf(e));)t.splice(n,1),r+=1;return r},s=0,a=o(f.rowIdxsWithGap),t=function(t){for(var c=0,p=o(f.colIdxsWithGap),d=r+t*f.pinDist+s*f.pinDist,h=t+i,e=function(t){var r=m+t*f.pinDist+c*f.pinDist,e=t+b,n=function(t){var e=r-.5*t.w,n=d-.5*t.h;return Z.svg.hydrate(t.el,{x:e,y:n}),v.appendChild(t.el),t.el},i=n(f.mkPin()),o=n(f.mkHoverPin()),s=f.getRowName(h),a=f.getColName(e),u=f.getGroupName?f.getGroupName(h,e):null,l={el:i,hoverEl:o,cx:r,cy:d,row:s,col:a,group:u};g.push(l),c+=y(p,e)},n=0;n<f.colCount;n++)e(n);s+=y(a,h)},e=0;e<f.rowCount;e++)t(e);return{g:v,allPins:g}}function Y(){var t=Z.svg.elt("rect"),e=i;return Z.svg.hydrate(t,{class:"sim-bb-pin",rx:o,ry:o,width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}}function K(){var t=Z.svg.elt("rect"),e=i*r;return Z.svg.hydrate(t,{class:"sim-bb-pin-hover",rx:o,ry:o,width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}}function Q(t,e,n,r,i,o,s){var a=B.mkTxt(t,e,n,r,i);Z.svg.addClass(a,"sim-bb-label"),s&&s.forEach(function(t){return Z.svg.addClass(a,t)});var u=B.mkTxt(t,e,n*l,r,i);return Z.svg.addClass(u,"sim-bb-label-hover"),s&&s.forEach(function(t){return Z.svg.addClass(u,t)}),{el:a,hoverEl:u,txt:i,group:o}}B.getColumnName=H,B.getRowName=z,B.mkGrid=J;var a=function(){function t(t){this.allPins=[],this.allLabels=[],this.allPowerBars=[],this.rowColToPin={},this.rowColToLbls={},this.buildDom(),t.wireframe&&Z.svg.addClass(this.bb,"sim-bb-outline")}return t.prototype.hide=function(){this.bb.style.display="none"},t.prototype.updateLocation=function(t,e){Z.svg.hydrate(this.bb,{x:t+"px",y:e+"px"})},t.prototype.getPin=function(t,e){var n=this.rowColToPin[t];if(!n)return null;var r=n[e];return r||null},t.prototype.getCoord=function(t){var e=t.row,n=t.col,r=t.xOffset,i=t.yOffset,o=this.getPin(e,n);if(!o)return null;var s=15*(r||0),a=15*(i||0);return[o.cx+s,o.cy+a]},t.prototype.getPinDist=function(){return 15},t.prototype.buildDom=function(){var a=this;this.bb=Z.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+M+" "+T,class:"sim-bb",width:M+"px",height:T+"px"}),this.styleEl=Z.svg.child(this.bb,"style",{}),this.styleEl.textContent+='\n        /* bread board */\n        .sim-bb-background {\n            fill:#E0E0E0;\n        }\n        .sim-bb-pin {\n            fill:#999;\n        }\n        .sim-bb-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width: 7.5px;\n            stroke: transparent;\n            fill: #777;\n        }\n        .sim-bb-pin-hover:hover {\n            visibility: visible;\n            fill:#444;\n        }\n        .sim-bb-group-wire {\n            stroke: #999;\n            stroke-width: 3.75px;\n            visibility: hidden;\n        }\n        .sim-bb-pin-group {\n            pointer-events: all;\n        }\n        .sim-bb-label,\n        .sim-bb-label-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            fill:#555;\n            pointer-events: all;\n            stroke-width: 0;\n            cursor: default;\n        }\n        .sim-bb-label-hover {\n            visibility: hidden;\n            fill:#000;\n            font-weight: bold;\n        }\n        .sim-bb-bar {\n            stroke-width: 0;\n        }\n        .sim-bb-blue {\n            fill:#1AA5D7;\n            stroke:#1AA5D7\n        }\n        .sim-bb-red {\n            fill:#DD4BA0;\n            stroke:#DD4BA0;\n        }\n        .sim-bb-pin-group:hover .sim-bb-pin-hover,\n        .sim-bb-pin-group:hover .sim-bb-group-wire,\n        .sim-bb-pin-group:hover .sim-bb-label-hover {\n            visibility: visible;\n        }\n        .sim-bb-pin-group:hover .sim-bb-label {\n            visibility: hidden;\n        }\n        /* outline mode */\n        .sim-bb-outline .sim-bb-background {\n            stroke-width: 2.142857142857143px;\n            fill: #FFF;\n            stroke: #000;\n        }\n        .sim-bb-outline .sim-bb-mid-channel {\n            fill: #FFF;\n            stroke: #888;\n            stroke-width: 2px;\n        }\n        /* grayed out */\n        .grayed .sim-bb-background {\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-red,\n        .grayed .sim-bb-blue {\n            fill: #BBB;\n        }\n        .grayed .sim-bb-bar {\n            fill: #FFF;\n        }\n        .grayed .sim-bb-pin {\n            fill: #000;\n            stroke: #FFF;\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-label {\n            fill: none;\n        }\n        .grayed .sim-bb-background {\n            stroke-width: 7.5px;\n            stroke: #555;\n        }\n        .grayed .sim-bb-group-wire {\n            stroke: #DDD;\n        }\n        .grayed .sim-bb-channel {\n            visibility: hidden;\n        }\n        /* highlighted */\n        .sim-bb-label.highlight {\n            visibility: hidden;\n        }\n        .sim-bb-label-hover.highlight {\n            visibility: visible;\n        }\n        .sim-bb-blue.highlight {\n            fill:#1AA5D7;\n        }\n        .sim-bb-red.highlight {\n            fill:#DD4BA0;\n        }\n        .sim-bb-bar.highlight {\n            stroke-width: 0px;\n        }\n        ',this.defs=Z.svg.child(this.bb,"defs",{}),Z.svg.child(this.bb,"rect",{class:"sim-bb-background",width:M,height:T,rx:4.5,ry:4.5});var i="sim-bb-channel-grad",t=Z.svg.elt("linearGradient");Z.svg.hydrate(t,{id:i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),this.defs.appendChild(t);Z.svg.child(t,"stop",{offset:"0%",style:"stop-color: #AAA;"}),Z.svg.child(t,"stop",{offset:"20%",style:"stop-color: #CCC;"}),Z.svg.child(t,"stop",{offset:"80%",style:"stop-color: #CCC;"}),Z.svg.child(t,"stop",{offset:"100%",style:"stop-color: #AAA;"});var e=function(t,e,n){var r=Z.svg.child(a.bb,"rect",{class:"sim-bb-channel "+(n||""),y:t-e/2,width:M,height:e});return r.setAttribute("fill","url(#"+i+")"),r};e(O+L/2,15,"sim-bb-mid-channel"),e(O,.75,"sim-bb-sml-channel"),e(O+L,.75,"sim-bb-sml-channel");var n=function(t,e){return""+(t<B.BREADBOARD_MID_ROWS/2?"b":"t")+H(e)},r=function(t){return 0===t?"-":"+"},o=function(t,e){var n=e<25?"b":"t";return""+r(t)+n},s=J({xOffset:q,yOffset:N,rowCount:B.BREADBOARD_MID_ROWS,colCount:B.BREADBOARD_MID_COLS,pinDist:15,mkPin:Y,mkHoverPin:K,getRowName:z,getColName:H,getGroupName:n,rowIdxsWithGap:P});s.g;this.allPins=this.allPins.concat(s.allPins);var u=J({xOffset:W,yOffset:G,rowCount:2,colCount:25,pinDist:15,mkPin:Y,mkHoverPin:K,getRowName:r,getColName:H,getGroupName:o,colIdxsWithGap:A});u.g;this.allPins=this.allPins.concat(u.allPins);var l=J({xOffset:U,yOffset:V,rowCount:2,colCount:25,colStartIdx:25,pinDist:15,mkPin:Y,mkHoverPin:K,getRowName:r,getColName:H,getGroupName:o,colIdxsWithGap:A.map(function(t){return t+25})});l.g;this.allPins=this.allPins.concat(l.allPins),this.allPins.forEach(function(t){var e=t.el,n=t.row,r=t.col,i=t.hoverEl,o="("+n+","+r+")";Z.svg.hydrate(e,{title:o}),Z.svg.hydrate(i,{title:o})}),this.allPins.forEach(function(t){var e=a.rowColToPin[t.row];e||(e=a.rowColToPin[t.row]={}),e[t.col]=t});for(var c=function(t,e,n,r,i,o){var s=a.getCoord({type:"breadboard",row:t,col:e});return Q(s[0]+n,s[1]+r,10.5,-90,i,o)},p=0;p<B.BREADBOARD_MID_COLS;p++){var d=H(p),h=c(z(0),d,0,-15,d,n(0,p));this.allLabels.push(h);var f=B.BREADBOARD_MID_ROWS-1,m=c(z(f),d,0,15,d,n(f,p));this.allLabels.push(m)}for(var g=0;g<B.BREADBOARD_MID_ROWS;g++){var v=z(g);h=c(v,H(0),-15,0,v);this.allLabels.push(h);m=c(v,H(B.BREADBOARD_MID_COLS-1),15,0,v);this.allLabels.push(m)}var b=[Q(13.05,O+L+12,30,j,"-",o(0,0),["sim-bb-blue"]),Q(12,O+L+O-12,25.5,j,"+",o(1,0),["sim-bb-red"]),Q(M-12+1.05,O+L+12,30,j,"-",o(0,24),["sim-bb-blue"]),Q(M-12,O+L+O-12,25.5,j,"+",o(1,24),["sim-bb-red"])];this.allLabels=this.allLabels.concat(b);var y=[Q(13.05,12,30,j,"-",o(0,25),["sim-bb-blue"]),Q(12,O-12,25.5,j,"+",o(1,25),["sim-bb-red"]),Q(M-12+1.05,12,30,j,"-",o(0,49),["sim-bb-blue"]),Q(M-12,O-12,25.5,j,"+",o(1,49),["sim-bb-red"])];this.allLabels=this.allLabels.concat(y);var w={};this.allLabels.forEach(function(t){t.el;var e=t.txt;(w[e]=w[e]||[]).push(t)});this.allPins.forEach(function(e){var t,n=e.row,r=e.col,i=(e.group,a.rowColToLbls[n]||(a.rowColToLbls[n]={})),o=i[r]||(i[r]=[]);"-"===(t=e).row||"+"===t.row?Number(r)<=25?b.filter(function(t){return t.group==e.group}).forEach(function(t){return o.push(t)}):y.filter(function(t){return t.group==e.group}).forEach(function(t){return o.push(t)}):(w[n].forEach(function(t){return o.push(t)}),w[r].forEach(function(t){return o.push(t)}))});var x=F+22.5,C=(x-F)/2,R=function(t,e,n,r){var i=Z.svg.elt("rect");return Z.svg.hydrate(i,{class:"sim-bb-bar "+r,x:t,y:e-1.5,width:x,height:3}),{el:i,group:n}},k=[R(W-C,G-9,o(0,49),"sim-bb-blue"),R(W-C,G+15+9,o(1,49),"sim-bb-red"),R(U-C,V-9,o(0,0),"sim-bb-blue"),R(U-C,V+15+9,o(1,0),"sim-bb-red")];this.allPowerBars=this.allPowerBars.concat(k),this.allPowerBars.forEach(function(t){return a.bb.appendChild(t.el)});var E=this.allPins.map(function(t){return t.group}).filter(function(t,e,n){return n.indexOf(t)==e}),D=E.map(function(t){return Z.svg.elt("g")});D.forEach(function(t){return Z.svg.addClass(t,"sim-bb-pin-group")}),D.forEach(function(t,e){return Z.svg.addClass(t,"group-"+E[e])});var I={};E.forEach(function(t,e){return I[t]=D[e]});var _={};this.allPins.forEach(function(t,e){var n=t.group;(_[n]||(_[n]=[])).push(t)}),E.forEach(function(t){var e=_[t],n=[e.map(function(t){return t.cx}),e.map(function(t){return t.cy})],r=n[0],i=n[1],o=function(t){return t.reduce(function(t,e){return t<e?t:e})},s=function(t){return t.reduce(function(t,e){return e<t?t:e})},a=[o(r),s(r),o(i),s(i)],u=a[0],l=a[1],c=a[2],p=a[3],d=Z.svg.elt("rect"),h=Math.max(l-u,1e-4),f=Math.max(p-c,1e-4);Z.svg.hydrate(d,{x:u,y:c,width:h,height:f}),Z.svg.addClass(d,"sim-bb-group-wire"),I[t].appendChild(d)}),this.allPins.forEach(function(t){var e=I[t.group];e.appendChild(t.el),e.appendChild(t.hoverEl)});var S=Z.svg.elt("g");Z.svg.hydrate(S,{class:"sim-bb-group-misc"}),D.push(S),this.allLabels.forEach(function(t){if(t.group){var e=I[t.group];e.appendChild(t.el),e.appendChild(t.hoverEl)}else S.appendChild(t.el),S.appendChild(t.hoverEl)}),D.forEach(function(t){return a.bb.appendChild(t)})},t.prototype.getSVGAndSize=function(){return{el:this.bb,y:0,x:0,w:M,h:T}},t.prototype.highlightLoc=function(t){var e=t.row,n=t.col,r=this.rowColToPin[e][n];r.cx,r.cy;this.rowColToLbls[e][n].forEach(function(t){Z.svg.addClass(t.el,"highlight"),Z.svg.addClass(t.hoverEl,"highlight")})},t}();B.Breadboard=a}(Z.visuals||(Z.visuals={}))}(pxsim||(pxsim={})),function(b){!function(d){d.BOARD_SYTLE="\n        .noselect {\n            -webkit-touch-callout: none; /* iOS Safari */\n            -webkit-user-select: none;   /* Chrome/Safari/Opera */\n            -khtml-user-select: none;    /* Konqueror */\n            -moz-user-select: none;      /* Firefox */\n            -ms-user-select: none;       /* Internet Explorer/Edge */\n            user-select: none;           /* Non-prefixed version, currently\n                                            not supported by any browser */\n        }\n\n        .sim-board-pin {\n            fill:#999;\n            stroke:#000;\n            stroke-width:"+d.PIN_DIST/3+"px;\n        }\n        .sim-board-pin-lbl {\n            fill: #333;\n        }\n        .gray-cover {\n            fill:#FFF;\n            opacity: 0.3;\n            stroke-width:0;\n            visibility: hidden;\n        }\n        .sim-board-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width:"+d.PIN_DIST/6+'px;\n        }\n        .sim-board-pin-hover:hover {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-lbl {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            fill: #555;\n        }\n        .sim-board-pin-lbl-hover {\n            fill: red;\n        }\n        .sim-board-outline .sim-board-pin-lbl-hover {\n            fill: black;\n        }\n        .sim-board-pin-lbl,\n        .sim-board-pin-lbl-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            pointer-events: all;\n            stroke-width: 0;\n        }\n        .sim-board-pin-lbl-hover {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + .sim-board-pin-lbl,\n        .sim-board-pin-lbl.highlight {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + * + .sim-board-pin-lbl-hover,\n        .sim-board-pin-lbl-hover.highlight {\n            visibility: visible;\n        }\n        /* Graying out */\n        .grayed .sim-board-pin-lbl:not(.highlight) {\n            fill: #AAA;\n        }\n        .grayed .sim-board-pin:not(.highlight) {\n            fill:#BBB;\n            stroke:#777;\n        }\n        .grayed .gray-cover {\n            visibility: inherit;\n        }\n        .grayed .sim-cmp:not(.notgrayed) {\n            opacity: 0.3;\n        }\n        /* Highlighting */\n        .sim-board-pin-lbl.highlight {\n            fill: #000;\n            font-weight: bold;\n        }\n        .sim-board-pin.highlight {\n            fill:#999;\n            stroke:#000;\n        }\n        ';var h=.7*d.PIN_DIST,f=1.5*h,m=.66666*d.PIN_DIST,g=.66666*d.PIN_DIST+d.PIN_DIST/3,v=0,t=function(){function t(t){var r=this;this.props=t,this.allPins=[],this.allLabels=[],this.pinNmToLbl={},this.pinNmToPin={},this.id=v++;var i=t.visualDef,e=t.wireframe&&i.outlineImage?i.outlineImage:i.image,n=d.mkImageSVG({image:e,width:i.width,height:i.height,imageUnitDist:i.pinDist,targetUnitDist:d.PIN_DIST}),s=d.mkScaleFn(i.pinDist,d.PIN_DIST);this.width=n.w,this.height=n.h;var o=n.el;this.element=b.svg.elt("svg"),b.svg.hydrate(this.element,{version:"1.0",viewBox:"0 0 "+this.width+" "+this.height,class:"sim sim-board-id-"+this.id,x:"0px",y:"0px"}),t.wireframe&&b.svg.addClass(this.element,"sim-board-outline"),this.style=b.svg.child(this.element,"style",{}),this.style.textContent+=d.BOARD_SYTLE,this.defs=b.svg.child(this.element,"defs",{}),this.g=b.svg.elt("g"),this.element.appendChild(this.g),this.g.appendChild(o),this.background=o,b.svg.hydrate(o,{class:"sim-board"});var a=function(){var t=b.svg.elt("rect"),e=m;return b.svg.hydrate(t,{class:"sim-board-pin",width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}},u=function(){var t=b.svg.elt("rect"),e=g;return b.svg.hydrate(t,{class:"sim-board-pin-hover",width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}},l=i.pinBlocks.map(function(e,t){var n=s(e.x)+d.PIN_DIST/2,r=s(e.y)+d.PIN_DIST/2,i=e.labels.length,o=d.mkGrid({xOffset:n,yOffset:r,rowCount:1,colCount:i,pinDist:d.PIN_DIST,mkPin:a,mkHoverPin:u,getRowName:function(){return""+(t+1)},getColName:function(t){return e.labels[t]},getGroupName:function(){return e.labels.join(" ")}});o.allPins,o.g;return b.svg.addClass(o.g,"sim-board-pin-group"),o}),c=[];l.forEach(function(t,n){return t.allPins.forEach(function(t,e){r.allPins.push(t),c.push(i.pinBlocks[n])})}),this.allPins.forEach(function(t){var e=t.col;b.svg.hydrate(t.el,{title:e}),b.svg.hydrate(t.hoverEl,{title:e})}),this.allPins.forEach(function(t){r.pinNmToPin[t.col]=t});var p=function(t,e,n,r,i){var o,s;"below"===i?(s=t,o=e+12+.25*n*r.length):(s=t,o=e-11-.32*n*r.length);return d.mkTxt(s,o,n,-90,r)};this.allLabels=this.allPins.map(function(t,e){var n=c[e];return function(t,e,n,r){var i=p(t,e,h,n,r);b.svg.addClass(i,"sim-board-pin-lbl");var o=p(t,e,f,n,r);return b.svg.addClass(o,"sim-board-pin-lbl-hover"),{el:i,hoverEl:o,txt:n}}(t.cx,t.cy,t.col,n.labelPosition)}),this.allPins.forEach(function(t,e){var n=r.allLabels[e];r.pinNmToLbl[t.col]=n}),this.allPins.forEach(function(t,e){var n=r.allLabels[e];r.g.appendChild(t.el),r.g.appendChild(t.hoverEl),r.g.appendChild(n.el),r.g.appendChild(n.hoverEl)})}return t.prototype.getCoord=function(t){var e=this.pinNmToPin[t];return e?[e.cx,e.cy]:null},t.prototype.mkGrayCover=function(t,e,n,r){var i=b.svg.elt("rect");return b.svg.hydrate(i,{x:t,y:e,width:n,height:r,class:"gray-cover"}),i},t.prototype.getView=function(){return{el:this.element,w:this.width,h:this.height,x:0,y:0}},t.prototype.getPinDist=function(){return d.PIN_DIST},t.prototype.highlightPin=function(t){var e=this.pinNmToLbl[t],n=this.pinNmToPin[t];e&&n&&(b.svg.addClass(e.el,"highlight"),b.svg.addClass(e.hoverEl,"highlight"),b.svg.addClass(n.el,"highlight"),b.svg.addClass(n.hoverEl,"highlight"))},t}();d.GenericBoardSvg=t}(b.visuals||(b.visuals={}))}(pxsim||(pxsim={})),function(r){!function(e){function n(t){return e.mkImageSVG({image:t.image,width:t.width,height:t.height,imageUnitDist:t.pinDistance,targetUnitDist:e.PIN_DIST})}e.mkGenericPartSVG=n;var t=function(){function t(t){this.style="",this.defs=[];var e=n(t).el;this.element=r.svg.elt("g"),this.element.appendChild(e)}return t.prototype.moveToCoord=function(t){e.translateEl(this.element,t)},t.prototype.init=function(t,e,n){},t.prototype.updateState=function(){},t.prototype.updateTheme=function(){},t}();e.GenericPart=t}(r.visuals||(r.visuals={}))}(pxsim||(pxsim={})),function(O){!function(B){var t,a=B.PIN_DIST/2.5,D=15,I=100;function P(t){return t.replace(/\#/g,"-").replace(/\(/g,"-").replace(/\)/g,"-").replace(/\,/g,"-").replace(/\./g,"-").replace(/\s/g,"")}function A(t,e,n,r){var i=function(t){return t[0]+", "+t[1]},o=t[0],s=t[1],a=e[0],u=e[1],l=u-s,c=[o,s+l*n],p=[a,u-l*n],d=O.svg.mkPath("sim-bb-wire","M"+i(t)+" C"+i(c)+" "+i(p)+" "+i(e));return O.svg.addClass(d,"wire-stroke-"+r),d}function M(t,e,n){var r=function(t){return t[0]+", "+t[1]},i=O.svg.mkPath("sim-bb-wire","M"+r(t)+" L"+r(e));return O.svg.addClass(i,"wire-stroke-"+n),i}function T(t,e){var n=B.PIN_DIST/4,r=O.svg.elt("circle"),i=t[0],o=t[1],s=a/2+n/2;return O.svg.hydrate(r,{cx:i,cy:o,r:s,class:"sim-bb-wire-end"}),O.svg.addClass(r,"wire-fill-"+e),r.style["stroke-width"]=n+"px",r}function _(t,e,n){var r=.24*B.PIN_DIST,i=10*r,o=2*r,s=6*r,a=r,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=O.svg.elt("g"),h=O.svg.elt("rect"),f=i,m=o,g=l-m/2,v=c-f/2;O.svg.hydrate(h,{x:g,y:v,width:m,height:f,rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var b=O.svg.elt("rect"),y=s,w=a,x=l-w/2,C=c+p*(f/2+y/2)-y/2;return O.svg.hydrate(b,{x:x,y:C,width:w,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",d.appendChild(b),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,C),w:m+2*u,h:f+y}}function L(t,e,n){var r=.24*B.PIN_DIST,i=4*r,o=10*r,s=3.5*r,a=3.5*r,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=O.svg.elt("g"),h=O.svg.elt("polygon"),f=o,m=i,g=l-m/2,v=c-f/2,b=e?.15:.3,y=e?.7:1-.7,w=e?.3:.15;O.svg.hydrate(h,{points:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.map(function(t){return(e=t)[0]+","+e[1];var e}).join(" ")}([g+m*b,v],[g+m*(1-b),v],[g+m,v+f*y],[g+m*(1-w),v+f],[g+m*w,v+f],[g,v+f*y])}),O.svg.hydrate(h,{rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var x=O.svg.elt("rect"),C=s,R=a,k=l-R/2,E=c+p*(f/2+C/2)-C/2;return O.svg.hydrate(x,{x:k,y:E,width:R,height:C,class:"sim-bb-wire-bare-end"}),d.appendChild(x),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,E),w:m+2*u,h:f+C}}B.WIRES_CSS="\n        .sim-bb-wire {\n            fill:none;\n            stroke-linecap: round;\n            stroke-width:"+a+"px;\n            pointer-events: none;\n        }\n        .sim-bb-wire-end {\n            stroke:#333;\n            fill:#333;\n        }\n        .sim-bb-wire-bare-end {\n            fill: #ccc;\n        }\n        .sim-bb-wire-hover {\n            stroke-width: "+a+"px;\n            visibility: hidden;\n            stroke-dasharray: "+B.PIN_DIST/10+","+B.PIN_DIST/1.5+";\n            /*stroke-opacity: 0.4;*/\n        }\n        .grayed .sim-bb-wire-ends-g:not(.highlight) .sim-bb-wire-end {\n            stroke: #777;\n            fill: #777;\n        }\n        .grayed .sim-bb-wire:not(.highlight) {\n            stroke: #CCC;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-end {\n            stroke: red;\n            fill: red;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-bare-end {\n            stroke: #FFF;\n            fill: #FFF;\n        }\n        ",(t=B.WireEndStyle||(B.WireEndStyle={}))[t.BBJumper=0]="BBJumper",t[t.OpenJumper=1]="OpenJumper",t[t.Croc=2]="Croc",B.mkWirePart=function(t,e,n){void 0===n&&(n=!1);var r,i=O.svg.elt("g"),o=t[0],s=t[1],a=[o-D,s-I/2],u=[o+D,s+I/2];e=B.mapWireColor(e),r=n?L(a,!0,e):_(a,!0,e);var l,c,p,d,h,f,m,g,v,b,y,w,x=(c=u,p=e,d=function(t){return t[0]+", "+t[1]},h=(l=a)[0],f=l[1],m=c[0],g=c[1],b=[h,f+.8*(v=g-f)],y=[m,g-.8*v],(w=O.svg.mkPath("sim-bb-wire","M"+d(l)+" C"+d(b)+" "+d(y)+" "+d(c))).style.stroke=p,{el:w,x:Math.min(h,m),y:Math.min(f,g),w:Math.abs(h-m),h:Math.abs(f-g)}),C=_(u,!1,e);i.appendChild(x.el),i.appendChild(r.el),i.appendChild(C.el);var R=Math.min(r.x,C.x),k=Math.max(r.x+r.w,C.x+C.w),E=Math.min(r.y,C.y);return{el:i,x:R,y:E,w:k-R,h:Math.max(r.y+r.h,C.y+C.h)-E}};var e=function(){function t(t,e,n,r,i,o){this.nextWireId=0,this.styleEl=r,this.styleEl.textContent+=B.WIRES_CSS,this.underboard=t,this.overboard=e,this.boardEdges=n,this.getLocCoord=i,this.getPinStyle=o}return t.prototype.indexOfMin=function(t){for(var e=0,n=t[0],r=1;r<t.length;r++)t[r]<n&&(n=t[r],e=r);return e},t.prototype.closestEdgeIdx=function(e){var t=this.boardEdges.map(function(t){return Math.abs(e[1]-t)});return this.indexOfMin(t)},t.prototype.closestEdge=function(t){return this.boardEdges[this.closestEdgeIdx(t)]},t.prototype.drawWire=function(t,e,n){var i=this,r=[],o=O.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),s=function(t){var e,n=B.PIN_DIST/2,r=i.closestEdge(t);return e=r-t[1]<0?r-n:r+n,[t[0],e]},a=this.nextWireId++,u=P(n),l=T(t,u),c=T(e,u),p=O.svg.child(o,"g",{class:"sim-bb-wire-ends-g"});p.appendChild(l),p.appendChild(c);var d=this.closestEdgeIdx(t),h=this.closestEdgeIdx(e);if(d==h){var f=M(t,e,u);o.appendChild(f),r.push(f)}else{var m=s(t),g=s(e),v=M(t,m,u),b=M(e,g,u),y=void 0,w=void 0;!(1!=d&&2!=d||1!=h&&2!=h)?(y=A(m,g,.7,u),w=A(m,g,.7,u)):(y=M(m,g,u),w=M(m,g,u)),O.svg.addClass(w,"sim-bb-wire-hover"),o.appendChild(v),r.push(v),o.appendChild(b),r.push(b),this.underboard.appendChild(y),r.push(y),o.appendChild(w),r.push(w);var x="sim-bb-wire-id-"+a,C=function(t){return O.svg.addClass(t,x)};C(p),C(w),this.styleEl.textContent+="\n                    ."+x+":hover ~ ."+x+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}var R="\n                .wire-stroke-"+u+" {\n                    stroke: "+B.mapWireColor(n)+";\n                }\n                .wire-fill-"+u+" {\n                    fill: "+B.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=R,{endG:p,end1:l,end2:c,wires:r}},t.prototype.drawWireWithCrocs=function(t,e,n,r){var i=this;void 0===r&&(r=!1);var o=[],s=O.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),a=this.nextWireId++,u=P(n),l=T(t,u),c=e,p=e[0],d=e[1],h=[p=(e=[p,d+40])[0],(d=e[1])+-17],f=(r?function(t,e,n){var r=.24*B.PIN_DIST,i=4*r,o=1.2*r,s=10*r,a=r,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=O.svg.elt("g"),h=O.svg.elt("rect"),f=i,m=o,g=l-m/2,v=c+10-f/2;O.svg.hydrate(h,{x:g,y:v,width:m,height:f,rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var b=O.svg.elt("rect"),y=s,w=a,x=l-w/2,C=c+10+p*(f/2+y/2)-y/2;return O.svg.hydrate(b,{x:x,y:C,width:w,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",d.appendChild(b),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,C),w:m+2*u,h:f+y}}(h,!0):L(h,!0)).el,m=O.svg.child(s,"g",{class:"sim-bb-wire-ends-g"});m.appendChild(l);var g,v,b,y,w=this.closestEdgeIdx(t),x=this.closestEdgeIdx(c);if(w==x){var C=M(t,e,u);s.appendChild(C),o.push(C)}else{var R=(g=t,b=B.PIN_DIST/2,y=i.closestEdge(g),v=y-g[1]<0?y-b:y+b,[g[0],v]),k=M(t,R,u),E=void 0,D=void 0;!(1!=w&&2!=w||1!=x&&2!=x)?(E=A(R,e,.7,u),D=A(R,e,.7,u)):(E=M(R,e,u),D=M(R,e,u)),O.svg.addClass(D,"sim-bb-wire-hover"),s.appendChild(k),o.push(k),this.underboard.appendChild(E),o.push(E);var I="sim-bb-wire-id-"+a,_=function(t){return O.svg.addClass(t,I)};_(m),_(D),this.styleEl.textContent+="\n                    ."+I+":hover ~ ."+I+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}m.appendChild(f);var S="\n                .wire-stroke-"+u+" {\n                    stroke: "+B.mapWireColor(n)+";\n                }\n                .wire-fill-"+u+" {\n                    fill: "+B.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=S,{endG:m,end1:l,end2:f,wires:o}},t.prototype.addWire=function(t,e,n){var r=this.getLocCoord(t),i=this.getLocCoord(e),o=(this.getPinStyle(t),this.getPinStyle(e));return"dalboard"==e.type&&"croc"==o?this.drawWireWithCrocs(r,i,n):this.drawWire(r,i,n)},t}();B.WireFactory=e}(O.visuals||(O.visuals={}))}(pxsim||(pxsim={}));