"use strict";var e=function(){function l(e,t){postMessage({action:Ue,cbn:t,result:e})}function P(e){var t=[];return t[e-1]=void 0,t}function w(e,t){return r(e[0]+t[0],e[1]+t[1])}function a(e,t){return n=~~Math.max(Math.min(e[1]/Re,2147483647),-2147483648)&~~Math.max(Math.min(t[1]/Re,2147483647),-2147483648),r=O(e)&O(t),(i=r)<0&&(i+=Re),[i,n*Re];var n,r,i}function U(e,t){var n,r;return e[0]==t[0]&&e[1]==t[1]?0:(n=e[1]<0,r=t[1]<0,n&&!r?-1:!n&&r?1:E(e,t)[1]<0?-1:1)}function r(e,t){var n,r;for(e%=0x10000000000000000,t=(t%=0x10000000000000000)-(n=t%Re)+(r=Math.floor(e/Re)*Re),e=e-r+n;e<0;)e+=Re,t-=Re;for(;4294967295<e;)e-=Re,t+=Re;for(t%=0x10000000000000000;0x7fffffff00000000<t;)t-=0x10000000000000000;for(;t<-0x8000000000000000;)t+=0x10000000000000000;return[e,t]}function k(e,t){return e[0]==t[0]&&e[1]==t[1]}function A(e){return 0<=e?[e,0]:[e+Re,-Re]}function O(e){return 2147483648<=e[0]?~~Math.max(Math.min(e[0]-Re,2147483647),-2147483648):~~Math.max(Math.min(e[0],2147483647),-2147483648)}function s(e){return e<=30?1<<e:s(30)*s(e-30)}function u(e,t){var n,r,i,o;if(t&=63,k(e,Le))return t?Be:e;if(e[1]<0)throw Error("Neg");return o=s(t),r=e[1]*o%0x10000000000000000,0x8000000000000000<=(r+=n=(i=e[0]*o)-i%Re)&&(r-=0x10000000000000000),[i-=n,r]}function R(e,t){var n;return n=s(t&=63),r(Math.floor(e[0]/n),e[1]/n)}function E(e,t){return r(e[0]-t[0],e[1]-t[1])}function i(e,t){return e.Mc=t,e.Lc=0,e.Yb=t.length,e}function h(e){return e.Lc>=e.Yb?-1:255&e.Mc[e.Lc++]}function o(e){return e.Mc=P(32),e.Yb=0,e}function f(e){var t=e.Mc;return t.length=e.Yb,t}function D(e,t){e.Mc[e.Yb++]=t<<24>>24}function L(e,t,n,r){c(t,n,e.Mc,e.Yb,r),e.Yb+=r}function c(e,t,n,r,i){for(var o=0;o<i;++o)n[r+o]=e[t+o]}function p(t,n,r,i,o){var a,s,u,c,l,f,p,d,h,g,m,v,b,y,x,w,k,A,E,C,S,_,T,I;if(U(i,De)<0)throw Error("invalid length "+i);for(t.Tb=i,a=function(e){var t;for(e.v=P(4),e.a=[],e.d={},e.C=P(192),e.bb=P(12),e.hb=P(12),e.Ub=P(12),e.vc=P(12),e._=P(192),e.K=[],e.Sb=P(114),e.S=de({},4),e.$=$({}),e.i=$({}),e.A={},e.m=[],e.P=[],e.lb=[],e.nc=P(16),e.x=P(4),e.Q=P(4),e.Xb=[Be],e.uc=[Be],e.Kc=[0],e.fc=P(5),e.yc=P(128),e.vb=0,e.X=1,e.D=0,e.Hb=-1,e.mb=0,t=0;t<4096;++t)e.a[t]={};for(t=0;t<4;++t)e.K[t]=de({},6);return e}({}),p=f=l=void 0,function(e,t){e.ab=t;for(var n=0;1<<n<t;++n);e.$b=2*n}(c=a,1<<(u=o).s),c.n=u.f,l=c,f=u.m,p=l.X,l.X=f,l.b&&p!=l.X&&(l.wb=-1,l.b=null),c.eb=0,c.fb=3,c.Y=2,c.y=3,a.Gc=void 0===e.disableEndMark,function(e,t){e.fc[0]=9*(5*e.Y+e.eb)+e.fb<<24>>24;for(var n=0;n<4;++n)e.fc[1+n]=e.ab>>8*n<<24>>24;L(t,e.fc,0,5)}(a,r),s=0;s<64;s+=8)D(r,255&O(R(i,s)));t.yb=(a.W=0,a.oc=n,a.pc=0,(h=a).b||(g={},m=4,h.X||(m=2),(I=g).qb=2<m,I.qb?(I.w=0,I.xb=4,I.R=66560):(I.w=2,I.xb=3,I.R=0),h.b=g),function(e,t,n){var r,i,o;if(null==e.V||e.u!=n||e.I!=t)for(e.I=t,e.qc=(1<<t)-1,e.u=n,i=1<<e.u+e.I,e.V=P(i),r=0;r<i;++r)e.V[r]=((o={}).tb=P(768),o)}(h.A,h.eb,h.fb),(h.ab!=h.wb||h.Hb!=h.n)&&(v=h.b,b=h.ab,y=4096,x=h.n,w=274,b<1073741567&&(v.Fc=16+(x>>1),S=x+w,_=256+~~(((C=b+y)+x+w)/2),(E=v).Bc=C,E._b=S,T=C+S+_,(null==E.c||E.Kb!=T)&&(E.c=null,E.Kb=T,E.c=P(E.Kb)),E.H=E.Kb-S,v.ob=x,k=b+1,v.p!=k&&(v.L=P(2*(v.p=k))),A=65536,v.qb&&(A=b-1,A|=A>>1,A|=A>>2,A|=A>>4,A|=A>>8,A>>=1,16777216<(A|=65535)&&(A>>=1),v.Ec=A,++A,A+=v.R),A!=v.rc&&(v.ub=P(v.rc=A))),h.wb=h.ab,h.Hb=h.n),a.d.Ab=r,function(e){(function(e){e.l=0;for(var t=e.J=0;t<4;++t)e.v[t]=0})(e),t=e.d,t.mc=Be,t.xc=Be,t.E=-1,t.Jb=1,t.Oc=0,we(e.C),we(e._),we(e.bb),we(e.hb),we(e.Ub),we(e.vc),we(e.Sb),function(e){var t,n=1<<e.u+e.I;for(t=0;t<n;++t)we(e.V[t].tb)}(e.A);var t;for(var n=0;n<4;++n)we(e.K[n].G);V(e.$,1<<e.Y),V(e.i,1<<e.Y),we(e.S.G),e.N=0,e.jb=0,e.q=0,e.s=0}(a),j(a),N(a),a.$.rb=a.n+1-2,Y(a.$,1<<a.Y),a.i.rb=a.n+1-2,Y(a.i,1<<a.Y),a.g=Be,(d={}).cb=a,d.Z=null,d.zc=1,d)}function d(e,t,n){return e.Nb=o({}),p(e,i({},t),e.Nb,A(t.length),n),e}function n(e,t,n){var r,i,o,a,s,u,c,l,f,p="",d=[];for(i=0;i<5;++i){if(-1==(o=h(t)))throw Error("truncated input");d[i]=o<<24>>24}if(!function(e,t){var n,r,i,o,a,s,u;if(t.length<5)return 0;for(u=255&t[0],i=u%9,o=(s=~~(u/9))%5,a=~~(s/5),r=n=0;r<4;++r)n+=(255&t[1+r])<<8*r;return 99999999<n||!function(e,t,n,r){if(8<t||4<n||4<r)return 0;!function(e,t,n){var r,i;if(null==e.V||e.u!=n||e.I!=t)for(e.I=t,e.qc=(1<<t)-1,e.u=n,i=1<<e.u+e.I,e.V=P(i),r=0;r<i;++r)e.V[r]=(o={},o.Ib=P(768),o);var o}(e.gb,n,t);var i=1<<r;return I(e.Rb,i),I(e.sb,i),e.Dc=i-1,1}(e,i,o,a)?0:(c=e,l=n,l<0?0:(c.Ob!=l&&(c.Ob=l,c.nb=Math.max(c.Ob,1),f=c.B,p=Math.max(c.nb,4096),(null==f.Lb||f.M!=p)&&(f.Lb=P(p)),f.M=p,f.o=0,f.h=0),1));var c,l,f,p}(r=function(e){e.B={},e.e={},e.Gb=P(192),e.Zb=P(12),e.Cb=P(12),e.Db=P(12),e.Eb=P(12),e.pb=P(192),e.kb=P(4),e.kc=P(114),e.Fb=fe({},4),e.Rb=M({}),e.sb=M({}),e.gb={};for(var t=0;t<4;++t)e.kb[t]=fe({},6);return e}({}),d))throw Error("corrupted input");for(i=0;i<64;i+=8){if(-1==(o=h(t)))throw Error("truncated input");1==(o=o.toString(16)).length&&(o="0"+o),p=o+""+p}/^0+$|^f+$/i.test(p)?e.Tb=De:(a=parseInt(p,16),e.Tb=4294967295<a?De:A(a)),e.yb=(s=r,u=t,c=n,l=e.Tb,s.e.Ab=u,y(s.B),s.B.cc=c,function(e){e.B.h=0,e.B.o=0,we(e.Gb),we(e.pb),we(e.Zb),we(e.Cb),we(e.Db),we(e.Eb),we(e.kc),function(e){var t,n;for(n=1<<e.u+e.I,t=0;t<n;++t)we(e.V[t].Ib)}(e.gb);for(var t=0;t<4;++t)we(e.kb[t].G);F(e.Rb),F(e.sb),we(e.Fb.G),function(e){e.Bb=0,e.E=-1;for(var t=0;t<5;++t)e.Bb=e.Bb<<8|h(e.Ab)}(e.e)}(s),s.U=0,s.ib=0,s.Jc=0,s.Ic=0,s.Qc=0,s.Nc=l,s.g=Be,s.jc=0,(f={}).Z=s,f.cb=null,f.zc=1,f)}function g(e,t){return e.Nb=o({}),n(e,i({},t),e.Nb),e}function K(e,t){return e.c[e.f+e.o+t]}function X(e,t,n,r){var i,o;for(e.T&&e.o+t+r>e.h&&(r=e.h-(e.o+t)),++n,o=e.f+e.o+t,i=0;i<r&&e.c[o+i]==e.c[o+i-n];++i);return i}function Q(e){return e.h-e.o}function C(e){var t,n,r,i,o,a;if(!e.T)for(;;){if(!(n=-e.f+e.Kb-e.h))return;if(r=e.cc,i=e.c,o=e.f+e.h,a=n,-1==(t=r.Lc>=r.Yb?-1:(a=Math.min(a,r.Yb-r.Lc),c(r.Mc,r.Lc,i,o,a),r.Lc+=a,a)))return e.zb=e.h,e.f+e.zb>e.H&&(e.zb=e.H-e.f),void(e.T=1);e.h+=t,e.h>=e.o+e._b&&(e.zb=e.h-e._b)}}function S(e,t){e.f+=t,e.zb-=t,e.o-=t,e.h-=t}function _(e){var t,n;++e.k>=e.p&&(e.k=0),++(n=e).o,n.o>n.zb&&(n.f+n.o>n.H&&function(e){var t,n,r;for(0<(r=e.f+e.o-e.Bc)&&--r,n=e.f+e.h-r,t=0;t<n;++t)e.c[t]=e.c[r+t];e.f-=r}(n),C(n)),1073741823==e.o&&(t=e.o-e.p,m(e.L,2*e.p,t),m(e.ub,e.rc,t),S(e,t))}function m(e,t,n){var r,i;for(r=0;r<t;++r)(i=e[r]||0)<=n?i=0:i-=n,e[r]=i}function v(e){var t=e.o-e.h;t&&(L(e.cc,e.Lb,e.h,t),e.o>=e.M&&(e.o=0),e.h=e.o)}function b(e,t){var n=e.o-t-1;return n<0&&(n+=e.M),e.Lb[n]}function y(e){v(e),e.cc=null}function T(e){return(e-=2)<4?e:3}function Z(e){return e<4?0:e<10?e-3:e-6}function x(e){if(!e.zc)throw Error("bad state");return e.cb?(function(e,t,n,r){var i,o,a,s,u,c,l,f,p,d,h,g,m,v,b,y,x;if(t[0]=Be,n[0]=Be,r[0]=1,e.oc&&(e.b.cc=e.oc,(x=e.b).f=0,x.o=0,x.h=0,x.T=0,C(x),x.k=0,S(x,-1),e.W=1,e.oc=null),!e.pc){if(e.pc=1,v=e.g,k(e.g,Be)){if(!Q(e.b))return G(e,O(e.g));ie(e),m=O(e.g)&e.y,ke(e.d,e.C,(e.l<<4)+m,0),e.l=Z(e.l),a=K(e.b,-e.s),se(ae(e.A,O(e.g),e.J),e.d,a),e.J=a,--e.s,e.g=w(e.g,Me)}if(!Q(e.b))return G(e,O(e.g));for(;;){if(l=W(e,O(e.g)),d=e.mb,m=O(e.g)&e.y,o=(e.l<<4)+m,1==l&&-1==d)ke(e.d,e.C,o,0),a=K(e.b,-e.s),b=ae(e.A,O(e.g),e.J),e.l<7?se(b,e.d,a):(p=K(e.b,-e.v[0]-1-e.s),ue(b,e.d,p,a)),e.J=a,e.l=Z(e.l);else{if(ke(e.d,e.C,o,1),d<4){if(ke(e.d,e.bb,e.l,1),d?(ke(e.d,e.hb,e.l,1),1==d?ke(e.d,e.Ub,e.l,0):(ke(e.d,e.Ub,e.l,1),ke(e.d,e.vc,e.l,d-2))):(ke(e.d,e.hb,e.l,0),ke(e.d,e._,o,1==l?0:1)),1==l?e.l=e.l<7?9:11:(J(e.i,e.d,l-2,m),e.l=e.l<7?8:11),s=e.v[d],0!=d){for(c=d;1<=c;--c)e.v[c]=e.v[c-1];e.v[0]=s}}else{for(ke(e.d,e.bb,e.l,0),e.l=e.l<7?7:10,J(e.$,e.d,l-2,m),g=H(d-=4),f=T(l),he(e.K[f],e.d,g),4<=g&&(h=d-(i=(2|1&g)<<(u=(g>>1)-1)),g<14?be(e.Sb,i-g-1,e.d,u,h):(Ae(e.d,h>>4,u-4),me(e.S,e.d,15&h),++e.Qb)),s=d,c=3;1<=c;--c)e.v[c]=e.v[c-1];e.v[0]=s,++e.Mb}e.J=K(e.b,l-1-e.s)}if(e.s-=l,e.g=w(e.g,A(l)),!e.s){if(128<=e.Mb&&j(e),16<=e.Qb&&N(e),t[0]=e.g,n[0]=w(w(A((y=e.d).Jb),y.mc),[4,0]),!Q(e.b))return G(e,O(e.g));if(0<=U(E(e.g,v),[4096,0]))return e.pc=0,r[0]=0}}}}((t=e).cb,t.cb.Xb,t.cb.uc,t.cb.Kc),t.Pb=t.cb.Xb[0],t.cb.Kc[0]&&(q(n=t.cb),n.d.Ab=null,t.zc=0)):function(e){var t=function(e){var t,n,r,i,o,a;if(a=O(e.g)&e.Dc,xe(e.e,e.Gb,(e.U<<4)+a)){if(xe(e.e,e.Zb,e.U))r=0,xe(e.e,e.Cb,e.U)?(xe(e.e,e.Db,e.U)?(xe(e.e,e.Eb,e.U)?(n=e.Qc,e.Qc=e.Ic):n=e.Ic,e.Ic=e.Jc):n=e.Jc,e.Jc=e.ib,e.ib=n):xe(e.e,e.pb,(e.U<<4)+a)||(e.U=e.U<7?9:11,r=1),r||(r=B(e.sb,e.e,a)+2,e.U=e.U<7?8:11);else if(e.Qc=e.Ic,e.Ic=e.Jc,e.Jc=e.ib,r=2+B(e.Rb,e.e,a),e.U=e.U<7?7:10,4<=(o=pe(e.kb[T(r)],e.e))){if(i=(o>>1)-1,e.ib=(2|1&o)<<i,o<14)e.ib+=function(e,t,n,r){var i,o,a=1,s=0;for(o=0;o<r;++o)i=xe(n,e,t+a),a<<=1,a+=i,s|=i<<o;return s}(e.kc,e.ib-o-1,e.e,i);else if(e.ib+=function(e,t){var n,r,i=0;for(n=t;0!=n;--n)e.E>>>=1,r=e.Bb-e.E>>>31,e.Bb-=e.E&r-1,i=i<<1|1-r,-16777216&e.E||(e.Bb=e.Bb<<8|h(e.Ab),e.E<<=8);return i}(e.e,i-4)<<4,e.ib+=function(e,t){var n,r,i=1,o=0;for(r=0;e.F>r;++r)n=xe(t,e.G,i),i<<=1,i+=n,o|=n<<r;return o}(e.Fb,e.e),e.ib<0)return-1==e.ib?1:-1}else e.ib=o;if(0<=U(A(e.ib),e.g)||e.ib>=e.nb)return-1;(function(e,t,n){var r=e.o-t-1;for(r<0&&(r+=e.M);0!=n;--n)r>=e.M&&(r=0),e.Lb[e.o++]=e.Lb[r++],e.o>=e.M&&v(e)})(e.B,e.ib,r),e.g=w(e.g,A(r)),e.jc=b(e.B,0)}else c=e.gb,l=O(e.g),f=e.jc,t=c.V[((l&c.qc)<<c.u)+((255&f)>>>8-c.u)],e.jc=e.U<7?function(e,t){var n=1;for(;n=n<<1|xe(t,e.Ib,n),n<256;);return n<<24>>24}(t,e.e):function(e,t,n){var r,i,o=1;do{if(i=n>>7&1,n<<=1,r=xe(t,e.Ib,(1+i<<8)+o),o=o<<1|r,i!=r){for(;o<256;)o=o<<1|xe(t,e.Ib,o);break}}while(o<256);return o<<24>>24}(t,e.e,b(e.B,e.ib)),s=e.B,u=e.jc,s.Lb[s.o++]=u,s.o>=s.M&&v(s),e.U=Z(e.U),e.g=w(e.g,Me);var s,u;var c,l,f;return 0}(e.Z);if(-1==t)throw Error("corrupted input");e.Pb=De,e.Pc=e.Z.g,(t||0<=U(e.Z.Nc,Be)&&0<=U(e.Z.g,e.Z.Nc))&&(v(e.Z.B),y(e.Z.B),e.Z.e.Ab=null,e.zc=0)}(e),e.zc;var t,n}function I(e,t){for(;t>e.O;++e.O)e.ec[e.O]=fe({},3),e.hc[e.O]=fe({},3)}function B(e,t,n){return xe(t,e.wc,0)?8+(xe(t,e.wc,1)?8+pe(e.tc,t):pe(e.hc[n],t)):pe(e.ec[n],t)}function M(e){return e.wc=P(2),e.ec=P(16),e.hc=P(16),e.tc=fe({},8),e.O=0,e}function F(e){we(e.wc);for(var t=0;e.O>t;++t)we(e.ec[t].G),we(e.hc[t].G);we(e.tc.G)}function ee(e,t){var n,r,i,o;for(e.jb=t,i=e.a[t].r,r=e.a[t].j;e.a[t].t&&(le(e.a[i]),e.a[i].r=i-1,e.a[t].Ac&&(e.a[i-1].t=0,e.a[i-1].r=e.a[t].r2,e.a[i-1].j=e.a[t].j2)),o=i,n=r,r=e.a[o].j,i=e.a[o].r,e.a[o].j=n,e.a[o].r=t,0<(t=o););return e.mb=e.a[0].j,e.q=e.a[0].r}function N(e){for(var t=0;t<16;++t)e.nc[t]=ve(e.S,t);e.Qb=0}function j(e){var t,n,r,i,o,a,s,u;for(i=4;i<128;++i)t=(2|1&(a=H(i)))<<(r=(a>>1)-1),e.yc[i]=ye(e.Sb,t-a-1,r,i-t);for(o=0;o<4;++o){for(n=e.K[o],s=o<<6,a=0;e.$b>a;++a)e.P[s+a]=ge(n,a);for(a=14;e.$b>a;++a)e.P[s+a]+=(a>>1)-1-4<<6;for(u=128*o,i=0;i<4;++i)e.lb[u+i]=e.P[s+i];for(;i<128;++i)e.lb[u+i]=e.P[s+H(i)]+e.yc[i]}e.Mb=0}function G(e,t){q(e),function(e,t){if(e.Gc){ke(e.d,e.C,(e.l<<4)+t,1),ke(e.d,e.bb,e.l,0),e.l=e.l<7?7:10,J(e.$,e.d,0,t);var n=T(2);he(e.K[n],e.d,63),Ae(e.d,67108863,26),me(e.S,e.d,15)}}(e,t&e.y);for(var n=0;n<5;++n)Ee(e.d)}function W(e,t){var n,r,i,o,a,s,u,c,l,f,p,d,h,g,m,v,b,y,x,w,k,A,E,C,S,_,T,I,P,U,O,R,D,L,B,M,F,N,j,G,W,q,H,V,z,J,$,Y;if(e.jb!=e.q)return h=e.a[e.q].r-e.q,e.mb=e.a[e.q].j,e.q=e.a[e.q].r,h;if(e.q=e.jb=0,e.N?(d=e.vb,e.N=0):d=ie(e),_=e.D,(C=Q(e.b)+1)<2)return e.mb=-1,1;for(273<C&&(C=273),l=j=0;l<4;++l)e.x[l]=e.v[l],e.Q[l]=X(e.b,-1,e.x[l],273),e.Q[l]>e.Q[j]&&(j=l);if(e.Q[j]>=e.n)return e.mb=j,re(e,(h=e.Q[j])-1),h;if(d>=e.n)return e.mb=e.m[_-1]+4,re(e,d-1),d;if(u=K(e.b,-1),b=K(e.b,-e.v[0]-1-1),d<2&&u!=b&&e.Q[j]<2)return e.mb=-1,1;if(e.a[0].Hc=e.l,D=t&e.y,e.a[1].z=je[e.C[(e.l<<4)+D]>>>2]+ce(ae(e.A,t,e.J),7<=e.l,b,u),le(e.a[1]),N=(y=je[2048-e.C[(e.l<<4)+D]>>>2])+je[2048-e.bb[e.l]>>>2],b==u&&(G=N+($=(J=e).l,Y=D,je[J.hb[$]>>>2]+je[J._[($<<4)+Y]>>>2]),e.a[1].z>G&&(e.a[1].z=G,(z=e.a[1]).j=0,z.t=0)),(p=d>=e.Q[j]?d:e.Q[j])<2)return e.mb=e.a[1].j,1;for(e.a[1].r=0,e.a[0].bc=e.x[0],e.a[0].ac=e.x[1],e.a[0].dc=e.x[2],e.a[0].lc=e.x[3],f=p;e.a[f--].z=268435455,2<=f;);for(l=0;l<4;++l)if(!((F=e.Q[l])<2))for(B=N+ne(e,l,e.l,D);o=B+oe(e.i,F-2,D),(U=e.a[F]).z>o&&(U.z=o,U.r=0,U.j=l,U.t=0),2<=--F;);if(E=y+je[e.bb[e.l]>>>2],(f=2<=e.Q[0]?e.Q[0]+1:2)<=d){for(T=0;f>e.m[T];)T+=2;for(;o=E+te(e,c=e.m[T+1],f,D),(U=e.a[f]).z>o&&(U.z=o,U.r=0,U.j=c+4,U.t=0),f!=e.m[T]||(T+=2)!=_;++f);}for(n=0;;){if(++n==p)return ee(e,n);if(x=ie(e),_=e.D,x>=e.n)return e.vb=x,e.N=1,ee(e,n);if(++t,R=e.a[n].r,e.a[n].t?(--R,e.a[n].Ac?(q=e.a[e.a[n].r2].Hc,q=e.a[n].j2<4?q<7?8:11:q<7?7:10):q=e.a[R].Hc,q=Z(q)):q=e.a[R].Hc,R==n-1?q=e.a[n].j?Z(q):q<7?9:11:(e.a[n].t&&e.a[n].Ac?(R=e.a[n].r2,O=e.a[n].j2,q=q<7?8:11):q=(O=e.a[n].j)<4?q<7?8:11:q<7?7:10,P=e.a[R],O<4?O?1==O?(e.x[0]=P.ac,e.x[1]=P.bc,e.x[2]=P.dc,e.x[3]=P.lc):2==O?(e.x[0]=P.dc,e.x[1]=P.bc,e.x[2]=P.ac,e.x[3]=P.lc):(e.x[0]=P.lc,e.x[1]=P.bc,e.x[2]=P.ac,e.x[3]=P.dc):(e.x[0]=P.bc,e.x[1]=P.ac,e.x[2]=P.dc,e.x[3]=P.lc):(e.x[0]=O-4,e.x[1]=P.bc,e.x[2]=P.ac,e.x[3]=P.dc)),e.a[n].Hc=q,e.a[n].bc=e.x[0],e.a[n].ac=e.x[1],e.a[n].dc=e.x[2],e.a[n].lc=e.x[3],s=e.a[n].z,u=K(e.b,-1),b=K(e.b,-e.x[0]-1-1),D=t&e.y,r=s+je[e.C[(q<<4)+D]>>>2]+ce(ae(e.A,t,K(e.b,-2)),7<=q,b,u),w=0,(k=e.a[n+1]).z>r&&(k.z=r,k.r=n,k.j=-1,k.t=0,w=1),N=(y=s+je[2048-e.C[(q<<4)+D]>>>2])+je[2048-e.bb[q]>>>2],b!=u||n>k.r&&!k.j||(G=N+(je[e.hb[q]>>>2]+je[e._[(q<<4)+D]>>>2]),k.z>=G&&(k.z=G,k.r=n,k.j=0,k.t=0,w=1)),!((C=S=4095-n<(S=Q(e.b)+1)?4095-n:S)<2)){if(C>e.n&&(C=e.n),!w&&b!=u&&(V=Math.min(S-1,e.n),2<=(m=X(e.b,0,e.x[0],V)))){for(H=Z(q),L=t+1&e.y,A=r+je[2048-e.C[(H<<4)+L]>>>2]+je[2048-e.bb[H]>>>2],I=n+1+m;p<I;)e.a[++p].z=268435455;o=A+(oe(e.i,m-2,L)+ne(e,0,H,L)),(U=e.a[I]).z>o&&(U.z=o,U.r=n+1,U.j=0,U.t=1,U.Ac=0)}for(W=2,M=0;M<4;++M)if(!((g=X(e.b,-1,e.x[M],C))<2)){v=g;do{for(;p<n+g;)e.a[++p].z=268435455;o=N+(oe(e.i,g-2,D)+ne(e,M,q,D)),(U=e.a[n+g]).z>o&&(U.z=o,U.r=n,U.j=M,U.t=0)}while(2<=--g);if(g=v,M||(W=g+1),g<S&&(V=Math.min(S-1-g,e.n),2<=(m=X(e.b,g,e.x[M],V)))){for(H=q<7?8:11,L=t+g&e.y,i=N+(oe(e.i,g-2,D)+ne(e,M,q,D))+je[e.C[(H<<4)+L]>>>2]+ce(ae(e.A,t+g,K(e.b,g-1-1)),1,K(e.b,g-1-(e.x[M]+1)),K(e.b,g-1)),H=Z(H),L=t+g+1&e.y,A=i+je[2048-e.C[(H<<4)+L]>>>2]+je[2048-e.bb[H]>>>2],I=g+1+m;p<n+I;)e.a[++p].z=268435455;o=A+(oe(e.i,m-2,L)+ne(e,0,H,L)),(U=e.a[n+I]).z>o&&(U.z=o,U.r=n+g+1,U.j=0,U.t=1,U.Ac=1,U.r2=n,U.j2=M)}}if(C<x){for(x=C,_=0;x>e.m[_];_+=2);e.m[_]=x,_+=2}if(W<=x){for(E=y+je[e.bb[q]>>>2];p<n+x;)e.a[++p].z=268435455;for(T=0;W>e.m[T];)T+=2;for(g=W;;++g)if(o=E+te(e,a=e.m[T+1],g,D),(U=e.a[n+g]).z>o&&(U.z=o,U.r=n,U.j=a+4,U.t=0),g==e.m[T]){if(g<S&&(V=Math.min(S-1-g,e.n),2<=(m=X(e.b,g,a,V)))){for(H=q<7?7:10,L=t+g&e.y,i=o+je[e.C[(H<<4)+L]>>>2]+ce(ae(e.A,t+g,K(e.b,g-1-1)),1,K(e.b,g-(a+1)-1),K(e.b,g-1)),H=Z(H),L=t+g+1&e.y,A=i+je[2048-e.C[(H<<4)+L]>>>2]+je[2048-e.bb[H]>>>2],I=g+1+m;p<n+I;)e.a[++p].z=268435455;o=A+(oe(e.i,m-2,L)+ne(e,0,H,L)),(U=e.a[n+I]).z>o&&(U.z=o,U.r=n+g+1,U.j=0,U.t=1,U.Ac=1,U.r2=n,U.j2=a+4)}if((T+=2)==_)break}}}}}function te(e,t,n,r){var i,o=T(n);return(t<128?e.lb[128*o+t]:e.P[(o<<6)+(i=t,i<131072?Ne[i>>6]+12:i<134217728?Ne[i>>16]+32:Ne[i>>26]+52)]+e.nc[15&t])+oe(e.$,n-2,r)}function ne(e,t,n,r){var i;return t?(i=je[2048-e.hb[n]>>>2],1==t?i+=je[e.Ub[n]>>>2]:(i+=je[2048-e.Ub[n]>>>2],i+=Ce(e.vc[n],t-2))):(i=je[e.hb[n]>>>2],i+=je[2048-e._[(n<<4)+r]>>>2]),i}function re(e,t){0<t&&(function(e,t){var n,r,i,o,a,s,u,c,l,f,p,d,h,g,m,v,b;do{if(e.h>=e.o+e.ob)d=e.ob;else if(d=e.h-e.o,e.xb>d){_(e);continue}for(h=e.o>e.p?e.o-e.p:0,r=e.f+e.o,e.qb?(s=1023&(b=Fe[255&e.c[r]]^255&e.c[r+1]),e.ub[s]=e.o,u=65535&(b^=(255&e.c[r+2])<<8),e.ub[1024+u]=e.o,c=(b^Fe[255&e.c[r+3]]<<5)&e.Ec):c=255&e.c[r]^(255&e.c[r+1])<<8,i=e.ub[e.R+c],e.ub[e.R+c]=e.o,m=1+(e.k<<1),v=e.k<<1,f=p=e.w,n=e.Fc;;){if(i<=h||0==n--){e.L[m]=e.L[v]=0;break}if(a=e.o-i,o=(e.k>=a?e.k-a:e.k-a+e.p)<<1,g=e.f+i,l=f<p?f:p,e.c[g+l]==e.c[r+l]){for(;++l!=d&&e.c[g+l]==e.c[r+l];);if(l==d){e.L[v]=e.L[o],e.L[m]=e.L[o+1];break}}(255&e.c[r+l])>(255&e.c[g+l])?(e.L[v]=i,v=o+1,i=e.L[v],p=l):(e.L[m]=i,m=o,i=e.L[m],f=l)}_(e)}while(0!=--t)}(e.b,t),e.s+=t)}function ie(e){var t=0;return e.D=function(e,t){var n,r,i,o,a,s,u,c,l,f,p,d,h,g,m,v,b,y,x,w,k;if(e.h>=e.o+e.ob)g=e.ob;else if(g=e.h-e.o,e.xb>g)return _(e),0;for(b=0,m=e.o>e.p?e.o-e.p:0,r=e.f+e.o,v=1,l=c=0,e.qb?(c=1023&(k=Fe[255&e.c[r]]^255&e.c[r+1]),l=65535&(k^=(255&e.c[r+2])<<8),f=(k^Fe[255&e.c[r+3]]<<5)&e.Ec):f=255&e.c[r]^(255&e.c[r+1])<<8,i=e.ub[e.R+f]||0,e.qb&&(o=e.ub[c]||0,a=e.ub[1024+l]||0,e.ub[c]=e.o,e.ub[1024+l]=e.o,m<o&&e.c[e.f+o]==e.c[r]&&(t[b++]=v=2,t[b++]=e.o-o-1),m<a&&e.c[e.f+a]==e.c[r]&&(a==o&&(b-=2),t[b++]=v=3,t[b++]=e.o-a-1,o=a),0!=b&&o==i&&(b-=2,v=1)),e.ub[e.R+f]=e.o,x=1+(e.k<<1),w=e.k<<1,d=h=e.w,0!=e.w&&m<i&&e.c[e.f+i+e.w]!=e.c[r+e.w]&&(t[b++]=v=e.w,t[b++]=e.o-i-1),n=e.Fc;;){if(i<=m||0==n--){e.L[x]=e.L[w]=0;break}if(u=e.o-i,s=(e.k>=u?e.k-u:e.k-u+e.p)<<1,y=e.f+i,p=d<h?d:h,e.c[y+p]==e.c[r+p]){for(;++p!=g&&e.c[y+p]==e.c[r+p];);if(v<p&&(t[b++]=v=p,t[b++]=u-1,p==g)){e.L[w]=e.L[s],e.L[x]=e.L[s+1];break}}(255&e.c[r+p])>(255&e.c[y+p])?(e.L[w]=i,w=s+1,i=e.L[w],h=p):(e.L[x]=i,x=s,i=e.L[x],d=p)}return _(e),b}(e.b,e.m),0<e.D&&((t=e.m[e.D-2])==e.n&&(t+=X(e.b,t-1,e.m[e.D-1],273-t))),++e.s,t}function q(e){e.b&&e.W&&(e.b.cc=null,e.W=0)}function H(e){return e<2048?Ne[e]:e<2097152?Ne[e>>10]+20:Ne[e>>20]+40}function V(e,t){we(e.db);for(var n=0;n<t;++n)we(e.Vb[n].G),we(e.Wb[n].G);we(e.ic.G)}function z(e,t,n,r,i){var o,a,s,u,c;for(o=je[e.db[0]>>>2],s=(a=je[2048-e.db[0]>>>2])+je[e.db[1]>>>2],u=a+je[2048-e.db[1]>>>2],c=c=0;c<8;++c){if(n<=c)return;r[i+c]=o+ge(e.Vb[t],c)}for(;c<16;++c){if(n<=c)return;r[i+c]=s+ge(e.Wb[t],c-8)}for(;c<n;++c)r[i+c]=u+ge(e.ic,c-8-8)}function J(e,t,n,r){var i,o,a,s;i=e,o=t,s=r,(a=n)<8?(ke(o,i.db,0,0),he(i.Vb[s],o,a)):(a-=8,ke(o,i.db,0,1),a<8?(ke(o,i.db,1,0),he(i.Wb[s],o,a)):(ke(o,i.db,1,1),he(i.ic,o,a-8))),0==--e.sc[r]&&(z(e,r,e.rb,e.Cc,272*r),e.sc[r]=e.rb)}function $(e){return function(e){e.db=P(2),e.Vb=P(16),e.Wb=P(16),e.ic=de({},8);for(var t=0;t<16;++t)e.Vb[t]=de({},3),e.Wb[t]=de({},3)}(e),e.Cc=[],e.sc=[],e}function oe(e,t,n){return e.Cc[272*n+t]}function Y(e,t){for(var n=0;n<t;++n)z(e,n,e.rb,e.Cc,272*n),e.sc[n]=e.rb}function ae(e,t,n){return e.V[((t&e.qc)<<e.u)+((255&n)>>>8-e.u)]}function se(e,t,n){var r,i,o=1;for(i=7;0<=i;--i)r=n>>i&1,ke(t,e.tb,o,r),o=o<<1|r}function ue(e,t,n,r){var i,o,a,s,u=1,c=1;for(o=7;0<=o;--o)i=r>>o&1,s=c,u&&(s+=1+(a=n>>o&1)<<8,u=a==i),ke(t,e.tb,s,i),c=c<<1|i}function ce(e,t,n,r){var i,o,a=1,s=7,u=0;if(t)for(;0<=s;--s)if(o=n>>s&1,i=r>>s&1,u+=Ce(e.tb[(1+o<<8)+a],i),a=a<<1|i,o!=i){--s;break}for(;0<=s;--s)i=r>>s&1,u+=Ce(e.tb[a],i),a=a<<1|i;return u}function le(e){e.j=-1,e.t=0}function fe(e,t){return e.F=t,e.G=P(1<<t),e}function pe(e,t){var n,r=1;for(n=e.F;0!=n;--n)r=(r<<1)+xe(t,e.G,r);return r-(1<<e.F)}function de(e,t){return e.F=t,e.G=P(1<<t),e}function he(e,t,n){var r,i,o=1;for(i=e.F;0!=i;)r=n>>>--i&1,ke(t,e.G,o,r),o=o<<1|r}function ge(e,t){var n,r,i=1,o=0;for(r=e.F;0!=r;)n=t>>>--r&1,o+=Ce(e.G[i],n),i=(i<<1)+n;return o}function me(e,t,n){var r,i,o=1;for(i=0;e.F>i;++i)r=1&n,ke(t,e.G,o,r),o=o<<1|r,n>>=1}function ve(e,t){var n,r,i=1,o=0;for(r=e.F;0!=r;--r)n=1&t,t>>>=1,o+=Ce(e.G[i],n),i=i<<1|n;return o}function be(e,t,n,r,i){var o,a,s=1;for(a=0;a<r;++a)ke(n,e,t+s,o=1&i),s=s<<1|o,i>>=1}function ye(e,t,n,r){var i,o,a=1,s=0;for(o=n;0!=o;--o)i=1&r,r>>>=1,s+=je[(2047&(e[t+a]-i^-i))>>>2],a=a<<1|i;return s}function xe(e,t,n){var r,i=t[n];return(-2147483648^(r=(e.E>>>11)*i))>(-2147483648^e.Bb)?(e.E=r,t[n]=i+(2048-i>>>5)<<16>>16,-16777216&e.E||(e.Bb=e.Bb<<8|h(e.Ab),e.E<<=8),0):(e.E-=r,e.Bb-=r,t[n]=i-(i>>>5)<<16>>16,-16777216&e.E||(e.Bb=e.Bb<<8|h(e.Ab),e.E<<=8),1)}function we(e){for(var t=e.length-1;0<=t;--t)e[t]=1024}function ke(e,t,n,r){var i,o=t[n];i=(e.E>>>11)*o,r?(e.xc=w(e.xc,a(A(i),[4294967295,0])),e.E-=i,t[n]=o-(o>>>5)<<16>>16):(e.E=i,t[n]=o+(2048-o>>>5)<<16>>16),-16777216&e.E||(e.E<<=8,Ee(e))}function Ae(e,t,n){for(var r=n-1;0<=r;--r)e.E>>>=1,1==(t>>>r&1)&&(e.xc=w(e.xc,A(e.E))),-16777216&e.E||(e.E<<=8,Ee(e))}function Ee(e){var t,n,r,i,o=O((n=e.xc,r=32,i=R(n,r&=63),n[1]<0&&(i=w(i,u([2,0],63-r))),i));if(0!=o||U(e.xc,[4278190080,0])<0){for(e.mc=w(e.mc,A(e.Jb)),t=e.Oc;D(e.Ab,t+o),t=255,0!=--e.Jb;);e.Oc=O(e.xc)>>>24}++e.Jb,e.xc=u(a(e.xc,[16777215,0]),8)}function Ce(e,t){return je[(2047&(e-t^-t))>>>2]}function Se(e){for(var t,n,r,i=0,o=0,a=e.length,s=[],u=[];i<a;++i,++o){if(128&(t=255&e[i]))if(192==(224&t)){if(a<=i+1)return e;if(128!=(192&(n=255&e[++i])))return e;u[o]=(31&t)<<6|63&n}else{if(224!=(240&t))return e;if(a<=i+2)return e;if(128!=(192&(n=255&e[++i])))return e;if(128!=(192&(r=255&e[++i])))return e;u[o]=(15&t)<<12|(63&n)<<6|63&r}else{if(!t)return e;u[o]=t}16383==o&&(s.push(String.fromCharCode.apply(String,u)),o=-1)}return 0<o&&(u.length=o,s.push(String.fromCharCode.apply(String,u))),s.join("")}function _e(e){var t,n,r,i=[],o=0,a=e.length;if("object"==typeof e)return e;for(function(e,t,n,r,i){var o;for(o=t;o<n;++o)r[i++]=e.charCodeAt(o)}(e,0,a,i,0),r=0;r<a;++r)1<=(t=i[r])&&t<=127?++o:o+=!t||128<=t&&t<=2047?2:3;for(n=[],r=o=0;r<a;++r)1<=(t=i[r])&&t<=127?n[o++]=t<<24>>24:(!t||128<=t&&t<=2047?n[o++]=(192|t>>6&31)<<24>>24:(n[o++]=(224|t>>12&15)<<24>>24,n[o++]=(128|t>>6&63)<<24>>24),n[o++]=(128|63&t)<<24>>24);return n}function Te(e){return e[1]+e[0]}var t,Ie=1,Pe=2,Ue=3,Oe="function"==typeof setImmediate?setImmediate:setTimeout,Re=4294967296,De=[4294967295,-Re],Le=[0,-0x8000000000000000],Be=[0,0],Me=[1,0],Fe=function(){var e,t,n,r=[];for(e=0;e<256;++e){for(n=e,t=0;t<8;++t)0!=(1&n)?n=n>>>1^-306674912:n>>>=1;r[e]=n}return r}(),Ne=function(){var e,t,n,r=2,i=[0,1];for(n=2;n<22;++n)for(t=1<<(n>>1)-1,e=0;e<t;++e,++r)i[r]=n<<24>>24;return i}(),je=function(){var e,t,n,r=[];for(t=8;0<=t;--t)for(e=1<<9-t,n=1<<9-t-1;n<e;++n)r[n]=(t<<6)+(e-n<<6>>>9-t-1);return r}(),Ge=(t=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,f:255,m:1}],function(e){return t[e-1]||t[6]});return"undefined"==typeof onmessage||"undefined"!=typeof window&&void 0!==window.document||(onmessage=function(t){t&&t.gc&&(t.gc.action==Pe?e.decompress(t.gc.gc,t.gc.cbn):t.gc.action==Ie&&e.compress(t.gc.gc,t.gc.Rc,t.gc.cbn))}),{compress:function(e,t,r,i){var o,n,a={},s=void 0===r&&void 0===i;if("function"!=typeof r&&(n=r,r=i=0),i=i||function(e){return void 0!==n?l(e,n):void 0},r=r||function(e,t){return void 0!==n?postMessage({action:Ie,cbn:n,result:e,error:t}):void 0},s){for(a.c=d({},_e(e),Ge(t));x(a.c.yb););return f(a.c.Nb)}try{a.c=d({},_e(e),Ge(t)),i(0)}catch(e){return r(null,e)}Oe(function e(){try{for(var t,n=(new Date).getTime();x(a.c.yb);)if(o=Te(a.c.yb.Pb)/Te(a.c.Tb),200<(new Date).getTime()-n)return i(o),Oe(e,0),0;i(1),t=f(a.c.Nb),Oe(r.bind(null,t),0)}catch(e){r(null,e)}},0)},decompress:function(e,i,o){var a,n,s,u,c={},t=void 0===i&&void 0===o;if("function"!=typeof i&&(n=i,i=o=0),o=o||function(e){return void 0!==n?l(s?e:-1,n):void 0},i=i||function(e,t){return void 0!==n?postMessage({action:Pe,cbn:n,result:e,error:t}):void 0},t){for(c.d=g({},e);x(c.d.yb););return Se(f(c.d.Nb))}try{c.d=g({},e),u=Te(c.d.Tb),s=-1<u,o(0)}catch(e){return i(null,e)}Oe(function e(){try{for(var t,n=0,r=(new Date).getTime();x(c.d.yb);)if(++n%1e3==0&&200<(new Date).getTime()-r)return s&&(a=Te(c.d.yb.Z.g)/u,o(a)),Oe(e,0),0;o(1),t=Se(f(c.d.Nb)),Oe(i.bind(null,t),0)}catch(e){i(null,e)}},0)}}}();this.LZMA=this.LZMA_WORKER=e;var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),pxt,pxt,pxt,ts;pxt||(pxt={}),function(s){!function(e){function t(){return"undefined"!=typeof mscc&&!mscc.hasConsent()}e.enable=function(){if(s.aiTrackException&&s.aiTrackEvent){s.debug("setting up app insights");var a=s.tickEvent;s.tickEvent=function(e,t,n){if(a&&a(e,t,n),n&&n.interactiveConsent&&"undefined"!=typeof mscc&&!mscc.hasConsent()&&mscc.setConsent(),t){var r={},i={};for(var o in t)"string"==typeof t[o]?r[o]=t[o]:i[o]=t[o];s.aiTrackEvent(e,r,i)}else s.aiTrackEvent(e)};var r=s.reportException;s.reportException=function(e,t){r&&r(e,t);var n={target:s.appTarget.id,version:s.appTarget.versions.target};t&&s.Util.jsonMergeFrom(n,t),s.aiTrackException(e,"exception",n)};var e=s.reportError;s.reportError=function(t,n,r){e&&e(t,n,r);try{throw n}catch(e){var i={target:s.appTarget.id,version:s.appTarget.versions.target,category:t,message:n};r&&s.Util.jsonMergeFrom(i,r),s.aiTrackException(e,"error",i)}}}},e.isCookieBannerVisible=t,e.enableCookies=function(){t()&&mscc.setConsent()}}(s.analytics||(s.analytics={}))}(pxt||(pxt={})),pxt||(pxt={}),(pxt||(pxt={})).tickEvent=function(e){},function(e){(e.pxtc||(e.pxtc={})).__dummy=42}(ts||(ts={}));var pxtc=ts.pxtc;!function(e){var t;(function(f){function t(e){return e.replace(/[^\w .!?\-$]/g,function(e){var t=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-t.length)+t})}f.assert=function(e,t){if(void 0===t&&(t="Assertion failed"),!e)throw new Error(t)},f.flatClone=function(t){if(null==t)return null;var n={};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n},f.clone=function(e){return null==e?null:JSON.parse(JSON.stringify(e))},f.htmlEscape=function(e){return e?e.replace(/([^\w .!?\-$])/g,function(e){return"&#"+e.charCodeAt(0)+";"}):e},f.jsStringQuote=t,f.jsStringLiteral=function(e){return'"'+t(e)+'"'};var n="en",r={},e={};f.localizeLive=!1;var i=function(){function e(){this.translations={}}return e.prototype.key=function(e,t,n){return e+"|"+t+"|"+(n||"")},e.prototype.getAsync=function(e,t,n){return Promise.resolve(this.translations[this.key(e,t,n)])},e.prototype.setAsync=function(e,t,n,r,i){return this.translations[this.key(e,t,n)]={etag:r,strings:i,cached:!0},Promise.resolve()},e}();function o(){return n}function a(e,l){return 0==l.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,n){var r=l[parseInt(t)],i="",o=/^:f(\d*)\.(\d+)/.exec(n);if(o){var a=parseInt(o[2]),s=parseInt(o[1])||0,u=/^0/.test(o[1])?"0":" ",c=r.toFixed(a);if(0<s&&0<a&&(s+=a+1),0<s)for(;c.length<s;)c=u+c;i=c}else i=":x"==n?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==n?/^\s*[euioah]/.test(i.toLowerCase())?i="an "+i:/^\s*[bcdfgjklmnpqrstvwxz]/.test(i.toLowerCase())&&(i="a "+i):":s"==n?i=1==r?"":"s":":q"==n?i=f.htmlEscape(i):":jq"==n?i=f.jsStringQuote(i):":uri"==n?i=encodeURIComponent(i).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==n?i=encodeURI(i).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==n&&(i=(100*r).toFixed(1).toString()+"%"),i})}f.translationDb=new i,f.localeInfo=function(){return(f.localizeLive?"live-":"")+o()},f.userLanguage=o,f.setUserLanguage=function(e){n=e},f.isUserLanguageRtl=function(){return/^ar|dv|fa|ha|he|ks|ku|ps|ur|yi/i.test(n)},f._localize=function(e){return r[e]||e},f.getLocalizedStrings=function(){return r},f.setLocalizedStrings=function(e){r=e},f.translationsCache=function(){return e},f.fmt_va=a,f.fmt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return a(e,t)};var s={};f.dumpLocStats=function(){var t={};Object.keys(s).sort(function(e,t){return s[t]-s[e]}).forEach(function(e){return t[e]=e}),console.log("prioritized list of strings:"),console.log(JSON.stringify(t,null,2))};var u=!0;function c(e,t){s[e]=(s[e]||0)+1;var n=f._localize(e);return!u&&n!=e&&/\d:s\}/.test(n)&&(n=n.replace(/\{\d+:s\}/g,"")),a(n=n.replace(/\{(id|loc):[^\}]+\}/g,""),t)}f.lf_va=c,f.lf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return c(e,t)},f.rlf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return c(e,t)},f.lookup=function(e,t){return e.hasOwnProperty(t)?e[t]:null},f.isoTime=function(e){var t=new Date(1e3*e);return f.fmt("{0}-{1:f02.0}-{2:f02.0} {3:f02.0}:{4:f02.0}:{5:f02.0}",t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},f.userError=function(e){var t=new Error(e);throw t.isUserError=!0,t}})((t=e.pxtc||(e.pxtc={})).Util||(t.Util={}))}(ts||(ts={}));var lf=ts.pxtc.Util.lf,ts,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,ts,pxt,pxt,pxt,pxt,ts,pxt,pxt,ts,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt;!function(e){var t;(t=e.pxtc||(e.pxtc={})).decodeBase64=function(e){return atob(e)},t.encodeBase64=function(e){return btoa(e)}}(ts||(ts={})),function(e){var v;(function(p){function r(e,t){for(var n=0;n<t.length;++n)e.push(t[n])}function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function c(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=n.length-r);for(var o=0;o<i;++o)e[t+o]=n[r+o]}function o(e,t){return e==t?0:e<t?-1:1}function t(n,r){var i={};return function(e){var t=n(e);return i.hasOwnProperty(t)?i[t]:i[t]=r(e)}}function n(e){return e&&(e=e.replace(/\\/g,"/")),e}function a(r){return p.httpRequestCoreAsync(r).then(function(e){if(200!=e.statusCode&&304!=e.statusCode&&!r.allowHttpErrors){var t=p.lf("Bad HTTP status code: {0} at {1}; message: {2}",e.statusCode,r.url,(e.text||"").slice(0,500)),n=new Error(t);return n.statusCode=e.statusCode,Promise.reject(n)}return e.text&&/application\/json/.test(e.headers["content-type"])&&(e.json=JSON.parse(e.text)),e})}function s(e){var t="";if(!e)return t;for(var n=0;n<e.length;++n){var r=e.charCodeAt(n);if(r<=127)t+=e.charAt(n);else if(r<=2047)t+=String.fromCharCode(192|r>>6,128|63&r);else{if(55296<=r&&r<=56319){var i=e.charCodeAt(++n);isNaN(i)||(r=65536+(r-55296<<10)+(i-56320))}t+=r<=65535?String.fromCharCode(224|r>>12,128|r>>6&63,128|63&r):String.fromCharCode(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}}return t}p.bufferSerial=function(e,t,n,r){void 0===t&&(t=""),void 0===n&&(n="?"),void 0===r&&(r=255);for(var i=0;i<t.length;++i){var o=t[i];if(e[n]=(e[n]||"")+o,"\n"===o||e[n].length>r){var a=e[n];e[n]="",window.postMessage({type:"serial",id:n,data:a},"*")}}},p.fileReadAsBufferAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(new Uint8Array(n.result))},n.readAsArrayBuffer(r)}):Promise.resolve(null)},p.fileReadAsTextAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(n.result)},n.readAsText(r)}):Promise.resolve(null)},p.repeatMap=function(e,t){e=e||0;for(var n=[],r=0;r<e;++r)n.push(t(r));return n},p.listsEqual=function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},p.oops=function(e){throw void 0===e&&(e="OOPS"),new Error(e)},p.reversed=function(e){return(e=e.slice(0)).reverse(),e},p.iterMap=function(t,n){Object.keys(t).forEach(function(e){return n(e,t[e])})},p.mapMap=function(t,n){var r={};return Object.keys(t).forEach(function(e){return r[e]=n(e,t[e])}),r},p.mapStringMapAsync=function(e,n){var r={};return Promise.all(Object.keys(e).map(function(t){return n(t,e[t]).then(function(e){return r[t]=e})})).then(function(){return r})},p.values=function(t){return Object.keys(t||{}).map(function(e){return t[e]})},p.pushRange=r,p.concat=function(e){for(var t=[],n=0;n<e.length;++n)r(t,e[n]);return t},p.memcpy=c,p.uint8ArrayConcat=function(e){for(var t=0,n=0,r=e;n<r.length;n++)t+=(u=r[n]).length;for(var i=new Uint8Array(t),o=0,a=0,s=e;a<s.length;a++){var u;c(i,o,u=s[a]),o+=u.length}return i},p.jsonMergeFrom=function t(n,r){r&&Object.keys(r).forEach(function(e){i(n[e])&&i(r[e])?t(n[e],r[e]):n[e]=p.clone(r[e])})},p.jsonCopyFrom=function(e,t){for(var n=p.clone(t),r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];e[o]=n[o]}},p.jsonFlatten=function(e){var o={},a=function(e,t){if(null!==t&&"object"==typeof t){p.assert(!Array.isArray(t)),e&&(e+=".");for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];a(e+i,t[i])}}else o[e]=t};return a("",e),o},p.jsonUnFlatten=function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++)for(var i=r[n],o=t,a=i.split("."),s=0;s<a.length;++s){var u=a[s];s==a.length-1?o[u]=e[i]:("object"!=typeof o[u]&&(o[u]={}),o=o[u])}return t},p.strcmp=o,p.stringMapEq=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!t.hasOwnProperty(a))return!1;if(e[a]!==t[a])return!1}return!0},p.endsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(-t.length)!=t)},p.startsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(0,t.length)!=t)},p.contains=function(e,t){return!(e.length<t.length)&&(0==t.length||-1<e.indexOf(t))},p.replaceAll=function(e,t,n){return t?e.split(t).join(n):e},p.sortObjectFields=function(t){var e=Object.keys(t);e.sort(o);var n={};return e.forEach(function(e){return n[e]=t[e]}),n},p.chopArray=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n},p.unique=function(e,n){var r=[],i={};return e.forEach(function(e){var t=n(e);i.hasOwnProperty(t)||(i[t]=null,r.push(e))}),r},p.groupBy=function(e,n){var r={};return e.forEach(function(e){var t=n(e);r.hasOwnProperty(t)||(r[t]=[]),r[t].push(e)}),r},p.toDictionary=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=e}),n},p.toArray=function(e){if(Array.isArray(e))return e;for(var t=[],n=0;n<e.length;++n)t.push(e[n]);return t},p.indexOfMatching=function(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1},p.nextTick=function(e){Promise._async._schedule(e)},p.memoizeString=function(e){return t(function(e){return e},e)},p.memoize=t,p.debounce=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||r.apply(e,t)},i),n&&r.apply(e,t)}},p.throttle=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;a||(a=setTimeout(function(){a=null,o||r.apply(e,t)},i)),n&&r.apply(e,t)}},p.randomPermute=function(e){for(var t=0;t<e.length;++t){var n=f()%e.length,r=e[t];e[t]=e[n],e[n]=r}},p.randomPick=function(e){return 0==e.length?null:e[f()%e.length]},p.timeSince=function(e){var t=(Date.now()-(e*=1e3))/1e3;return isNaN(t)?"":t<-30?(t=-t)<60?p.lf("in a few seconds"):t<120?p.lf("in a minute"):t<3600?p.lf("in {0} minute{0:s}",Math.floor(t/60)):t<7200?p.lf("in an hour"):t<86400?p.lf("in {0} hour{0:s}",Math.floor(t/60/60)):t<2592e3?p.lf("in {0} day{0:s}",Math.floor(t/60/60/24)):t<31536e3?p.lf("in {0} month{0:s}",Math.floor(t/60/60/24/30)):p.lf("in {0} year{0:s}",Math.floor(t/60/60/24/365)):t<0?p.lf("now"):t<10?p.lf("a few seconds ago"):t<60?p.lf("{0} second{0:s} ago",Math.floor(t)):t<120?p.lf("a minute ago"):t<3600?p.lf("{0} minute{0:s} ago",Math.floor(t/60)):t<7200?p.lf("an hour ago"):t<86400?p.lf("{0} hour{0:s} ago",Math.floor(t/60/60)):t<2592e3?p.lf("{0} day{0:s} ago",Math.floor(t/60/60/24)):t<31536e3?p.lf("{0} month{0:s} ago",Math.floor(t/60/60/24/30)):p.lf("{0} year{0:s} ago",Math.floor(t/60/60/24/365))},p.unicodeToChar=function(e){return e.replace(/\\u([\d\w]{4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})},p.escapeForRegex=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},p.stripUrlProtocol=function(e){return e.replace(/.*?:\/\//g,"")},p.normalizePath=n,p.pathJoin=function(e,t){if(n(e),n(t),e||t)return e?t?("/"!==e.charAt(e.length-1)&&(e+="/"),"/"==t.charAt(0)&&(t=t.substring(1)),e+t):e:t},p.isNodeJS=!1,p.requestAsync=a,p.httpGetTextAsync=function(e){return a({url:e}).then(function(e){return e.text})},p.httpGetJsonAsync=function(e){return a({url:e}).then(function(e){return e.json})},p.httpPostJsonAsync=function(e,t){return a({url:e,data:t||{}}).then(function(e){return e.json})},p.stringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n},p.uint8ArrayToString=function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n},p.fromUTF8=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e.charCodeAt(n);t+=37==r||127<r?"%"+r.toString(16):e.charAt(n)}return decodeURIComponent(t)},p.toUTF8=s,p.toHex=function(e){for(var t="",n=0;n<e.length;++n)t+=("0"+e[n].toString(16)).slice(-2);return t},p.fromHex=function(e){for(var t=new Uint8Array(e.length>>1),n=0;n<e.length;n+=2)t[n>>1]=parseInt(e.slice(n,n+2),16);return t};var e=function(){function e(){this.promises={}}return e.prototype.enqueue=function(r,i){var o=this;return new Promise(function(e,t){var n=o.promises[r];n||(n=o.promises[r]=[]),n.push(function(){return i().finally(function(){n.shift(),0==n.length?delete o.promises[r]:n[0]()}).then(e,t)}),1==n.length&&n[0]()})},e}();p.PromiseQueue=e;var u=function(){function e(){this.waiting=[],this.available=[]}return e.prototype.drain=function(){for(var e=0,t=this.waiting;e<t.length;e++)(0,t[e])(new Error("Promise Buffer Reset"));this.waiting=[],this.available=[]},e.prototype.pushError=function(e){this.push(e)},e.prototype.push=function(e){var t=this.waiting.shift();t?t(e):this.available.push(e)},e.prototype.shiftAsync=function(e){var i=this;if(void 0===e&&(e=0),0<this.available.length){var t=this.available.shift();return t instanceof Error?Promise.reject(t):Promise.resolve(t)}return new Promise(function(t,n){var r=function(e){e instanceof Error?n(e):t(e)};i.waiting.push(r),0<e&&Promise.delay(e).then(function(){var e=i.waiting.indexOf(r);0<=e&&(i.waiting.splice(e,1),n(new Error("Timeout")))})})},e}();function l(){return Date.now()}function f(){var e=new Uint8Array(4);return p.getRandomBuf(e),new Uint32Array(e.buffer)[0]}function d(n,r,i,o){function t(){var t="https://makecode.com/api/translations?lang="+encodeURIComponent(n)+"&filename="+encodeURIComponent(r)+"&approved=true";i&&(t+="&branch="+encodeURIComponent(i));var e={};return o&&(e["If-None-Match"]=o),a({url:t,headers:e}).then(function(e){if(304!=e.statusCode)return 200==e.statusCode?(o=e.headers.ETag||"",p.translationDb.setAsync(n,r,i,o,e.json).then(function(){return e.json})):e.json},function(e){console.log("failed to load translations from "+t)})}return p.translationDb.getAsync(n,r,i).then(function(e){return e?(o=e.etag,e.cached||t().done(),e.strings):t()})}function h(e){return/^(es|pt|si|sv|zh)/i.test(e)||(e=e.split("-")[0]),e}function g(e){return e=h(e),pxt.appTarget.appTheme&&pxt.appTarget.appTheme.availableLocales&&-1<pxt.appTarget.appTheme.availableLocales.indexOf(e)}function m(e,t,n,r,i,o,a){var s=(r=h(r))+"/"+a+"/"+t;if(p.translationsCache()[s])return Promise.resolve(p.translationsCache()[s]);var u,c=t?[{branch:o,path:e+"/sim-strings.json"}]:[{branch:i,path:"strings.json"},{branch:o,path:e+"/target-strings.json"}];function l(t){t&&(u||(u={}),Object.keys(t).filter(function(e){return!!t[e]}).forEach(function(e){return u[e]=t[e]}))}if(a){var f=0;return Promise.mapSeries(c,function(e){return d(r,e.path,e.branch).then(l,function(e){console.log(e.message),++f})}).then(function(){return f&&(p.translationsCache()[s]=u),f!==c.length&&u?Promise.resolve(u):(pxt.tickEvent("translations.livetranslationsfailed"),m(e,t,n,r,i,o,!1))})}return p.httpGetJsonAsync(n+"locales/"+r+"/strings.json").then(function(e){e&&(u=e,p.translationsCache()[s]=u)},function(e){console.error("failed to load localizations")}).then(function(){return u})}p.PromiseBuffer=u,p.now=l,p.nowSeconds=function(){return Math.round(l()/1e3)},p.getMime=function(e){var t=/\.([a-zA-Z0-9]+)$/.exec(e);if(!t)return"application/octet-stream";switch(t[1].toLowerCase()){case"txt":return"text/plain";case"html":case"htm":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"ico":return"image/x-icon";case"manifest":return"text/cache-manifest";case"webmanifest":return"application/manifest+json";case"json":return"application/json";case"svg":return"image/svg+xml";case"eot":return"application/vnd.ms-fontobject";case"ttf":return"font/ttf";case"woff":return"application/font-woff";case"woff2":return"application/font-woff2";case"md":return"text/markdown";case"xml":return"application/xml";case"m4a":return"audio/m4a";case"mp3":return"audio/mp3";default:return"application/octet-stream"}},p.randomUint32=f,p.guidGen=function(){function e(){return(65536|f()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()},p.downloadLiveTranslationsAsync=d,p.isLocaleEnabled=g,p.updateLocalizationAsync=function(e,t,n,r,i,o,a,s){return(r=h(r))===p.userLanguage()||!g(r)&&!s?Promise.resolve():m(e,t,n,r,i,o,a).then(function(e){return e&&(p.setUserLanguage(r),p.setLocalizedStrings(e),a&&(p.localizeLive=!0)),Promise.resolve()})},p.downloadSimulatorLocalizationAsync=function(e,t,n,r,i,o,a){return(n=h(n))===p.userLanguage()||!g(n)&&!a?Promise.resolve(void 0):m(e,!0,t,n,r,i,o)},p.downloadTranslationsAsync=m,p.capitalize=function(e){return e?e[0].toLocaleUpperCase()+e.slice(1):e},p.uncapitalize=function(e){return(e||"").split(/(?=[A-Z])/g).join(" ").toLowerCase()},p.range=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},p.multipartPostAsync=function(e,r,t,n){void 0===r&&(r={}),void 0===t&&(t=null),void 0===n&&(n=null);var i,o,a,s="--------------------------0461489f461126c5",u="";Object.keys(r).forEach(function(e){return n=r[t=e],u+=s+"\r\n",u+='Content-Disposition: form-data; name="'+t+'"\r\n\r\n',void(u+=n+"\r\n");var t,n}),t&&(o=n,a=(i=t).split("/").reverse()[0],u+=s+"\r\n",u+='Content-Disposition: form-data; name="files['+i+']"; filename="'+a+'"\r\n',u+="\r\n",u+=o+"\r\n"),u+=s+"--\r\n";var c={url:e,method:"POST",headers:{"Content-Type":"multipart/form-data; boundary="+s.slice(2)},data:u};return p.httpRequestCoreAsync(c)},p.toDataUri=function(e,t){return/^https?:/i.test(e)?e:/^data:/i.test(e)?e:(t||/^<svg/i.test(e)&&(t="image/svg+xml"),/xml|svg/.test(t)?"data:"+t+","+encodeURIComponent(e):"data:"+(t||"image/png")+";base64,"+v.encodeBase64(s(e)))}})((v=e.pxtc||(e.pxtc={})).Util||(v.Util={}))}(ts||(ts={})),function(e){var v;(function(e){v.Util.httpRequestCoreAsync=function(u){return new Promise(function(e,t){var r,i=!1,n=v.Util.clone(u.headers)||{};r=new XMLHttpRequest,u.responseArrayBuffer&&(r.responseType="arraybuffer"),r.onreadystatechange=function(){if(!i&&4==r.readyState){i=!0;var n={statusCode:r.status,headers:{},buffer:r.responseBody||r.response,text:u.responseArrayBuffer?void 0:r.responseText};r.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t=/^\s*([^:]+): (.*)/.exec(e);t&&(n.headers[t[1].toLowerCase()]=t[2])}),e(n)}};var o,a=u.data,s=u.method||(null==a?"GET":"POST");null==a?o=null:a instanceof Uint8Array?o=a:"object"==typeof a?(o=JSON.stringify(a),n["content-type"]="application/json; charset=utf8"):"string"==typeof a?o=a:v.Util.oops("bad data"),r.open(s,u.url),Object.keys(n).forEach(function(e){r.setRequestHeader(e,n[e])}),null==o?r.send():r.send(o)})},v.Util.sha256=n,v.Util.getRandomBuf=function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())};var g=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function m(e,t){return e>>>t|e<<32-t}function p(e,t){v.Util.assert(8==e.length),v.Util.assert(64==t.length);for(var n=16;n<64;++n){var r=m(t[n-15],7)^m(t[n-15],18)^t[n-15]>>>3,i=m(t[n-2],17)^m(t[n-2],19)^t[n-2]>>>10;t[n]=t[n-16]+r+t[n-7]+i|0}var o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],f=e[6],p=e[7];for(n=0;n<64;++n){var d=p+(i=m(c,6)^m(c,11)^m(c,25))+(c&l^~c&f)+g[n]+t[n]|0,h=o&a^o&s^a&s;p=f,f=l,l=c,c=u+d|0,u=s,s=a,o=d+((r=m(a=o,2)^m(o,13)^m(o,22))+h|0)|0}e[0]+=o,e[1]+=a,e[2]+=s,e[3]+=u,e[4]+=c,e[5]+=l,e[6]+=f,e[7]+=p}function t(e){var o=new Uint32Array(8);o[0]=1779033703,o[1]=3144134277,o[2]=1013904242,o[3]=2773480762,o[4]=1359893119,o[5]=2600822924,o[6]=528734635,o[7]=1541459225;var a=new Uint32Array(64),s=64;function t(e){for(var t=e.length-(s-1),n=0;n<t;n+=s){for(var r=0;r<16;r++){var i=(r<<2)+n;a[r]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]}p(o,a)}}t(e);var n=64-(e.length+9)%64;64==n&&(n=0);for(var r=e.length-e.length%s,i=new Uint8Array(e.length-r+1+n+8),u=0;r<e.length;)i[u++]=e[r++];for(i[u++]=128;0<n--;)i[u++]=0;var c=8*e.length;for(u=i.length;0<c;)i[--u]=255&c,c>>=8;t(i);for(var l="",f=0;f<o.length;++f)l+=("000000000"+o[f].toString(16)).slice(-8);return l.toLowerCase()}function n(e){return t(v.Util.stringToUint8Array(v.Util.toUTF8(e)))}e.sha256buffer=t,e.sha256string=n})((v=e.pxtc||(e.pxtc={})).BrowserImpl||(v.BrowserImpl={}))}(ts||(ts={})),function(i){var o;i.U=pxtc.Util,i.Util=pxtc.Util,i.setAppTarget=function(e){i.appTarget=e||{};var t=i.appTarget.compile;t||(t=i.appTarget.compile={isNative:!1,hasHex:!1}),t.hasHex&&void 0===t.jsRefCounting&&(t.jsRefCounting=!0),t.hasHex||void 0!==t.floatingPoint||(t.floatingPoint=!0),t.hasHex&&!t.nativeType&&(t.nativeType=pxtc.NATIVE_TYPE_THUMB),t.nativeType!=pxtc.NATIVE_TYPE_AVR&&t.nativeType!=pxtc.NATIVE_TYPE_AVRVM||(t.shortPointers=!0,t.flashCodeAlign=16),t.nativeType==pxtc.NATIVE_TYPE_CS&&(t.floatingPoint=!0,t.needsUnboxing=!0,t.jsRefCounting=!1),t.taggedInts&&(t.floatingPoint=!0,t.needsUnboxing=!0),t.vtableShift||(t.vtableShift=2),t.useUF2||t.useELF||null!=t.noSourceInFlash||(t.noSourceInFlash=!0),i.appTarget.appTheme||(i.appTarget.appTheme={}),i.appTarget.appTheme.embedUrl||(i.appTarget.appTheme.embedUrl=i.appTarget.appTheme.homeUrl);var n=i.appTarget.compileService;n&&n.yottaTarget&&!n.yottaBinary&&(n.yottaBinary="pxt-microbit-app-combined.hex");var r=i.appTarget.appTheme;Object.keys(r).filter(function(e){return/(logo|hero)$/i.test(e)&&/^@cdnUrl@/.test(r[e])}).forEach(function(e){return r[e]=i.BrowserUtils.patchCdn(r[e])}),o=i.U.clone(i.appTarget)},i.setAppTargetVariant=function(e){if(i.appTargetVariant=e,i.appTarget=i.U.clone(o),e){if(i.appTarget.variants){var t=i.appTarget.variants[e];if(t)return void i.U.jsonMergeFrom(i.appTarget,t)}i.U.userError(lf("Variant '{0}' not defined in pxtarget.json",e))}},i.options={},i.debug="undefined"!=typeof console&&console.debug?function(e){i.options.debug&&console.debug(e)}:function(){},i.log="undefined"!=typeof console&&console.log?function(e){console.log(e)}:function(){},i.reportException=function(e,t){if(console&&(console.error(e),t))try{console.log(t)}catch(e){}},i.reportError=function(e,t,n){if(console&&(console.error(e+": "+t),n))try{i.log(JSON.stringify(n,null,2))}catch(e){}};var n={},r=i.Util.debounce(function(){i.tickEvent("activity",n),n={}},1e4,!1);function t(){return{relprefix:"/--",workerjs:"/worker.js",monacoworkerjs:"/monacoworker.js",pxtVersion:"local",pxtRelId:"",pxtCdnUrl:"/cdn/",commitCdnUrl:"/cdn/",blobCdnUrl:"/blb/",cdnUrl:"/cdn/",targetUrl:"",targetVersion:"local",targetRelId:"",targetId:i.appTarget?i.appTarget.id:"",simUrl:"/sim/simulator.html",partsUrl:"/sim/siminstructions.html"}}i.tickActivity=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.filter(function(e){return!!e}).map(function(e){return e.slice(0,64)}).forEach(function(e){return n[e]=(n[e]||0)+1}),r()},i.localWebConfig=t,i.getOnlineCdnUrl=function(){if(!i.webConfig)return null;var e=/^(https:\/\/[^\/]+)/.exec(i.webConfig.commitCdnUrl);return e?e[1]:null},i.setupWebConfig=function(e){e?i.webConfig=e:i.webConfig||(i.webConfig=t())},i.getEmbeddedScript=function(e){return i.U.lookup(i.appTarget.bundledpkgs||{},e)};var e=void 0;function a(){return e||(e=i.Cloud.downloadTargetConfigAsync().then(function(e){return e||{}},function(e){return{}})),e}function s(e){return void 0===e&&(e=null),e||(e=i.appTarget.compile),e.nativeType==ts.pxtc.NATIVE_TYPE_CS?ts.pxtc.BINARY_CS:e.useUF2?ts.pxtc.BINARY_UF2:e.useELF?ts.pxtc.BINARY_ELF:ts.pxtc.BINARY_HEX}i.targetConfigAsync=a,i.packagesConfigAsync=function(){return a().then(function(e){return e?e.packages:void 0})},i.CONFIG_NAME="pxt.json",i.SERIAL_EDITOR_FILE="serial.txt",i.CLOUD_ID="pxt/",i.BLOCKS_PROJECT_NAME="blocksprj",i.JAVASCRIPT_PROJECT_NAME="tsprj",i.outputName=s,i.isOutputText=function(e){return void 0===e&&(e=null),s(e)==ts.pxtc.BINARY_HEX||s(e)==ts.pxtc.BINARY_CS}}(pxt||(pxt={})),function(r){!function(i){var t,m="this";function n(){(t={device_while:{name:r.Util.lf("a loop that repeats while the condition is true"),tooltip:r.Util.lf("Run the same sequence of actions while the condition is met."),url:"/blocks/loops/while",category:"loops",block:{message0:r.Util.lf("while %1"),appendField:r.Util.lf("{id:while}do")}},pxt_controls_for:{name:r.Util.lf("a loop that repeats the number of times you say"),tooltip:r.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:r.Util.lf("for %1 from 0 to %2"),variable:r.Util.lf("{id:var}index"),appendField:r.Util.lf("{id:for}do")}},controls_simple_for:{name:r.Util.lf("a loop that repeats the number of times you say"),tooltip:r.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:r.Util.lf("for %1 from 0 to %2"),variable:r.Util.lf("{id:var}index"),appendField:r.Util.lf("{id:for}do")}},pxt_controls_for_of:{name:r.Util.lf("a loop that repeats for each value in an array"),tooltip:r.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:r.Util.lf("for element %1 of %2"),variable:r.Util.lf("{id:var}value"),appendField:r.Util.lf("{id:for_of}do")}},controls_for_of:{name:r.Util.lf("a loop that repeats for each value in an array"),tooltip:r.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:r.Util.lf("for element %1 of %2"),variable:r.Util.lf("{id:var}value"),appendField:r.Util.lf("{id:for_of}do")}},math_op2:{name:r.Util.lf("minimum or maximum of 2 numbers"),tooltip:{min:r.Util.lf("smaller value of 2 numbers"),max:r.Util.lf("larger value of 2 numbers")},url:"/blocks/math",operators:{op:["min","max"]},category:"math"},math_op3:{name:r.Util.lf("absolute number"),tooltip:r.Util.lf("absolute value of a number"),url:"/reference/math",category:"math",block:{message0:r.Util.lf("absolute of %1")}},math_number:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.appTarget&&r.appTarget.compile&&r.appTarget.compile.floatingPoint?r.Util.lf("a decimal number"):r.Util.lf("an integer number")},math_integer:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.Util.lf("an integer number")},math_whole_number:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.Util.lf("an whole number")},math_number_minmax:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math"},math_arithmetic:{name:r.Util.lf("arithmetic operation"),url:"/blocks/math",tooltip:{ADD:r.Util.lf("Return the sum of the two numbers."),MINUS:r.Util.lf("Return the difference of the two numbers."),MULTIPLY:r.Util.lf("Return the product of the two numbers."),DIVIDE:r.Util.lf("Return the quotient of the two numbers."),POWER:r.Util.lf("Return the first number raised to the power of the second number.")},operators:{OP:["ADD","MINUS","MULTIPLY","DIVIDE","POWER"]},category:"math",block:{MATH_ADDITION_SYMBOL:r.Util.lf("{id:op}+"),MATH_SUBTRACTION_SYMBOL:r.Util.lf("{id:op}-"),MATH_MULTIPLICATION_SYMBOL:r.Util.lf("{id:op}×"),MATH_DIVISION_SYMBOL:r.Util.lf("{id:op}÷"),MATH_POWER_SYMBOL:r.Util.lf("{id:op}**")}},math_modulo:{name:r.Util.lf("division remainder"),tooltip:r.Util.lf("Return the remainder from dividing the two numbers."),url:"/blocks/math",category:"math",block:{MATH_MODULO_TITLE:r.Util.lf("remainder of %1 ÷ %2")}},math_js_op:{name:r.Util.lf("math function"),tooltip:{sin:r.Util.lf("Returns the sine of the argument"),cos:r.Util.lf("Returns the cosine of the argument"),tan:r.Util.lf("Returns the tangent of the argument"),sqrt:r.Util.lf("Returns the square root of the argument"),ceil:r.Util.lf("Returns the lowest integer value greater than or equal to the argument"),floor:r.Util.lf("Returns the highest integer value lesser than or equal to the argument"),atan2:r.Util.lf("Returns the arctangent of the quotient of the two arguments")},url:"/blocks/math",operators:{OP:["sqrt","sin","cos","tan","ceil","floor","atan2"]},category:"math",block:{sin:r.Util.lf("{id:op}sin"),cos:r.Util.lf("{id:op}cos"),tan:r.Util.lf("{id:op}tan"),sqrt:r.Util.lf("{id:op}square root"),ceil:r.Util.lf("{id:op}ceiling"),floor:r.Util.lf("{id:op}floor"),atan2:r.Util.lf("{id:op}atan2")}},variables_change:{name:r.Util.lf("update the value of a number variable"),tooltip:r.Util.lf("Changes the value of the variable by this amount"),url:"/blocks/variables/change",category:"variables",block:{message0:r.Util.lf("change %1 by %2")}},controls_repeat_ext:{name:r.Util.lf("a loop that repeats and increments an index"),tooltip:r.Util.lf("Do some statements several times."),url:"/blocks/loops/repeat",category:"loops",block:{CONTROLS_REPEAT_TITLE:r.Util.lf("repeat %1 times"),CONTROLS_REPEAT_INPUT_DO:r.Util.lf("{id:repeat}do")}},variables_get:{name:r.Util.lf("get the value of a variable"),tooltip:r.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:r.Util.lf("Create 'set %1'")}},variables_get_reporter:{name:r.Util.lf("get the value of a variable"),tooltip:r.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:r.Util.lf("Create 'set %1'")}},variables_set:{name:r.Util.lf("assign the value of a variable"),tooltip:r.Util.lf("Sets this variable to be equal to the input."),url:"/blocks/variables/assign",category:"variables",block:{VARIABLES_SET:r.Util.lf("set %1 to %2")}},controls_if:{name:r.Util.lf("a conditional statement"),tooltip:{CONTROLS_IF_TOOLTIP_1:r.Util.lf("If a value is true, then do some statements."),CONTROLS_IF_TOOLTIP_2:r.Util.lf("If a value is true, then do the first block of statements. Otherwise, do the second block of statements."),CONTROLS_IF_TOOLTIP_3:r.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements."),CONTROLS_IF_TOOLTIP_4:r.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.")},tooltipSearch:"CONTROLS_IF_TOOLTIP_2",url:"/blocks/logic/if",category:"logic",block:{CONTROLS_IF_MSG_IF:r.Util.lf("{id:logic}if"),CONTROLS_IF_MSG_THEN:r.Util.lf("{id:logic}then"),CONTROLS_IF_MSG_ELSE:r.Util.lf("{id:logic}else"),CONTROLS_IF_MSG_ELSEIF:r.Util.lf("{id:logic}else if")}},lists_create_with:{name:r.Util.lf("create an array"),tooltip:r.Util.lf("Creates a new array."),url:"/reference/arrays/create",category:"arrays",blockTextSearch:"LISTS_CREATE_WITH_INPUT_WITH",block:{LISTS_CREATE_EMPTY_TITLE:r.Util.lf("empty array"),LISTS_CREATE_WITH_INPUT_WITH:r.Util.lf("array of"),LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:r.Util.lf("array"),LISTS_CREATE_WITH_ITEM_TITLE:r.Util.lf("value")}},lists_length:{name:r.Util.lf("array length"),tooltip:r.Util.lf("Returns the number of items in an array."),url:"/reference/arrays/length",category:"arrays",block:{LISTS_LENGTH_TITLE:r.Util.lf("length of array %1")}},lists_index_get:{name:r.Util.lf("get a value in an array"),tooltip:r.Util.lf("Returns the value at the given index in an array."),url:"/reference/arrays/get",category:"arrays",block:{message0:r.Util.lf("%1 get value at %2")}},lists_index_set:{name:r.Util.lf("set a value in an array"),tooltip:r.Util.lf("Sets the value at the given index in an array"),url:"/reference/arrays/set",category:"arrays",block:{message0:r.Util.lf("%1 set value at %2 to %3")}},logic_compare:{name:r.Util.lf("comparing two numbers"),tooltip:{LOGIC_COMPARE_TOOLTIP_EQ:r.Util.lf("Return true if both inputs equal each other."),LOGIC_COMPARE_TOOLTIP_NEQ:r.Util.lf("Return true if both inputs are not equal to each other."),LOGIC_COMPARE_TOOLTIP_LT:r.Util.lf("Return true if the first input is smaller than the second input."),LOGIC_COMPARE_TOOLTIP_LTE:r.Util.lf("Return true if the first input is smaller than or equal to the second input."),LOGIC_COMPARE_TOOLTIP_GT:r.Util.lf("Return true if the first input is greater than the second input."),LOGIC_COMPARE_TOOLTIP_GTE:r.Util.lf("Return true if the first input is greater than or equal to the second input.")},url:"/blocks/logic/boolean",category:"logic",block:{search:"= ≠ < ≤ > ≥"}},logic_operation:{name:r.Util.lf("boolean operation"),tooltip:{LOGIC_OPERATION_TOOLTIP_AND:r.Util.lf("Return true if both inputs are true."),LOGIC_OPERATION_TOOLTIP_OR:r.Util.lf("Return true if at least one of the inputs is true.")},url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_OPERATION_AND:r.Util.lf("{id:op}and"),LOGIC_OPERATION_OR:r.Util.lf("{id:op}or")}},logic_negate:{name:r.Util.lf("logical negation"),tooltip:r.Util.lf("Returns true if the input is false. Returns false if the input is true."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_NEGATE_TITLE:r.Util.lf("not %1")}},logic_boolean:{name:r.Util.lf("a `true` or `false` value"),tooltip:r.Util.lf("Returns either true or false."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_BOOLEAN_TRUE:r.Util.lf("{id:boolean}true"),LOGIC_BOOLEAN_FALSE:r.Util.lf("{id:boolean}false")}},text:{name:r.Util.lf("a piece of text"),tooltip:r.Util.lf("A letter, word, or line of text."),url:"types/string",category:"text",block:{search:r.Util.lf("a piece of text")}},text_length:{name:r.Util.lf("number of characters in the string"),tooltip:r.Util.lf("Returns the number of letters (including spaces) in the provided text."),url:"reference/text/length",category:"text",block:{TEXT_LENGTH_TITLE:r.Util.lf("length of %1")}},text_join:{name:r.Util.lf("join items to create text"),tooltip:r.Util.lf("Create a piece of text by joining together any number of items."),url:"reference/text/join",category:"text",block:{TEXT_JOIN_TITLE_CREATEWITH:r.Util.lf("join")}},procedures_defnoreturn:{name:r.Util.lf("define the function"),tooltip:r.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{PROCEDURES_DEFNORETURN_TITLE:r.Util.lf("function"),PROCEDURE_ALREADY_EXISTS:r.Util.lf("A function named '%1' already exists.")}},procedures_callnoreturn:{name:r.Util.lf("call the function"),tooltip:r.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{PROCEDURES_CALLNORETURN_TITLE:r.Util.lf("call function")}}})[pxtc.ON_START_TYPE]={name:r.Util.lf("on start event"),tooltip:r.Util.lf("Run code when the program starts"),url:"/blocks/on-start",category:"loops",block:{message0:r.Util.lf("on start %1 %2")}},t[pxtc.PAUSE_UNTIL_TYPE]={name:r.Util.lf("pause until"),tooltip:r.Util.lf("Pause execution of code until the given boolean expression is true"),url:"/blocks/pause-until",category:"loops",block:{message0:r.Util.lf("pause until %1")}}}i.MATH_FUNCTIONS={unary:["sqrt","sin","cos","tan","ceil","floor"],binary:["atan2"]},i.builtinFunctionInfo={"Math.abs":{blockId:"math_op3",params:["x"]},"Math.min":{blockId:"math_op2",params:["x","y"]},"Math.max":{blockId:"math_op2",params:["x","y"]}},i.normalizeBlock=function(e){if(!e)return e;var t=e.replace(/%\s+/g,"%");return t!=e?(r.log("block has extra spaces: "+e),e):t=t.replace(/\s*\|\s*/g,"|")},i.compileInfo=function(n){var o={parameters:[],actualNameToParam:{},definitionNameToParam:{},handlerArgs:[]},e=(n.kind==ts.pxtc.SymbolKind.Method||n.kind==ts.pxtc.SymbolKind.Property)&&!n.attributes.defaultInstance,a=!!n.attributes._def,s=a?n.attributes._def.parameters.slice(0):void 0,u=a?s.length:n.parameters?n.parameters.length:0,c=i.builtinFunctionInfo[n.qName];a&&n.attributes._expandedDef&&s.push.apply(s,n.attributes._expandedDef.parameters);var l={},f=s?s.filter(function(e){return!e.ref||(l[e.name]=e,!1)}):[];if(e&&a&&s.length){var t=l[m]||s[0],r=t.name;o.thisParameter={actualName:m,definitionName:r,shadowBlockId:t.shadowBlockId,type:n.namespace,fieldEditor:d(r,m),fieldOptions:h(r,m),shadowOptions:g(r,m)}}if(n.parameters){var p=e&&!l[m]?1:0;n.parameters.forEach(function(e,t){var n;if(l[e.name]?n=l[e.name]:p<f.length&&(n=f[p],++p),n||!a){var r=void 0;e.options&&e.options.min&&e.options.max&&(r={min:e.options.min.value,max:e.options.max.value});var i=n?n.name:c?c.params[p++]:e.name;o.parameters.push({actualName:e.name,type:e.type,defaultValue:e.default,definitionName:i,shadowBlockId:n&&n.shadowBlockId,isOptional:!!s&&s.indexOf(n)>=u,fieldEditor:d(i,e.name),fieldOptions:h(i,e.name),shadowOptions:g(i,e.name),range:r})}e.handlerParameters&&e.handlerParameters.forEach(function(t){o.handlerArgs.push({name:t.name,type:t.type,inBlockDef:!!s&&s.some(function(e){return e.ref&&e.name===t.name})})})})}return o.parameters.forEach(function(e){o.actualNameToParam[e.actualName]=e,o.definitionNameToParam[e.definitionName]=e}),o;function d(e,t){return n.attributes.paramFieldEditor&&(n.attributes.paramFieldEditor[e]||n.attributes.paramFieldEditor[t])}function h(e,t){return n.attributes.paramFieldEditorOptions&&(n.attributes.paramFieldEditorOptions[e]||n.attributes.paramFieldEditorOptions[t])}function g(e,t){return n.attributes.paramShadowOptions&&(n.attributes.paramShadowOptions[e]||n.attributes.paramShadowOptions[t])}},i.parseFields=function(e){return e.split("|").map(function(e,t){var n=/([^%]*)\s*%([a-zA-Z0-9_]+)/.exec(e);if(!n)return{n:e,ni:t};var r=n[1];return r&&(r=r.trim()),{n:e,ni:t,pre:r,p:n[2]}})},i.blockDefinitions=function(){return t||n(),t},i.getBlockDefinition=function(e){return t||n(),t[e]}}(r.blocks||(r.blocks={}))}(pxt||(pxt={})),function(_){!function(e){function t(){return"undefined"!=typeof navigator}function n(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)}function f(){return t()&&/mobi/i.test(navigator.userAgent)}function r(){return t()&&/Mac/i.test(navigator.platform)}function l(){return!!navigator&&/Linux/i.test(navigator.platform)}function p(){return t()&&/arm/i.test(navigator.platform)}function d(){return t()&&/Edge/i.test(navigator.userAgent)}function h(){return t()&&/Trident/i.test(navigator.userAgent)}function g(){return!d()&&!h()&&!!navigator&&(/Chrome/i.test(navigator.userAgent)||/Chromium/i.test(navigator.userAgent))}function m(){return!g()&&!d()&&!!navigator&&/(Safari|iPod|iPhone|iPad)/i.test(navigator.userAgent)}function v(){return!m()&&!!navigator&&(/Firefox/i.test(navigator.userAgent)||/Seamonkey/i.test(navigator.userAgent))}function b(){return t()&&/Opera|OPR/i.test(navigator.userAgent)}function y(){return t()&&/Midori/i.test(navigator.userAgent)}function x(){return t()&&/Epiphany/i.test(navigator.userAgent)}function w(){return n()?"windows":r()?"mac":l()&&p()?"rpi":l()?"linux":"unknown"}function k(){return d()?"edge":x()?"epiphany":y()?"midori":b()?"opera":h()?"ie":g()?"chrome":m()?"safari":v()?"firefox":"unknown"}function A(){if(!t())return null;var e=[];return b()&&(e=/(Opera|OPR)\/([0-9\.]+)/i.exec(navigator.userAgent)),x()?e=/Epiphany\/([0-9\.]+)/i.exec(navigator.userAgent):y()?e=/Midori\/([0-9\.]+)/i.exec(navigator.userAgent):m()?(e=/Version\/([0-9\.]+)/i.exec(navigator.userAgent))||(e=/(iPod|iPhone|iPad); CPU .*?OS (\d+)/i.exec(navigator.userAgent)):e=g()?/(Chrome|Chromium)\/([0-9\.]+)/i.exec(navigator.userAgent):d()?/Edge\/([0-9\.]+)/i.exec(navigator.userAgent):h()?/(MSIE |rv:)([0-9\.]+)/i.exec(navigator.userAgent):/(Firefox|Seamonkey)\/([0-9\.]+)/i.exec(navigator.userAgent),e&&0!=e.length?e[e.length-1]:null}e.isIFrame=function(){try{return window&&window.self!==window.top}catch(e){return!0}},e.hasNavigator=t,e.isWindows=n,e.isWindows10=function(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)&&/Windows NT 10/i.test(navigator.userAgent)},e.isMobile=f,e.isMac=r,e.isLinux=l,e.isARM=p,e.isUwpEdge=function(){return"undefined"!=typeof window&&!!window.Windows},e.isEdge=d,e.isIE=h,e.isChrome=g,e.isSafari=m,e.isFirefox=v,e.isOpera=b,e.isMidori=y,e.isEpiphany=x,e.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},e.hasPointerEvents=function(){return"undefined"!=typeof window&&!!window.PointerEvent},e.hasSaveAs=function(){return d()||h()||v()},e.os=w,e.browser=k,e.browserVersion=A;var i,E=!1;function C(){return f()&&m()&&!/downloadWindowOpen=0/i.test(window.location.href)}function u(e,t,n){var r=C(),i=A(),o=parseInt(i||"0");if(r)n?n.location.href=e:window.open(e,"_self");else if(_.BrowserUtils.isSafari()&&(o<10||0==i.indexOf("10.0")||f())){var a=document.getElementById("downloader");a||(_.debug("injecting downloader iframe"),(a=document.createElement("iframe")).id="downloader",a.style.position="absolute",a.style.right="0",a.style.bottom="0",a.style.zIndex="-1",a.style.width="1px",a.style.height="1px",document.body.appendChild(a)),a.src=e}else if(_.BrowserUtils.isEdge()||_.BrowserUtils.isIE()){var s=atob(e.split(",")[1]),u=_.Util.stringToUint8Array(s),c=new Blob([u],{type:"img/png"});window.navigator.msSaveOrOpenBlob(c,t)}else{var l=window.document.createElement("a");"string"==typeof l.download?(l.href=e,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l)):document.location.href=e}}function c(e,t){var n="data";f()&&m()&&_.appTarget.appTheme.mobileSafariDownloadProtocol&&(n=_.appTarget.appTheme.mobileSafariDownloadProtocol);var r=/downloadProtocol=([a-z0-9:/?]+)/i.exec(window.location.href);return r&&(n=r[1]),n+":"+t+";base64,"+e}function o(e,t,n,r,i){void 0===n&&(n="application/octet-stream"),_.debug("trigger download");var o=window.navigator.msSaveOrOpenBlob&&!_.BrowserUtils.isMobile(),a=c(e,t);try{if(o){var s=new Blob([_.Util.stringToUint8Array(atob(e))],{type:n});window.navigator.msSaveOrOpenBlob(s,t)}else u(a,t,r)}catch(e){i&&i(e),_.debug("saving failed")}return a}function a(e){if(/^https?:\/\//i.test(e))return e;var t=(window.MonacoPaths||{})[e];return t||(_.U.startsWith(e,_.webConfig.commitCdnUrl)?e:_.webConfig.commitCdnUrl+e)}function S(e){return e&&_.getOnlineCdnUrl()?e.replace("@cdnUrl@",_.getOnlineCdnUrl()):e}e.isBrowserSupported=function(){if(!navigator)return!0;if(/bot|crawler|spider|crawling/i.test(navigator.userAgent))return!0;var e=A(),t=parseInt(e||"0"),n=g()&&38<=t,r=v()&&31<=t,i=d(),o=m()&&9<=t,a=b()&&g()&&21<=t,s=h()&&11<=t,u=n||r||i||o||a||s,c=y()||l()&&p()&&x();return u=(u=u&&!c)||/anybrowser=(true|1)/.test(window.location.href),E||(_.log("Browser: "+k()+" "+e+" on "+w()),u||_.tickEvent("browser.unsupported."+navigator.userAgent),E=!0),u},e.devicePixelRatio=function(){return"undefined"!=typeof window&&window.screen?void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?window.screen.systemXDPI/window.screen.logicalXDPI:window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1:1},e.browserDownloadBinText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),o(ts.pxtc.encodeBase64(e),t,n,r,i)},e.browserDownloadText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),o(ts.pxtc.encodeBase64(_.Util.toUTF8(e)),t,n,r,i)},e.isBrowserDownloadInSameWindow=C,e.isBrowserDownloadWithinUserContext=function(){var e=A(),t=parseInt(e||"0");return f()&&m()&&11<=t||/downloadUserContext=1/i.test(window.location.href)},e.browserDownloadDataUri=u,e.browserDownloadUInt8Array=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),o(ts.pxtc.encodeBase64(_.Util.uint8ArrayToString(e)),t,n,r,i)},e.toDownloadDataUri=c,e.browserDownloadBase64=o,e.loadImageAsync=function(n){var r=document.createElement("img");return new Promise(function(e,t){r.onload=function(){return e(r)},r.onerror=function(){return e(void 0)},r.crossOrigin="anonymous",r.src=n})},e.loadStyleAsync=function(e,t){t&&(e="rtl"+e);var r="style-"+e;if(document.getElementById(r))return Promise.resolve();var i=a(e),n=_.Util.toArray(document.head.getElementsByTagName("link")).filter(function(e){return e.getAttribute("href")==i})[0];return n?(n.id||(n.id=r),Promise.resolve()):new Promise(function(e,t){var n=document.createElement("link");n.href=i,n.rel="stylesheet",n.type="text/css",n.id=r,n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){return t(e)}),document.head.appendChild(n)})},e.loadScriptAsync=function(e){var r=a(e);return _.debug("script: loading "+r),new Promise(function(e,t){var n=document.createElement("script");n.type="text/javascript",n.src=r,n.async=!0,n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){return t(e)}),document.body.appendChild(n)})},e.loadAjaxAsync=function(r){return new Promise(function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(200==n.status?e(n.responseText):t(n.status))},n.open("GET",r,!0),n.send()})},e.loadBlocklyAsync=function(){if(!i){_.debug("blockly: delay load");var e=_.BrowserUtils.loadStyleAsync("blockly.css",ts.pxtc.Util.isUserLanguageRtl());"undefined"==typeof Blockly&&(e=e.then(function(){return _.BrowserUtils.loadScriptAsync("pxtblockly.js")})),e=e.then(function(){_.debug("blockly: loaded")}),i=e}return i},e.patchCdn=S,e.initTheme=function(){var e=_.appTarget.appTheme;if(e&&e.accentColor){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(".ui.accent { color: "+e.accentColor+"; }\n                .ui.inverted.menu .accent.active.item, .ui.inverted.accent.menu  { background-color: "+e.accentColor+"; }")),document.getElementsByTagName("head")[0].appendChild(t)}if(_.Util.isUserLanguageRtl()){_.debug("rtl layout"),document.body.classList.add("rtl"),document.body.style.direction="rtl";var n=_.Util.toArray(document.head.getElementsByTagName("link")),r=n.filter(function(e){return _.Util.endsWith(e.getAttribute("href"),"semantic.css")})[0];if(r){var i=r.getAttribute("data-rtl");i&&(_.debug("swapping to "+i),r.setAttribute("href",i))}var o=n.filter(function(e){return _.Util.endsWith(e.getAttribute("href"),"blockly.css")})[0];if(o){var a=o.getAttribute("data-rtl");a&&(_.debug("swapping to "+a),o.setAttribute("href",a),o.removeAttribute("data-rtl"))}}var s=_.appTarget.simulator;if(s&&s.boardDefinition&&s.boardDefinition.visual){var u=s.boardDefinition.visual;u.image&&(u.image=S(u.image),u.outlineImage&&(u.outlineImage=S(u.outlineImage)))}Object.keys(_.appTarget.bundledpkgs).forEach(function(e){var t=_.appTarget.bundledpkgs[e],n=JSON.parse(t[_.CONFIG_NAME]);n.icon&&(n.icon=S(n.icon)),t[_.CONFIG_NAME]=JSON.stringify(n,null,4)})},e.changeHash=function(e,t){"#"!=e.charAt(0)&&(e="#"+e),t?window.location.hash=e:window.history.replaceState("","",e)}}(_.BrowserUtils||(_.BrowserUtils={}))}(pxt||(pxt={})),function(e){var t;(t=e.commands||(e.commands={})).deployCoreAsync=void 0,t.browserDownloadAsync=void 0,t.saveOnlyAsync=void 0,t.showUploadInstructionsAsync=void 0,t.saveProjectAsync=void 0}(pxt||(pxt={})),function(i){function e(){var e;return e||(e=i.U.isNodeJS?Promise.resolve(require("lzma")):Promise.resolve(window.LZMA)).then(function(e){return e||i.reportError("lzma","failed to load"),e}),e}i.lzmaDecompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.decompress(r,function(e,t){t&&i.debug("lzma decompression failed"),n(t?void 0:e)})}catch(e){e&&i.debug("lzma decompression failed"),n(void 0)}})})},i.lzmaCompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.compress(r,7,function(e,t){t&&i.reportException(t),n(t?void 0:new Uint8Array(e))})}catch(e){i.reportException(e),n(void 0)}})})}}(pxt||(pxt={})),function(Oe){!function(e){var Ce,Se,_e=pxtc.Util,Te=_e.lf;function Ie(n){void 0===n&&(n="namespace");var r="",i="",e=function(e,t){void 0===t&&(t=""),i!=e&&(i&&(r+="}\n"),e&&(r+=t||n+" "+e+" {\n"),i=e)},t="    ";return{setNs:e,clear:function(){i=r=""},write:function(e){e.trim()?(e=e.trim().replace(/^\s*/gm,t).replace(/^(\s*)\*/gm,function(e,t){return t+" *"}),r+=e+"\n"):r+="\n"},incrIndent:function(){t+="    "},decrIndent:function(){t=t.slice(4)},finish:function(){return e(""),r}}}function Pe(e){if(!e)return null;e=e.trim();var t=/^\((.*)\)/.exec(e);return t&&(e=t[1]),/^-?(\d+|0[xX][0-9a-fA-F]+)$/.test(e)?parseInt(e):null}e.nsWriter=Ie,e.parseCppInt=Pe;var Ue=function(n){function e(e){var t=n.call(this,e)||this;return t.isUserError=!0,t.message=e,t}return __extends(e,n),e}(Error);function c(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e[n];t+=37==r||127<r?"%"+r.toString(16):String.fromCharCode(r)}return decodeURIComponent(t)}function l(e){for(var t="",n=0;n<e.length;n+=2)t=e[n]+e[n+1]+t;return Oe.Util.assert(n==e.length),t}function o(e){var t=[65,20,14,47,184,47,162,187];e:for(var n=0;n<e.length;n+=16)if(e[n]==t[0]){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;var i=e[n+8]|e[n+9]<<8,o=e[n+10]|e[n+11]<<8|e[n+12]<<16|e[n+13]<<24,a=(n+=16)+i+o;if(!(a>e.length)){var s=e.slice(n,n+i),u=e.slice(n+i,a);return{meta:c(s),text:u}}}return null}function t(e){function t(e){return Oe.debug(e),Promise.reject(new Error(e))}var n;if(Oe.HF2.read32(e,0)==ts.pxtc.UF2.UF2_MAGIC_START0){var r=ts.pxtc.UF2.toBin(e);r&&(n=o(r.buf))}(1179403647==Oe.HF2.read32(e,0)&&(n=o(e)),58==e[0])&&(n=function(e){if(e){var r,i=0,o=0,a=0,s=0;if(e.split(/\r?\n/).forEach(function(e){var t=/^:10....0041140E2FB82FA2BB(....)(....)(....)(....)(..)/.exec(e);if(t)i=parseInt(l(t[1]),16),o=parseInt(l(t[2]),16),a=i+o,r=new Uint8Array(a);else if(0<a){if(!(t=/^:10....00(.*)(..)$/.exec(e)))return;for(var n=t[1];0<a&&0<n.length;)r[s++]=parseInt(n[0]+n[1],16),n=n.slice(2),a--}}),r&&0==a&&s==r.length){for(var t=new Uint8Array(i),n=new Uint8Array(o),u=0;u<i;++u)t[u]=r[u];for(u=0;u<o;++u)n[u]=r[i+u];return{meta:c(t),text:n}}}}(c(e)||""));if(!n||!n.meta||!n.text)return t("This .hex file doesn't contain source.");var i=JSON.parse(n.meta);return i?"LZMA"==i.compression?Oe.lzmaDecompressAsync(n.text).then(function(e){if(!e)return null;var t=e.slice(0,i.headerSize||i.metaSize||0),n=e.slice(t.length);return t&&Oe.Util.jsonCopyFrom(i,JSON.parse(t)),{meta:i,source:n}}):i.compression?t("Compression type "+i.compression+" not supported."):Promise.resolve({source:c(n.text)}):t("This .hex file is not valid.")}e.PkgConflictError=Ue,e.getExtensionInfo=function(e){for(var t={},n="dal.d.ts",r="/source/",i=0,o=e.sortedDeps();i<o.length;i++)(ie=o[i]).addSnapshot(t,[n,".h",".cpp"]);if(Se&&_e.stringMapEq(t,Se))return Oe.debug("Using cached extinfo"),Ce;Oe.debug("Generating new extinfo");var k=pxtc.emptyExtInfo(),a=Oe.appTarget.compileService;a||(a={gittag:"none",serviceId:"nocompile"}),a=_e.clone(a);var s=Oe.appTarget.compile;s||(s={isNative:!1,hasHex:!1});var u=s.nativeType==pxtc.NATIVE_TYPE_CS,c=!!a.platformioIni,l="codal"==a.buildEngine,f="dockermake"==a.buildEngine,A=!(u||c||l||f);c?r="/src/":(l||f)&&(r="/pxtapp/");var p="// Configuration defines\n",E="\nPXT_SHIMS_BEGIN\n",C="",d='#include "pxt.h"\n',h="",g="",S=function(e){return g+="   "+m+"("+_+"): "+e+"\n"},_=0,m="",T=Ie("namespace"),I=Ie("declare namespace"),P=Ie("declare namespace"),v="",U={},b={true:"1",false:"0",null:"0",NULL:"0"};function O(e){return e.trim().replace(/[\_\*]$/,"")}for(var y="",x=0,w=e.sortedDeps();x<w.length;x++){if(0<=(ie=w[x]).getFiles().indexOf(n)){var R=ie.host().readFile(ie,n);Oe.Util.assert(!!R,n+" not found in "+ie.id),R.split(/\r?\n/).forEach(function(e){var t=/^\s*(\w+) = (.*),/.exec(e);t&&(b[t[1]]=t[2])})}!y&&0<=ie.getFiles().indexOf("Makefile")&&(y=ie.host().readFile(ie,"Makefile"))}function D(e){return e.replace(/\/\/.*/,"").replace(/\/\*/,"")}var L=0,B=!1,M="",F="",N="",j=!1,G="";function W(e){return B?(G+=e+"\n",!0):/^\s*\/\*\*/.test(e)?(j=!0,F=e+"\n",/\*\//.test(e)&&(j=!1),G+="//\n",!0):j?(F+=e+"\n",/\*\//.test(e)&&(j=!1),G+="//\n",!0):/^\s*\/\/%/.test(e)?(N+=e+"\n",G+="//\n",!0):(G+=e+"\n",!1)}function q(e,t){B=!0,L=-1,P.write(""),P.write(""),(N||F)&&(P.write(F),P.write(N),F=N=""),P.write("declare const enum "+O(e)+" "+t),U[e]=!0}function H(e){var t=D(e);if(B&&0<=t.indexOf("}")&&(B=!1,P.write("}")),B){var n=/^\s*(\w+)\s*(=\s*(.*?))?,?\s*$/.exec(t);if(n){var r=n[1],i=n[3],o="";if(i){i=i.trim();var a=_e.lookup(b,i);null!=a&&(o="  // "+i,i=a),null==(L=Pe(i))&&S("cannot determine value of "+t)}else i=++L+"";P.write("    "+O(r)+" = "+i+","+o)}else P.write(e)}}function V(){I.setNs(""),I.write(""),I.write(""),(N||F)&&(I.write(F),I.write(N),F=N="")}function z(e,t){t=t.trim();var n=/(.*)=\s*(-?\w+)$/.exec(t),r="",i="";if(n&&(r=n[2],i="?",t=n[1].trim()),!(n=/^(.*?)(\w+)$/.exec(t)))return S("invalid argument: "+t),{name:"???",type:"int"};var o=n[2];e.paramDefl[o]&&(r=e.paramDefl[o],i="?");var a=r?_e.lookup(b,r):null;return null!=a&&(r=a),r&&(null==Pe(r)&&S("Invalid default value (non-integer): "+r),N+=" "+o+".defl="+r),{name:o+i,type:n[1]}}function J(e,m){var v;N=F=M="",j=!1;var b=-1;function y(){var e=M.replace(/Methods$/,"");return e==M?null:e}function x(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int32_t":case"int":return"int32";case"uint32_t":case"unsigned":return"uint32";case"TNumber":case"float":case"double":return"number";case"uint16_t":return"uint16";case"int16_t":case"short":return"int16";case"uint8_t":case"byte":return"uint8";case"int8_t":case"sbyte":return"int8";case"bool":return s.shortPointers&&S("use 'boolean' not 'bool' on 8 bit targets"),"boolean";case"StringData*":case"String":case"ImageLiteral_":case"ImageLiteral":return"string";case"Action":return"() => void";case"TValue":return"any";default:return O(e)}}function w(e){switch(e=e.replace(/\s+/g,"")){case"int32_t":case"uint32_t":case"unsigned":case"uint16_t":case"int16_t":case"short":case"uint8_t":case"byte":case"int8_t":case"sbyte":case"int":return"I";case"void":return"V";case"float":return"F";case"TNumber":return"N";case"TValue":return"T";case"bool":return"B";case"double":return"D";case"ImageLiteral_":return"T";default:return _e.lookup(U,e)?"I":"_"}}return e=e.replace(/^\s*#\s*if\s+0\s*$[^]*?^\s*#\s*endif\s*$/gm,function(e){return e.replace(/[^\n]/g,"")}),G="",B=!1,L=_=0,P.setNs(""),I.setNs(""),e.split(/\r?\n/).forEach(function(e){++_;var t=D(e);H(e);var n=/^\s*enum\s+(|class\s+|struct\s+)(\w+)\s*({|$)/.exec(t);if(n&&(q(n[2],n[3]),m||(T.setNs(M),T.write("enum "+n[2]+" : int;"))),!W(e)){/^typedef.*;\s*$/.test(e)&&(T.setNs(M),T.write(e));var r=/^\s*namespace\s+(\w+)/.exec(e);if(!r){if((r=/^PXT_ABI\((\w+)\)/.exec(e))&&(E+="PXT_FNPTR(::"+r[1]+"),\n",C+='extern "C" void '+r[1]+"();\n",k.functions.push({name:r[1],argsFmt:"",value:0})),(r=/^#define\s+PXT_COMM_BASE\s+([0-9a-fx]+)/.exec(e))&&(k.commBase=parseInt(r[1])),r=/^\s*(\w+)([\*\&]*\s+[\*\&]*)(\w+)\s*\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),N&&r){v=null;var i=pxtc.parseCommentString(N);M||S("missing namespace declaration");var o=(r[1]+r[2]).replace(/\s+/g,""),a=r[3],s=r[4];N=N.trim().replace(/ \w+\.defl=\w+/g,"");var u=w(o),c=s.split(/,/).filter(function(e){return!!e}).map(function(e){var t=z(i,e);return u+=w(t.type),t.name+": "+x(t.type)}),l=(c.length,{name:M+"::"+a,argsFmt:u,value:null});if(F)if(I.setNs(O(M)),I.write(""),I.write(F),/ImageLiteral/.test(r[4])&&!/imageLiteral=/.test(N)&&(N+=" imageLiteral=1"),N+=" shim="+l.name,I.write(N),a=O(a),y()){var f=(c[0]||"").replace(/^.*:\s*/,"").trim();f.toLowerCase()!=y().toLowerCase()&&S(Te("Invalid first argument; should be of type '{0}', but is '{1}'",y(),f)),c.shift(),0==c.length&&/\bproperty\b/.test(N)?I.write(a+": "+x(o)+";"):I.write(a+"("+c.join(", ")+"): "+x(o)+";")}else I.write("function "+a+"("+c.join(", ")+"): "+x(o)+";");return N=F="",m||(T.setNs(M),T.write(o+" "+a+"("+s+");")),k.functions.push(l),void(E+=A?"(uint32_t)(void*)::"+l.name+",\n":"PXT_FNPTR(::"+l.name+"),\n")}if(r=/^\s*(\w+)\s+(\w+)\s*;/.exec(e),N&&r){var p=pxtc.parseCommentString(N);p.indexedInstanceNS&&(v=p,I.setNs(p.indexedInstanceNS),b=0);var d=r[1],h=r[2];if(v)return N=N.trim(),N+=" fixedInstance shim="+v.indexedInstanceShim+"("+b+++")",I.write(""),I.write(F),I.write(N),I.write("const "+h+": "+x(d)+";"),void(N=F="")}return N&&e.trim()?(S("declaration not understood: "+e),void(F=N="")):void 0}if(M=r[1],y()){V();var g=y();I.setNs(M,"declare interface "+g+" {")}else(N||F)&&(V(),I.setNs(O(M)),P.setNs(O(M)))}}),G}function $(e){function b(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int":return"int32";case"uint":return"uint32";case"float":case"double":return"number";case"ushort":return"uint16";case"short":return"int16";case"byte":return"uint8";case"sbyte":return"int8";case"bool":return"boolean";case"string":case"String":return"string";case"Function":return"() => void";case"object":return"any";default:return O(e)}}function y(e){return function(e){if(e=e.replace(/\s+/g,""),_e.lookup(U,e))return!0;var t=b(e);return!("number"!=t&&!/^u?int\d+$/.test(t))}(e=e.replace(/\s+/g,""))&&(e="#"+e),e+";"}return N=F=M="",j=!1,e=e.replace(/^\s*#\s*if\s+false\s*$[^]*?^\s*#\s*endif\s*$/gm,function(e){return e.replace(/[^\n]/g,"")}),G="",B=!1,L=_=0,P.setNs(""),I.setNs(""),e.split(/\r?\n/).forEach(function(e){++_;var t=D(e);H(e);var n=/^\s*(public) enum\s+(\w+)\s*({|$)/.exec(t);if(n&&q(n[2],n[3]),!W(e)){var r=/^\s*public (static\s+|partial\s+)*class\s+(\w+)/.exec(e);if(r)return M=r[2],void((N||F)&&(V(),I.setNs(O(M)),P.setNs(O(M))));if(r=/^\s*public static (async\s+)*([\w\[\]<>]+)\s+(\w+)\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),N&&r){var i=pxtc.parseCommentString(N);M||S("missing namespace declaration");var o=r[2],a=r[3],s=r[4],u=!1;if(N=N.trim().replace(/ \w+\.defl=\w+/g,""),"Task"==o)o="void",u=!0;else{var c=/^Task<(.*)>$/.exec(o);c&&(u=!0,o=c[1])}var l=y(o);u&&(l="async;"+l,N+=" async");for(var f=[],p=0,d=s.split(/,/);p<d.length;p++){var h=d[p];if(h){var g=z(i,h),m=y(g.type);l+=m,"CTX;"!=m&&f.push(g.name+": "+b(g.type))}}var v={name:M+"::"+a,argsFmt:l,value:null};return F&&(I.setNs(O(M)),I.write(""),I.write(F),N+=" shim="+v.name,I.write(N),a=O(a),I.write("function "+a+"("+f.join(", ")+"): "+b(o)+";")),N=F="",void k.functions.push(v)}return N&&e.trim()?(S("declaration not understood: "+e),void(F=N="")):void 0}}),G}var Y=_e.clone(a.yottaConfig||{}),K={},X={};function Q(e){var t=e.config.platformio;t&&t.dependencies&&_e.jsonCopyFrom(k.platformio.dependencies,t.dependencies),k.npmDependencies&&e.config.npmDependencies&&_e.jsonCopyFrom(k.npmDependencies,e.config.npmDependencies);var n=e.config.yotta;if(n){if(n.dependencies&&_e.jsonCopyFrom(k.yotta.dependencies,n.dependencies),n.config)for(var r=_e.jsonFlatten(n.config),i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=_e.lookup(X,a),u=r[a];if(!s||s.config.yotta.configIsJustDefaults)X[a]=e,Y[a]=u;else if(Y[a]===u);else if(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts){var c=new Ue(Te("conflict on yotta setting {0} between packages {1} and {2}",a,e.id,s.id));throw c.pkg0=s,c.pkg1=e,c.settingName=a,c}}if(n.optionalConfig){r=_e.jsonFlatten(n.optionalConfig);for(var l=0,f=Object.keys(r);l<f.length;l++)u=r[a=f[l]],K[a]=u}}}if(A&&s.hasHex){var Z=a;_e.assert(!!Z.yottaCorePackage),_e.assert(!!Z.githubCorePackage),_e.assert(!!Z.gittag);var ee=Z.githubCorePackage+"#"+a.gittag;k.yotta.dependencies[Z.yottaCorePackage]=ee}if(e)for(var te=!1,ne=0,re=e.sortedDeps();ne<re.length;ne++){var ie=re[ne];g="",Q(ie),ie==e?(te=!0,I.clear(),P.clear()):_e.assert(!te);for(var oe=u?".cs":".cpp",ae=0,se=ie.getFiles();ae<se.length;ae++){var ue=se[ae],ce=!u&&_e.endsWith(ue,".h");if(ce||_e.endsWith(ue,oe)){var le=ie.config.name+"/"+ue;"base"!=ie.config.name&&"core"!=ie.config.name||!ce||(le=ue),ce&&(d+='#include "'+(A?r.slice(1):"")+le+'"\n'),null==(R=ie.readFile(ue))&&_e.userError(Te("C++ file {0} is missing in package {1}.",ue,ie.config.name)),m=le,u?(Oe.debug("Parse C#: "+le),$(R),h+='\n\n\n#line 1 "'+le+'"\n'+R):(Oe.debug("Parse C++: "+le),R=J(R,ce),k.extensionFiles[r+le]=R),0==ie.level&&(k.onlyPublic=!1),ie.verProtocol()&&"pub"!=ie.verProtocol()&&"embed"!=ie.verProtocol()&&(k.onlyPublic=!1)}!u&&(_e.endsWith(ue,".c")||_e.endsWith(ue,".S")||_e.endsWith(ue,".s"))&&(R=ie.readFile(ue),k.extensionFiles[r+ie.config.name+"/"+ue.replace(/\.S$/,".s")]=R)}g&&(v+=Te("Package {0}:\n",ie.id)+g)}v&&_e.userError(v),h+="\n#line default\n",_e.jsonCopyFrom(K,Y);var fe=_e.jsonUnFlatten(K);if(u)k.extensionFiles["/lib.cs"]=h,k.generatedFiles["/module.json"]="{}";else if(f){var pe={name:"pxt-app",private:!0,dependencies:k.npmDependencies};k.generatedFiles["/package.json"]=JSON.stringify(pe,null,4)+"\n"}else if(l){Z=a;var de=_e.clone(Z.codalDefinitions)||{},he=Z.codalTarget;"string"==typeof he&&(he+=".json");var ge={target:he,definitions:de,config:de,application:"pxtapp",output_folder:"build",pxt_gitrepo:Z.githubCorePackage,pxt_gittag:Z.gittag};_e.iterMap(_e.jsonFlatten(fe),function(e,t){e=e.replace(/^codal\./,"device.").toUpperCase().replace(/\./g,"_"),de[e]=t}),k.generatedFiles["/codal.json"]=JSON.stringify(ge,null,4)+"\n"}else if(c){var me=a.platformioIni.slice();me.push("lib_deps ="),_e.iterMap(k.platformio.dependencies,function(e,t){var n=/[@#\/]/.test(t)?t:e+"@"+t;me.push("  "+n)}),k.generatedFiles["/platformio.ini"]=me.join("\n")+"\n"}else{k.yotta.config=fe;var ve="pxt-app";a.yottaBinary&&(ve=a.yottaBinary.replace(/-combined/,"").replace(/\.hex$/,""));var be={name:ve,version:"0.0.0",description:"Auto-generated. Do not edit.",license:"n/a",dependencies:k.yotta.dependencies,targetDependencies:{},bin:"./source"};k.generatedFiles["/module.json"]=JSON.stringify(be,null,4)+"\n"}if(s.boxDebug&&(p+="#define PXT_BOX_DEBUG 1\n",p+="#define PXT_MEMLEAK_DEBUG 1\n"),s.vtableShift&&(p+="#define PXT_VTABLE_SHIFT "+s.vtableShift+"\n"),s.nativeType==pxtc.NATIVE_TYPE_AVRVM?p+="#define PXT_VM 1\n":p+="#define PXT_VM 0\n",u||(k.generatedFiles[r+"pointers.cpp"]=d+T.finish()+C+E+"\nPXT_SHIMS_END\n",k.generatedFiles[r+"pxtconfig.h"]=p,A&&(k.generatedFiles["/config.json"]=JSON.stringify(fe,null,4)+"\n"),k.generatedFiles[r+"main.cpp"]='\n#include "pxt.h"\n#ifdef PXT_MAIN\nPXT_MAIN\n#else\nint main() {\n    uBit.init();\n    pxt::start();\n    while (1) uBit.sleep(10000);\n    return 0;\n}\n#endif\n'),y){var ye=Object.keys(k.extensionFiles).concat(Object.keys(k.generatedFiles)),xe="",we=function(e,t){var n=ye.filter(function(e){return _e.endsWith(e,t)}).map(function(e){return e.slice(1)});xe+=e+" = "+n.join(" ")+"\n"};we("PXT_C",".c"),we("PXT_CPP",".cpp"),we("PXT_S",".s"),we("PXT_HEADERS",".h"),xe+="PXT_SOURCES = $(PXT_C) $(PXT_S) $(PXT_CPP)\n",xe+="PXT_OBJS = $(addprefix bld/, $(PXT_C:.c=.o) $(PXT_S:.s=.o) $(PXT_CPP:.cpp=.o))\n",k.generatedFiles["/Makefile"]=y,k.generatedFiles["/Makefile.inc"]=xe}var ke=k.extensionFiles;_e.jsonCopyFrom(ke,k.generatedFiles);var Ae={config:a.serviceId,tag:a.gittag,replaceFiles:ke,dependencies:A?k.yotta.dependencies:null},Ee=JSON.stringify(Ae);return k.sha=_e.sha256(Ee),k.compileData=ts.pxtc.encodeBase64(_e.toUTF8(Ee)),k.shimsDTS=I.finish(),k.enumsDTS=P.finish(),Se=t,Ce=k},e.unpackSourceFromHexFileAsync=function(e){if(e)return Oe.Util.fileReadAsBufferAsync(e).then(function(e){return t(new Uint8Array(e))})},e.unpackSourceFromHexAsync=t}(Oe.cpp||(Oe.cpp={}))}(pxt||(pxt={})),function(h){!function(s){var u,c={};function o(t){var n,i,e,r,o,a=Promise.resolve();return c.hasOwnProperty(t.sha)||(a=(n=t,i="",s.showLoading(h.U.lf("Compiling (this may take a minute)...")),(e=n,h.webConfig&&h.webConfig.isStatic?h.Util.requestAsync({url:h.webConfig.cdnUrl+"hexcache/"+e.sha+".hex"}).then(function(e){if(e.text){var t={enums:[],functions:[],hex:e.text.split(/\r?\n/)};return Promise.resolve(t)}return h.log("Hex info not found in bundled hex cache"),Promise.resolve()}).catch(function(e){return h.log("Error fetching hex info from bundled hex cache"),Promise.resolve()}):h.Cloud.localToken&&window&&h.Cloud.isLocalHost()?(r="compile/"+e.sha,h.Cloud.localRequestAsync(r,o).then(function(e){return e.json})).then(function(e){return e&&!e.notInOfflineCache&&e.hex?(e.hex=e.hex.split(/\r?\n/),e):Promise.resolve()}).catch(function(e){return Promise.resolve()}):Promise.resolve()).then(function(e){return e||function(){if(u)return u;var e=h.getOnlineCdnUrl();if(e)return u=Promise.resolve(e);var t=h.webConfig&&h.webConfig.isStatic;return u=h.Cloud.privateGetAsync("clientconfig",t).then(function(e){return e.primaryCdnUrl})}().then(function(e){return i=e+"/compile/"+n.sha,h.U.httpGetTextAsync(i+".hex")}).then(function(e){return e},function(e){return h.Cloud.privatePostAsync("compile/extension",{data:n.compileData}).then(function(r){return new Promise(function(t,e){var n=function(){var e=r.hex.replace(/\.hex/,".json");return h.log("polling at "+e),h.Util.httpGetJsonAsync(e).then(function(e){e.success?(h.log("fetching "+i+".hex"),t(h.U.httpGetTextAsync(i+".hex"))):h.U.userError(JSON.stringify(e,null,1))},function(e){return setTimeout(n,1e3),null})};n()})})}).then(function(e){return s.hideLoading(),{enums:[],functions:[],hex:e.split(/\r?\n/)}})}).finally(function(){s.hideLoading()})).then(function(e){c[t.sha]=e})),a.then(function(){return c[t.sha]})}function a(r,i,o,e,a){return void 0===a&&(a=10),r.cacheStoreAsync(o,e).then(function(){return r.cacheGetAsync(i)}).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){console.error("invalid cache entry, clearing entry"),t=[]}(t=t.filter(function(e){return e!=o})).unshift(o);var n=t.slice(a);return t=t.slice(0,a),Promise.map(n,function(e){return r.cacheStoreAsync(e,null)}).then(function(){return r.cacheStoreAsync(i,JSON.stringify(t))})})}function l(n,r,i){return n.cacheGetAsync(r).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){return console.error("invalid cache entry, clearing entry"),n.cacheStoreAsync(r,"[]")}return t[0]!=i?((t=t.filter(function(e){return e!=i})).unshift(i),n.cacheStoreAsync(r,JSON.stringify(t))):null})}s.showLoading=function(e){},s.hideLoading=function(){},s.storeWithLimitAsync=a,s.recordGetAsync=l,s.getHexInfoAsync=function(r,n,e){if(!n.sha)return Promise.resolve(null);if(pxtc.hex.isSetupFor(n))return Promise.resolve(pxtc.hex.currentHexInfo);h.debug("get hex info: "+n.sha);var i="hex-"+n.sha;return r.cacheGetAsync(i).then(function(e){var t;try{t=e?JSON.parse(e):null}catch(e){console.log("invalid cache entry, clearing entry"),t=null}return t&&t.hex?(h.debug("cache hit, size="+e.length),t.hex=function(e){for(var t=[],n=0;n<e.length;n++){var r=/^([@!])(....)$/.exec(e[n]);if(r){var i=parseInt(r[2],16),o=e[++n],a="";if("@"==r[1]){a="";for(var s=parseInt(o,16);0<s--;)a+="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}else a=ts.pxtc.decodeBase64(o);h.Util.assert(0<a.length),h.Util.assert(a.length%16==0);for(var u=0;u<a.length;){var c=[16,i>>8&255,255&i,0];i+=16;for(var l=0;l<16;++l)c.push(a.charCodeAt(u++));for(var f=0,l=0;l<c.length;++l)f+=c[l];c.push(255&-f);for(var p=":",l=0;l<c.length;++l){var d=255&c[l];d<=15&&(p+="0"),p+=d.toString(16)}t.push(p.toUpperCase())}}else t.push(e[n])}return t}(t.hex),l(r,"hex-keys",i).then(function(){return t})):o(n).then(function(e){var t=e.hex;e.hex=function(e){for(var t=[],n=0,r=0;r<e.length;r+=n){var i=-1,o="";n=0;for(var a=!1;n<500;){var s=/^:10(....)00(.{32})(..)$/.exec(e[r+n]);if(!s)break;var u=s[2],c=/^0+$/.test(u),l=parseInt(s[1],16);if(-1==i)a=c,t.push((a?"@":"!")+s[1]),i=l-16;else{if(c!=a)break;if(i+16!=l)break}a||(o+=u),i=l,n++}if(0==n)t.push(e[r]),n=1;else if(a)t.push(n.toString(16));else{for(var f="",p=0;p<o.length;p+=2)f+=String.fromCharCode(parseInt(o.slice(p,p+2),16));t.push(ts.pxtc.encodeBase64(f))}}return t}(e.hex);var n=JSON.stringify(e);return e.hex=t,a(r,"hex-keys",i,n).then(function(){return e})}).catch(function(e){return h.reportException(e,{sha:n.sha}),Promise.resolve(null)})})}}(h.hex||(h.hex={}))}(pxt||(pxt={})),function(h){!function(e){function p(e,t,n,r,i){h.Util.assert(!!t&&!!n&&!!r);var o="https://api.crowdin.com/api/project/"+t+"/",a="?key="+n;return e&&(i||(i={}),i.branch=e),i&&(a+="&"+Object.keys(i).map(function(e){return e+"="+encodeURIComponent(i[e])}).join("&")),o+r+a}function t(e){var t=0;return function(){if(10<t++)throw new Error("Too many API calls for "+e)}}function l(r,i,o,a,s){return a=d(a),h.debug("create directory "+(r||"")+"/"+a),s||(s=t(a)),h.Util.multipartPostAsync(p(r,i,o,"add-directory"),{json:"true",name:a}).then(function(e){if(h.debug("crowdin resp: "+e.statusCode),200==e.statusCode||400==e.statusCode)return Promise.resolve();if(500==e.statusCode&&e.text&&50===JSON.parse(e.text).error.code)return h.log("directory already exists"),Promise.resolve();var t=e.json||JSON.parse(e.text)||{error:{}};if(404==e.statusCode&&17==t.error.code){h.log("parent directory missing for "+a);var n=a.replace(/\/[^\/]+$/,"");if(n!=a)return l(r,i,o,n,s).then(function(){return l(r,i,o,a,s)})}throw new Error("cannot create directory "+(r||"")+"/"+a+": "+e.statusCode+" "+JSON.stringify(t))})}function d(e){return e.replace(/\\/g,"/")}function i(e,t){var n=h.appTarget.versions.pxtCrowdinBranch||"",r=h.appTarget.versions.targetCrowdinBranch||"",i=[];if(e.forEach(function(e){return function t(n,r,i,e){var o=r.name,a=i?i+"/"+o:o;switch(r.fullName=a,r.branch=e||"",r.node_type){case"file":n.push(r);break;case"directory":(r.files||[]).forEach(function(e){return t(n,e,a)});break;case"branch":(r.files||[]).forEach(function(e){return t(n,e,i,r.name)})}}(i,e,"")}),i=i.filter(function(e){return e.fullName.indexOf("/")<0?e.branch==n:e.branch==r}),t&&(i=i.filter(function(e){return 0==e.fullName.indexOf(t)})),"core"!=h.appTarget.id){var o=h.appTarget.id+"/";i=i.filter(function(e){return e.fullName.indexOf("/")<0||e.fullName.substr(0,o.length)==o||0<=e.fullName.indexOf("common-docs")})}return i}function r(e,t){var n=p("",e,t,"info",{json:"true"});return h.Util.httpGetTextAsync(n).then(function(e){return JSON.parse(e)})}e.KEY_VARIABLE="CROWDIN_KEY",e.downloadTranslationsAsync=function(a,s,u,c,l){void 0===l&&(l={});var e=p(a,s,u,"info",{json:"true"}),f={};return c=d(c),h.Util.httpGetTextAsync(e).then(function(e){var t=JSON.parse(e);if(!t)throw new Error("info failed");var i=t.languages;h.log("languages: "+i.map(function(e){return e.code}).join(", "));var o=function(){var n=i.pop();if(!n)return Promise.resolve();var r=p(a,s,u,"export-file",{file:c,language:n.code,export_translated_only:l.translatedOnly?"1":"0",export_approved_only:l.validatedOnly?"1":"0"});return h.log("downloading "+n.name+" - "+n.code+" ("+i.length+" more)"),h.Util.httpGetTextAsync(r).then(function(e){try{var t=JSON.parse(e);t&&(f[n.code]=t)}catch(e){h.log(r+" "+e)}return o()}).delay(1e3)};return o()}).then(function(){return f})},e.createDirectoryAsync=l,e.uploadTranslationAsync=function(r,i,o,a,n){h.Util.assert(!!i),h.Util.assert(!!o);var s=t(a=d(a));function u(){return c("update-file",{update_option:"update_as_unapproved"})}function c(e,t){return t.type="auto",t.json="",t.escape_quotes="0",s(),h.Util.multipartPostAsync(p(r,i,o,e),t,a,n).then(function(e){return function(e){var t=e.statusCode,n=JSON.parse(e.text);if(h.debug("upload result: "+t),404==t&&8==n.error.code)return h.log("create new translation file: "+a),c("add-file",{});if(404==t&&17==n.error.code)return l(r,i,o,a.replace(/\/[^\/]+$/,""),s).then(function(){return u()});if(200==t)return Promise.resolve();throw new Error("Error, upload translation: "+a+", "+e+", "+JSON.stringify(n))}(e)})}return u()},e.projectInfoAsync=r,e.listFilesAsync=function(e,t,n){return h.log("crowdin: listing files under "+n),r(e,t).then(function(e){if(!e)throw new Error("info failed");var t=i(e.files,n);return h.debug("crowdin: found "+t.length+" under "+n),t.map(function(e){return{fullName:e.fullName,branch:e.branch||""}})})},e.languageStatsAsync=function(e,t,n){var r=p("",e,t,"language-status",{language:n,json:"true"});return h.Util.httpGetJsonAsync(r).then(function(e){return i(e.files)})}}(h.crowdin||(h.crowdin={}))}(pxt||(pxt={})),function(c){!function(A){var E,I=pxtc.Util,P={},U={},e="\x3c!-- @CMD@ @ARGS@ --\x3e",O={parent:e,short:e,description:"\x3c!-- desc --\x3e"};function t(e,t,n){return e.split(t).join(n)}function n(e){return e=t(e=t(e=t(e=t(e=t(e,"&","&amp;"),"<","&lt;"),">","&gt;"),'"',"&quot;"),"'","&#39;")}function R(e){return e?n(e.replace(/\&([#a-z0-9A-Z]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1))):e}})):e}A.htmlQuote=n,A.html2Quote=R;var C=[{rx:/^vimeo\.com\/(\d+)/i,cmd:"### @vimeo $1"},{rx:/^(www\.youtube\.com\/watch\?v=|youtu\.be\/)([\w\-]+(\#t=([0-9]+m[0-9]+s|[0-9]+m|[0-9]+s))?)/i,cmd:"### @youtube $2"}];A.requireMarked=function(){return"undefined"!=typeof marked?marked:"undefined"!=typeof require?require("marked"):void 0};var D=function(e){return"<div class='ui negative message'>"+n(e)+"</div>"};function S(i){var o=I.clone(P),a=I.clone(U),s=I.clone(O),u={},c={},e=i.params,t=i.theme;i.boxes=o,i.macros=a,i.settings=s,i.html=i.html.replace(/<aside\s+([^<>]+)>([^]*?)<\/aside>/g,function(e,t,n){var r=function(e){for(var t={};e.trim();){var n=/\s*([^=\s]+)=("([^"]*)"|'([^']*)'|(\S*))/.exec(e);if(n){var r=n[3]||n[4]||n[5]||"";t[n[1].toLowerCase()]=r}else t[(n=/^\s*(\S+)/.exec(e))[1]]="true";e=e.slice(n[0].length)}return t}(t),i=r["data-name"]||r.id;return i?(/box/.test(r.class)?o[i]=n:/aside/.test(r.class)?o[i]="\x3c!-- BEGIN-ASIDE "+i+" --\x3e"+n+"\x3c!-- END-ASIDE --\x3e":/setting/.test(r.class)?s[i]=n:/menu/.test(r.class)?u[i]=n:/toc/.test(r.class)?c[i]=n:a[i]=n,"\x3c!-- macro "+i+" --\x3e"):D("id or data-name missing on macro")});var l,f=function(e,t){var n=u.item,r={NAME:e.name};if(e.subitems)n=0==t?u["top-dropdown"]:u["inner-dropdown"],r.ITEMS=e.subitems.map(function(e){return f(e,t+1)}).join("\n");else{if(/^-+$/.test(e.name)&&(n=u.divider),e.path&&!/^(https?:|\/)/.test(e.path))return D("Invalid link: "+e.path);r.LINK=e.path}return L(n,r,["ITEMS"])},p=[{name:lf("Docs"),href:"/docs"}],d=[],h=function(e){for(var t=0,n=e.subitems||[];t<n.length;t++){var r=n[t];if(h(r))return d.push(e),!0}return!(!i.filepath||0!=i.filepath.indexOf(e.path))&&(d.push(e),!0)};(t.TOC||[]).forEach(h);var g=function(e,t){var n=c.item,r={NAME:e.name};return e.path&&!/^(https?:|\/)/.test(e.path)?D("Invalid link: "+e.path):(/^\//.test(e.path)&&i.versionPath&&(e.path="/"+i.versionPath+e.path),r.LINK=e.path,0<=d.indexOf(e)?(r.ACTIVE="active",r.EXPANDED="true",l=e,p.push({name:e.name,href:e.path})):r.EXPANDED="false",e.subitems&&0<e.subitems.length?(n=0==t?""!==e.name?c["top-dropdown"]:c["top-dropdown-noHeading"]:1==t?c["inner-dropdown"]:c["nested-dropdown"],r.ITEMS=e.subitems.map(function(e){return g(e,t+1)}).join("\n")):/^-+$/.test(e.name)&&(n=c.divider),L(n,r,["ITEMS"]))};e.menu=(t.docMenu||[]).map(function(e){return f(e,0)}).join("\n"),e.TOC=(t.TOC||[]).map(function(e){return g(e,0)}).join("\n"),t.appStoreID&&(e.appstoremeta='<meta name="apple-itunes-app" content="app-id='+I.htmlEscape(t.appStoreID)+'"/>');var n="";1<p.length&&(n='\n            <nav class="ui breadcrumb" aria-label="'+lf("Breadcrumb")+'">\n                '+p.map(function(e,t){return'<a class="'+(t==p.length-1?"active":"")+' section"\n                        href="'+R(e.href)+'" aria-current="'+(t==p.length-1?"page":"")+'">'+R(e.name)+"</a>"}).join('<i class="right chevron icon divider"></i>')+"\n            </nav>"),e.breadcrumb=n,l&&(l.prevPath&&(e.prev='<a href="'+l.prevPath+'" class="navigation navigation-prev " title="'+l.prevName+'">\n                                    <i class="icon angle left"></i>\n                                </a>'),l.nextPath&&(e.next='<a href="'+l.nextPath+'" class="navigation navigation-next " title="'+l.nextName+'">\n                                    <i class="icon angle right"></i>\n                                </a>')),t.boardName&&(e.boardname=R(t.boardName)),t.boardNickname&&(e.boardnickname=R(t.boardNickname)),t.driveDisplayName&&(e.drivename=R(t.driveDisplayName)),t.homeUrl&&(e.homeurl=R(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.targetlogo=t.docsLogo?'<img aria-hidden="true" role="presentation" class="ui mini image" src="'+t.docsLogo+'" />':"";var r=i.ghEditURLs||[];if(r.length){for(var m='<p style="margin-top:1em">\n',v=lf("Edit this page on GitHub"),b=0,y=r;b<y.length;b++){m+='<a href="'+y[b]+'"><i class="write icon"></i>'+v+"</a><br>\n",v=lf("Edit template of this page on GitHub")}m+="</p>\n",e.github=m}else e.github="";var x='\n            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">'+lf("Skip to main content")+"</a>\n        ";e.accMenu=x;var w='\n            <button id="printbtn" class="circular ui icon right floated button hideprint" title="'+lf("Print this page")+'">\n                <i class="icon print"></i>\n            </button>\n        ';e.printBtn=w;var k='\n            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="'+lf("Side menu")+'" role="menu" aria-expanded="false">\n                <i class="content icon"></i>\n            </a>\n        ';e.sidebarToggle=k;var A=["tocsearch1","tocsearch2"].map(function(e){return'\n                <input type="search" name="q" placeholder="'+lf("Search...")+'" aria-label="'+lf("Search Documentation")+'">\n                <i onclick="document.getElementById(\''+e+'\').submit();" tabindex="0" class="search link icon" aria-label="'+lf("Search")+'" role="button"></i>\n            '});e.searchBar1=A[0],e.searchBar2=A[1];var E="";t.accentColor&&(E+="\n.ui.accent { color: "+t.accentColor+"; }\n.ui.inverted.accent { background: "+t.accentColor+"; }\n"),e.targetstyle=E;for(var C=0,S=Object.keys(t);C<S.length;C++){var _=S[C],T=t[_];void 0===e[_]&&"string"==typeof T&&(e[_]=T)}i.finish=function(){return L(i.html,e,["body","menu","accMenu","TOC","prev","next","printBtn","breadcrumb","targetlogo","github","JSON","appstoremeta","sidebarToggle","searchBar1","searchBar2"])}}function L(e,r,i){return void 0===i&&(i=[]),e?e.replace(/@(\w+)@/g,function(e,t){var n=I.lookup(r,t)||"";return n+="",i.indexOf(t)<0&&(n=R(n)),n}):""}A.prepTemplate=S,A.renderMarkdown=function(l){var e=!0;l.pubinfo||(e=!1,l.pubinfo={});var f=l.pubinfo;if(l.theme||(l.theme={}),delete l.pubinfo.private,f.time){var t=parseInt(f.time);f.timems||(f.timems=1e3*t+""),f.humantime||(f.humantime=I.isoTime(t))}f.name&&(f.dirname=f.name.replace(/[^A-Za-z0-9_]/g,"-"),f.title=f.name),e&&(f.JSON=JSON.stringify(f,null,4).replace(/</g,"\\u003c"));var n=l.template;n=(n=n.replace(/<!--\s*@include\s+(\S+)\s*-->/g,function(e,t){return"\x3c!-- include "+t+" --\x3e\n"+((l.theme.htmlDocIncludes||{})[t]||"")+"\n\x3c!-- end include --\x3e\n"})).replace(/<!--\s*@(ifn?def)\s+(\w+)\s*-->([^]*?)<!--\s*@endif\s*-->/g,function(e,t,n,r){return"ifdef"==t&&f[n]||"ifndef"==t&&!f[n]?"\x3c!-- "+t+" "+n+" --\x3e"+r+"\x3c!-- endif --\x3e":"\x3c!-- "+t+" "+n+" endif --\x3e"}),l.locale&&(n=_(n,l.locale).text);var p={html:n,theme:l.theme,filepath:l.filepath,versionPath:l.versionPath,ghEditURLs:l.ghEditURLs,params:f};if(S(p),!E){var o=new((E=A.requireMarked()).Renderer);o.image=function(e,t,n){var r='<img class="ui centered image" src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=this.options.xhtml?"/>":">"},o.listitem=function(e){var t=/^\s*\[( |x)\]/i.exec(e);return t?'<li class="'+(" "==t[1]?"unchecked":"checked")+'">'+e.slice(t[0].length)+"</li>\n":"<li>"+e+"</li>\n"};var a=o.link;o.link=function(e,t,n){var r=0==e.indexOf("/"),i=r?"":"_blank";return r&&p.versionPath&&(e="/"+p.versionPath+e),a.call(o,e,t,n).replace(/^<a /,"<a "+(i?'target="'+i+'"':"")+' rel="nofollow noopener" ')},o.heading=function(e,t,n){var r=/(.*)#([\w\-]+)\s*$/.exec(e),i="";return r?(e=r[1],i=r[2]):i=n.toLowerCase().replace(/[^\w]+/g,"-"),"<h"+t+' id="'+this.options.headerPrefix+i+'">'+e+"</h"+t+">"},E.setOptions({renderer:o,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!0})}var r=l.markdown;l.repo&&(r+="\n```package\n"+l.repo.name.replace(/^pxt-/,"")+"=github:"+l.repo.fullName+"#"+(l.repo.tag||"master")+"\n```\n"),r=(r=r.replace(/^\s*https?:\/\/(\S+)\s*$/gm,function(e,t){for(var n=function(e){var n=e.rx.exec(t);if(n)return{value:e.cmd.replace(/\$(\d+)/g,function(e,t){return n[parseInt(t)]||""})+"\n"}},r=0,i=C;r<i.length;r++){var o=n(i[r]);if("object"==typeof o)return o.value}return e})).replace(/@([a-z]+)@/gi,function(e,t){var n=f[t];return!n&&l.throwOnError&&I.userError("unknown macro "+t),n||"unknown macro"});var i=E(r);i=i.replace(/&lt;br\s*\/&gt;/gi,"<br/>");var d="";if(i=i.replace(/<h\d[^>]+>\s*([~@])\s*(.*?)<\/h\d>/g,function(e,t,n){var r=/^(\w+)\s+(.*)/.exec(n),i=r?r[1]:n,o=r?r[2]:"";if(o=R(o),i=R(i),"@"==t){var a=I.lookup(p.settings,i);if(null!=a)f[i]=o;else if(null==(a=I.lookup(p.macros,i)))return l.throwOnError&&I.userError("Unknown command: @"+i),D("Unknown command: @"+i);return L(a,{ARGS:o,CMD:i},["ARGS","CMD"])}if(!i){var s=d;return d="",s}var u=I.lookup(p.boxes,i);if(u){var c=u.split("@BODY@");return d=c[1],c[0].replace("@ARGS@",o)}return l.throwOnError&&I.userError("Unknown box: ~ "+i),D("Unknown box: ~ "+i)}),!f.title){var s=/<h1[^<>]*>([^<>]+)<\/h1>/.exec(i);s&&(f.title=R(s[1]))}if(!f.description){var u=/<p>([^]+?)<\/p>/.exec(i);u&&(f.description=R(u[1]))}var c=/<div class="ui embed mdvid"[^<>]+?data-placeholder="([^"]+)"[^>]*\/?>/i.exec(i)||/<img class="ui [^"]*image" src="([^"]+)"[^>]*\/?>/i.exec(i);c&&(f.cardLogo=R(c[1])),f.twitter=R(l.theme.twitter||"@msmakecode");var h,g,m={main:""};i=(i=i.replace(/<!-- BEGIN-ASIDE (\S+) -->([^]*?)<!-- END-ASIDE -->/g,function(e,t,n){var r=I.lookup(m,t);return m[t]=(r||"")+n,"\x3c!-- aside --\x3e"})).replace(/\n<\/code>/g,"</code>"),m.main=i,i="";for(var v=0,b=Object.keys(m);v<b.length;v++){var y=b[v];i+=(h=y+"-container",g=m[y],L(p.boxes[h]||"@BODY@",{BODY:g},["BODY"]))}f.body=i,f.name=f.title+" - "+f.targetname;for(var x=0,w=Object.keys(l.theme);x<w.length;x++){y=w[x];var k=l.theme[y];"string"==typeof k&&(f["theme_"+y]=k)}return p.finish()},A.embedUrl=function(e,t,n,r){return'<div style="position:relative;height:0;padding-bottom:70%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"#"+t+":"+n+'" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>'},A.runUrl=function(e,t,n){return'<div style="position:relative;height:0;padding-bottom:'+t+';overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"?id="+encodeURIComponent(n)+'" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div>'},A.codeEmbedUrl=function(e,t,n){var r=e+"---codeembed#pub:"+t;return'<div style="position:relative;height:calc('+(n=Math.ceil(n||300))+'px + 5em);width:100%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+r+'" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-scripts allow-same-origin"></iframe></div>'};var u={b:1,strong:1,em:1};function _(e,i){var o={};function a(e){var t=/^(\s*)([^]*?)(\s*)$/.exec(e),n=t[2].replace(/\s+/g," ");if(""==n||/^((IE=edge,.*|width=device-width.*|(https?:\/\/|\/)[\w@\/\.]+|@[\-\w]+@|\{[^\{\}]+\}|[^a-zA-Z]*|(&nbsp;)+)\s*)+$/.test(n))return null;var r=I.lookup(i,n);return r?n=r:o[n]="",t[1]+n+t[3]}function s(e){return e.replace(/&llt;/g,"<").replace(/&ggt;/g,">")}return{text:e=(e=(e=(e="<start>"+(e=e.replace(/<([\/\w]+)([^<>]*)>/g,function(e,t,n){var r=t.replace(/^\//,"").toLowerCase();return 1===u[r]?"&llt;"+t+n+"&ggt;":e}))).replace(/(<([\/\w]+)([^<>]*)>)([^<>]+)/g,function(e,t,n,r,i){if("script"==n||"style"==n)return s(e);var o=a(s(i));return null==o?s(e):t+o})).replace(/(<[^<>]*)(content|placeholder|alt|title)="([^"]+)"/g,function(e,t,n,r){return null==a(r)?e:t+n+'="'+r.replace(/"/g,"''")+'"'})).replace(/^<start>/g,""),missing:o}}function v(e,a){for(var s=0,u=[{level:0,id:"",title:"",start:s,text:"",children:[]}],t=(e=e.replace(/\r/g,"")).split(/\n/),c={},n=function(e){var t=/^\s*(#+)\s*(.*?)(#(\S+)\s*)?$/.exec(e),n=null;if(a&&t)if(t[4])if(c[t[4]])t=null;else{n=function e(t,n){if(t.id==n)return t;for(var r=0,i=t.children;r<i.length;r++){var o=e(i[r],n);if(o)return o}return null}(a,t[4]);var r=function(e){e.id&&(c[e.id]=!0),e.children.forEach(r)};n&&r(n)}else t=null;if(t){var i={level:a?1:t[1].length,title:t[2].trim(),id:t[4]||"",start:s,text:"",children:[]};if(n){e="";for(var o=0;o<n.level;++o)e+="#";e+=" ",e+=i.title||n.title,e+=" #"+i.id}for(;u[u.length-1].level>=i.level;)u.pop();u[u.length-1].children.push(i),u.push(i)}u[u.length-1].text+=e+"\n",s++},r=0,i=t;r<i.length;r++){n(i[r])}return u[0]}A.translate=_,A.buildTOC=function(e){if(!e)return null;var t=c.docs.requireMarked(),n={renderer:new t.Renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,smartypants:!1},r={name:"dummy",subitems:[]},i=[];i.push(r),t.lexer(e,n).forEach(function(e){switch(e.type){case"heading":e.depth;break;case"list_start":break;case"list_item_start":case"loose_item_start":i.push({name:"",subitems:[]});break;case"text":e.text.replace(/^\[(.*)\]\((.*)\)$/i,function(e,t,n){i[i.length-1].name=t,i[i.length-1].path=n.replace(".md","")});break;case"list_item_end":case"loose_item_end":var t=i.pop();i[i.length-1].subitems.push(t)}});var o,a=r.subitems;if(!a||0==a.length)return null;var s=function(e){o&&(e.prevName=o.name,e.prevPath=o.path,o.nextName=e.name,o.nextPath=e.path),e.path&&(o=e),e.subitems.forEach(function(e,t){s(e)})};return a.forEach(function(e,t){s(e)}),a};var b=!(A.visitTOC=function(e,t){e.forEach(function(e){t(e),e.subitems&&e.subitems.forEach(t)})});function y(e,t){if(b||function(){function e(e,t,n){var r=y(e,t).trim();if(n=n.trim(),r!=n)throw console.log("*** Template:\n"+e+"\n*** Input:\n"+t+"\n*** Expected:\n"+n+"\n*** Output:\n"+r),new Error("augment docs test fail")}b=!0;var t="\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nTEx2\n### Example 3\nTEx3\n\n## See also #also\nTAlso\n";e(t,"",t),e(t," ",t),e(t,"\n# @extends\n# #ex2\nMy example\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nMy example\n### Example 3\nTEx3\n\n## See Also These! #also\nMy links\n"),e(t,"\n# @extends\n### #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n")}(),!t)return e;for(var n=v(e,null),r=v(t,n),i={},o={},a=0,s=r.children;a<s.length;a++){var u=s[a];I.assert(0==u.children.length),I.assert(!!u.id),i[u.id]=u.text}var c=function(e){e.id&&void 0!==i[e.id]&&(o[e.id]=!0,e.text=i[e.id],e.children=[]),e.children.forEach(c)};c(n);var l="",f=function(e){l+=e.text,e.children.forEach(f)};f(n);var p="",d=r.text.replace(/^\s*#+\s*@extends.*/gm,"").replace(/^\s*\n/gm,"");d.trim()&&(p+=d.trim()+"\n");for(var h=0,g=r.children;h<g.length;h++){var m=g[h];o[m.id]||(p+=m.text)}return p&&(l+="## Couldn't apply replacement logic to:\n"+p),l}A.augmentDocs=y}(c.docs||(c.docs={}))}(pxt||(pxt={})),function(a){!function(e){function n(e,t){if(t){var n=/```(blocks?|typescript)\s+((.|\s)+?)\s*```/i.exec(t);if(n){var r=/```package\s+((.|\s)+?)\s*```/i.exec(t),i=void 0;r&&(i={},r[1].split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).map(function(e){return e.split("=")}).forEach(function(e){return i[e[0]]=e[1]||"*"}));var o=n[2],a=t.substring(0,n.index).replace(/^(#+.*|\s*)$/gim,"").trim();return a&&(o="/**\n"+a.split("\n").map(function(e){return"* "+e}).join("\n")+"\n*/\n"+o),{name:e,filesOverride:{"main.blocks":'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',"main.ts":o},dependencies:i}}}}function t(e){if(!e)return[];var n=[],r=!1,i=void 0,o="";return e.split(/\r?\n/).forEach(function(e){if(/^##/.test(e))i=e.substr(2).trim();else if(/^```codecard$/.test(e))r=!0;else if(/^```$/.test(e)){if(r=!1,i&&o)try{var t=JSON.parse(o);t&&0<t.length&&n.push({name:i,cards:t})}catch(e){a.log("invalid card format in gallery")}o="",i=void 0}else r&&(o+=e+"\n")}),n}e.parseExampleMarkdown=n,e.parseGalleryMardown=t,e.loadGalleryAsync=function(e){return a.Cloud.downloadMarkdownAsync(e,a.Util.userLanguage(),a.Util.localizeLive).then(function(e){return t(e)})},e.loadExampleAsync=function(t,e){return a.Cloud.downloadMarkdownAsync(e,a.Util.userLanguage(),a.Util.localizeLive).then(function(e){return n(t,e)})}}(a.gallery||(a.gallery={}))}(pxt||(pxt={})),function(m){!function(r){function s(){return!m.U.isNodeJS&&!(m.appTarget&&m.appTarget.cloud&&m.appTarget.cloud.noGithubProxy)}r.useProxy=s;var a,e,t=function(){function e(){this.configs={},this.packages={}}return e.prototype.proxyLoadPackageAsync=function(e,t){var n=this,r=e+"/"+t,i=this.packages[r];return i?(m.debug("github cache "+e+"/"+t+"/text"),Promise.resolve(i)):m.U.httpGetJsonAsync(m.Cloud.apiRoot+"gh/"+e+"/"+t+"/text").then(function(e){return n.packages[r]={files:e}})},e.prototype.loadConfigAsync=function(e,t){var n=this;t||(t="master");var r=e+"/"+t,i=this.configs[r];if(i)return m.debug("github cache "+e+"/"+t+"/config"),Promise.resolve(m.U.clone(i));var o=function(e){var t=JSON.parse(e);return n.configs[r]=t,m.U.clone(t)};if(s())return this.proxyLoadPackageAsync(e,t).then(function(e){return o(e.files[m.CONFIG_NAME])});var a="https://raw.githubusercontent.com/"+e+"/"+t+"/"+m.CONFIG_NAME;return m.U.httpGetTextAsync(a).then(function(e){return o(e)})},e.prototype.loadPackageAsync=function(n,o){var a=this;return o||(o="master"),s()?this.proxyLoadPackageAsync(n,o).then(function(e){return m.U.clone(e)}):u(n,o).then(function(e){var r=n+"/"+e,t=a.packages[r];if(t)return m.debug("github cache "+n+"/"+o+"/text"),Promise.resolve(m.U.clone(t));var i="https://raw.githubusercontent.com/"+n+"/"+e+"/";return m.log("Downloading "+n+"/"+o+" -> "+e),m.U.httpGetTextAsync(i+m.CONFIG_NAME).then(function(e){var n={files:{}};n.files[m.CONFIG_NAME]=e;var t=JSON.parse(e);return Promise.map(t.files.concat(t.testFiles||[]),function(t){return m.U.httpGetTextAsync(i+t).then(function(e){n.files[t]=e})}).then(function(){return a.packages[r]=n,m.U.clone(n)})})})},e}();function i(e,n){void 0===n&&(n="tags");var o=null,t=m.U.httpGetJsonAsync(m.Cloud.apiRoot+"gh/"+e+"/refs").then(function(t){var e=Object.keys(t.refs).filter(function(e){return m.U.startsWith(e,"refs/"+n+"/")}).map(function(e){return{ref:e,object:{sha:t.refs[e]}}});return o=t.refs.HEAD,e}),a=function(e){return e.replace(/^refs\/[^\/]+\//,"")};return t.then(function(e){e.sort(function(e,t){return m.semver.strcmp(a(e.ref),a(t.ref))});for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[a(i.ref)]=i.object.sha}return{refs:t,head:o}},function(e){return 404==e.statusCode?{refs:{}}:Promise.reject(e)})}function o(e){return"commit"==e.object.type?Promise.resolve(e.object.sha):"tag"==e.object.type?m.U.httpGetJsonAsync(e.object.url).then(function(e){return"commit"==e.object.type?e.object.sha:Promise.reject(new Error("Bad type (2nd order) "+e.object.type))}):Promise.reject(new Error("Bad type "+e.object.type))}function u(t,n){return/^[a-f0-9]{40}$/.test(n)?Promise.resolve(n):m.U.httpGetJsonAsync("https://api.github.com/repos/"+t+"/git/refs/tags/"+n).then(o,function(e){return m.U.httpGetJsonAsync("https://api.github.com/repos/"+t+"/git/refs/heads/"+n).then(o)})}function n(e){return m.Cloud.apiRoot+"gh/"+e.fullName+"/icon"}function c(e,t,n){if(e){var r={owner:e.owner.login.toLowerCase(),fullName:e.full_name.toLowerCase(),name:e.name,description:e.description,defaultBranch:e.default_branch,tag:n};return r.status=l(r,t),r}}function l(e,t){return f(e,t)?a.Banned:(o=r=t,(i=n=e)&&o&&i.owner&&o.approvedOrgs&&o.approvedOrgs.some(function(e){return e.toLowerCase()==i.owner.toLowerCase()})||n&&r&&n.fullName&&r.approvedRepos&&r.approvedRepos.some(function(e){return e.toLowerCase()==n.fullName.toLowerCase()})?a.Approved:a.Unknown);var n,r,i,o}function f(t,e){return n=t,!(!(r=e)||n&&n.owner&&(!r.bannedOrgs||!r.bannedOrgs.some(function(e){return e.toLowerCase()==n.owner.toLowerCase()})))||!!e&&(!t||!t.fullName||!(!e.bannedRepos||!e.bannedRepos.some(function(e){return e.toLowerCase()==t.fullName.toLowerCase()})));var n,r}function p(e,t){var n=h(e),r=l(n,t);return r==a.Banned?Promise.resolve(void 0):s()?m.Util.httpGetJsonAsync(m.Cloud.apiRoot+"gh/"+n.fullName).then(function(e){if(e)return{github:!0,owner:n.owner,fullName:n.fullName,name:e.name,description:e.description,defaultBranch:"master",tag:n.tag,status:r}}):m.U.httpGetJsonAsync("https://api.github.com/repos/"+n.fullName).then(function(e){return c(e,t,n.tag)})}function d(e){if(e){var t=/^((https:\/\/)?github.com\/)?([^/]+\/[^/#]+)(#(\w+))?$/i.exec(e.trim());if(t){var n={repo:t?t[3].toLowerCase():null,tag:t?t[5]:null};return n.path=n.repo+(n.tag?"#"+n.tag:""),n}}}function h(e){if(e){e=e.replace(/^github:/i,"");var t=/([^#]+)(#(.*))?/.exec(e);return{owner:t?t[1].split("/")[0].toLowerCase():void 0,fullName:t?t[1].toLowerCase():e.toLowerCase(),tag:t?t[3]:null}}}function g(e){return e?"github:"+e.fullName.toLowerCase()+"#"+(e.tag||"master"):void 0}r.MemoryGithubDb=t,r.db=new t,r.listRefsAsync=function(e,t){return void 0===t&&(t="tags"),i(e,t).then(function(e){return Object.keys(e.refs)})},r.listRefsExtAsync=i,r.pkgConfigAsync=function(e,t){return void 0===t&&(t="master"),r.db.loadConfigAsync(e,t)},r.downloadPackageAsync=function(e,t){var n=h(e);return n?f(n,t)?(m.tickEvent("github.download.banned"),m.log("Github repo is banned"),Promise.resolve(void 0)):r.db.loadPackageAsync(n.fullName,n.tag):(m.log("Unknown github syntax"),Promise.resolve(void 0))},(e=a=r.GitRepoStatus||(r.GitRepoStatus={}))[e.Unknown=0]="Unknown",e[e.Approved=1]="Approved",e[e.Banned=2]="Banned",r.repoIconUrl=function(e){if(e.status==a.Approved)return n(e)},r.mkRepoIconUrl=n,r.repoStatus=l,r.repoAsync=p,r.searchAsync=function(e,t){if(!t)return Promise.resolve([]);var n=e.split("|").map(d).filter(function(e){return!!e});return 0<n.length?Promise.all(n.map(function(e){return p(e.path,t)})).then(function(e){return e.filter(function(e){return e.status!=a.Banned})}):(e+=' in:name,description,readme "for PXT/'+(m.appTarget.platformid||m.appTarget.id)+'"',m.U.httpGetJsonAsync("https://api.github.com/search/repositories?q="+encodeURIComponent(e)).then(function(e){return e.items.map(function(e){return c(e,t)}).filter(function(e){return e.status==a.Approved||t.allowUnapproved&&e.status==a.Unknown})}).catch(function(e){return[]}))},r.parseRepoUrl=d,r.parseRepoId=h,r.isGithubId=function(e){return"github:"==e.slice(0,7)},r.stringifyRepo=g,r.noramlizeRepoId=function(e){return g(h(e))},r.latestVersionAsync=function(e,t){var n=h(e);return n?p(n.fullName,t).then(function(n){if(n)return i(n.fullName,"tags").then(function(e){var t=Object.keys(e.refs);return t.reverse(),(t=t.filter(function(e){return/^v\d+(\.\d+(\.\d+)?)?$/i.test(e)}))[0]?Promise.resolve(t[0]):e.head||u(n.fullName,n.defaultBranch)})}):Promise.resolve(null)},r.publishGistAsync=function(e,t,n,r,i){var o,a={description:r,public:!1,files:n},s={},u="https://api.github.com/gists";return e&&(s.Authorization="token "+e),i&&e&&!t?(o="PATCH",u+="/"+i):o="POST",m.U.requestAsync({url:u,allowHttpErrors:!0,headers:s,method:o,data:a}).then(function(e){return 200!=e.statusCode&&201!=e.statusCode||!e.json.id?404==e.statusCode&&"PATCH"==o?Promise.reject(e.statusCode):404==e.statusCode?Promise.reject("Make sure to add the ``gist`` scope to your token. "+e.text):Promise.reject(e.text):Promise.resolve(e.json.id)})}}(m.github||(m.github={}))}(pxt||(pxt={})),function(m){!function(g){function u(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function c(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function l(e,t){return e[t]|e[t+1]<<8}function n(e){for(var t=new Uint8Array(4*e.length),n=0;n<e.length;++n)u(t,4*n,e[n]);return t}g.HF2_CMD_BININFO=1,g.HF2_MODE_BOOTLOADER=1,g.HF2_MODE_USERSPACE=2,g.HF2_CMD_INFO=2,g.HF2_CMD_RESET_INTO_APP=3,g.HF2_CMD_RESET_INTO_BOOTLOADER=4,g.HF2_CMD_START_FLASH=5,g.HF2_CMD_WRITE_FLASH_PAGE=6,g.HF2_CMD_CHKSUM_PAGES=7,g.HF2_CMD_READ_WORDS=8,g.HF2_CMD_WRITE_WORDS=9,g.HF2_CMD_DMESG=16,g.HF2_FLAG_SERIAL_OUT=128,g.HF2_FLAG_SERIAL_ERR=192,g.HF2_FLAG_CMDPKT_LAST=64,g.HF2_FLAG_CMDPKT_BODY=0,g.HF2_FLAG_MASK=192,g.HF2_SIZE_MASK=63,g.HF2_STATUS_OK=0,g.HF2_STATUS_INVALID_CMD=1,g.HF2_STATUS_EXEC_ERR=2,g.HF2_STATUS_EVENT=128,g.HF2_EV_MASK=8388608,g.write32=u,g.write16=c,g.read32=o,g.read16=l,g.encodeU32LE=n;var t=!(g.decodeU32LE=function(e){for(var t=[],n=0;n<e.length;n+=4)t.push(o(e,n));return t});function f(e){t?m.log("HF2: "+e):m.debug("HF2: "+e)}g.enableLog=function(){t=!0};var e=function(){function e(p){var d=this;this.io=p,this.cmdSeq=m.U.randomUint32(),this.lock=new m.U.PromiseQueue,this.rawMode=!1,this.maxMsgSize=63,this.bootloaderMode=!1,this.reconnectTries=0,this.autoReconnect=!1,this.msgs=new m.U.PromiseBuffer,this.eventHandlers={},this.onSerial=function(e,t){};var h=[];p.onSerial=function(e,t){return d.onSerial(e,t)},p.onData=function(e){var t=e[0]&g.HF2_FLAG_MASK,n=63&e[0],r=new Uint8Array(n);if(m.U.memcpy(r,0,e,1,n),t&g.HF2_FLAG_SERIAL_OUT)d.onSerial(r,t==g.HF2_FLAG_SERIAL_ERR);else if(h.push(r),t!=g.HF2_FLAG_CMDPKT_BODY){m.U.assert(t==g.HF2_FLAG_CMDPKT_LAST);for(var i=0,o=0,a=h;o<a.length;o++){i+=(f=a[o]).length}for(var s=new Uint8Array(i),u=0,c=0,l=h;c<l.length;c++){var f=l[c];m.U.memcpy(s,u,f),u+=f.length}h=[],s[2]&g.HF2_STATUS_EVENT?p.onEvent(s):d.msgs.push(s)}},p.onEvent=function(e){var t=o(e,0),n=m.U.lookup(d.eventHandlers,t+"");n?n(e.slice(4)):f("unhandled event: "+t.toString(16))},p.onError=function(e){f("recv error: "+e.message),d.autoReconnect&&(d.autoReconnect=!1,d.reconnectAsync().then(function(){d.autoReconnect=!0},function(e){f("reconnect error: "+e.message)}))}}return e.prototype.resetState=function(){this.lock=new m.U.PromiseQueue,this.info=null,this.infoRaw=null,this.pageSize=null,this.flashSize=null,this.maxMsgSize=63,this.bootloaderMode=!1,this.msgs.drain()},e.prototype.onEvent=function(e,t){m.U.assert(!!(e&g.HF2_EV_MASK)),this.eventHandlers[e+""]=t},e.prototype.reconnectAsync=function(e){var t=this;return void 0===e&&(e=!1),this.resetState(),e?this.initAsync():(f("reconnect raw="+this.rawMode),this.io.reconnectAsync().then(function(){return t.initAsync()}).catch(function(e){if(t.reconnectTries<5)return t.reconnectTries++,f("error "+e.message+"; reconnecting attempt #"+t.reconnectTries),Promise.delay(500).then(function(){return t.reconnectAsync()});throw e}))},e.prototype.disconnectAsync=function(){return f("disconnect"),this.io.disconnectAsync()},e.prototype.error=function(e){return this.io.error(e)},e.prototype.talkAsync=function(e,t){var n=this;if(this.io.talksAsync)return this.io.talksAsync([{cmd:e,data:t}]).then(function(e){return e[0]});var r=8;t&&(r+=t.length);var i=new Uint8Array(r),o=65535&++this.cmdSeq;u(i,0,e),c(i,4,o),c(i,6,0),t&&m.U.memcpy(i,8,t,0,t.length);var a=0,s=function(){return n.msgs.shiftAsync(1e3).then(function(e){if(l(e,0)!=o){if(a<3)return a++,f("message out of sync, ("+o+" vs "+l(e,0)+"); will re-try"),s();n.error("out of sync")}var t="";switch(e[3]&&(t="; info="+e[3]),e[2]){case g.HF2_STATUS_OK:return e.slice(4);case g.HF2_STATUS_INVALID_CMD:n.error("invalid command"+t);break;case g.HF2_STATUS_EXEC_ERR:n.error("execution error"+t);break;default:n.error("error "+e[2]+t)}return null})};return this.sendMsgAsync(i).then(s)},e.prototype.sendMsgAsync=function(e){return this.sendMsgCoreAsync(e)},e.prototype.sendSerialAsync=function(e,t){return void 0===t&&(t=!1),this.io.sendSerialAsync?this.io.sendSerialAsync(e,t):this.sendMsgCoreAsync(e,t?2:1)},e.prototype.sendMsgCoreAsync=function(r,i){var o=this;void 0===i&&(i=0);var a=new Uint8Array(64),s=function(e){var t=r.length-e;if(t<=0)return Promise.resolve();63<t?(t=63,a[0]=g.HF2_FLAG_CMDPKT_BODY):a[0]=g.HF2_FLAG_CMDPKT_LAST,i&&(a[0]=1==i?g.HF2_FLAG_SERIAL_OUT:g.HF2_FLAG_SERIAL_ERR),a[0]|=t;for(var n=0;n<t;++n)a[n+1]=r[e+n];return o.io.sendPacketAsync(a).then(function(){return s(e+t)})};return this.lock.enqueue("out",function(){return s(0)})},e.prototype.switchToBootloaderAsync=function(){var e=this;return this.bootloaderMode?Promise.resolve():(f("Switching into bootloader mode"),this.io.isSwitchingToBootloader&&this.io.isSwitchingToBootloader(),this.maybeReconnectAsync().then(function(){return e.talkAsync(g.HF2_CMD_START_FLASH)}).then(function(){return e.initAsync()}).then(function(){e.bootloaderMode||e.error("cannot switch into bootloader mode")}))},e.prototype.reflashAsync=function(e){var t=this;return f("reflash"),this.flashAsync(e).then(function(){return Promise.delay(100)}).then(function(){return t.reconnectAsync()})},e.prototype.writeWordsAsync=function(e,t){return m.U.assert(t.length<=64),this.talkAsync(g.HF2_CMD_WRITE_WORDS,n([e,t.length].concat(t))).then(function(){})},e.prototype.readWordsAsync=function(e,t){var n=new Uint8Array(8);return u(n,0,e),u(n,4,t),m.U.assert(t<=64),this.talkAsync(g.HF2_CMD_READ_WORDS,n)},e.prototype.pingAsync=function(){return this.rawMode?Promise.resolve():this.talkAsync(g.HF2_CMD_BININFO).then(function(e){})},e.prototype.maybeReconnectAsync=function(){var t=this;return this.pingAsync().catch(function(e){return t.reconnectAsync().then(function(){return t.pingAsync()})})},e.prototype.flashAsync=function(r){var i=this,o=Date.now(),a=0,s=function(e){if(e>=r.length)return Promise.resolve();var t=r[e];m.U.assert(t.payloadSize==i.pageSize);var n=new Uint8Array(4+t.payloadSize);return u(n,0,t.targetAddr),m.U.memcpy(n,4,t.data,0,t.payloadSize),i.talkAsync(g.HF2_CMD_WRITE_FLASH_PAGE,n).then(function(){return s(e+1)})};return this.switchToBootloaderAsync().then(function(){var e=r.length*i.pageSize;return f("Starting flash ("+Math.round(e/1024)+"kB)."),a=Date.now(),p(r,function(e,t){return i.readWordsAsync(e,t)})}).then(function(e){if(e.length!=r.length){var t=(r=e).length*i.pageSize;f("Performing partial flash ("+Math.round(t/1024)+"kB).")}}).then(function(){return s(0)}).then(function(){var e=Date.now(),t=e-o,n=e-a;f("Flashing done at "+Math.round(r.length*i.pageSize/n*1e3/1024)+" kB/s in "+t+"ms (reset "+(t-n)+"ms). Resetting.")}).then(function(){return i.talkAsync(g.HF2_CMD_RESET_INTO_APP).catch(function(e){})}).then(function(){})},e.prototype.initAsync=function(){var n=this;return this.rawMode?Promise.resolve():Promise.resolve().then(function(){return n.talkAsync(g.HF2_CMD_BININFO)}).then(function(e){return n.bootloaderMode=e[0]==g.HF2_MODE_BOOTLOADER,n.pageSize=o(e,4),n.flashSize=o(e,8)*n.pageSize,n.maxMsgSize=o(e,12),f("Connected; msgSize "+n.maxMsgSize+"B; flash "+n.flashSize/1024+"kB; "+(n.bootloaderMode?"bootloader":"application")+" mode"),n.talkAsync(g.HF2_CMD_INFO)}).then(function(e){n.infoRaw=m.U.fromUTF8(m.U.uint8ArrayToString(e));var r={};("Header: "+n.infoRaw).replace(/^([\w\-]+):\s*([^\n\r]*)/gm,function(e,t,n){return r[t.replace(/-/g,"")]=n,""}),n.info=r;var t=/v(\d\S+)\s+(\S+)/.exec(n.info.Header);n.info.Parsed={Version:t[1],Features:t[2]},f("Board-ID: "+n.info.BoardID+" v"+n.info.Parsed.Version+" f"+n.info.Parsed.Features)}).then(function(){n.reconnectTries=0})},e}();function p(r,e){if(!m.appTarget.compile.flashChecksumAddr)return Promise.resolve(r);var n,t=pxtc.UF2.readBytes(r,m.appTarget.compile.flashChecksumAddr,48),i=pxtc.hex.parseChecksumBlock(t);return i?(n=e,m.appTarget.compile.flashChecksumAddr?n(m.appTarget.compile.flashChecksumAddr,12).then(function(e){var t=pxtc.hex.parseChecksumBlock(e);return t?n(t.endMarkerPos,1).then(function(e){return o(e,0)!=t.endMarker?(m.log("end-marker mismatch"),null):t}):null}):Promise.resolve(null)).then(function(e){if(!e)return r;var n=e.regions.filter(function(t){return i.regions.some(function(e){return t.checksum==e.checksum&&t.length==e.length&&t.start==e.start})});if(0==n.length)return r;f("skipping flash at: "+n.map(function(e){return pxtc.assembler.tohex(e.start)+" ("+e.length/1024+"kB)"}).join(", "));var t=function(t){return n.some(function(e){return e.start<=t&&t<e.start+e.length})};return r.filter(function(e){return!(t(e.targetAddr)&&t(e.targetAddr+e.payloadSize-1))})}):Promise.resolve(r)}g.Wrapper=e,g.onlyChangedBlocksAsync=p}(m.HF2||(m.HF2={}))}(pxt||(pxt={})),function(e){e.REF_TAG_STRING=1,e.REF_TAG_BUFFER=2,e.REF_TAG_IMAGE=3,e.REF_TAG_NUMBER=32,e.REF_TAG_ACTION=33}(pxt||(pxt={})),function(I){!function(t){var g,e,f,n,m,v,a,p,b=I.Util,d=I.HF2,r=1409050336,i=665147697,o=287358355,h=1888490768,s=915601917,u=d.read32,y=!1;function c(e){return e<<2|2}function x(e){return 1&e?e>>1:0!=e?2&e?e==t.taggedNull?null:e!=t.taggedFalse&&(e==t.taggedTrue||{tagged:e>>2}):{ptr:e}:void 0}function l(e,t){if(b.assert(!(3&e)),b.assert(0<=e),e<2097152){var n=new Uint8Array(t);return e-=a.start,b.memcpy(n,0,a.buf,e,t),Promise.resolve(n)}var r=p.maxMsgSize-32;if(r<t){for(var i=[];0<t;){var o=Math.min(r,t);i.push(l(e,o)),t-=o,e+=o}return Promise.all(i).then(b.uint8ArrayConcat)}return p.readWordsAsync(e,Math.ceil(t/4)).then(function(e){return e.length>t?e.slice(0,t):e})}function w(n){if("object"!=typeof n||!n)return Promise.resolve(n);if("number"==typeof n.ptr){if(3&n.ptr)return Promise.resolve({unalignedPtr:n.ptr});var r=0;return l(n.ptr,56).then(function(t){r=d.read16(t,2);var e=t.length;return r==I.REF_TAG_STRING||r==I.REF_TAG_BUFFER?e=d.read16(t,4)+6:r==I.REF_TAG_IMAGE?e=d.read16(t,4)*d.read16(t,8)+8:r==I.REF_TAG_NUMBER&&(e=12),e>t.length?l(n.ptr+t.length,e-t.length).then(function(e){return b.uint8ArrayConcat([t,e])}):e<t.length?t.slice(0,e):t}).then(function(e){return r==I.REF_TAG_STRING?b.uint8ArrayToString(e.slice(6)):r==I.REF_TAG_STRING?{type:"buffer",data:e.slice(6)}:r==I.REF_TAG_IMAGE?{type:"image",data:e.slice(8),width:d.read16(e,4),height:d.read16(e,8)}:r==I.REF_TAG_NUMBER?new Float64Array(e.buffer.slice(4))[0]:{type:"unknown",tag:r,refcnt:d.read16(e,0),data:e.slice(4)}})}return Promise.resolve(n)}function k(n){for(var e=[],t=function(t){e.push(w(n[t]).then(function(e){n[t]=e}))},r=0,i=Object.keys(n);r<i.length;r++){t(i[r])}return Promise.all(e).then(function(){})}function A(e){for(var t=g.breakpoints,n=t[0],r=1/0,i=0,o=t;i<o.length;i++){var a=o[i],s=e-a.binAddr;0<=s&&s<r&&(r=s,n=a)}return n}function E(c){return y?Promise.resolve():(y=!0,T().then(function(e){for(var t,n,r,i=d.decodeU32LE(c)[0],o={},a=0,s=g.procDebugInfo[0].locals;a<s.length;a++){var u=s[a];t=u,r=void 0,n=e.globals,null===(r=function(){switch(t.type){case"uint32":return d.read32(n,t.index);case"int32":return 0|d.read32(n,t.index);case"uint16":return d.read16(n,t.index);case"int16":return d.read16(n,t.index)<<16>>16;case"uint8":return n[t.index];case"int8":return n[t.index]<<24>>24;default:return null}}())&&(b.assert(0==(3&t.index)),r=x(d.read32(n,t.index))),o[t.name]=r}return m=A(i),l={type:"debugger",subtype:"breakpoint",breakpointId:m.id,globals:o,stackframes:[]},f(),p.talkAsync(h)}).then(function(e){!function(e,t){for(var n=m.binAddr,r=0,i=g.procDebugInfo.filter(function(e){return e.codeStartLoc<=n&&n<=e.codeEndLoc})[0];i&&i!=g.procDebugInfo[0];){var o=A(n),a=b.clone(o);a.functionName=i.name,t.stackframes.push({locals:{},funcInfo:a,breakpointId:o.id});for(var s=t.stackframes[t.stackframes.length-1],u=0,c=0,l=i.locals;c<l.length;c++){var f=l[c];b.assert(f.index==u++),s.locals[f.name]=x(e[r++])}n=2147483646&e[r++];for(var p=v[n+""],d=0,h=i.args;d<h.length;d++)f=h[d],s.locals[f.name]=x(e[r+(i.args.length-1-f.index)]);if(!p)break;i=p.from,r+=p.stack-i.localsMark}}(d.decodeU32LE(e),l);var t=[l.globals].concat(l.stackframes.map(function(e){return e.locals}));return Promise.map(t,k)}).then(function(){return t.postMessage(l)}));var l}function C(){y=!1,e=new Promise(function(e,t){f=e})}function S(e){return void 0===e&&(e=!1),Promise.resolve().then(function(){return p.talkAsync(i,d.encodeU32LE([e?1:3]))}).then(C)}function _(){return e||(e=Promise.resolve()),e}function T(){return(n?Promise.resolve(n):p.talkAsync(r).then(function(e){return n={numGlobals:u(e,0),globalsPtr:u(e,4)}})).then(function(e){return p.readWordsAsync(e.globalsPtr,e.numGlobals)}).then(function(e){return{staticState:n,globals:e}})}t.taggedUndefined=0,t.taggedNull=c(1),t.taggedFalse=c(2),t.taggedTrue=c(16),t.postMessage=function(e){return console.log(e)},t.decodeValue=x,t.heapExpandAsync=w,t.heapExpandMapAsync=k,t.startDebugAsync=function(c,e){return(p=e).onEvent(s,E),(y=!1,n=g=null,Promise.resolve()).then(function(){v={};for(var e=[],t=0,n=(g=c).procDebugInfo;t<n.length;t++)e[(o=n[t]).idx]=o;for(var r=0,i=c.procDebugInfo;r<i.length;r++)for(var o,a=0,s=(o=i[r]).calls;a<s.length;a++){var u=s[a];v[u.addr+""]={from:o,to:e[u.procIndex],stack:u.stack}}}).then(function(){var e=g.outfiles[pxtc.BINARY_UF2],t=b.stringToUint8Array(atob(e));a=pxtc.UF2.toBin(t);var n=pxtc.UF2.parseFile(t);return p.reflashAsync(n)}).then(function(){return p.talkAsync(o).catch(function(e){})}).then(function(){return Promise.delay(200)}).then(function(){return p.reconnectAsync()}).then(C).then(_)},t.handleMessage=function(e){if(console.log("HWDBGMSG",e),"debugger"==e.type){var t=!1;switch(e.subtype){case"stepinto":t=!0;case"stepover":S(t)}}},t.resumeAsync=S,t.waitForHaltAsync=_,t.getHwStateAsync=T}(I.HWDBG||(I.HWDBG={}))}(pxt||(pxt={})),function(y){!function(e){var h,t,g,n;(t=h=e.NT||(e.NT={}))[t.Prefix=0]="Prefix",t[t.Infix=1]="Infix",t[t.Block=2]="Block",t[t.NewLine=3]="NewLine",(n=g=e.GlueMode||(e.GlueMode={}))[n.None=0]="None",n[n.WithSpace=1]="WithSpace",n[n.NoSpace=2]="NoSpace";var r,i=["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"];function o(e){return 20<e.length&&/\n/.test(e)?"`"+e.replace(/[\\`${}]/g,function(e){return"\\"+e})+"`":JSON.stringify(e)}function a(e,t,n){return{type:e,op:t,children:n}}function s(){return a(h.NewLine,"",[])}function u(e,t){return a(h.Prefix,e,t)}function c(e,t,n){return a(h.Infix,t,null==e?[n]:[e,n])}function m(e){return u(e,[])}function l(e){return a(h.Block,"",e)}function v(e){return u("",e)}function f(e,t){void 0===t&&(t=!1);for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];t?(0<n.length&&n.push(m(",")),n.push(s())):0<n.length&&n.push(m(", ")),n.push(o)}return t&&n.push(s()),v(n)}e.stringLit=o,e.mkNode=a,e.mkNewLine=s,e.mkPrefix=u,e.mkInfix=c,e.mkText=m,e.mkBlock=l,e.mkGroup=v,e.mkStmt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return n&&n.type==h.Block||e.push(s()),v(e)},e.mkCommaSep=f,function(e){function i(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),v(r?[c(t[0],".",m(e)),m("("),f(t.slice(1),n),m(")")]:[m(e),m("("),f(t,n),m(")")])}function n(e,t,n,r){return i(e+"."+t,n,r)}function r(e,t){return y.U.assert(2==t.length),c(t[0],e,t[1])}e.mkArrayLiteral=function(e){return v([m("["),f(e,!1),m("]")])},e.mkNumberLiteral=function(e){return m(e.toString())},e.mkBooleanLiteral=function(e){return m(e?"true":"false")},e.mkStringLiteral=function(e){return m(o(e))},e.mkPropertyAccess=function(e,t){return v([c(t,".",m(e))])},e.mkCall=i,e.stdCall=function(e,t,n){return i(e,t,n)},e.extensionCall=function(e,t,n){return i(e,t,n,!0)},e.namespaceCall=n,e.mathCall=function(e,t){return n("Math",e,t,!1)},e.mkGlobalRef=function(e){return m(e)},e.mkSimpleCall=r,e.mkWhile=function(e,t){return v([m("while ("),e,m(")"),l(t)])},e.mkComment=function(e){return m("// "+e)},e.mkMultiComment=function(e){var r=[m("/**"),s()];return e.split("\n").forEach(function(e,t,n){e&&(r.push(m(" * "+e)),r.push(s()),t<n.length-1&&(r.push(m(" * ")),r.push(s())))}),v(r.concat([m(" */"),s()]))},e.mkAssign=function(e,t){return r("=",[e,t])},e.mkParenthesizedExpression=function(e){return v([m("("),e,m(")")])}}(r=e.Helpers||(e.Helpers={})),e.H=r;var b={"=":3,"+=":3,"-=":3,"?":4,":":4,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,">>":12,">>>":12,"<<":12,"+":13,"-":13,"*":14,"/":14,"%":14,"**":15,"!":16,"~":16,"P-":16,"P+":16,"++":16,"--":16,".":18};e.flattenNode=function(e){var o=[],a={},s="",u="",c=[{}],t=v(e);return function e(t,n){if(t.type==h.Infix){var r=[],i=y.U.lookup(b,t.op);if(null==i&&y.U.oops("bad infix op: "+t.op),i<n&&u("("),1==t.children.length)u(t.op),e(t.children[0],i),r.push(t.children[0]);else{var o=3!=i&&"**"!=t.op;e(t.children[0],o?i:i+.1),r.push(t.children[0]),"."==t.op?u("."):u(" "+t.op+" "),e(t.children[1],o?i+.1:i),r.push(t.children[1])}i<n&&u(")"),t.type=h.Prefix,t.op="",t.children=r}else for(var a=0,s=t.children;a<s.length;a++)e(s[a],-1);function u(e){"P"==e[0]&&(e=e.slice(1)),r.push(m(e))}}(t,-1),l(t),s||(s+="\n"),{output:s,sourceMap:o};function l(e){e.glueToBlock&&(d(),e.glueToBlock==g.WithSpace&&(s+=" "));var t=f();switch(e.type){case h.Infix:y.U.oops("no infix should be left");break;case h.NewLine:s+="\n"+u;break;case h.Block:!function(e){var t=e.noFinalNewline?"":"\n";if(0==e.children.length)return p(" {\n\t\n}"+t);var n=y.U.clone(c[c.length-1]||{});c.push(n),u+="    "," "!=s[s.length-1]&&p(" "),p("{\n");for(var r=0,i=e.children;r<i.length;r++){var o=i[r];l(o)}u=u.slice(4),d(),p("\n}"+t),c.pop()}(e);break;case h.Prefix:e.canIndentInside?s+=e.op.replace(/\n/g,"\n"+u+"    "):s+=e.op,e.children.forEach(l)}var n=f();if(e.id)if(a[e.id]){var r=a[e.id];r.start=Math.min(r.start,t),r.end=Math.max(r.end,n)}else{var i={id:e.id,start:t,end:n};a[e.id]=i,o.push(i)}}function f(){var t=0;return s.replace(/\n/g,function(e){return t++,e}),t}function p(e){s+=e.replace(/\n/g,"\n"+u)}function d(){s=s.replace(/\n *$/,"")}},e.isReservedWord=function(e){return-1!==i.indexOf(e)}}(y.blocks||(y.blocks={}))}(pxt||(pxt={})),function(g){var e=function(){function i(e,t,n,r){this.id=e,this._verspec=t,this.parent=n,this.level=-1,this.isLoaded=!1,r&&(this.level=r.level+1),this.addedBy=[r]}return i.getConfigAsync=function(r,i,o){return Promise.resolve().then(function(){if(g.github.isGithubId(o)){var t=g.github.parseRepoId(o);return g.packagesConfigAsync().then(function(e){return g.github.repoAsync(t.fullName,e)}).then(function(e){return e?g.github.pkgConfigAsync(t.fullName,t.tag):null})}var e=g.patching.upgradePackageReference(r,i,o),n=g.appTarget.bundledpkgs[e];return JSON.parse(n[g.CONFIG_NAME])})},i.corePackages=function(){var t=g.appTarget.bundledpkgs;return Object.keys(t).map(function(e){return JSON.parse(t[e][g.CONFIG_NAME])}).filter(function(e){return!!e})},i.prototype.version=function(){return this.resolvedVersion||this._verspec},i.prototype.verProtocol=function(){var e=this.version().split(":");return 1<e.length?e[0]:""},i.prototype.verArgument=function(){var e=this.verProtocol();return e?this.version().slice(e.length+1):this.version()},i.prototype.targetVersion=function(){return this.parent&&this.parent!=this?this.parent.targetVersion():this.config.targetVersions?this.config.targetVersions.target:void 0},i.prototype.commonDownloadAsync=function(){var t=this,e=this.verProtocol();if("pub"==e)return g.Cloud.downloadScriptFilesAsync(this.verArgument());if("github"==e)return g.packagesConfigAsync().then(function(e){return g.github.downloadPackageAsync(t.verArgument(),e)}).then(function(e){return e.files});if("embed"==e){var n=g.getEmbeddedScript(this.verArgument());return Promise.resolve(n)}return Promise.resolve(null)},i.prototype.host=function(){return this.parent._host},i.prototype.readFile=function(e){return this.host().readFile(this,e)},i.prototype.resolveDep=function(e){return this.parent.deps.hasOwnProperty(e)?this.parent.deps[e]:null},i.prototype.saveConfig=function(){var e=JSON.stringify(this.config,null,4)||"\n";this.host().writeFile(this,g.CONFIG_NAME,e)},i.prototype.parseJRes=function(e){void 0===e&&(e={});for(var t=0,n=this.getFiles();t<n.length;t++){var r=n[t];if(g.U.endsWith(r,".jres"))for(var i=JSON.parse(this.readFile(r)),o=i["*"],a=0,s=Object.keys(i);a<s.length;a++){var u=s[a];if("*"!=u){var c=i[u];"string"==typeof c&&(c={data:c});var l=c.namespace||o.namespace||"";l&&(l+=".");var f=c.id||l+u,p=c.icon,d=c.mimeType||o.mimeType,h=c.dataEncoding||o.dataEncoding||"base64";p||"base64"!=h||"image/png"!=d&&"image/jpeg"!=d||(p="data:"+d+";base64,"+c.data),e[f]={id:f,data:c.data,dataEncoding:c.dataEncoding||o.dataEncoding||"base64",icon:p,namespace:l,mimeType:d}}}}return e},i.prototype.resolveVersionAsync=function(){var e=this._verspec;return g.getEmbeddedScript(this.id)?this.resolvedVersion=e="embed:"+this.id:e&&"*"!=e||g.U.userError(lf("version not specified for {0}",this.id)),Promise.resolve(e)},i.prototype.downloadAsync=function(){var t=this;return this.resolveVersionAsync().then(function(e){if(/^embed:/.test(e)||!t.config||t.config.installedVersion!=e)return g.debug("downloading "+e),t.host().downloadPackageAsync(t).then(function(){var e=t.readFile(g.CONFIG_NAME);e||g.U.userError("package "+t.id+" is missing "+g.CONFIG_NAME),t.parseConfig(e),0!=t.level&&(t.config.installedVersion=t.version()),t.saveConfig()}).then(function(){g.debug("installed "+t.id+" /"+e)})})},i.prototype.validateConfig=function(){this.config.dependencies||g.U.userError("Missing dependencies in config of: "+this.id),Array.isArray(this.config.files)||g.U.userError("Missing files in config of: "+this.id),("string"!=typeof this.config.name||!this.config.name||this.config.public&&!/^[a-z][a-z0-9\-_]+$/i.test(this.config.name))&&g.U.userError("Invalid package name: "+this.config.name),this.config.targetVersions&&this.config.targetVersions.target&&0<g.semver.majorCmp(this.config.targetVersions.target,g.appTarget.versions.target)&&g.U.userError(lf("Package {0} requires target version {1} (you are running {2})",this.config.name,this.config.targetVersions.target,g.appTarget.versions.target))},i.prototype.isPackageInUse=function(n,e){void 0===e&&(e=this.readFile("main.ts"));var r=null,t=g.patching.computePatches(this.targetVersion(),"missingPackage");return t&&t.forEach(function(t){Object.keys(t.map).forEach(function(e){t.map[e]===n&&(r=new RegExp(e,"g"))})}),r||(r=new RegExp(n+"\\.","g")),r.test(e)},i.prototype.getMissingPackages=function(i,o){var e=g.patching.computePatches(this.targetVersion(),"missingPackage"),a={};return o&&e&&e.forEach(function(r){Object.keys(r.map).forEach(function(e){var t=new RegExp(e,"g"),n=r.map[e];o.replace(t,function(e){return i.dependencies[n]||(a[n]="*"),""})})}),a},i.prototype.findConflictsAsync=function(e,f){var p,n=this,d=[];return Promise.resolve().then(function(){return"string"==typeof e?i.getConfigAsync(n.targetVersion(),e,f):Promise.resolve(e)}).then(function(e){if(p=e){var l=p.yotta?g.U.jsonFlatten(p.yotta.config):null;n.parent.sortedDeps().forEach(function(e){if(p.core&&e.config.core)return(a=new g.cpp.PkgConflictError(lf("conflict between core packages {0} and {1}",p.name,e.id))).pkg0=e,void d.push(a);var t=!1;if(l){var n=e.config||JSON.parse(e.readFile(g.CONFIG_NAME));if(!!n&&!!n.yotta&&!!e.config.yotta.config)for(var r=g.U.jsonFlatten(n.yotta.config),i=0,o=Object.keys(l);i<o.length;i++){var a,s=o[i],u=r[s],c=p.yotta.configIsJustDefaults||n.yotta.configIsJustDefaults;if(r.hasOwnProperty(s)&&u!==l[s]&&!c&&(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts))(a=new g.cpp.PkgConflictError(lf("conflict on yotta setting {0} between packages {1} and {2}",s,p.name,e.id))).pkg0=e,a.settingName=s,d.push(a),t=!0}}t||p.name!==e.id||e._verspec==f||/^file:/.test(e._verspec)||/^file:/.test(f)||((a=new g.cpp.PkgConflictError(lf("version mismatch for package {0} (installed: {1}, installing: {2})",e,e._verspec,f))).pkg0=e,a.isVersionConflict=!0,d.push(a))})}return Object.keys(p.dependencies).reduce(function(e,t){return e.then(function(){return n.findConflictsAsync(t,p.dependencies[t])}).then(function(e){return d.push.apply(d,e)})},Promise.resolve())}).then(function(){var r=function(e){var t=[];return e.addedBy.forEach(function(e){e.id!==n.id&&(t.push.apply(r(e)),t.push(e))}),t},e=[];return d.forEach(function(n){e.push.apply(e,r(n.pkg0).map(function(e){var t=new g.cpp.PkgConflictError(n.isVersionConflict?lf("a dependency of {0} has a version mismatch with package {1} (installed: {1}, installing: {2})",e.id,p.name,n.pkg0._verspec,f):lf("conflict on yotta setting {0} between packages {1} and {2}",n.settingName,p.name,n.pkg0.id));return t.pkg0=e,t}))}),d.push.apply(d,e),d=d.filter(function(e,t){for(var n=0;n<t;++n)if(e.pkg0.id===d[n].pkg0.id)return!1;return!0})})},i.prototype.upgradeFile=function(e,t){var n=g.patching.patchJavaScript(this.targetVersion(),t);return n!=t&&(g.debug("patching javascript in "+e+" (size="+t.length+")..."),this.host().writeFile(this,e,n,!0)),n},i.prototype.parseConfig=function(e,t){var n=JSON.parse(e);this.config=n;var r=JSON.stringify(this.config);for(var i in this.config.dependencies){var o=g.patching.upgradePackageReference(this.targetVersion(),i,this.config.dependencies[i]);o!=i&&(delete this.config.dependencies[i],o&&(this.config.dependencies[o]="*"))}t&&(this.config.targetVersions={target:t}),JSON.stringify(this.config)!=r&&this.saveConfig(),this.validateConfig()},i.prototype.patchCorePackage=function(){var t=this;g.Util.assert(g.appTarget.simulator&&g.appTarget.simulator.dynamicBoardDefinition),g.Util.assert(0==this.level);var e=Object.keys(this.config.dependencies).filter(function(e){return!!e&&JSON.parse((g.appTarget.bundledpkgs[e]||{})[g.CONFIG_NAME]||"{}").core});if(0==e.length){var n=g.Package.corePackages();n.length&&this.config.dependencies[n[0].name]}else 1<e.length&&(e.pop(),e.forEach(function(e){g.log("removing core package "+e),delete t.config.dependencies[e]}))},i.prototype.dependencies=function(){if(!this.config)return{};var e=g.Util.clone(this.config.dependencies||{});return 0==this.level&&this.config.testDependencies&&g.Util.jsonMergeFrom(e,this.config.testDependencies),e},i.prototype.loadAsync=function(r,e){var s=this;if(void 0===r&&(r=!1),this.isLoaded)return Promise.resolve();var t=Promise.resolve();this.isLoaded=!0;var n=this.readFile(g.CONFIG_NAME);null==n?r||g.U.userError("Package not installed: "+this.id+", did you forget to run `pxt install`?"):t=t.then(function(){return s.parseConfig(n)}),r&&(t=t.then(function(){return s.downloadAsync()})),r&&0==this.level&&(t=t.then(function(){g.debug("upgrading files, target version "+s.targetVersion()),s.getFiles().filter(function(e){return/\.ts$/.test(e)}).forEach(function(e){return s.upgradeFile(e,s.readFile(e))})})),g.appTarget.simulator&&g.appTarget.simulator.dynamicBoardDefinition&&(0==this.level&&(t=t.then(function(){return s.patchCorePackage()})),t=t.then(function(){if(!(s.config.files.indexOf("board.json")<0)){g.setAppTargetVariant(s.config.compileServiceVariant);var e=g.appTarget.simulator.boardDefinition=JSON.parse(s.readFile("board.json"));e.id=s.config.name,g.appTarget.appTheme.boardName=e.boardName||lf("board"),g.appTarget.appTheme.driveDisplayName=e.driveDisplayName||lf("DRIVE");var t=function(e){var t=/^pkg:\/\/(.*)/.exec(e);if(t){var n=t[1],r=s.readFile(n);return g.U.toDataUri(r,g.U.getMime(n))}return e},n=g.appTarget.simulator.boardDefinition;if("object"==typeof n.visual){var r=n.visual;r.image=t(r.image),r.outlineImage=t(r.outlineImage)}}}));var u=function(e){return g.U.mapStringMapAsync(e,function(e,t){var n=s.resolveDep(e);return t=t||"*",n?(n._verspec==t||/^file:/.test(n._verspec)||/^file:/.test(t)||g.U.userError("Version spec mismatch on "+e),n.level=Math.min(n.level,s.level+1),n.addedBy.push(s),Promise.resolve()):(n=new i(e,t,s.parent,s),s.parent.deps[e]=n,(s.parent.deps[e.replace(/---.*/,"")]=n).loadAsync(r))})};return t.then(function(){return u(s.dependencies())}).then(function(){if(s.config.palette&&g.appTarget.runtime&&(g.appTarget.runtime.palette=g.U.clone(s.config.palette)),s.config.screenSize&&g.appTarget.runtime&&(g.appTarget.runtime.screenSize=g.U.clone(s.config.screenSize)),0===s.level){var e=s.readFile("main.ts");if(!e)return Promise.resolve(null);var o=s.getMissingPackages(s.config,e),a=!1;Promise.resolve();Object.keys(o).reduce(function(e,i){return e.then(function(){return s.findConflictsAsync(i,o[i])}).then(function(e){if(e.length){var t=e.map(function(e){return e.pkg0.id}).join(", "),n=e.map(function(e){return e.settingName}).filter(function(e){return!!e}).join(", ");return g.log("skipping missing package "+i+" because it conflicts with the following packages: "+t+" (conflicting settings: "+n+")"),Promise.resolve(null)}g.log("adding missing package "+i),a=!0,s.config.dependencies[i]="*";var r={};return r[i]=o[i],u(r)})},Promise.resolve(null)).then(function(){return a&&(s.saveConfig(),s.validateConfig()),Promise.resolve(null)})}return Promise.resolve(null)}).then(function(){return null})},i.prototype.getFiles=function(){return 0==this.level?this.config.files.concat(this.config.testFiles||[]):this.config.files.slice(0)},i.prototype.addSnapshot=function(e,n){void 0===n&&(n=[""]);for(var t=function(t){n.some(function(e){return g.U.endsWith(t,e)})&&(e[r.id+"/"+t]=r.readFile(t))},r=this,i=0,o=this.getFiles();i<o.length;i++){t(o[i])}e[this.id+"/"+g.CONFIG_NAME]=this.readFile(g.CONFIG_NAME)},i.prototype.packageLocalizationStringsAsync=function(n){var r=this,i=g.appTarget.id,e=[this.id+"-jsdoc",this.id],o={},a=g.appTarget.appTheme||{};if(g.Util.localizeLive&&"this"!=this.id&&g.appTarget.bundledpkgs[this.id]){g.log("loading live translations for "+this.id);var s=g.Util.userLanguage();return Promise.all(e.map(function(t){return g.Util.downloadLiveTranslationsAsync(s,i+"/"+t+"-strings.json",a.crowdinBranch).then(function(e){e&&Object.keys(e).length?g.Util.jsonMergeFrom(o,e):(g.tickEvent("translations.livetranslationsfailed",{filename:t}),g.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t)))}).catch(function(e){g.tickEvent("translations.livetranslationsfailed",{filename:t}),g.log("error while downloading "+i+"/"+t+"-strings.json"),g.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t))})})).then(function(){return o})}return e.map(function(e){return r.bundledStringsForFile(n,e)}).filter(function(e){return!!e}).forEach(function(e){return g.Util.jsonMergeFrom(o,e)}),Promise.resolve(o)},i.prototype.bundledStringsForFile=function(e,t){var n={},r=this.config.files,i="_locales/"+e.toLowerCase()+"/"+t+"-strings.json";return-1<r.indexOf(i)&&(n=JSON.parse(this.readFile(i))),2<e.length&&(i="_locales/"+e.substring(0,2).toLowerCase()+"/"+t+"-strings.json",-1<r.indexOf(i)&&(n=JSON.parse(this.readFile(i)))),n},i}(),t=function(n){function e(e){var t=n.call(this,"this","file:.",null,null)||this;return t._host=e,t.deps={},(t.parent=t).addedBy=[t],t.level=0,t.deps[t.id]=t}return __extends(e,n),e.prototype.installAllAsync=function(e){return this.loadAsync(!0,e)},e.prototype.sortedDeps=function(){var r=this,i={},o=[],a=function(e){if(e&&!g.U.lookup(i,e.id)){i[e.id]=!0;var t=e.dependencies(),n=Object.keys(t);n.sort(function(e,t){return g.U.strcmp(e,t)}),n.forEach(function(e){return a(r.resolveDep(e))}),o.push(e.id)}};return a(this),o.map(function(e){return r.resolveDep(e)})},e.prototype.localizationStringsAsync=function(t){var n={};return Promise.all(g.Util.values(this.deps).map(function(e){return e.packageLocalizationStringsAsync(t).then(function(t){t&&Object.keys(t).forEach(function(e){n[e]||(n[e]=t[e])})})})).then(function(){return n})},e.prototype.getTargetOptions=function(){var e=g.U.clone(g.appTarget.compile);return g.U.assert(!!e),e},e.prototype.getJRes=function(){if(!this._jres){this._jres={};for(var e=0,t=this.sortedDeps();e<t.length;e++){t[e].parseJRes(this._jres)}if(g.appTarget.runtime&&g.appTarget.runtime.palette){var n=g.appTarget.runtime.palette.map(function(e){return("000000"+parseInt(e.replace(/#/,""),16).toString(16)).slice(-6)}).join("");this._jres.__palette={id:"__palette",data:n,dataEncoding:"hex",mimeType:"application/x-palette"}}}return this._jres},e.prototype.getCompileOptionsAsync=function(r){var s=this;void 0===r&&(r=this.getTargetOptions());var u={sourceFiles:[],fileSystem:{},target:r,hexinfo:{hex:[]},name:this.config?this.config.name:""},e=function(e,t){s.config.files.indexOf(e)<0&&g.U.userError(lf("please add '{0}' to \"files\" in {1}",e,g.CONFIG_NAME)),t="// Auto-generated. Do not edit.\n"+t+"\n// Auto-generated. Do not edit. Really.\n",s.host().readFile(s,e,!0)!==t&&(g.debug("updating "+e+" (size="+t.length+")..."),s.host().writeFile(s,e,t,!0))};return this.loadAsync().then(function(){g.debug("building: "+s.sortedDeps().map(function(e){return e.config.name}).join(", "));var t=g.cpp.getExtensionInfo(s);return t.shimsDTS&&e("shims.d.ts",t.shimsDTS),t.enumsDTS&&e("enums.d.ts",t.enumsDTS),(r.isNative?s.host().getHexInfoAsync(t):Promise.resolve(null)).then(function(e){delete(t=g.U.flatClone(t)).compileData,delete t.generatedFiles,delete t.extensionFiles,u.extinfo=t,u.hexinfo=e})}).then(function(){return s.config.binaryonly||g.appTarget.compile.shortPointers||!u.target.isNative?null:s.filesToBePublishedAsync(!0)}).then(function(e){if(e){e=g.U.mapMap(e,function(e,t){return s.upgradeFile(e,t)});var t=JSON.stringify({name:s.config.name,comment:s.config.description,status:"unpublished",scriptId:s.config.installedVersion,cloudId:g.CLOUD_ID+g.appTarget.id,editor:r.preferredEditor?r.preferredEditor:g.U.lookup(e,"main.blocks")?g.BLOCKS_PROJECT_NAME:g.JAVASCRIPT_PROJECT_NAME,targetVersions:g.appTarget.versions}),n=JSON.stringify(e);return g.lzmaCompressAsync(t+n).then(function(e){e&&(u.embedMeta=JSON.stringify({compression:"LZMA",headerSize:t.length,textSize:n.length,name:s.config.name,eURL:g.appTarget.appTheme.embedUrl,eVER:g.appTarget.versions?g.appTarget.versions.target:"",pxtTarget:g.appTarget.id}),u.embedBlob=ts.pxtc.encodeBase64(g.U.uint8ArrayToString(e)))})}return Promise.resolve()}).then(function(){for(var e=0,t=s.sortedDeps();e<t.length;e++)for(var n=t[e],r=0,i=n.getFiles();r<i.length;r++){var o=i[r];if(/\.(ts|asm)$/.test(o)){var a=o;0<n.level&&(a="pxt_modules/"+n.id+"/"+o),u.sourceFiles.push(a),u.fileSystem[a]=n.readFile(o)}}return u.jres=s.getJRes(),u})},e.prototype.filesToBePublishedAsync=function(o){var a=this;void 0===o&&(o=!1);var s={};return this.loadAsync().then(function(){o||a.config.public||g.U.userError('Only packages with "public":true can be published');var n=g.U.clone(a.config);delete n.installedVersion,delete n.additionalFilePath,n.targetVersions||(n.targetVersions=g.appTarget.versions),g.U.iterMap(n.dependencies,function(e,t){(!t||/^file:/.test(t)||/^workspace:/.test(t))&&(n.dependencies[e]="*")}),s[g.CONFIG_NAME]=JSON.stringify(n,null,4);for(var e=0,t=a.getFiles();e<t.length;e++){var r=t[e],i=a.readFile(r);null==i&&g.U.userError("referenced file missing: "+r),s[r]=i}return g.U.sortObjectFields(s)})},e.prototype.saveToJsonAsync=function(t){var n=this;return this.filesToBePublishedAsync(!0).then(function(e){return{meta:{cloudId:g.CLOUD_ID+g.appTarget.id,targetVersions:g.appTarget.versions,editor:t||g.BLOCKS_PROJECT_NAME,name:n.config.name},source:JSON.stringify(e,null,2)}})},e.prototype.compressToFileAsync=function(e){return this.saveToJsonAsync(e).then(function(e){return g.lzmaCompressAsync(JSON.stringify(e,null,2))})},e.prototype.computePartDefinitions=function(o){if(!o||!o.length)return{};var a={};return this.sortedDeps().forEach(function(r){var e=r.readFile("pxtparts.json");if(e)try{var i=JSON.parse(e);Object.keys(i).forEach(function(e){if(0<=o.indexOf(e)){var t=a[e]=i[e];if("string"==typeof t.visual.image&&/\.svg$/i.test(t.visual.image)){var n=r.readFile(t.visual.image);n||g.reportError("parts","invalid part definition",{error:"missing visual "+t.visual.image}),t.visual.image="data:image/svg+xml,"+encodeURIComponent(n)}}})}catch(e){g.reportError("parts","invalid pxtparts.json file")}}),a},e}(g.Package=e);g.MainPackage=t}(pxt||(pxt={})),function(o){var e;(e=o.patching||(o.patching={})).computePatches=function(e,t){var n=o.appTarget.compile?o.appTarget.compile.patches:void 0;if(n){var r=o.semver.tryParse(e||"0.0.0")||o.semver.tryParse("0.0.0"),i=[];return Object.keys(n).filter(function(e){return o.semver.inRange(e,r)}).forEach(function(e){return i=i.concat(n[e])}),t&&(i=i.filter(function(e){return e.type==t})),i.length?i:void 0}},e.upgradePackageReference=function(e,t,n){if("*"!=n)return t;var r=o.patching.computePatches(e,"package"),i=t;return r&&r.forEach(function(t){Object.keys(t.map).forEach(function(e){i==e&&(i=t.map[e])})}),i},e.patchJavaScript=function(e,t){var n=o.patching.computePatches(e,"api"),r=t;return n&&n.forEach(function(e){for(var t in e.map){var n=new RegExp(t,"g");r=r.replace(n,e.map[t])}}),r}}(pxt||(pxt={})),function(f){!function(e){function s(e,t){if(e){if(t){var n=e.major-t.major||e.minor-t.minor||e.patch-t.patch;if(n)return n;if(0==e.pre.length&&0<t.pre.length)return 1;if(0<e.pre.length&&0==t.pre.length)return-1;for(var r=0;r<e.pre.length+1;++r){var i=e.pre[r],o=t.pre[r];if(!i)return o?-1:0;if(!o)return 1;if(/^\d+$/.test(i)){if(!/^\d+$/.test(o))return-1;if(n=parseInt(i)-parseInt(o))return n}else{if(/^\d+$/.test(o))return 1;if(n=f.U.strcmp(i,o))return n}}return 0}return-1}return t?1:0}function a(e){var t=u(e);return t||f.U.userError(f.U.lf("'{0}' doesn't look like a semantic version number",e)),t}function u(e){/^v\d/i.test(e)&&(e=e.slice(1));var t=/^(\d+)\.(\d+)\.(\d+)(-([0-9a-zA-Z\-\.]+))?(\+([0-9a-zA-Z\-\.]+))?$/.exec(e);return t?{major:parseInt(t[1]),minor:parseInt(t[2]),patch:parseInt(t[3]),pre:t[5]?t[5].split("."):[],build:t[7]?t[7].split("."):[]}:null}function c(e){var t=e.major+"."+e.minor+"."+e.patch;return e.pre.length&&(t+="-"+e.pre.join(".")),e.build.length&&(t+="+"+e.build.join(".")),t}function l(e,t){var n=e.split(" - ");if(2!=n.length)return!1;var r=u(n[0]),i=u(n[1]);if(!r||!i)return!1;if(!t)return!0;var o=s(r,t),a=s(t,i);return o<=0&&a<0}e.cmp=s,e.parse=a,e.tryParse=u,e.normalize=function(e){return c(a(e))},e.stringify=c,e.majorCmp=function(e,t){var n=u(e),r=u(t);return n.major-r.major},e.strcmp=function(e,t){var n=u(e),r=u(t);return n||r?s(n,r):f.U.strcmp(e,t)},e.inRange=l,e.test=function(){console.log("Test semver");for(var e=["0.9.0","1.0.0-0.3.7","1.0.0-alpha","1.0.0-alpha.1","1.0.0-alpha.beta","1.0.0-beta","1.0.0-beta.2","1.0.0-beta.11","1.0.0-rc.1","1.0.0-x.7.z.92","1.0.0","1.0.1","1.9.0","1.10.0","1.11.0"],t=0;t<e.length;++t){var n=a(e[t]);console.log(e[t],n),f.U.assert(c(n)==e[t]);for(var r=0;r<e.length;++r){var i=s(n,a(e[r]));console.log(e[t],e[r],i),t<r?f.U.assert(i<0):r<t?f.U.assert(0<i):f.U.assert(0==i)}}var o=u("1.2.3");f.U.assert(l("0.1.2 - 2.2.3",o)),f.U.assert(l("1.2.3 - 2.2.3",o)),f.U.assert(!l("0.0.0 - 1.2.3",o)),f.U.assert(!l("1.2.4 - 4.2.3",o)),f.U.assert(!l("0.0.0 - 0.0.1",o))}}(f.semver||(f.semver={}))}(pxt||(pxt={})),function(e){!function(x){var w,e;x.assert=x.Util.assert,x.oops=x.Util.oops,x.U=x.Util,x.ON_START_TYPE="pxt-on-start",x.ON_START_COMMENT=x.U.lf("on start"),x.HANDLER_COMMENT=x.U.lf("code goes here"),x.TS_STATEMENT_TYPE="typescript_statement",x.TS_DEBUGGER_TYPE="debugger_keyword",x.TS_OUTPUT_TYPE="typescript_expression",x.PAUSE_UNTIL_TYPE="pxt_pause_until",x.BINARY_JS="binary.js",x.BINARY_CS="binary.cs",x.BINARY_ASM="binary.asm",x.BINARY_HEX="binary.hex",x.BINARY_UF2="binary.uf2",x.BINARY_ELF="binary.elf",x.NATIVE_TYPE_THUMB="thumb",x.NATIVE_TYPE_AVR="AVR",x.NATIVE_TYPE_CS="C#",x.NATIVE_TYPE_AVRVM="AVRVM",(e=w=x.SymbolKind||(x.SymbolKind={}))[e.None=0]="None",e[e.Method=1]="Method",e[e.Property=2]="Property",e[e.Function=3]="Function",e[e.Variable=4]="Variable",e[e.Module=5]="Module",e[e.Enum=6]="Enum",e[e.EnumMember=7]="EnumMember",e[e.Class=8]="Class",e[e.Interface=9]="Interface",x.computeUsedParts=function(r,e){if(void 0===e&&(e=!1),!r.usedSymbols||!pxt.appTarget.simulator||!pxt.appTarget.simulator.parts)return[];var i=[];if(Object.keys(r.usedSymbols).forEach(function(e){var t=r.usedSymbols[e];if(t&&t.attributes.parts){var n=t.attributes.parts;n&&n.split(/[ ,]+/).forEach(function(e){0<e.length&&i.indexOf(e)<0&&i.push(e)})}}),e){var t=pxt.appTarget.simulator.boardDefinition.onboardComponents;t&&(i=i.filter(function(e){return t.indexOf(e)<0}))}return i.sort(),i=i.reverse()},x.blocksCategory=function(e){var t=e?e.attributes.blockNamespace||e.namespace:void 0;return t?x.Util.capitalize(t.split(".")[0]):void 0},x.getBlocksInfo=function(e){var g=[],m={},v={},b={};function t(e,t){var n="get"==e,r="set"==e,i="number"==t.retType,o=n?v:r?m:b,a=t.namespace+"."+t.retType,s=x.U.lookup(o,a);if(!s){var u="@"+e+"@",c=void 0,l=void 0;if(t.attributes.blockCombineShadow){var f=t.attributes.blockCombineShadow,p=f.match(/^([^,.]*),?([^,.]*)$/);p&&3==p.length&&(c=p[1].trim(),0!=(l=p[2].trim()).length||x.Util.endsWith(f,",")||(l=c,c=""))}var d=t.namespace.toLowerCase()+"="+(c||""),h="value="+(l||"");(s=o[a]={attributes:{blockId:(i?t.namespace:a)+"_blockCombine_"+e,callingConvention:x.ir.CallingConvention.Plain,group:t.attributes.group,paramDefl:{},jsDoc:n?x.U.lf("Read value of a property on an object"):x.U.lf("Update value of property on an object")},name:u,namespace:t.namespace,qName:a+"."+u,pkg:t.pkg,kind:w.Property,parameters:[{name:"property",description:n?x.U.lf("the name of the property to read"):x.U.lf("the name of the property to change"),isEnum:!0,type:"@combined@"},{name:"value",description:r?x.U.lf("the new value of the property"):x.U.lf("the amount by which to change the property"),type:t.retType}].slice(0,n?1:2),retType:n?t.retType:"void",combinedProperties:[]}).attributes.block=n?"%"+d+" %property":r?"set %"+d+" %property to %"+h:"change %"+d+" %property by %"+h,k(s.attributes),g.push(s)}s.combinedProperties.push(t.qName)}for(var n=0,r=x.Util.values(e.byQName);n<r.length;n++){var i=r[n];if(i.attributes.blockCombine)/@set/.test(i.name)||t("get",i),i.isReadOnly||("number"==i.retType&&t("change",i),t("set",i));else if(i.attributes.block&&!i.attributes.fixedInstance&&i.kind!=x.SymbolKind.EnumMember&&i.kind!=x.SymbolKind.Module&&i.kind!=x.SymbolKind.Interface&&i.kind!=x.SymbolKind.Class){if(i.attributes.blockId||(i.attributes.blockId=i.qName.replace(/\./g,"_")),"true"==i.attributes.block){var o=x.U.uncapitalize(i.name);i.kind!=w.Method&&i.kind!=w.Property||(o+=" %"+i.namespace.toLowerCase());for(var a=0,s=i.parameters||[];a<s.length;a++)o+=" %"+s[a].name;i.attributes.block=o,k(i.attributes)}g.push(i)}}for(var u=0,c=g;u<c.length;u++){o=c[u];var l=x.U.lookup(e.byQName,o.namespace);if(l)for(var f=l.attributes,p=o.attributes,d=0,h=["blockNamespace","color","blockGap"];d<h.length;d++){var y=h[d];void 0===p[y]&&f[y]&&(p[y]=f[y])}}return{apis:e,blocks:g,blocksById:pxt.Util.toDictionary(g,function(e){return e.attributes.blockId})}},x.localizeApisAsync=function(e,t){var n=x.Util.userLanguage();return"en"==x.Util.userLanguage()?Promise.resolve(e):t.localizationStringsAsync(n).then(function(s){return x.Util.values(e.byQName).forEach(function(t){var e=s[t.qName];e&&(t.attributes.jsDoc=e,t.parameters&&t.parameters.forEach(function(e){return e.description=s[t.qName+"|param|"+e.name]||e.description}));var n=s["{id:category}"+x.Util.capitalize(t.qName)],r=s[t.qName+"|block"];if(n)t.attributes.block?t.attributes.block=r||t.attributes.block:t.attributes.block=n;else if(t.attributes.block&&r){var i=pxt.blocks.compileInfo(t),o=t.attributes.block;if(t.attributes.block=pxt.blocks.normalizeBlock(r),o!=t.attributes.block){var a=pxt.blocks.compileInfo(t);JSON.stringify(i)!=JSON.stringify(a)&&(pxt.log("block has non matching arguments: "+o+" vs "+t.attributes.block),t.attributes.block=o)}}k(t.attributes)})}).then(function(){return e})},x.emptyExtInfo=function(){var e=pxt.appTarget.compileService;e||(e={});var t=!!e.platformioIni,n="dockermake"==e.buildEngine,r={functions:[],generatedFiles:{},extensionFiles:{},sha:"",compileData:"",shimsDTS:"",enumsDTS:"",onlyPublic:!0};return t?r.platformio={dependencies:{}}:n?r.npmDependencies={}:r.yotta={config:{},dependencies:{}},r};var t,a=["weight","imageLiteral"],s=["advanced","handlerStatement","afterOnStart","optionalVariableArgs","blockHidden","constantShim","blockCombine","decompileIndirectFixedInstances","draggableParameters"];function k(e){if(e.block){var t=e.block.split("||");e._def=n(t[0]),e._def||pxt.debug("Unable to parse block def for id: "+e.blockId),t[1]&&(e._expandedDef=n(t[1])),t[1]&&!e._expandedDef&&pxt.debug("Unable to parse expanded block def for id: "+e.blockId)}}function n(u){for(var c,l=[],f=0,e=function(){var t=u[f],e=void 0;switch(t){case"*":case"_":var n=b(function(e){return e==t}).length,r="_"===t?2:0;if(1===n)e={kind:1<<r};else if(2===n)e={kind:2<<r};else{if(3!==n)return{value:void 0};e={kind:3<<r}}break;case"`":var i=y("`");if(void 0===i)return{value:void 0};e={kind:256,content:i};break;case"|":e={kind:32};break;case"\\":f<u.length-1&&(e={kind:16,content:u[1+f++]});break;case"[":var o=y("]");if(void 0===o)return{value:void 0};if("("!==u[1+f++])return{value:void 0};var a=y(")");if(void 0===a)return{value:void 0};e={kind:512,content:o,type:a};break;case"$":case"%":var s=b(function(e){return/[a-zA-Z0-9_=]/.test(e)},!0).split("=");if(2<s.length)return{value:void 0};e={kind:"$"===t?1024:64,content:s[0],type:s[1]}}e?(c&&l.push({kind:128,content:c}),c=void 0,l.push(e)):c?c+=t:c=t};f<u.length;f++){var t=e();if("object"==typeof t)return t.value}c&&l.push({kind:128,content:c});for(var n=[],r=[],i=[],o=0,a="",s=0;s<l.length;s++){var p=l[s].kind,d=i[i.length-1],h=!1,g=[];if(10&o&&g.push("bold"),5&o&&g.push("italics"),15&p)if(h=!0,p&o){if(!(d&p))return;i.pop();var m=d&(o^=p)|p&o;m&&i.push(m)}else o|=p,i.push(p);else switch(p){case 16:case 128:a+=l[s].content;break;case 32:case 64:case 1024:if(o)return;case 256:case 512:h=!0}if(h&&a&&(n.push({kind:"label",text:a,style:g}),a=""),64==p){var v={kind:"param",name:l[s].content,shadowBlockId:l[s].type,ref:!1};n.push(v),r.push(v)}else if(1024==p){v={kind:"param",name:l[s].content,shadowBlockId:l[s].type,ref:!0};n.push(v),r.push(v)}else 256==p?n.push({kind:"image",uri:l[s].content}):512==p?n.push({kind:"label",text:l[s].content,cssClass:l[s].type}):32==p&&n.push({kind:"break"})}if(!o)return a&&n.push({kind:"label",text:a,style:[]}),{parts:n,parameters:r};function b(e,t){void 0===t&&(t=!1);var n="";for(t&&f++;f<u.length&&e(u[f]);)n+=u[f],++f;return n&&f--,n}function y(t){var e=b(function(e){return e!==t},!0);if(u[f+1]===t)return++f,e}}x.parseCommentString=function(e){for(var l={paramDefl:{},callingConvention:x.ir.CallingConvention.Plain,_source:e},f=!0;f;)f=!1,e=e.replace(/\/\/%[ \t]*([\w\.]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,function(e,t,n,r,i,o,a){var s=i?JSON.parse(i):n?i||o||a:"true";if(s||(s=""),x.U.endsWith(t,".defl"))-1<s.indexOf(" ")?l.paramDefl[t.slice(0,t.length-5)]='"'+s+'"':l.paramDefl[t.slice(0,t.length-5)]=s;else if(x.U.endsWith(t,".fieldEditor"))l.paramFieldEditor||(l.paramFieldEditor={}),l.paramFieldEditor[t.slice(0,t.length-12)]=s;else if(x.U.contains(t,".fieldOptions.")){l.paramFieldEditorOptions||(l.paramFieldEditorOptions={});var u=t.slice(0,t.indexOf(".fieldOptions.")),c=t.slice(t.indexOf(".fieldOptions.")+14,t.length);l.paramFieldEditorOptions[u]||(l.paramFieldEditorOptions[u]={}),l.paramFieldEditorOptions[u][c]=s}else x.U.contains(t,".shadowOptions.")?(l.paramShadowOptions||(l.paramShadowOptions={}),u=t.slice(0,t.indexOf(".shadowOptions.")),c=t.slice(t.indexOf(".shadowOptions.")+15,t.length),l.paramShadowOptions[u]||(l.paramShadowOptions[u]={}),l.paramShadowOptions[u][c]=s):x.U.endsWith(t,".min")?(l.paramMin||(l.paramMin={}),l.paramMin[t.slice(0,t.length-4)]=s):x.U.endsWith(t,".max")?(l.paramMax||(l.paramMax={}),l.paramMax[t.slice(0,t.length-4)]=s):l[t]=s;return f=!0,"//% "});for(var t=0,n=a;t<n.length;t++){var r=n[t];"string"==typeof l[r]&&(l[r]=parseInt(l[r]))}for(var i=0,o=s;i<o.length;i++)r=o[i],"string"==typeof l[r]&&(l[r]="true"==l[r]||"1"==l[r]);if(l.trackArgs&&(l.trackArgs=l.trackArgs.split(/[ ,]+/).map(function(e){return parseInt(e)||0})),l.blockExternalInputs&&!l.inlineInputMode&&(l.inlineInputMode="external"),l.paramHelp={},l.jsDoc="",e=e.replace(/\/\*\*([^]*?)\*\//g,function(e,t){return t=(t=t.replace(/\n\s*(\*\s*)?/g,"\n")).replace(/^\s*@param\s+(\w+)\s+(.*)$/gm,function(e,t,n){if(l.paramHelp[t]=n,!l.paramDefl[t]){var r=/\beg\.?:\s*(.+)/.exec(n);if(r&&r[1]){var i=/(?:"([^"]*)")|(?:'([^']*)')|(?:([^\s,]+))/g.exec(r[1]);if(i){var o=i[1]||i[2]||i[3];o||(o=""),-1<o.indexOf(" ")?l.paramDefl[t]='"'+o+'"':l.paramDefl[t]=o}}}return""}),l.jsDoc+=t,""}),l.jsDoc=l.jsDoc.trim(),l.async&&(l.callingConvention=x.ir.CallingConvention.Async),l.promise&&(l.callingConvention=x.ir.CallingConvention.Promise),l.jres&&(l.whenUsed=!0),l.subcategories)try{l.subcategories=JSON.parse(l.subcategories)}catch(e){l.subcategories=void 0}if(l.groups)try{l.groups=JSON.parse(l.groups)}catch(e){l.groups=void 0}if(l.groupIcons)try{l.groupIcons=JSON.parse(l.groupIcons)}catch(e){l.groupIcons=void 0}return k(l),l},x.updateBlockDef=k,x.parseBlockDefinition=n,(t=x.hex||(x.hex={})).isSetupFor=function(e){return t.currentSetup==e.sha},t.currentSetup=null,t.parseChecksumBlock=function(e,t){void 0===t&&(t=0);var n=pxt.HF2.read32(e,t);if(133083260!=(2147483647&n))return pxt.log("no checksum block magic"),null;var r=pxt.HF2.read32(e,t+4),i=pxt.HF2.read32(e,t+8);if(3&r)return pxt.log("invalid end marker position"),null;var o=1<<(255&i);if(o!=pxt.appTarget.compile.flashCodeAlign)return pxt.log("invalid page size: "+o),null;for(var a={magic:n,endMarkerPos:r,endMarker:i,regions:[]},s=t+12;s<e.length-7;s+=8){var u={start:o*pxt.HF2.read16(e,s),length:o*pxt.HF2.read16(e,s+2),checksum:pxt.HF2.read32(e,s+4)};if(!u.length||!u.checksum)break;a.regions.push(u)}return a},function(f){function m(t){var e=function(e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0};if(!t||512!=t.length||e(0)!=f.UF2_MAGIC_START0||e(4)!=f.UF2_MAGIC_START1||e(t.length-4)!=f.UF2_MAGIC_END)return null;var n=e(8),r=e(16);476<r&&(r=256);var i=null;if(n&f.UF2_FLAG_FILE){var o=t.slice(32+r),a=o.indexOf(0);0<=a&&(o=o.slice(0,a)),i=x.U.fromUTF8(x.U.uint8ArrayToString(o))}return{flags:n,targetAddr:e(12),payloadSize:r,blockNo:e(20),numBlocks:e(24),fileSize:e(28),data:t.slice(32,32+r),filename:i}}function a(e,t){return!!e&&(e.targetAddr<=t&&t<e.targetAddr+e.payloadSize)}function p(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function e(){return{currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0}}function s(e){for(var t=0;t<e.blocks.length;++t)p(e.blocks[t],20,t),p(e.blocks[t],24,e.blocks.length),e.filename&&p(e.blocks[t],28,e.filesize)}function d(e,t,n){var r=e.currBlock,i=t>>8,o=256-(255&t);if(n.length>o){var a=new Uint8Array(n);for(d(e,t,a.slice(0,o));o<n.length;){var s=Math.min(o+256,n.length);d(e,t+o,a.slice(o,s)),o=s}}else{if(i!=e.currPtr){var u=0;r=null;for(var c=0;c<e.ptrs.length;++c)if(e.ptrs[c]==i){r=e.blocks[c];break}r||(p(r=new Uint8Array(512),0,f.UF2_MAGIC_START0),p(r,4,f.UF2_MAGIC_START1),p(r,8,e.filename?f.UF2_FLAG_FILE:f.UF2_FLAG_NONE),p(r,12,i<<8),p(r,16,256),p(r,20,e.blocks.length),p(r,508,f.UF2_MAGIC_END),e.filename&&x.U.memcpy(r,288,x.U.stringToUint8Array(x.U.toUTF8(e.filename))),e.blocks.push(r),e.ptrs.push(i)),e.currPtr=i,e.currBlock=r}var l=32+(255&t);for(u=0;u<n.length;++u)r[l+u]=n[u];e.filesize=Math.max(e.filesize,n.length+t)}}f.UF2_MAGIC_START0=171066965,f.UF2_MAGIC_START1=2656915799,f.UF2_MAGIC_END=179400496,f.UF2_FLAG_NONE=0,f.UF2_FLAG_NOFLASH=1,f.UF2_FLAG_FILE=4096,f.parseBlock=m,f.parseFile=function(e){for(var t=[],n=0;n<e.length;n+=512){var r=m(e.slice(n,n+512));r&&t.push(r)}return t},f.toBin=function(e){if(e.length<512)return null;for(var t=-1,n=-1,r=[],i=0;i<e.length;++i){var o=512*i,a=m(e.slice(o,o+512));if(a){-1==t&&(n=t=a.targetAddr);var s=a.targetAddr-t;s<0||s%4||1048576<s||(0<s&&r.push(new Uint8Array(s)),r.push(e.slice(o+32,o+32+a.payloadSize)),t=a.targetAddr+a.payloadSize)}}for(var u=0,c=0,l=r;c<l.length;c++)u+=(g=l[c]).length;if(0==u)return null;for(var f=new Uint8Array(u),p=0,d=0,h=r;d<h.length;d++){var g=h[d];for(i=0;i<g.length;++i)f[p++]=g[i]}return{buf:f,start:n}},f.readBytes=function(e,t,n){for(var r,i=new Uint8Array(n),o=0;o<n;++o,++t)a(r,t)||(r=e.filter(function(e){return a(e,t)})[0]),r&&(i[o]=r.data[t-r.targetAddr]);return i},f.newBlockFile=e,f.finalizeFile=s,f.concatFiles=function(e){for(var t=0,n=e;t<n.length;t++)s(a=n[t]),a.filename=null;var r={currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0};r.blocks=x.U.concat(e.map(function(e){return e.blocks}));for(var i=0,o=e;i<o.length;i++){var a;(a=o[i]).blocks=[]}return r},f.serializeFile=function(e){s(e);for(var t="",n=0,r=e.blocks;n<r.length;n++){var i=r[n];t+=x.Util.uint8ArrayToString(i)}return t},f.readBytesFromFile=function e(t,n,r){var i,o=n>>8;if(o==t.currPtr)i=t.currBlock;else{for(var a=0;a<t.ptrs.length;++a)if(t.ptrs[a]==o){i=t.blocks[a];break}i&&(t.currPtr=o,t.currBlock=i)}if(!i)return null;var s=new Uint8Array(r),u=Math.min(r,256-(255&n));x.U.memcpy(s,0,i,32+(255&n),u);var c=r-u;if(0<c){var l=e(t,n+u,c);x.U.memcpy(s,u,l)}return s},f.writeBytes=d,f.writeHex=function(e,t){for(var n="0000",r=0;r<t.length;++r){var i=/:02000004(....)/.exec(t[r]);if(i&&(n=i[1]),i=/^:..(....)00(.*)[0-9A-F][0-9A-F]$/.exec(t[r])){for(var o=parseInt(n+i[1],16),a=i[2],s=[],u=0;u<a.length;u+=2)s.push(parseInt(a[u]+a[u+1],16));d(e,o,s)}}}}(x.UF2||(x.UF2={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={})),function(e){var t,n,r;t=e.pxtc||(e.pxtc={}),n=t.ir||(t.ir={}),(r=n.CallingConvention||(n.CallingConvention={}))[r.Plain=0]="Plain",r[r.Async=1]="Async",r[r.Promise=2]="Promise"}(ts||(ts={})),function(n){var e;(e=n.streams||(n.streams={})).createStreamAsync=function(e,t){return n.Cloud.privatePostAsync("streams",{target:e,name:t||"data"}).then(function(e){return e})},e.postPayloadAsync=function(e,t){return n.Util.assert(!!e.privatekey),n.Cloud.privatePostAsync(e.id+"/data?privatekey="+e.privatekey,t)}}(pxt||(pxt={})),function(e){!function(n){var r,e,i,t;(e=r=n.PatternUnits||(n.PatternUnits={}))[e.userSpaceOnUse=0]="userSpaceOnUse",e[e.objectBoundingBox=1]="objectBoundingBox",(t=i=n.LengthUnit||(n.LengthUnit={}))[t.em=0]="em",t[t.ex=1]="ex",t[t.px=2]="px",t[t.in=3]="in",t[t.cm=4]="cm",t[t.mm=5]="mm",t[t.pt=6]="pt",t[t.pc=7]="pc",t[t.percent=8]="percent";var o=function(){function e(e){this.el=E(e)}return e.prototype.attr=function(t){var n=this;return Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),this},e.prototype.setAttribute=function(e,t){return this.el.setAttribute(e,t.toString()),this},e.prototype.id=function(e){return this.setAttribute("id",e)},e.prototype.setClass=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.setAttribute("class",e.join(" "))},e.prototype.appendClass=function(e){var t,n;return t=this.el,n=e,t.classList?t.classList.add(n):t.className.baseVal.indexOf(n)<0&&(t.className.baseVal+=" "+n),this},e.prototype.removeClass=function(e){var t,n;t=this.el,n=e,t.classList?t.classList.remove(n):t.className.baseVal=t.className.baseVal.replace(n,"").replace(/\s{2,}/," ")},e.prototype.title=function(e){this.titleElement||(this.titleElement=E("title"),this.el.firstChild?this.el.insertBefore(this.titleElement,this.el.firstChild):this.el.appendChild(this.titleElement)),this.titleElement.textContent=e},e.prototype.setVisible=function(e){return this.setAttribute("visibility",e?"visible":"hidden")},e}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.draw=function(e){var t=function(e){switch(e){case"text":return new p;case"circle":return new h;case"rect":return new d;case"line":return new g;case"polygon":return new b;case"polyline":return new v;case"path":return new y;default:return new f(e)}}(e);return this.el.appendChild(t.el),t},t.prototype.element=function(e,t){return t(this.draw(e)),this},t.prototype.group=function(){var e=new u;return this.el.appendChild(e.el),e},t.prototype.appendChild=function(e){this.el.appendChild(e.el)},t}(n.BaseElement=o),s=function(n){function e(e){var t=n.call(this,"svg")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.define=function(e){return this.defs||(this.defs=new l(this.el)),e(this.defs),this},e}(n.DrawContext=a);n.SVG=s;var u=function(n){function e(e){var t=n.call(this,"g")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.translate=function(e,t){return this.left=e,this.top=t,this.updateTransform()},e.prototype.scale=function(e){return this.scaleFactor=e,this.updateTransform()},e.prototype.updateTransform=function(){var e="";return null!=this.left&&(e+="translate("+this.left+" "+this.top+")"),null!=this.scaleFactor&&(e+=" scale("+this.scaleFactor+")"),this.setAttribute("transform",e),this},e}(a);n.Group=u;var c=function(e){function t(){return e.call(this,"pattern")||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("patternUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.contentUnits=function(e){return this.setAttribute("patternContentUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.size=function(e,t){return this.setAttribute("width",e),this.setAttribute("height",t),this},t}(a);n.Pattern=c;var l=function(n){function e(e){var t=n.call(this,"defs")||this;return e.appendChild(t.el),t}return __extends(e,n),e.prototype.create=function(e,t){var n;switch(e){case"path":n=new y;break;case"pattern":n=new c;break;case"radialGradient":n=new A;break;case"linearGradient":n=new k;break;default:n=new o(e)}return n.id(t),this.el.appendChild(n.el),n},e}(o);n.DefsElement=l;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("x",e),this.setAttribute("y",t),this},t.prototype.moveTo=function(e,t){return this.at(e,t)},t.prototype.fill=function(e,t){return this.setAttribute("fill",e),null!=t&&this.opacity(t),this},t.prototype.opacity=function(e){return this.setAttribute("fill-opacity",e)},t.prototype.stroke=function(e,t){return this.setAttribute("stroke",e),null!=t&&this.strokeWidth(t),this},t.prototype.strokeWidth=function(e){return this.setAttribute("stroke-width",e)},t.prototype.strokeOpacity=function(e){return this.setAttribute("stroke-opacity",e)},t.prototype.onDown=function(e){return n.events.down(this.el,e),this},t.prototype.onUp=function(e){return n.events.up(this.el,e),this},t.prototype.onMove=function(e){return n.events.move(this.el,e),this},t.prototype.onEnter=function(e){return n.events.enter(this.el,e),this},t.prototype.onLeave=function(e){return n.events.leave(this.el,e),this},t.prototype.onClick=function(e){return n.events.click(this.el,e),this},t}(a),p=function(n){function e(e){var t=n.call(this,"text")||this;return null!=e&&t.text(e),t}return __extends(e,n),e.prototype.text=function(e){return this.el.textContent=e,this},e.prototype.fontFamily=function(e){return this.setAttribute("font-family",e)},e.prototype.fontSize=function(e,t){return this.setAttribute("font-size",S(e,t))},e.prototype.offset=function(e,t,n){return 0!==e&&this.setAttribute("dx",S(e,n)),0!==t&&this.setAttribute("dy",S(t,n)),this},e.prototype.anchor=function(e){return this.setAttribute("text-anchor",e)},e}(n.Drawable=f);n.Text=p;var d=function(e){function t(){return e.call(this,"rect")||this}return __extends(t,e),t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",S(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",S(e,t))},t.prototype.corner=function(e){return this.corners(e,e)},t.prototype.corners=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(f);n.Rect=d;var h=function(e){function t(){return e.call(this,"circle")||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(f);n.Circle=h;!function(e){function t(){return e.call(this,"ellipse")||this}__extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this}}(f);var g=function(e){function t(){return e.call(this,"line")||this}return __extends(t,e),t.prototype.at=function(e,t,n,r){return this.from(e,t),null!=n&&null!=r&&this.to(n,r),this},t.prototype.from=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.to=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(f);n.Line=g;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.points=function(e){return this.setAttribute("points",e)},t.prototype.with=function(e){return this.points(e.map(function(e){return e.x+" "+e.y}).join(","))},t}(f),v=function(e){function t(){return e.call(this,"polyline")||this}return __extends(t,e),t}(n.PolyElement=m);n.Polyline=v;var b=function(e){function t(){return e.call(this,"polygon")||this}return __extends(t,e),t}(m);n.Polygon=b;var y=function(t){function e(){var e=t.call(this,"path")||this;return e.d=new C,e}return __extends(e,t),e.prototype.update=function(){return this.setAttribute("d",this.d.toAttribute())},e.prototype.path=function(e){return e(this.d),this.update()},e}(f);n.Path=y;var x=function(e){function t(){return e.call(this,"image")||this}return __extends(t,e),t.prototype.src=function(e){return this.setAttribute("href",e)},t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",S(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",S(e,t))},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(f);n.Image=x;var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("gradientUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.stop=function(e,t,n){var r=E("stop");return r.setAttribute("offset",e+"%"),null!=t&&r.setAttribute("stop-color",t),null!=n&&r.setAttribute("stop-opacity",n),this.el.appendChild(r),this},t}(o),k=function(e){function t(){return e.call(this,"linearGradient")||this}return __extends(t,e),t.prototype.start=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.end=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(n.Gradient=w);n.LinearGradient=k;var A=function(e){function t(){return e.call(this,"radialGradient")||this}return __extends(t,e),t.prototype.center=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.focus=function(e,t,n){return this.setAttribute("fx",e),this.setAttribute("fy",t),this.setAttribute("fr",n),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(w);function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}n.RadialGradient=A;var C=function(){function e(){this.ops=[]}return e.prototype.clear=function(){this.ops=[]},e.prototype.moveTo=function(e,t){return this.op("M",e,t)},e.prototype.moveBy=function(e,t){return this.op("m",e,t)},e.prototype.lineTo=function(e,t){return this.op("L",e,t)},e.prototype.lineBy=function(e,t){return this.op("l",e,t)},e.prototype.cCurveTo=function(e,t,n,r,i,o){return this.op("C",e,t,n,r,i,o)},e.prototype.cCurveBy=function(e,t,n,r,i,o){return this.op("c",e,t,n,r,i,o)},e.prototype.qCurveTo=function(e,t,n,r){return this.op("Q",e,t,n,r)},e.prototype.qCurveBy=function(e,t,n,r){return this.op("q",e,t,n,r)},e.prototype.sCurveTo=function(e,t,n,r){return this.op("S",e,t,n,r)},e.prototype.sCurveBy=function(e,t,n,r){return this.op("s",e,t,n,r)},e.prototype.tCurveTo=function(e,t){return this.op("T",e,t)},e.prototype.tCurveBy=function(e,t){return this.op("t",e,t)},e.prototype.arcTo=function(e,t,n,r,i,o,a){return this.op("A",e,t,n,r?1:0,i?1:0,o,a)},e.prototype.close=function(){return this.op("z")},e.prototype.toAttribute=function(){return this.ops.map(function(e){return e.op+" "+e.args.join(" ")}).join(" ")},e.prototype.op=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.ops.push({op:e,args:t}),this},e}();function S(e,t){switch(t){case i.em:return e+"em";case i.ex:return e+"ex";case i.px:return e+"px";case i.in:return e+"in";case i.cm:return e+"cm";case i.mm:return e+"mm";case i.pt:return e+"pt";case i.pc:return e+"pc";case i.percent:return e+"%";default:return e.toString()}}n.PathContext=C}(e.svgUtil||(e.svgUtil={}))}(pxt||(pxt={})),function(e){var t;(function(e){function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}e.isTouchEnabled=n,e.hasPointerEvents=r,e.down=function(e,t){r()?e.addEventListener("pointerdown",t):n()?(e.addEventListener("mousedown",t),e.addEventListener("touchstart",t)):e.addEventListener("mousedown",t)},e.up=function(e,t){r()?e.addEventListener("pointerup",t):(n(),e.addEventListener("mouseup",t))},e.enter=function(e,t){r()?e.addEventListener("pointerover",function(e){t(!!(1&e.buttons))}):n()?e.addEventListener("touchstart",function(e){t(!0)}):e.addEventListener("mouseover",function(e){t(!!(1&e.buttons))})},e.leave=function(e,t){r()?e.addEventListener("pointerleave",t):n()?e.addEventListener("touchend",t):e.addEventListener("mouseleave",t)},e.move=function(e,t){r()?e.addEventListener("pointermove",t):n()?e.addEventListener("touchmove",t):e.addEventListener("mousemove",t)},e.click=function(e,t){e.addEventListener("click",t)}})((t=e.svgUtil||(e.svgUtil={})).events||(t.events={}))}(pxt||(pxt={})),function(e){var t,n,r;t=e.svgUtil||(e.svgUtil={}),n=t.helpers||(t.helpers={}),r=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.at=function(e,t){return this.cx=e,this.cy=t,this.rePosition(),this},e.prototype.text=function(e,t){return void 0===t&&(t=12),n.prototype.text.call(this,e),this.fontSizePixels=t,this.setAttribute("font-size",t+"px"),this.rePosition(),this},e.prototype.rePosition=function(){null!=this.cx&&null!=this.cy&&null!=this.fontSizePixels&&(this.setAttribute("x",this.cx),this.setAttribute("y",this.cy),this.setAttribute("text-anchor","middle"),this.setAttribute("alignment-baseline","middle"))},e}(t.Text),n.CenteredText=r}(pxt||(pxt={})),function(i){!function(e){e.blockColors={loops:"#107c10",logic:"#006970",math:"#712672",images:"#5C2D91",variables:"#A80000",functions:"#005a9e",text:"#996600",arrays:"#A94400",advanced:"#3c3c3c",addpackage:"#717171",search:"#000",debug:"#e03030",default:"#dddddd"},e.blockIcons={loops:"",logic:"",math:"",variables:"",functions:"",text:"",arrays:"",advancedcollapsed:"",advancedexpanded:"",more:"",addpackage:"",search:"",debug:"",default:""};var r="";e.appendToolboxIconCss=function(e,t){if(!(-1<r.indexOf(e)))if(1===t.length){var n=i.Util.unicodeToChar(t);r+="\n                .blocklyTreeIcon."+e+'::before {\n                    content: "'+n+'";\n                }\n            '}else r+="\n                .blocklyTreeIcon."+e+' {\n                    background-image: url("'+i.Util.pathJoin(i.webConfig.commitCdnUrl,encodeURI(t))+'")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }\n            '},e.getNamespaceColor=function(e){return i.appTarget.appTheme.blockColors&&i.appTarget.appTheme.blockColors[e]?i.appTarget.appTheme.blockColors[e]:i.toolbox.blockColors[e]?i.toolbox.blockColors[e]:""},e.getNamespaceIcon=function(e){return i.appTarget.appTheme.blockIcons&&i.appTarget.appTheme.blockIcons[e]?i.appTarget.appTheme.blockIcons[e]:i.toolbox.blockIcons[e]?i.toolbox.blockIcons[e]:""},e.advancedTitle=function(){return i.Util.lf("{id:category}Advanced")},e.addPackageTitle=function(){return i.Util.lf("{id:category}Extensions")},e.convertColor=function(e){var t=parseInt(e);return isNaN(t)||console.error("hue style color not supported anymore, use #rrggbb"),e},e.fadeColor=function(e,t,n){(e=e.replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);for(var r="#",i=0;i<3;i++){var o=parseInt(e.substr(2*i,2),16),a=(o=Math.round(Math.min(Math.max(0,n?o+o*t:o-o*t),255))).toString(16);r+=("00"+a).substr(a.length)}return r}}(i.toolbox||(i.toolbox={}))}(pxt||(pxt={})),function(u){var e;(e=u.tutorial||(u.tutorial={})).parseTutorialSteps=function(e,t){var n=t.split(/^##[^#].*$/gim),r=!0;if(n.length<=1&&(n=t.split(/^###[^#].*$/gim),r=!1),0==n[0].indexOf("# Not found"))throw u.log("Tutorial not found: "+e),new Error("Tutorial not found: "+e);var i=[];if(t.replace(r?/^##[^#](.*)$/gim:/^###[^#](.*)$/gim,function(e,t){var n={fullscreen:/@(fullscreen|unplugged)/.test(t),unplugged:/@unplugged/.test(t)};return i.push(n),""}),!(n.length<1)){n[0],n=n.slice(1,n.length);for(var o=0;o<n.length;o++){var a=n[o].trim(),s=a.split("\n");i[o].headerContentMd=s[0],i[o].contentMd=a,i[o].hasHint=1<s.length}return i}},e.bundleTutorialCode=function(e){e=e.replace(/((?!.)\s)+/g,"\n");var r="";return e.replace(/```(sim|block|blocks|filterblocks)\s*\n([\s\S]*?)\n```/gim,function(e,t,n){return r+="\n { \n "+n+"\n } \n",""}),r}}(pxt||(pxt={})),function(l){!function(n){var r,e;n.flattenDiagnosticMessageText=function(e,t){if("string"==typeof e)return e;for(var n=e,r="",i=0;n;){if(i){r+=t;for(var o=0;o<i;o++)r+="  "}r+=n.messageText,i++,n=n.next}return r},(e=r=n.ScriptTarget||(n.ScriptTarget={}))[e.ES3=0]="ES3",e[e.ES5=1]="ES5",e[e.ES6=2]="ES6",e[e.ES2015=2]="ES2015",e[e.Latest=2]="Latest",n.isIdentifierStart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||36===e||95===e||127<e&&u(e,t)},n.isIdentifierPart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||36===e||95===e||127<e&&(n=e,t>=r.ES5?c(n,o):c(n,s));var n},n.reservedWords=["abstract","any","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","let","module","namespace","new","null","package","private","protected","public","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","var","void","while","with","yield","async","await","of","Math"],n.escapeIdentifier=function(e){if(!e)return"_";var t=e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_$]/g,function(e){return l.pxtc.isIdentifierPart(e.charCodeAt(0),l.pxtc.ScriptTarget.ES5)?e:""});return t&&l.pxtc.isIdentifierStart(t.charCodeAt(0),l.pxtc.ScriptTarget.ES5)&&-1===n.reservedWords.indexOf(t)||(t="_"+t),t};var t,i=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],o=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],a=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],s=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,768,846,864,866,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1155,1158,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1488,1514,1520,1522,1569,1594,1600,1621,1632,1641,1648,1747,1749,1756,1759,1768,1770,1773,1776,1788,1808,1836,1840,1866,1920,1968,2305,2307,2309,2361,2364,2381,2384,2388,2392,2403,2406,2415,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2524,2525,2527,2531,2534,2545,2562,2562,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2649,2652,2654,2654,2662,2676,2689,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2784,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2876,2883,2887,2888,2891,2893,2902,2903,2908,2909,2911,2913,2918,2927,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3134,3140,3142,3144,3146,3149,3157,3158,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3395,3398,3400,3402,3405,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3805,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3946,3953,3972,3974,3979,3984,3991,3993,4028,4038,4038,4096,4129,4131,4135,4137,4138,4140,4146,4150,4153,4160,4169,4176,4185,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4969,4977,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6099,6112,6121,6160,6169,6176,6263,6272,6313,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8255,8256,8319,8319,8400,8412,8417,8417,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12335,12337,12341,12344,12346,12353,12436,12441,12442,12445,12446,12449,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65056,65059,65075,65076,65101,65103,65136,65138,65140,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65381,65470,65474,65479,65482,65487,65490,65495,65498,65500];function u(e,t){return t>=r.ES5?c(e,i):c(e,a)}function c(e,t){if(e<t[0])return!1;for(var n,r=0,i=t.length;r+1<i;){if(n=r+(i-r)/2,t[n-=n%2]<=e&&e<=t[n+1])return!0;e<t[n]?i=n:r=n+2}return!1}n.isUnicodeIdentifierStart=u,(t=n.DiagnosticCategory||(n.DiagnosticCategory={}))[t.Warning=0]="Warning",t[t.Error=1]="Error",t[t.Message=2]="Message"}(l.pxtc||(l.pxtc={}))}(ts||(ts={})),function(u){!function(o){var t=function(n){function e(e){var t=n.call(this,e)||this;return t.message=e,t}return __extends(e,n),e}(Error);o.USBError=t,o.filters=[{classCode:255,subclassCode:42}],o.setFilters=function(e){o.filters=e};var n,r=function(){function e(e){this.dev=e,this.ready=!1,this.onData=function(e){},this.onError=function(e){},this.onEvent=function(e){},this.readLoop()}return e.prototype.error=function(e){throw new t(u.U.lf("USB error on device {0} ({1})",this.dev.productName,e))},e.prototype.log=function(e){e="WebUSB: "+e,u.debug(e)},e.prototype.disconnectAsync=function(){var e=this;return this.dev?(this.ready=!1,this.log("close device"),this.dev.close().catch(function(e){}).then(function(){return e.dev=null,Promise.delay(500)})):Promise.resolve()},e.prototype.reconnectAsync=function(){var t=this;return this.log("reconnect"),this.disconnectAsync().then(i).then(function(e){return t.log("got device: "+e.manufacturerName+" "+e.productName),t.dev=e,t.initAsync()})},e.prototype.sendPacketAsync=function(e){var t=this;return u.Util.assert(e.length<=64),this.dev.transferOut(this.epOut.endpointNumber,e).then(function(e){"ok"!=e.status&&t.error("USB OUT transfer failed")})},e.prototype.readLoop=function(){var t=this,n=function(){t.ready?t.recvPacketAsync().then(function(e){t.onData(e),n()},function(e){t.onError(e),Promise.delay(300).then(n)}):Promise.delay(300).then(n)};n()},e.prototype.recvPacketAsync=function(){var n=this;return this.dev.transferIn(this.epIn.endpointNumber,64).then(function(e){"ok"!=e.status&&n.error("USB IN transfer failed");var t=new Uint8Array(e.data.buffer);return 0==t.length?n.recvPacketAsync():t})},e.prototype.initAsync=function(){var t=this,n=this.dev;return this.log("open device"),n.open().then(function(){return t.log("select configuration"),n.selectConfiguration(1)}).then(function(){t.log("got "+n.configurations[0].interfaces.length+" interfaces");var e=n.configurations[0].interfaces.filter(function(e){for(var t=e.alternates[0],n=0,r=o.filters;n<r.length;n++){var i=r[n];if((null==i.classCode||t.interfaceClass===i.classCode)&&(null==i.subclassCode||t.interfaceSubclass===i.subclassCode)&&(null==i.protocolCode||t.interfaceProtocol===i.protocolCode)&&2==t.endpoints.length&&t.endpoints.every(function(e){return 64==e.packetSize}))return!0}return!1})[0];return e||t.error("cannot find supported USB interface"),t.altIface=e.alternates[0],t.epIn=t.altIface.endpoints.filter(function(e){return"in"==e.direction})[0],t.epOut=t.altIface.endpoints.filter(function(e){return"out"==e.direction})[0],u.Util.assert(64==t.epIn.packetSize),u.Util.assert(64==t.epOut.packetSize),t.log("claim interface"),n.claimInterface(e.interfaceNumber)}).then(function(){t.log("device ready"),t.ready=!0})},e}();function i(){return navigator.usb.getDevices().then(function(e){return e&&e.length?e[0]:Promise.reject(new t(u.U.lf("No USB device selected or connected; try pairing!")))})}function a(){return n||(n=i().then(function(e){var t=new r(e);return t.initAsync().then(function(){return t})}).catch(function(e){return n=null,Promise.reject(e)})),n}function s(){return!!navigator.usb&&(!u.BrowserUtils.isWindows()||u.BrowserUtils.isWindows10())}o.pairAsync=function(){return navigator.usb.requestDevice({filters:o.filters}).then(function(e){return a()}).then(function(e){return e.reconnectAsync()})},o.mkPacketIOAsync=a,o.isEnabled=!1,o.setEnabled=function(e){s()||(e=!1),o.isEnabled=e},o.isAvailable=s}(u.usb||(u.usb={}))}(pxt||(pxt={})),function(s){!function(e){var n=s.Util,r={};function a(o){var a={},s=0,e=new n.PromiseQueue,t=new Promise(function(e,t){a.ready=e});e.enqueue("main",function(){return t});return{opAsync:function(r,i){return e.enqueue("main",function(){return new Promise(function(t,n){var e=""+s++;a[e]=function(e){e?e.errorMessage?n(new Error(e.errorMessage)):t(e):n(new Error("no response"))},o({id:e,op:r,arg:i})})})},recvHandler:function(e){if(a.hasOwnProperty(e.id)){var t=a[e.id];delete a[e.id],t(e.result)}}}}function i(e){var t=new Worker(e),n=a(function(e){return t.postMessage(e)});return t.onmessage=function(e){n.recvHandler(e.data)},n}e.getWorker=function(e){var t=r[e];return t||(t=r[e]=i(e)),t},e.wrap=a,e.makeWebWorker=i,e.makeWebSocket=function(e,n){void 0===n&&(n=null);var i=new WebSocket(e),o=[],r=a(function(e){var t=JSON.stringify(e);o?o.push(t):i.send(t)});return i.onmessage=function(e){var t=JSON.parse(e.data);n&&null==t.id?n(t):r.recvHandler(t)},i.onopen=function(e){s.debug("socket opened");for(var t=0,n=o;t<n.length;t++){var r=n[t];i.send(r)}o=null},i.onclose=function(e){s.debug("socket closed")},r}}(s.worker||(s.worker={}))}(pxt||(pxt={})),function(e){var v;(function(p){function d(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return e.replace(/{(\d+)}/g,function(e,t){return n[+t]})}p.debug=!1,p.lf=d;var g=m("opcode name doesn't match","<name>"),a=function(){function e(e,t,n,r,i){var o=this;this.opcode=n,this.mask=r,this.is32bit=i,this.canBeShared=!1,v.assert((n&r)==n),this.ei=e,this.code=t.replace(/\s+/g," "),this.friendlyFmt=t.replace(/\$\w+/g,function(e){return o.ei.encoders[e]?o.ei.encoders[e].pretty:e});var a=l(t);this.name=a[0],this.args=a.slice(1)}return e.prototype.emit=function(e){var t=e.words;if(t[0]!=this.name)return g;for(var n=this.opcode,r=1,i=0,o=[],a=null,s=null,u=null,c=0;c<this.args.length;++c){var l=this.args[c],f=t[r++];if("$"==l[0]){var p=this.ei.encoders[l],d=null;if(p.isRegister){if(null==(d=this.ei.registerNo(f)))return m("expecting register name",f);this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--}else if(p.isImmediate){if(f=f.replace(/^#/,""),null==(d=e.bin.parseOneInt(f)))return m("expecting number",f);this.ei.isAddSP(this.opcode)?i=-d/this.ei.wordSize():this.ei.isSubSP(this.opcode)&&(i=d/this.ei.wordSize())}else if(p.isRegList){if("{"!=f)return m("expecting {",f);for(d=0;"}"!=t[r];){if(!(f=t[r++]))return m("expecting }",t[r-2]);var h=this.ei.registerNo(f);if(null==h)return m("expecting register name",f);if(d&1<<h)return m("duplicate register name",f);d|=1<<h,this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--,","==t[r]&&r++}f=t[r++]}else if(p.isLabel){if(f=f.replace(/^#/,""),/^[+-]?\d+$/.test(f))a="rel"+(d=parseInt(f,10));else if(/^0x[0-9a-fA-F]+$/.test(f))a="abs"+(d=parseInt(f,16));else if(a=f,null==(d=this.ei.getAddressFromLabel(e.bin,this,f,p.isWordAligned))){if(e.bin.finalEmit)return m("unknown label",f);d=8}if(this.ei.is32bit(this)){s=d,u=f;continue}}else v.oops();if(null==d)return m("didn't understand it",f);if(o.push(d),null==(d=p.encode(d)))return m("argument out of range or mis-aligned",f);v.assert(0==(n&d)),n|=d}else if(l!=f)return m("expecting "+l,f)}return t[r]?m("trailing tokens",t[r]):this.ei.is32bit(this)?this.ei.emit32(n,s,e.bin.normalizeExternalLabel(u)):{stack:i,opcode:n,numArgs:o,labelName:e.bin.normalizeExternalLabel(a)}},e.prototype.toString=function(){return this.friendlyFmt},e}();p.Instruction=a;var c=function(){function e(e,t){this.bin=e,this.text=t}return e.prototype.getOpExt=function(){return this.instruction?this.instruction.code:""},e.prototype.getOp=function(){return this.instruction?this.instruction.name:""},e.prototype.update=function(e){this.bin.peepOps++,(e=e.replace(/^\s*/,""))||this.bin.peepDel++,e&&(e+="      "),e="    "+e,this.text=e+"; WAS: "+this.text.trim(),this.instruction=null,this.numArgs=null,this.words=l(e)||[],0==this.words.length?this.type="empty":"@"==this.words[0][0]&&(this.type="directive")},e}();p.Line=c;var s=function(){function e(e){this.baseOffset=0,this.checkStack=!0,this.inlineMode=!1,this.normalizeExternalLabel=function(e){return e},this.currLineNo=0,this.scope="",this.scopeId=0,this.errors=[],this.labels={},this.stackpointers={},this.stack=0,this.commPtr=0,this.peepOps=0,this.peepDel=0,this.peepCounts={},this.stats="",this.throwOnError=!1,this.disablePeepHole=!1,this.stackAtLabel={},this.currLine=new c(this,"<start>"),this.currLine.lineNo=0,this.ei=e,this.ei.file=this}return e.prototype.emitShort=function(e){v.assert(0<=e&&e<=65535),this.buf.push(e)},e.prototype.emitOpCode=function(e){this.emitShort(e)},e.prototype.location=function(){return 2*this.buf.length},e.prototype.pc=function(){return this.location()+this.baseOffset},e.prototype.parseOneInt=function(e){if(!e)return null;if("0"==e)return 0;var t=1;if(0<=e.indexOf("*"))for(var n=null;n=/^([^\*]*)\*(.*)$/.exec(e);){var r=this.parseOneInt(n[1]);if(null==r)return null;t*=r,e=n[2]}"-"==e[0]?(t*=-1,e=e.slice(1)):"+"==e[0]&&(e=e.slice(1));var i=null;if(v.U.endsWith(e,"|1"))return 1|this.parseOneInt(e.slice(0,e.length-2));if(v.U.endsWith(e,"-1"))return this.parseOneInt(e.slice(0,e.length-2))-1;if(v.U.endsWith(e,"+1"))return this.parseOneInt(e.slice(0,e.length-2))+1;if("0"==e[0])if("x"==e[1]||"X"==e[1]){var o=/^0x([a-f0-9]+)$/i.exec(e);o&&(i=parseInt(o[1],16))}else if("b"==e[1]||"B"==e[1]){var a=/^0b([01]+)$/i.exec(e);a&&(i=parseInt(a[1],2))}var s=/^(\d+)$/i.exec(e);return s&&(i=parseInt(s[1],10)),0<=e.indexOf("@")&&((s=/^(\w+)@(-?\d+)$/.exec(e))&&(1!=t&&this.directiveError(d("multiplication not supported with saved stacks")),this.stackpointers.hasOwnProperty(s[1])?i=this.ei.wordSize()*this.ei.computeStackOffset(s[1],this.stack-this.stackpointers[s[1]]+parseInt(s[2])):this.directiveError(d("saved stack not found"))),(s=/^(.*)@(hi|lo|fn)$/.exec(e))&&this.looksLikeLabel(s[1])&&null!=(i=this.lookupLabel(s[1],!0))&&("fn"==s[2]?i=this.ei.toFnPtr(i,this.baseOffset):0<=(i>>=1)&&i<=65535?"hi"==s[2]?i=i>>8&255:"lo"==s[2]?i&=255:v.oops():(this.directiveError(d("@hi/lo out of range")),i=null))),null==i&&this.looksLikeLabel(e)&&null!=(i=this.lookupLabel(e,!0))&&1==this.ei.postProcessRelAddress(this,1)&&(i+=this.baseOffset),null==i||isNaN(i)?null:i*t},e.prototype.looksLikeLabel=function(e){return!/^(r\d|pc|sp|lr)$/i.test(e)&&/^[\.a-zA-Z_][\.:\w+]*$/.test(e)},e.prototype.scopedName=function(e){return"."==e[0]&&this.scope?this.scope+"$"+e:e},e.prototype.lookupLabel=function(e,t){void 0===t&&(t=!1);var n=null,r=this.scopedName(e);return this.labels.hasOwnProperty(r)?(n=this.labels[r],n=this.ei.postProcessRelAddress(this,n)):this.lookupExternalLabel&&null!=(n=this.lookupExternalLabel(e))&&(n=this.ei.postProcessAbsAddress(this,n)),null==n&&t&&(this.finalEmit?this.directiveError(d("unknown label: {0}",e)):n=33333),n},e.prototype.align=function(e){for(v.assert(2==e||4==e||8==e||16==e);this.location()%e!=0;)this.emitOpCode(0)},e.prototype.pushError=function(e,t){void 0===t&&(t="");var n={scope:this.scope,message:d("  -> Line {2} ('{1}'), error: {0}\n{3}",e,this.currLine.text,this.currLine.lineNo,t),lineNo:this.currLine.lineNo,line:this.currLine.text,coremsg:e,hints:t};if(this.errors.push(n),this.throwOnError)throw new Error(n.message)},e.prototype.directiveError=function(e){this.pushError(e)},e.prototype.emitString=function(e){function t(e,t){return 255&(e.charCodeAt(t)||0)}var n,r=/^\s*([\w\.]+\s*:\s*)?.\w+\s+(".*")\s*$/.exec(e);if(r&&null!=(n=function(e){e=e.replace(/\\\\/g,"\\B").replace(/\\(['\?])/g,function(e,t){return t}).replace(/\\[z0]/g,"\0").replace(/\\x([0-9a-f][0-9a-f])/gi,function(e,t){return"\\u00"+t}).replace(/\\B/g,"\\\\");try{return JSON.parse(e)}catch(e){return null}}(r[2]))){this.align(2);for(var i=0;i<n.length+1;i+=2)this.emitShort(t(n,i+1)<<8|t(n,i))}else this.directiveError(d("expecting string"))},e.prototype.parseNumber=function(e){var t=this.parseOneInt(e.shift());return null==t?null:t},e.prototype.parseNumbers=function(e){e=e.slice(1);for(var t=[];;){var n=this.parseNumber(e);if(null==n){this.directiveError(d("cannot parse number at '{0}'",e[0]));break}if(t.push(n),","!=e[0]){if(null==e[0])break;this.directiveError(d("expecting number, got '{0}'",e[0]));break}if(e.shift(),null==e[0])break}return t},e.prototype.emitSpace=function(e){var t=this.parseNumbers(e);if(1==t.length&&t.push(0),2!=t.length)this.directiveError(d("expecting one or two numbers"));else if(t[0]%2!=0)this.directiveError(d("only even space supported"));else{var n=255&t[1];n|=n<<8;for(var r=0;r<t[0];r+=2)this.emitShort(n)}},e.prototype.emitBytes=function(e){var t=this.parseNumbers(e);t.length%2!=0&&(this.directiveError(".bytes needs an even number of arguments"),t.push(0));for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];0<=r&&i<=255&&0<=i&&r<=255?this.emitShort(255&r|(255&i)<<8):this.directiveError(d("expecting uint8"))}},e.prototype.emitHex=function(e){var r=this;e.slice(1).forEach(function(e){if(","!=e)if(e.length%4!=0)r.directiveError(".hex needs an even number of bytes");else if(/^[a-f0-9]+$/i.test(e))for(var t=0;t<e.length;t+=4){var n=parseInt(e.slice(t,t+4),16);n=(255&n)<<8|n>>8&255,r.emitShort(n)}else r.directiveError(".hex needs a hex number")})},e.prototype.handleDirective=function(e){var t,n=this,r=e.words,i=function(){2!=r.length&&n.directiveError(d("expecting one argument"))};switch(r[0]){case".ascii":case".asciz":case".string":this.emitString(e.text);break;case".align":if(i(),null!=(t=this.parseOneInt(r[1]))){if(0==t)return;t<=4?this.align(1<<t):this.directiveError(d("expecting 1, 2, 3 or 4 (for 2, 4, 8, or 16 byte alignment)"))}else this.directiveError(d("expecting number"));break;case".balign":if(i(),null!=(t=this.parseOneInt(r[1]))){if(1==t)return;2==t||4==t||8==t||16==t?this.align(t):this.directiveError(d("expecting 2, 4, 8, or 16"))}else this.directiveError(d("expecting number"));break;case".p2align":i(),null!=(t=this.parseOneInt(r[1]))?this.align(1<<t):this.directiveError(d("expecting number"));break;case".byte":this.emitBytes(r);break;case".hex":this.emitHex(r);break;case".hword":case".short":case".2bytes":this.parseNumbers(r).forEach(function(e){-32768<=e&&e<=65535?n.emitShort(65535&e):n.directiveError(d("expecting int16"))});break;case".word":case".4bytes":case".long":this.parseNumbers(r).forEach(function(e){-2147483648<=e&&e<=4294967295?(n.emitShort(65535&e),n.emitShort(e>>16&65535)):n.directiveError(d("expecting int32"))});break;case".skip":case".space":this.emitSpace(r);break;case".startaddr":this.location()&&this.directiveError(d(".startaddr can be only be specified at the beginning of the file")),i(),this.baseOffset=this.parseOneInt(r[1]);break;case"@stackmark":i(),this.stackpointers[r[1]]=this.stack;break;case"@stackempty":this.checkStack&&(null==this.stackpointers[r[1]]?this.directiveError(d("no such saved stack")):this.stackpointers[r[1]]!=this.stack&&this.directiveError(d("stack mismatch")));break;case"@scope":this.scope=r[1]||"",this.currLineNo=this.scope?0:this.realCurrLineNo;break;case".syntax":case"@nostackcheck":this.checkStack=!1;break;case"@dummystack":i(),this.stack+=this.parseOneInt(r[1]);break;case".section":case".global":this.stackpointers={},this.stack=0,this.scope="$S"+this.scopeId++;break;case".comm":(r=r.filter(function(e){return","!=e})).shift();var o=this.parseOneInt(r[1]),a=0;if(a=r[2]?this.parseOneInt(r[2]):4,null==this.lookupLabel(r[0])){for(this.commPtr||(this.commPtr=this.lookupExternalLabel("_pxt_comm_base")||0,this.commPtr||this.directiveError(d("PXT_COMM_BASE not defined")));this.commPtr&a-1;)this.commPtr++;this.labels[this.scopedName(r[0])]=this.commPtr-this.baseOffset,this.commPtr+=o}break;case".file":case".text":case".cpu":case".fpu":case".eabi_attribute":case".code":case".thumb_func":case".type":case".fnstart":case".save":case".size":case".fnend":case".pad":case".globl":case".local":case"@":break;default:/^\.cfi_/.test(r[0])||this.directiveError(d("unknown directive"))}},e.prototype.handleOneInstruction=function(e,t){var n=t.emit(e);return!n.error&&(this.stack+=n.stack,this.checkStack&&this.stack<0&&this.pushError(d("stack underflow")),e.location=this.location(),e.opcode=n.opcode,e.stack=n.stack,this.emitOpCode(n.opcode),null!=n.opcode2&&this.emitOpCode(n.opcode2),null!=n.opcode3&&this.emitOpCode(n.opcode3),e.instruction=t,e.numArgs=n.numArgs,!0)},e.prototype.handleInstruction=function(n){var t=this;if(!n.instruction||!this.handleOneInstruction(n,n.instruction)){var e=function(e){return t.ei.instructions.hasOwnProperty(e)?t.ei.instructions[e]:[]};if(!n.instruction)for(var r=e(n.words[0]),i=0;i<r.length;++i)if(this.handleOneInstruction(n,r[i]))return;var o=n.words[0].toLowerCase().replace(/s$/,"").replace(/[^a-z]/g,""),a="",s=e(o).concat(e(o+"s"));0<s.length&&s.forEach(function(e){var t=e.emit(n);a+=d("   Maybe: {0} ({1} at '{2}')\n",e.toString(),t.error,t.errorAt)}),this.pushError(d("assembly error"),a)}},e.prototype.buildLine=function(e,n){var r=this,t=function(e){var t=new c(r,e);return t.scope=r.scope,t.lineNo=r.currLineNo,n.push(t),t},i=t(e),o=l(i.text)||[],a=(i.words=o)[0]||"";if(":"==a.charAt(a.length-1)){var s=/^([\.\w]+):$/.exec(o[0]);if(s){if(i.type="label",i.text=s[1]+":",i.words=[s[1]],!(1<o.length))return;o.shift(),a=((i=t(e.replace(/^[^:]*:/,""))).words=o)[0]||""}}var u=a.charAt(0);"."==u||"@"==u?(i.type="directive","@scope"==i.words[0]&&this.handleDirective(i)):0==i.words.length?i.type="empty":i.type="instruction"},e.prototype.prepLines=function(e){var t=this;this.currLineNo=0,this.realCurrLineNo=0,this.lines=[],e.split(/\r?\n/).forEach(function(e){10<t.errors.length||(t.currLineNo++,t.realCurrLineNo++,t.buildLine(e,t.lines))})},e.prototype.iterLines=function(){var r=this;this.stack=0,this.buf=[],this.scopeId=0,this.lines.forEach(function(e){if(!(10<r.errors.length)&&0!=(r.currLine=e).words.length)if("label"==e.type){var t=r.scopedName(e.words[0]);if(r.prevLabel=t,r.finalEmit){var n=r.labels[t];null==n&&v.oops(),v.assert(0<r.errors.length||n==r.location()),r.reallyFinalEmit&&(r.stackAtLabel[t]=r.stack)}else r.labels.hasOwnProperty(t)?r.directiveError(d("label redefinition")):r.inlineMode&&/^_/.test(t)?r.directiveError(d("labels starting with '_' are reserved for the compiler")):r.labels[t]=r.location();e.location=r.location()}else"directive"==e.type?r.handleDirective(e):"instruction"==e.type?r.handleInstruction(e):"empty"==e.type||v.oops()})},e.prototype.getSource=function(r,e,t){var i=this;void 0===e&&(e=1),void 0===t&&(t=0);var n=this.buf?this.location():0,o=this.labels._program_end||n,a=this.labels._frag_start||0;a&&(a=this.labels._js_end-a);var s=this.labels._program_end;s&&(s-=this.labels._js_end);var u=n+this.baseOffset;t&&t<u&&v.U.userError(d("program too big by {0} bytes!",u-t));var c=d("; total bytes: {0} ({1}% of {2}k flash with {3} free)",u,(100*u/(t=t||131072)).toFixed(1),(t/1024).toFixed(1),t-u),l=d("; code sizes (bytes): {0} (incl. {1} frags, and {2} lits); src size {3}\n",o,a,s,n-o)+d("; assembly: {0} lines; density: {1} bytes/stmt\n",this.lines.length,Math.round(100*(o-s)/e)/100)+c+"\n"+this.stats+"\n\n",f=!1;return this.lines.forEach(function(e,t){if("_stored_program"==e.words[0])return l+='_stored_program: .string "..."\n',void(f=!0);if(f)f=!1;else{var n=e.text;if(r){if("@stackempty"==e.words[0]&&i.lines[t-1].text==e.text)return;if(!(n=n.replace(/; WAS: .*/,"")).trim())return}p.debug&&("label"!=e.type&&"instruction"!=e.type||(n+=" \t; 0x"+(e.location+i.baseOffset).toString(16))),l+=n+"\n"}}),l},e.prototype.peepHole=function(){for(var e=this.lines.filter(function(e){return"empty"!=e.type}),t=0;t<e.length;++t){var n=e[t];if(!/^user/.test(n.scope)){var r=e[t+1];if(r){var i=e[t+2];"instruction"==n.type&&this.ei.peephole(n,r,i)}}}},e.prototype.clearLabels=function(){this.labels={},this.commPtr=0},e.prototype.peepPass=function(e){this.disablePeepHole||(this.peepOps=0,this.peepDel=0,this.peepCounts={},this.peepHole(),this.throwOnError=!0,this.finalEmit=!1,this.clearLabels(),this.iterLines(),v.assert(!this.checkStack||0==this.stack),this.finalEmit=!0,this.reallyFinalEmit=e||0==this.peepOps,this.iterLines(),this.stats+=d("; peep hole pass: {0} instructions removed and {1} updated\n",this.peepDel,this.peepOps-this.peepDel))},e.prototype.getLabels=function(){var n=this;return this.userLabelsCache||(this.userLabelsCache=v.U.mapMap(this.labels,function(e,t){return t+n.baseOffset})),this.userLabelsCache},e.prototype.emit=function(e){if(v.assert(null==this.buf),this.prepLines(e),!(0<this.errors.length||(this.clearLabels(),this.iterLines(),this.checkStack&&0!=this.stack&&this.directiveError(d("stack misaligned at the end of the file")),0<this.errors.length||(this.ei.expandLdlit(this),this.ei.commonalize(this),this.clearLabels(),this.iterLines(),this.finalEmit=!0,this.reallyFinalEmit=this.disablePeepHole,this.iterLines(),0<this.errors.length))))for(var t=0;t<5&&(pxt.debug("Peephole OPT, pass "+t),this.peepPass(5==t),0!=this.peepOps);++t);},e}(),e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.location=function(){return this.buf.length},e.prototype.emitShort=function(e){v.assert(0<=e&&e<=65535),this.buf.push(255&e),this.buf.push(e>>8)},e.prototype.emitOpCode=function(e){v.assert(0<=e&&e<=255),this.buf.push(e)},e}(p.File=s);p.VMFile=e;var t=function(){function e(){var o=this;this.file=null,this.addEnc=function(e,t,n){var r={name:e,pretty:t,encode:n,isRegister:/^\$r\d/.test(e),isImmediate:/^\$i\d/.test(e),isRegList:/^\$rl\d/.test(e),isLabel:/^\$l[a-z]/.test(e)};return o.encoders[e]=r},this.inrange=function(e,t,n){return Math.floor(t)!=t?null:t<0?null:e<t?null:n},this.inminmax=function(e,t,n,r){return Math.floor(n)!=n?null:n<e?null:t<n?null:r},this.inseq=function(e,t){var n=e.indexOf(t);return n<0?null:n},this.inrangeSigned=function(e,t,n){return Math.floor(t)!=t?null:t<-(e+1)?null:e<t?null:n&(e<<1|1)},this.addInst=function(e,t,n,r){var i=new a(o,e,t,n,r);return o.instructions.hasOwnProperty(i.name)||(o.instructions[i.name]=[]),o.instructions[i.name].push(i),i},this.encoders={},this.instructions={}}return e.prototype.toFnPtr=function(e,t){return e},e.prototype.wordSize=function(){return-1},e.prototype.computeStackOffset=function(e,t){return t},e.prototype.is32bit=function(e){return!1},e.prototype.emit32=function(e,t,n){return null},e.prototype.postProcessRelAddress=function(e,t){return t},e.prototype.postProcessAbsAddress=function(e,t){return t},e.prototype.peephole=function(e,t,n){},e.prototype.registerNo=function(e){return null},e.prototype.getAddressFromLabel=function(e,t,n,r){return void 0===r&&(r=!1),null},e.prototype.isPop=function(e){return!1},e.prototype.isPush=function(e){return!1},e.prototype.isAddSP=function(e){return!1},e.prototype.isSubSP=function(e){return!1},e.prototype.testAssembler=function(){v.assert(!1)},e.prototype.commonalize=function(e){},e.prototype.expandLdlit=function(e){},e}();function l(e){var t=[],n="";e:for(var r=0;r<e.length;++r)switch(e[r]){case"[":case"]":case"!":case"{":case"}":case",":n&&(t.push(n),n=""),t.push(e[r]);break;case" ":case"\t":case"\r":case"\n":n&&(t.push(n),n="");break;case";":break e;default:n+=e[r]}return n&&(t.push(n),n=""),t[0]?t:null}function m(e,t){return{stack:null,opcode:null,error:e,errorAt:t}}function u(e){return e<0||65535<e?("0x"+e.toString(16)).toLowerCase():("0x"+("000"+e.toString(16)).slice(-4)).toLowerCase()}p.AbstractProcessor=t,p.emitErr=m,p.expectError=function(e,t){var n=new s(e);n.emit(t),0==n.errors.length&&v.oops("ASMTEST: expecting error for: "+t)},p.tohex=u,p.expect=function(e,t){var n=[],r=t.replace(/^([0-9a-fA-F]{4,8})\s/gm,function(e,t){return n.push(parseInt(t.slice(0,4),16)),8==t.length&&n.push(parseInt(t.slice(4,8),16)),""}),i=new s(e);i.throwOnError=!0,i.disablePeepHole=!0,i.emit(r),0<i.errors.length&&(console.debug(i.errors[0].message),v.oops("ASMTEST: not expecting errors")),i.buf.length!=n.length&&v.oops("ASMTEST: wrong buf len");for(var o=0;o<n.length;++o)i.buf[o]!=n[o]&&v.oops("ASMTEST: wrong buf content at "+o+" , exp:"+u(n[o])+", got: "+u(i.buf[o]))}})((v=e.pxtc||(e.pxtc={})).assembler||(v.assembler={}))}(ts||(ts={})),function(p){!function(u){var c=pxtc.Util;u.apiRoot="https://makecode.com/api/",u.accessToken="";var n=!(u.localToken="");function r(e){var t=new Error(c.lf("Cannot access {0} while offline",e));return t.isOffline=!0,Promise.delay(1e3).then(function(){return Promise.reject(t)})}function l(e,t){return p.U.requestAsync({url:"/api/"+e,headers:{Authorization:u.localToken},method:t?"POST":"GET",data:t||void 0,allowHttpErrors:!0})}function i(t){return t.url=p.webConfig&&p.webConfig.isStatic&&!t.forceLiveEndpoint?p.webConfig.relprefix+t.url:u.apiRoot+t.url,t.allowGzipPost=!0,u.isOnline()?(u.accessToken&&(t.headers||(t.headers={}),t.headers["x-td-access-token"]=u.accessToken),c.requestAsync(t).catch(function(e){return 0==e.statusCode?(n&&(n=!1,u.onOffline()),r(t.url)):Promise.reject(e)})):r(t.url)}function f(e){return i({url:e}).then(function(e){return e.text})}function e(){return navigator&&navigator.onLine}u.onOffline=function(){},u.hasAccessToken=function(){return!!u.accessToken},u.isLocalHost=function(){try{return/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&!/nolocalhost=1/.test(window.location.href)&&!(p.webConfig&&p.webConfig.isStatic)}catch(e){return!1}},u.localRequestAsync=l,u.privateRequestAsync=i,u.privateGetTextAsync=f,u.privateGetAsync=function(e,t){return void 0===t&&(t=!1),i({url:e,forceLiveEndpoint:t}).then(function(e){return e.json})},u.downloadTargetConfigAsync=function(){if(!u.isOnline())return Promise.resolve(void 0);var e=p.appTarget.versions&&p.appTarget.versions.target,t=p.webConfig&&p.webConfig.isStatic?"targetconfig.json":"config/"+p.appTarget.id+"/targetconfig"+(e?"/v"+e:"");return u.isLocalHost()?l(t).then(function(e){return e?e.json:void 0}):u.privateGetAsync(t)},u.downloadScriptFilesAsync=function(e){return i({url:e+"/text",forceLiveEndpoint:!0}).then(function(e){return JSON.parse(e.text)})},u.downloadMarkdownAsync=function(e,t,n){var r,i=p.webConfig&&p.webConfig.isStatic,o=p.appTarget.versions&&p.appTarget.versions.target||"?";if(i){var a=/\/docs\//.test(r=e),s=/\.\w+$/.test(r);a||(r="docs/"+r),s||(r+=".md")}else r="md/"+p.appTarget.id+"/"+e.replace(/^\//,"")+"?targetVersion="+encodeURIComponent(o);return i||"en"==t||(r+="&lang="+encodeURIComponent(c.userLanguage()),n&&(r+="&live=1")),u.isLocalHost()&&!n?l(r).then(function(e){return 404==e.statusCode?f(r):e.text}):f(r)},u.privateDeleteAsync=function(e){return i({url:e,method:"DELETE"}).then(function(e){return e.json})},u.privatePostAsync=function(e,t,n){return void 0===n&&(n=!1),i({url:e,data:t||{},forceLiveEndpoint:n}).then(function(e){return e.json})},u.isLoggedIn=function(){return!!u.accessToken},u.isNavigatorOnline=e,u.isOnline=function(){return"undefined"!=typeof navigator&&e()&&(n=!0),n},u.getServiceUrl=function(){return u.apiRoot.replace(/\/api\/$/,"")},u.getUserId=function(){var e=/^0(\w+)\./.exec(u.accessToken);return e?e[1]:null},u.parseScriptId=function(e){var t=p.appTarget;if(e&&t.appTheme&&t.cloud&&t.cloud.sharing){var n=["makecode.com"];t.appTheme.embedUrl&&n.push(t.appTheme.embedUrl),t.appTheme.shareUrl&&n.push(t.appTheme.shareUrl);var r="^((https://)?(?:"+(n=c.unique(n,function(e){return e}).map(function(e){return c.escapeForRegex(c.stripUrlProtocol(e).replace(/\/$/,"")).toLowerCase()})).join("|")+")/)?(api/oembed?url=.*%2F([^&]*)&.*?|([a-z0-9-_]+))$",i=new RegExp(r,"i").exec(e.trim());return i&&(!i[1]||0<=n.indexOf(c.escapeForRegex(i[1].replace(/https:\/\//,"").replace(/\/$/,"")).toLowerCase()))&&(i[3]||i[4])?i[3]?i[3]:i[4]:null}}}(p.Cloud||(p.Cloud={}))}(pxt||(pxt={})),function(a){var e;(e=a.winrt||(a.winrt={})).driveDeployCoreAsync=function(e){var t=a.appTarget.compile.deployDrives;a.Util.assert(!!t),a.debug("deploying to drives "+t);var n=new RegExp(t),r=a.outputName(),i=e.outfiles[r];function o(t){return a.debug("writing "+r+" to "+t.displayName),a.winrt.promisify(t.createFileAsync(r,Windows.Storage.CreationCollisionOption.replaceExisting).then(function(e){return Windows.Storage.FileIO.writeTextAsync(e,i)})).then(function(e){}).catch(function(e){a.debug("failed to write "+r+" to "+t.displayName+" - "+e)})}return a.winrt.promisify(Windows.Storage.KnownFolders.removableDevices.getFoldersAsync()).then(function(e){var t=e.filter(function(e){return n.test(e.displayName)}).map(o);return Promise.join.apply(Promise,t)}).then(function(e){})},e.browserDownloadAsync=function(t,e,n){var r;return a.winrt.promisify(Windows.Storage.ApplicationData.current.temporaryFolder.createFileAsync(e,Windows.Storage.CreationCollisionOption.replaceExisting).then(function(e){return Windows.Storage.FileIO.writeTextAsync(r=e,t)}).then(function(){return Windows.System.Launcher.launchFileAsync(r)}).then(function(e){}))},e.saveOnlyAsync=function(r){var i=a.appTarget.compile.useUF2,e=i?[".uf2"]:[".hex"],t=new Windows.Storage.Pickers.FileSavePicker;return t.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.documentsLibrary,t.fileTypeChoices.insert("MakeCode binary file",e),t.suggestedFileName=r.downloadFileBaseName,a.winrt.promisify(t.pickSaveFileAsync().then(function(e){if(e){var t=i?r.outfiles[pxtc.BINARY_UF2]:r.outfiles[pxtc.BINARY_HEX],n=[];return a.Util.stringToUint8Array(atob(t)).forEach(function(e){return n.push(e)}),Windows.Storage.FileIO.writeBytesAsync(e,n).then(function(){return!0})}return Promise.resolve(!1)}))}}(pxt||(pxt={})),function(p){!function(s){var e=function(){function e(){this.onData=function(e){},this.onEvent=function(e){},this.onError=function(e){}}return e.prototype.error=function(e){throw new Error(p.U.lf("USB/HID error ({0})",e))},e.prototype.reconnectAsync=function(){var e=this;return this.disconnectAsync().then(function(){return e.initAsync()})},e.prototype.isSwitchingToBootloader=function(){t()},e.prototype.disconnectAsync=function(){if(this.dev){var e=this.dev;delete this.dev,e.close()}return Promise.resolve()},e.prototype.sendPacketAsync=function(e){if(!this.dev)return Promise.resolve();for(var t=[0],n=0;n<Math.max(e.length,64);++n)t.push(e[n]||0);var r=new Windows.Storage.Streams.DataWriter;r.writeBytes(t);var i=r.detachBuffer(),o=this.dev.createOutputReport(0);return o.data=i,p.winrt.promisify(this.dev.sendOutputReportAsync(o).then(function(e){p.debug("hf2: "+e+" bytes written")}))},e.prototype.initAsync=function(t){var r=this;void 0===t&&(t=!1),p.Util.assert(!this.dev,"HID interface not properly reseted");var n,i=Windows.Devices,o=i.HumanInterfaceDevice.HidDevice,a=function(){var e=new Error(p.U.lf("Device not found"));return e.notifyUser=!0,e.type="devicenotfound",Promise.reject(e)};return u.reduce(function(e,t){return e.then(function(e){return e&&e.length?Promise.resolve(e):i.Enumeration.DeviceInformation.findAllAsync(t,null)})},Promise.resolve(null)).then(function(e){if(!e||!e[0])return p.debug("no hid device found"),Promise.reject(new Error("no hid device found"));p.debug("hid enumerate "+e.length+" devices");var t=e[0];return p.debug("hid connect to "+t.name+" ("+t.id+")"),n=t.id,o.fromIdAsync(t.id,Windows.Storage.FileAccessMode.readWrite)}).then(function(e){if(r.dev=e,!r.dev){p.debug("can't connect to hid device");var t=Windows.Devices.Enumeration.DeviceAccessInformation.createFromId(n).currentStatus;return p.reportError("winrt_device","could not connect to HID device; device status: "+t),Promise.reject(new Error("can't connect to hid device"))}return p.debug("hid device version "+r.dev.version),r.dev.addEventListener("inputreportreceived",function(e){p.debug("input report");for(var t=Windows.Storage.Streams.DataReader.fromBuffer(e.report.data),n=[];t.unconsumedBufferLength;)n.push(t.readByte());65==n.length&&0===n[0]&&n.shift(),r.onData(new Uint8Array(n))}),Promise.resolve()}).catch(function(e){return t?a():s.bootloaderViaBaud().then(function(){return r.initAsync(!0)}).catch(function(){return a()})})},e}();function t(){l=!0,s.packetIO&&s.packetIO.dev&&(f=!0)}s.WindowsRuntimeIO=e,s.packetIO=void 0,s.mkPacketIOAsync=function(){return p.U.assert(!s.packetIO),s.packetIO=new e,s.packetIO.initAsync().catch(function(e){return s.packetIO=null,Promise.reject(e)}).then(function(){return s.packetIO})},s.isSwitchingToBootloader=t;var u=[],a=[],c=0,l=!1,f=!1;s.initWinrtHid=function(n,r){var e=Windows.Devices,i=Windows.Devices.Enumeration.DeviceInformation,o=e.HumanInterfaceDevice.HidDevice;p.appTarget&&p.appTarget.compile&&p.appTarget.compile.hidSelectors&&p.appTarget.compile.hidSelectors.forEach(function(e){var t=o.getDeviceSelector(parseInt(e.usagePage),parseInt(e.usageId),parseInt(e.vid),parseInt(e.pid));u.push(t)}),u.forEach(function(e){var t=i.createWatcher(e,null);t.addEventListener("added",function(e){p.debug("new hid device detected: "+e.id),l?l=!1:1==++c&&n&&n()}),t.addEventListener("removed",function(e){p.debug("hid device closed: "+e.id),f?f=!1:0<--c&&n?n():0===c&&r&&r()}),t.addEventListener("updated",function(e){}),a.push(t)}),a.forEach(function(e){return e.start()})}}(p.winrt||(p.winrt={}))}(pxt||(pxt={})),function(l){!function(n){var r,i,c={};function o(e){if(!e)return Promise.resolve([]);var t=Windows.Devices,n=t.SerialCommunication.SerialDevice,r=t.Enumeration.DeviceInformation,i=[];return e.forEach(function(e){var t=n.getDeviceSelectorFromUsbVidPid(parseInt(e.vid),parseInt(e.pid));i.push(t)}),i.reduce(function(e,t){var n;return e.then(function(e){return n=e,r.findAllAsync(t,null)}).then(function(e){if(n)for(var t=0;t<e.length;++t)n.push(e[t]);else n=e;return Promise.resolve(n)})},Promise.resolve(null)).then(function(e){return e?Promise.map(e,function(e){return n.fromIdAsync(e.id)}):Promise.resolve([])})}function a(t){i&&!i.test(t.name)||(l.debug("serial port added "+t.name+" - "+t.id),c[t.id]={info:t},Windows.Devices.SerialCommunication.SerialDevice.fromIdAsync(t.id).done(function(e){c[t.id].device=e,function n(r){var i=c[r];if(!i)return;if(!i.device){var e=Windows.Devices.Enumeration.DeviceAccessInformation.createFromId(r).currentStatus;return void l.reportError("winrt_device","could not connect to serial device; device status: "+e)}var t=Windows.Storage.Streams;i.device.baudRate=115200;var o=i.device.inputStream;var a=new t.DataReader(o);a.inputStreamOptions=t.InputStreamOptions.partial;var s={};var u=function(){c[r]&&!i.cancellingDeferred&&(i.readingOperation=a.loadAsync(32),i.readingOperation.done(function(e){var t=a.readString(4*Math.floor(a.unconsumedBufferLength/4));l.Util.bufferSerial(s,t,r),setTimeout(function(){return u()},1)},function(e){var t=i.readingOperation.operation.status;t===Windows.Foundation.AsyncStatus.canceled?(a.detachStream(),a.close(),i.cancellingDeferred&&setTimeout(function(){return i.cancellingDeferred.resolve()},25)):setTimeout(function(){return n(r)},1e3)}))};setTimeout(function(){return u()},100)}(t.id)}))}function s(e){delete c[e.id]}function u(e){var t=c[e.id];t&&t.info.update(e)}n.initSerial=function(){var e=!(!l.appTarget.serial||!(l.appTarget.serial.nameFilter||l.appTarget.serial.vendorId&&l.appTarget.serial.productId));if(l.appTarget.serial&&l.appTarget.serial.log&&e){var t,n=Windows.Devices.SerialCommunication.SerialDevice;l.appTarget.serial.vendorId&&l.appTarget.serial.productId?t=n.getDeviceSelectorFromUsbVidPid(parseInt(l.appTarget.serial.vendorId),parseInt(l.appTarget.serial.productId)):(i=new RegExp(l.appTarget.serial.nameFilter),t=n.getDeviceSelector()),(r=Windows.Devices.Enumeration.DeviceInformation.createWatcher(t,null)).addEventListener("added",a),r.addEventListener("removed",s),r.addEventListener("updated",u),r.start()}},n.suspendSerialAsync=function(){r&&(r.stop(),r.removeEventListener("added",a),r.removeEventListener("removed",s),r.removeEventListener("updated",u),r=void 0);var i=Promise.resolve();return Object.keys(c).forEach(function(e){var t=c[e],n=t.readingOperation;if(n){var r=Promise.defer();t.cancellingDeferred=r,i=i.then(function(){return r.promise.timeout(500).catch(function(e){l.reportError("winrt_device","could not cancel reading operation for a device: "+e.message)})}),n.cancel()}}),i.then(function(){Object.keys(c).forEach(function(e){var t=c[e];t.device&&t.device.close()}),c={}})},n.bootloaderViaBaud=function(){if(!(l.appTarget&&l.appTarget.compile&&l.appTarget.compile.useUF2&&l.appTarget.simulator&&l.appTarget.simulator.boardDefinition&&l.appTarget.simulator.boardDefinition.bootloaderBaudSwitchInfo))return Promise.reject(new Error("device does not support switching to bootloader via baudrate"));var t,e=l.appTarget.simulator.boardDefinition.bootloaderBaudSwitchInfo;return o([{vid:e.vid,pid:e.pid,usageId:void 0,usagePage:void 0}]).then(function(e){return e&&0!==e.length?((t=e).length&&n.isSwitchingToBootloader(),t.forEach(function(e){e.baudRate=1200,e.close()}),Promise.delay(1500)):Promise.reject(new Error("no serial devices to switch into bootloader"))})},n.connectSerialDevicesAsync=o}(l.winrt||(l.winrt={}))}(pxt||(pxt={})),function(p){!function(i){function o(){return"undefined"!=typeof Windows}function a(){return o()?(t.resolve(null),t.promise.then(function(e){return Promise.resolve(e&&e.kind===Windows.ApplicationModel.Activation.ActivationKind.file)})):Promise.resolve(!1)}function n(){return o()?Promise.resolve().then(function(){return i.packetIO?(p.log("disconnecting packetIO"),i.packetIO.disconnectAsync()):Promise.resolve()}).catch(function(e){e.message="error disconnecting packetIO: "+e.message,p.reportException(e)}).then(function(){return p.log("suspending serial"),i.suspendSerialAsync()}).catch(function(e){e.message="error suspending serial: "+e.message,p.reportException(e)}):Promise.resolve()}function s(e){Windows.UI.WebUI.WebUIApplication.removeEventListener("activated",s),t.resolve(e)}function u(e){p.log("suspending");var t=e.suspendingOperation.getDeferral();return n().then(function(){return t.complete()},function(e){return t.complete()}).done()}function c(e){p.log("resuming"),i.packetIO&&(p.log("reconnet pack io"),i.packetIO.reconnectAsync().done()),i.initSerial()}var t,l;function f(e,t){if(void 0===t&&(t=!1),e.kind===Windows.ApplicationModel.Activation.ActivationKind.file){var n=e.files.getAt(0);if(n&&n.isOfType(Windows.Storage.StorageItemTypes.file)){var r=n;Windows.Storage.FileIO.readBufferAsync(r).then(function(e){for(var t=[],n=Windows.Storage.Streams.DataReader.fromBuffer(e);n.unconsumedBufferLength;)t.push(n.readByte());return n.close(),p.cpp.unpackSourceFromHexAsync(new Uint8Array(t))}).then(function(e){return l(e,t)})}}}i.promisify=function(e){return new Promise(function(t,n){e.done(function(e){return t(e)},function(e){return n(e)})})},i.toArray=function(e){for(var t=[],n=e.length,r=0;r<n;++r)t.push(e[r]);return t},i.isWindows=function(){return!!navigator&&/Win32/i.test(navigator.platform)},i.isWinRT=o,i.initAsync=function(e){if(!o()||p.BrowserUtils.isIFrame())return Promise.resolve();var t=Windows.UI.Core,n=t.SystemNavigationManager.getForCurrentView(),r=Windows.UI.WebUI.WebUIApplication;return r.addEventListener("suspending",u),r.addEventListener("resuming",c),n.onbackrequested=function(e){p.log("BACK NAVIGATION"),n.appViewBackButtonVisibility=t.AppViewBackButtonVisibility.collapsed,e.handled=!0},i.initSerial(),a().then(function(){e&&(l=e,r.removeEventListener("activated",s),r.addEventListener("activated",f))})},i.captureInitialActivation=function(){o()&&(t=Promise.defer(),Windows.UI.WebUI.WebUIApplication.addEventListener("activated",s))},i.loadActivationProject=function(){return t.promise.then(function(e){return f(e,!0)})},i.hasActivationProjectAsync=a,i.releaseAllDevicesAsync=n}(p.winrt||(p.winrt={}))}(pxt||(pxt={})),function(b){var y;(function(e){var l,a,s,f=b.Util,u=[];function p(t){return u.filter(function(e){return e.id==t})[0]}function d(e){var t=p(e.path);t||(t={id:e.path,header:null,text:null,fsText:null},u.push(t));var n=e.files.map(function(e){return e.mtime});n.sort(function(e,t){return t-e});var r=Math.round(n[0]/1e3)||f.nowSeconds(),i={target:a,targetVersion:t.header?t.header.targetVersion:s,name:e.config.name,meta:{},editor:b.JAVASCRIPT_PROJECT_NAME,pubId:e.config.installedVersion,pubCurrent:!1,_rev:null,id:e.path,recentUse:r,modificationTime:r,blobId:null,blobCurrent:!1,isDeleted:!1,icon:e.icon};if(t.header){var o=t.header;o.name=i.name,o.pubId=i.pubId,o.modificationTime=i.modificationTime,o.isDeleted=i.isDeleted,o.icon=i.icon}else t.header=i}var n=new f.PromiseQueue;function c(s,u){if(s.temporary)return Promise.resolve();var c=p(s.id);return f.assert(c.header===s),u?(s.saveId=null,c.textNeedsSave=!0,c.text=u,n.enqueue(s.id,function(){f.assert(!!c.fsText);for(var e={files:[],config:null,path:s.id},t=0,n=Object.keys(c.text);t<n.length;t++){var r=n[t];c.text[r]!==c.fsText[r]&&e.files.push({name:r,mtime:null,content:c.text[r],prevContent:c.fsText[r]})}var o,i,a=f.flatClone(c.text);return 0==e.files.length?Promise.resolve():(o=s.id,i=e,b.debug("winrt: writing package at "+o),y.promisify(l.createFolderAsync(o,Windows.Storage.CreationCollisionOption.openIfExists)).then(function(){return Promise.map(i.files,function(t){return g(h(o,t.name)).then(function(e){if(t.name==b.CONFIG_NAME)try{JSON.parse(t.content).name||(b.log("Trying to save invalid JSON config"),m(410))}catch(e){b.log("Trying to save invalid format JSON config"),m(410)}e!==t.prevContent&&(b.log("merge error for "+t.name+": previous content changed..."),m(409))},function(e){})})}).then(function(){return Promise.map(i.files,function(e){return t=o,n=e.name,r=e.content,i=h(l.path,t),b.debug("winrt: writing "+h(i,n)),y.promisify(Windows.Storage.StorageFolder.getFolderFromPathAsync(i)).then(function(e){return e.createFileAsync(n,Windows.Storage.CreationCollisionOption.replaceExisting)}).then(function(e){return Windows.Storage.FileIO.writeTextAsync(e,r)}).then(function(){});var t,n,r,i})}).then(function(){return v(o,!1)})).then(function(e){c.fsText=a,d(e),u&&(s.saveId=null)})})):Promise.resolve()}function h(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.join("\\")}function g(e){var t=h(l.path,e);return b.debug("winrt: reading "+t),y.promisify(Windows.Storage.StorageFile.getFileFromPathAsync(t).then(function(e){return Windows.Storage.FileIO.readTextAsync(e)}))}function m(e,t){void 0===t&&(t=null);var n=new Error(t||"Error "+e);throw n.statusCode=e,n}function v(r,i){return b.debug("winrt: reading package under "+r),g(h(r,b.CONFIG_NAME)).then(function(e){var t=JSON.parse(e),n=[b.CONFIG_NAME].concat(t.files||[]).concat(t.testFiles||[]);return Promise.map(n,function(n){return(t=h(r,n),e=h(l.path,t),b.debug("winrt: "+e),y.promisify(Windows.Storage.StorageFile.getFileFromPathAsync(e).then(function(e){return e.getBasicPropertiesAsync().then(function(e){return{name:t,mtime:e.dateModified.getTime()}})}))).then(function(e){var t={name:n,mtime:e?e.mtime:null};return null!=e&&i?g(h(r,n)).then(function(e){return t.content=e,t}):t});var t,e}).then(function(e){return{path:r,config:t,files:e}})})}function r(){return y.promisify(l.getFoldersAsync()).then(function(e){return Promise.all(e.map(function(e){return v(e.name,!1)}))}).then(function(e){e.forEach(d)})}e.provider={getHeaders:function(){return u.map(function(e){return e.header})},getHeader:function(e){var t=p(e);return t&&!t.header.isDeleted?t.header:null},getTextAsync:function(e){b.debug("winrt: get text "+e);var t=p(e);return t?t.text?Promise.resolve(t.text):n.enqueue(e,function(){return i=t,b.debug("winrt: fetch "+i.id),v(i.id,!0).then(function(e){if(!i.text){i.text={};for(var t=i.mtime=0,n=e.files;t<n.length;t++){var r=n[t];i.text[r.name]=r.content,i.mtime=Math.max(i.mtime,r.mtime)}i.fsText=f.flatClone(i.text)}return i.text});var i}):Promise.resolve(null)},initAsync:function(e,t){u=[],a=e,s=t;var n=Windows.Storage.ApplicationData.current.localFolder;return b.debug("winrt: initializing workspace"),y.promisify(n.createFolderAsync(a,Windows.Storage.CreationCollisionOption.openIfExists)).then(function(e){return l=e,b.debug("winrt: initialized workspace at "+l.path),r()}).then(function(){})},saveAsync:function(e,t){return c(e,t)},installAsync:function(e,t){var n=e,r=n.name.replace(/[^a-zA-Z0-9]+/g," ").trim().replace(/ /g,"-");if(p(r)){for(var i=2;p(r+"-"+i);)i++;r+="-"+i,n.name+=" "+i}n.id=r,n.recentUse=f.nowSeconds(),n.modificationTime=n.recentUse;var o={id:n.id,header:n,text:t,fsText:{}};return u.push(o),c(n,t).then(function(){return n})},saveToCloudAsync:function(e){return Promise.resolve()},syncAsync:r,resetAsync:function(){return y.promisify(l.deleteAsync(Windows.Storage.StorageDeleteOption.default).then(function(){l=void 0,u=[],b.storage.clearLocal()}))},loadedAsync:function(){return Promise.resolve()}}})((y=b.winrt||(b.winrt={})).workspace||(y.workspace={}))}(pxt||(pxt={})),function(e){var t,n;t=e.editor||(e.editor={}),(n=t.FilterState||(t.FilterState={}))[n.Hidden=0]="Hidden",n[n.Visible=1]="Visible",n[n.Disabled=2]="Disabled",t.initExtensionsAsync=function(e){return Promise.resolve({})},t.initFieldExtensionsAsync=function(e){return Promise.resolve({})}}(pxt||(pxt={})),function(x){!function(e){var b={};function y(e,t,n,r){e.response&&window.parent.postMessage({type:e.type,id:e.id,resp:t,success:n,error:r},"*")}function o(r){return new Promise(function(e,t){var n=x.Util.clone(r);n.id=ts.pxtc.Util.guidGen(),r.response&&(b[n.id]={resolve:e,reject:t}),window.parent.postMessage(n,"*"),r.response||e(void 0)})}e.bindEditorMessages=function(h){var g=(x.appTarget.appTheme.allowParentController||x.shell.isControllerMode())&&x.BrowserUtils.isIFrame(),m=x.appTarget.appTheme.allowPackageExtensions,v=x.appTarget.appTheme.allowSimulatorTelemetry;(g||m||v)&&window.addEventListener("message",function(e){var t=e.data;if(!t||!/^pxt(host|editor|pkgext|sim)$/.test(t.type))return!1;if("pxtpkgext"===t.type&&m)h.handleExtensionRequest(t);else if("pxtsim"===t.type&&v){var n=t;"event"===n.action&&(n.category||n.message?x.reportError(n.category,n.message,n.data):x.tickEvent(n.tick,n.data))}else if(g){var r=Promise.resolve(),i=void 0;if("pxthost"==t.type){var o=b[t.id];o?r=r.then(function(){return o.resolve(t)}):x.debug("pxthost: unknown request "+t.id)}else if("pxteditor"==t.type){var a=t;switch(x.debug("pxteditor: "+a.action),a.action.toLowerCase()){case"switchjavascript":r=r.then(function(){return h.openJavaScript()});break;case"switchblocks":r=r.then(function(){return h.openBlocks()});break;case"startsimulator":r=r.then(function(){return h.startSimulator()});break;case"restartsimulator":r=r.then(function(){return h.restartSimulator()});break;case"hidesimulator":r=r.then(function(){return h.collapseSimulator()});break;case"showsimulator":r=r.then(function(){return h.expandSimulator()});break;case"closeflyout":r=r.then(function(){return h.closeFlyout()});break;case"redo":r=r.then(function(){var e=h.editor;e&&e.hasRedo()&&e.redo()});break;case"undo":r=r.then(function(){var e=h.editor;e&&e.hasUndo()&&e.undo()});break;case"setscale":var s=t;r=r.then(function(){return h.editor.setScale(s.scale)});break;case"stopsimulator":var u=t;r=r.then(function(){return h.stopSimulator(u.unload)});break;case"newproject":var c=t;r=r.then(function(){return h.newProject(c.options)});break;case"importproject":var l=t;r=r.then(function(){return h.importProjectAsync(l.project,{filters:l.filters,searchBar:l.searchBar})});break;case"proxytosim":var f=t;r=r.then(function(){return h.proxySimulatorMessage(f.content)});break;case"renderblocks":var p=t;r=r.then(function(){return h.renderBlocksAsync(p)}).then(function(e){i=e.xml});break;case"toggletrace":var d=t;r=r.then(function(){return h.toggleTrace(d.intervalSpeed)})}}r.done(function(){return y(t,i,!0,void 0)},function(e){return y(t,i,!1,e)})}return!0},!1)},e.enableControllerAnalytics=function(){if(x.appTarget.appTheme.allowParentController&&x.BrowserUtils.isIFrame()){var n=x.tickEvent;x.tickEvent=function(e,t){n&&n(e,t),o({type:"pxthost",action:"event",tick:e,response:!1,data:t})};var r=x.reportException;x.reportException=function(e,t){r&&r(e,t);try{o({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:t})}catch(e){}};var i=x.reportError;x.reportError=function(e,t,n){i&&i(e,t,n),o({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:n})}}},e.postHostMessageAsync=o}(x.editor||(x.editor={}))}(pxt||(pxt={})),function(e){var t,n;t=e.editor||(e.editor={}),(n=t.PermissionResponses||(t.PermissionResponses={}))[n.Granted=0]="Granted",n[n.Denied=1]="Denied",n[n.NotAvailable=2]="NotAvailable"}(pxt||(pxt={})),function(s){!function(e){var n,r=function(){function e(){this.items={}}return e.prototype.removeItem=function(e){delete this.items[e]},e.prototype.getItem=function(e){return this.items[e]},e.prototype.setItem=function(e,t){this.items[e]=t},e.prototype.clear=function(){this.items={}},e}(),i=function(){function e(e){this.storageId=e}return e.prototype.targetKey=function(e){return this.storageId+"/"+e},e.prototype.removeItem=function(e){window.localStorage.removeItem(this.targetKey(e))},e.prototype.getItem=function(e){return window.localStorage[this.targetKey(e)]},e.prototype.setItem=function(e,t){window.localStorage[this.targetKey(e)]=t},e.prototype.clear=function(){for(var e=this.targetKey(""),t=[],n=0;n<window.localStorage.length;++n){var r=window.localStorage.key(n);0==r.indexOf(e)&&t.push(r)}t.forEach(function(e){return window.localStorage.removeItem(e)})},e}();function o(){return s.appTarget?s.appTarget.id:window.pxtConfig?window.pxtConfig.targetId:""}function a(){if(!n){var e=o(),t=!1;if(!s.shell.isSandboxMode())try{window.localStorage[e]="1";window.localStorage[e];t=!0}catch(e){}t?(n=new i(e),s.debug("storage: local under "+e)):(n=new r,s.debug("storage: in memory"))}}e.storageId=o,e.setLocal=function(e,t){a(),n.setItem(e,t)},e.getLocal=function(e){return a(),n.getItem(e)},e.removeLocal=function(e){a(),n.removeItem(e)},e.clearLocal=function(){a(),n.clear()}}(s.storage||(s.storage={}))}(pxt||(pxt={})),function(r){!function(e){function a(e){var t=r.appTarget.appTheme.invertedMonaco,n=monaco.editor.create(e,{model:null,ariaLabel:r.Util.lf("JavaScript editor"),fontFamily:"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!1,language:"typescript",mouseWheelZoom:!1,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,minimap:{enabled:!1},autoIndent:!0,dragAndDrop:!0,matchBrackets:!0,occurrencesHighlight:!1,quickSuggestionsDelay:200,theme:t?"vs-dark":"vs",accessibilityHelpUrl:""});return n.layout(),n}e.syncModels=function(e,i,o,t){if(!t){var n=monaco.languages.typescript.typescriptDefaults.getExtraLibs(),a={};e.sortedDeps().forEach(function(r){r.getFiles().forEach(function(e){var t=r.id+"/"+e;if(/\.(ts)$/.test(e)&&t!=o){if(!monaco.languages.typescript.typescriptDefaults.getExtraLibs()[t]){var n=r.readFile(e)||" ";i[t]=monaco.languages.typescript.typescriptDefaults.addExtraLib(n,t)}a[t]="1"}})}),Object.keys(n).filter(function(e){return/\.(ts)$/.test(e)&&!a[e]}).forEach(function(e){i[e].dispose()})}},e.initMonacoAsync=function(o){return new Promise(function(t,e){if("object"!=typeof window.monaco){var n=window.MonacoPaths,r=function(){var e=window.require;e.config({paths:n}),e(["vs/editor/editor.main"],function(){monaco.languages.typescript&&(monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}}),monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSyntaxValidation:!0,noSemanticValidation:!0}),monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowUnreachableCode:!0,noImplicitAny:!0,allowJs:!1,allowUnusedLabels:!0,target:monaco.languages.typescript.ScriptTarget.ES5,outDir:"built",rootDir:".",noLib:!0,mouseWheelZoom:!1}),monaco.languages.typescript.typescriptDefaults.setMaximunWorkerIdleTime(12e5)),t(a(o))})};if(window.require)r();else{var i=document.createElement("script");i.type="text/javascript",i.src=n["vs/loader"],i.addEventListener("load",r),document.body.appendChild(i)}}else t(a(o))})},e.createEditor=a}(r.vs||(r.vs={}))}(pxt||(pxt={})),function(s){!function(e){var i,t,o;function n(){if(void 0===o){var e=/sandbox=1|#sandbox|#sandboxproject/i.test(window.location.href)||s.BrowserUtils.isIFrame(),t=/nosandbox=1/i.test(window.location.href),n=/controller=1/i.test(window.location.href)&&s.BrowserUtils.isIFrame(),r=/editorlayout=(widget|sandbox|ide)/i.exec(window.location.href);if(o=i.IDE,t?o=i.Widget:n?o=i.Controller:e&&(o=i.Sandbox),r)switch(r[1].toLowerCase()){case"widget":o=i.Widget;break;case"sandbox":o=i.Sandbox;break;case"ide":o=i.IDE}s.debug("shell: layout type "+i[o]+", readonly "+a())}}function r(){return n(),o==i.Sandbox}function a(){return r()&&!/[?&]edit=1/i.test(window.location.href)}(t=i=e.EditorLayoutType||(e.EditorLayoutType={}))[t.IDE=0]="IDE",t[t.Sandbox=1]="Sandbox",t[t.Widget=2]="Widget",t[t.Controller=3]="Controller",e.layoutTypeClass=function(){return n(),s.shell.EditorLayoutType[o].toLowerCase()},e.isSandboxMode=r,e.isReadOnly=a,e.isControllerMode=function(){return n(),o==i.Controller}}(s.shell||(s.shell={}))}(pxt||(pxt={}));var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim;!function(e){var t,n;(t=e.accessibility||(e.accessibility={})).makeFocusable=function(e){e.setAttribute("focusable","true"),e.setAttribute("tabindex","0")},t.enableKeyboardInteraction=function(e,n,r){n&&e.addEventListener("keydown",function(e){var t="number"==typeof e.which?e.which:e.keyCode;32!==t&&13!==t||n()}),r&&e.addEventListener("keyup",function(e){var t="number"==typeof e.which?e.which:e.keyCode;32!==t&&13!==t||r()})},t.setAria=function(e,t,n){t&&!e.hasAttribute("role")&&e.setAttribute("role",t),n&&!e.hasAttribute("aria-label")&&e.setAttribute("aria-label",n)},t.setLiveContent=function(e){n||((n=document.createElement("div")).setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-hidden","false"),n.setAttribute("style","position: absolute !important;display: block;visibility: visible;overflow: hidden;width: 1px;height: 1px;margin: -1px;border: 0;padding: 0;clip: rect(0 0 0 0);"),document.body.appendChild(n)),n.textContent!==e&&(n.textContent=e)}}(pxsim||(pxsim={})),function(v){var l="blue";var f=function(e){return 0<e.reduce(function(e,t){return e+(t?1:0)},0)};function g(e,t){var n={};for(var r in e)n[r]=e[r];for(var i in t)n[i]=t[i];return n}function p(e){v.U.assert(!!e,"Invalid pin: "+e);var t=/^(\w+)\.\s*(?:[a-z]*)?([A-Z][A-Z\d_]+)$/.exec(e);return t?t[2]:void 0}function d(e){return"-Z"===e.orientation&&"male"===e.style}v.readPin=p;var t=function(){function e(e){this.availablePowerPins={top:{threeVolt:v.mkRange(26,51).map(function(e){return{type:"breadboard",row:"+",col:""+e}}),ground:v.mkRange(26,51).map(function(e){return{type:"breadboard",row:"-",col:""+e}})},bottom:{threeVolt:v.mkRange(1,26).map(function(e){return{type:"breadboard",row:"+",col:""+e}}),ground:v.mkRange(1,26).map(function(e){return{type:"breadboard",row:"-",col:""+e}})}},this.opts=e}return e.prototype.allocPartIRs=function(n,r,m){var t=this,i=[],s=function(e,t,n,r){for(var i=[],o=0;o<e.numberOfPins;o++){var a=e.pinDefinitions[o],s=void 0;if("string"==typeof a.target)s=a.target;else{var u=a.target.pinInstantiationIdx;v.U.assert(!!n&&void 0!==n[u],"No pin found for PinInstantiationIdx: "+u+'. (Is the part missing an ArgumentRole or "trackArgs=" annotations?)'),s=n[u]}var c=e.visual.pinLocations[o],l=m.yOffset+c.y,f=Math.round(l/e.visual.pinDistance),p=l-f*e.visual.pinDistance,d=m.xOffset+c.x,h=Math.round(d/e.visual.pinDistance),g={partRelativeRowIdx:f,partRelativeColIdx:h,xOffset:d-h*e.visual.pinDistance,yOffset:p};i.push({def:a,loc:c,target:s,bbFit:g})}return{name:t,def:e,pins:i,partParams:r||{},bbFit:m}};if("singleton"===n.instantiation.kind)i.push(s(n,r));else if("function"===n.instantiation.kind){var u=n.instantiation,c=u.fullyQualifiedName.split(","),o={};c.forEach(function(e){t.opts.fnArgs[e]&&t.opts.fnArgs[e].forEach(function(e){o[e]=1})});var e=Object.keys(o);v.U.assert(!!e&&!!e.length,"Failed to read pin(s) from callsite for: "+c),e.forEach(function(e){var t=e.split(",");v.U.assert(t.length===u.argumentRoles.length,"Mismatch between number of arguments at callsite (function name: "+c+") vs number of argument roles in part definition (part: "+r+").");var o=[],a={};t.forEach(function(e,t){var n=u.argumentRoles[t];if(void 0!==n.partParameter&&(a[n.partParameter]=e),void 0!==n.pinInstantiationIdx){var r=n.pinInstantiationIdx,i=p(e);o[r]=i}}),i.push(s(n,r,o,a))})}return i},e.prototype.computePartDimensions=function(e,t){var n=e.visual.pinLocations,o=e.pinDefinitions,r=e.numberOfPins;v.U.assert(n.length===r,'Mismatch between "numberOfPins" and length of "visual.pinLocations" for "'+t+'"'),v.U.assert(o.length===r,'Mismatch between "numberOfPins" and length of "pinDefinitions" for "'+t+'"'),v.U.assert(0<r,'Part "'+t+'" has no pins');var i,a,s,u,c=n.map(function(e,t){return n={idx:t},r=e,i=o[t],g(g(n,r),i);var n,r,i}).filter(function(e){return"-Z"===e.orientation}),l=0<c.length,f=e.visual.pinDistance;if(l){var p=c[0],d=Math.ceil(p.x/f),h=Math.ceil(p.y/f);i=d*f-p.x,a=h*f-p.y,s=Math.ceil((i+e.visual.width)/f)+1,u=Math.ceil((a+e.visual.height)/f)+1}else s=Math.ceil(e.visual.width/f),u=Math.ceil(e.visual.height/f),i=s*f-e.visual.width,a=u*f-e.visual.height;return{xOffset:i,yOffset:a,rowCount:u,colCount:s}},e.prototype.allocColumns=function(e){var t=e.length,n=v.visuals.BREADBOARD_MID_COLS-e.map(function(e){return e.colCount}).reduce(function(e,t){return e+t},0);n<=0&&console.log("Not enough breadboard space!");var r=Math.floor(n/(t-1+2)),i=n-r*(t-1),o=Math.floor(i/2),a=(Math.ceil(i/2),1+o);return e.map(function(e){var t=a;return a+=e.colCount+r,t})},e.prototype.placeParts=function(e){var r=v.visuals.BREADBOARD_MID_ROWS+2,i=this.allocColumns(e.map(function(e){return e.bbFit})),o=e.map(function(e){var t=r-e.bbFit.rowCount,n=Math.floor(t/2);return 4<n&&(n=4),n<1&&(n=1),n});return e.map(function(e,t){var n=o[t];return g({startColumnIdx:i[t],startRowIdx:n},e)})},e.prototype.nextColor=function(){return(!this.availableWireColors||this.availableWireColors.length<=0)&&(this.availableWireColors=v.visuals.GPIO_WIRE_COLORS.map(function(e){return e})),this.availableWireColors.pop()},e.prototype.allocWireIRs=function(s){var u=this,c=[],e=s.pins.map(function(e,t){var n,r=e.target,i=s.startColumnIdx+e.bbFit.partRelativeColIdx,o=v.visuals.getColumnName(i),a=s.startRowIdx+e.bbFit.partRelativeRowIdx;(7<=a&&(a-=2),d(e.def))?n={type:"breadboard",row:a<5?"j":"a",col:o,style:e.def.style}:n={type:"breadboard",row:v.visuals.getRowName(a),col:o,xOffset:e.bbFit.xOffset/s.def.visual.pinDistance,yOffset:e.bbFit.yOffset/s.def.visual.pinDistance,style:e.def.style};return{start:n,end:r,color:"ground"===r?l:"threeVolt"===r?"red":"number"==typeof e.def.colorGroup?c[e.def.colorGroup]?c[e.def.colorGroup]:c[e.def.colorGroup]=u.nextColor():u.nextColor(),pinIdx:t}});return g(s,{wires:e})},e.prototype.allocLocation=function(e,t){var n=this;if("ground"===e||"threeVolt"===e){if("ground"===e&&this.powerUsage.singleGround)return{type:"dalboard",pin:this.getBoardGroundPin()};if("threeVolt"===e&&this.powerUsage.singleThreeVolt)return{type:"dalboard",pin:this.getBoardThreeVoltPin()};v.U.assert(!!t.referenceBBPin);var r=this.opts.getBBCoord(t.referenceBBPin),i=[this.availablePowerPins.top.ground[0]||this.availablePowerPins.top.threeVolt[0],this.availablePowerPins.bottom.ground[0]||this.availablePowerPins.bottom.threeVolt[0]].map(function(e){return n.opts.getBBCoord(e)});i[0]&&i[1]||console.debug('No more available "'+e+'" locations!');var o=0==v.visuals.findClosestCoordIdx(r,i),a=void 0;o?"ground"===e?a=this.availablePowerPins.top.ground:"threeVolt"===e&&(a=this.availablePowerPins.top.threeVolt):"ground"===e?a=this.availablePowerPins.bottom.ground:"threeVolt"===e&&(a=this.availablePowerPins.bottom.threeVolt);var s=a.map(function(e){return n.opts.getBBCoord(e)}),u=v.visuals.findClosestCoordIdx(r,s),c=a[u];return o?(this.availablePowerPins.top.ground.splice(u,1),this.availablePowerPins.top.threeVolt.splice(u,1)):(this.availablePowerPins.bottom.ground.splice(u,1),this.availablePowerPins.bottom.threeVolt.splice(u,1)),c}if("breadboard"===e.type)return e;if("MOSI"===e||"MISO"===e||"SCK"===e)return this.opts.boardDef.spiPins||console.debug("No SPI pin mappings found!"),{type:"dalboard",pin:c=this.opts.boardDef.spiPins[e]};if("SDA"===e||"SCL"===e)return this.opts.boardDef.i2cPins||console.debug("No I2C pin mappings found!"),{type:"dalboard",pin:c=this.opts.boardDef.i2cPins[e]};v.U.assert("string"==typeof e,"Unknown location type: "+e);var l=e,f=this.opts.boardDef.gpioPinMap[l];return f?{type:"dalboard",pin:f}:void 0},e.prototype.getBoardGroundPin=function(){var e=this.opts.boardDef.groundPins[0]||null;return e||console.log("No available ground pin on board!"),e},e.prototype.getBoardThreeVoltPin=function(){var e=this.opts.boardDef.threeVoltPins[0]||null;return e||console.log("No available 3.3V pin on board!"),e},e.prototype.allocPowerWires=function(e){var t,n,r=this.getBoardGroundPin(),i=this.getBoardThreeVoltPin();this.opts.boardDef.attachPowerOnRight?(t={type:"breadboard",row:"-",col:"50"},n={type:"breadboard",row:"-",col:"25"}):(t={type:"breadboard",row:"-",col:"26"},n={type:"breadboard",row:"-",col:"1"});var o=[],a=[];e.bottomGround&&e.topGround&&o.push({start:this.allocLocation("ground",{referenceBBPin:t}),end:this.allocLocation("ground",{referenceBBPin:n}),color:l}),e.topGround?o.push({start:this.allocLocation("ground",{referenceBBPin:t}),end:{type:"dalboard",pin:r},color:l}):e.bottomGround&&o.push({start:this.allocLocation("ground",{referenceBBPin:n}),end:{type:"dalboard",pin:r},color:l}),e.bottomThreeVolt&&e.bottomGround&&a.push({start:this.allocLocation("threeVolt",{referenceBBPin:t}),end:this.allocLocation("threeVolt",{referenceBBPin:n}),color:"red"}),e.topThreeVolt?a.push({start:this.allocLocation("threeVolt",{referenceBBPin:t}),end:{type:"dalboard",pin:i},color:"red"}):e.bottomThreeVolt&&a.push({start:this.allocLocation("threeVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:i},color:"red"});var s=[];0<o.length&&s.push({wireIndices:o.map(function(e,t){return t})});var u=o.length;return 0<a.length&&s.push({wireIndices:a.map(function(e,t){return t+u})}),{wires:o.concat(a),assembly:s}},e.prototype.allocWire=function(e){var r=this,i=[e.start,e.end],n=i.map(function(e){return"ground"===e||"threeVolt"===e}),o=i.map(function(e,t){return n[t]?void 0:r.allocLocation(e,{})});if((o=o.map(function(e,t){if(e)return e;var n=o[1-t];return r.allocLocation(i[t],{referenceBBPin:n})}))[0]&&o[1])return{start:o[0],end:o[1],color:e.color}},e.prototype.allocPart=function(i){var e=i.pins.filter(function(e){return d(e.def)}).map(function(e){var t=i.startRowIdx+e.bbFit.partRelativeRowIdx;7<=t&&(t-=2);var n=v.visuals.getRowName(t),r=i.startColumnIdx+e.bbFit.partRelativeColIdx;return{type:"breadboard",row:n,col:v.visuals.getColumnName(r)}});return{name:i.name,visual:i.def.visual,bbFit:i.bbFit,startColumnIdx:i.startColumnIdx,startRowIdx:i.startRowIdx,breadboardConnections:e,params:i.partParams,simulationBehavior:i.def.simulationBehavior}},e.prototype.allocAll=function(){var e,o=this,t=this.opts.partsList.map(function(e){return{name:e,def:o.opts.partDefs[e]}}).filter(function(e){return!!e.def});if(0<t.length){t.map(function(e){return e.name}),t.map(function(e){return e.def});var i=t.map(function(e){return o.computePartDimensions(e.def,e.name)}),a=[];t.forEach(function(e,t){var n=i[t],r=o.allocPartIRs(e.def,e.name,n);a=a.concat(r)});var n=this.placeParts(a).map(function(e){return o.allocWireIRs(e)}),r=n.map(function(e){return e.wires}).reduce(function(e,t){return e.concat(t)},[]).map(function(e){return n=[(t=e).start,t.end],r=n.map(function(e){return"ground"===e}),i=n.map(function(e){return"threeVolt"===e}),o=n.map(function(e){return function(e){var t=!1;if("string"!=typeof e&&"breadboard"===e.type){var n=e.row;t=0<=["a","b","c","d","e"].indexOf(n)}return t}(e)}),a=f(r),s=f(i),u=f(o),{topGround:a&&!u,topThreeVolt:s&&!u,bottomGround:a&&u,bottomThreeVolt:s&&u,singleGround:a,singleThreeVolt:s};var t,n,r,i,o,a,s,u});this.powerUsage=((e=r.reduce(function(e,t){return{topGround:e.topGround||t.topGround,topThreeVolt:e.topThreeVolt||t.topThreeVolt,bottomGround:e.bottomGround||t.bottomGround,bottomThreeVolt:e.bottomThreeVolt||t.bottomThreeVolt,singleGround:t.singleGround?null===e.singleGround:e.singleGround,singleThreeVolt:t.singleThreeVolt?null===e.singleThreeVolt:e.singleThreeVolt}},{topGround:!1,topThreeVolt:!1,bottomGround:!1,bottomThreeVolt:!1,singleGround:null,singleThreeVolt:null})).singleGround&&(e.topGround=e.bottomGround=!1),e.singleThreeVolt&&(e.topThreeVolt=e.bottomThreeVolt=!1),e);var s=this.allocPowerWires(this.powerUsage),u=n.map(function(e,t){var n=o.allocPart(e),r=e.wires.map(function(e){return o.allocWire(e)});if(!r.some(function(e){return!e})){var i=[];return e.wires.forEach(function(e,t){i[e.pinIdx]=t}),{part:n,wires:r,assembly:e.def.assembly.map(function(e){return{part:e.part,wireIndices:(e.pinIndices||[]).map(function(e){return i[e]})}})}}}).filter(function(e){return!!e}),c=[s].concat(u);return{partsAndWires:c,requiresBreadboard:c.some(function(e){return e.part&&e.part.breadboardConnections&&0<e.part.breadboardConnections.length||e.wires&&e.wires.some(function(e){return"breadboard"==e.end.type&&"croc"!=e.end.style||"breadboard"==e.start.type&&"croc"!=e.start.style})})}}return{partsAndWires:[]}},e}();v.allocateDefinitions=function(e){return new t(e).allocAll()}}(pxsim||(pxsim={})),function(e){!function(s){var e=function(e){this.seq=0,this.type=e},t=function(r){function e(e,t){var n=r.call(this,"response")||this;return n.request_seq=e.seq,n.command=e.command,t?(n.success=!1,n.message=t):n.success=!0,n}return __extends(e,r),e}(s.Message=e);s.Response=t;var n=function(r){function e(e,t){var n=r.call(this,"event")||this;return n.event=e,t&&(n.body=t),n}return __extends(e,r),e}(e);s.Event=n;var r=function(e,t,n,r,i){void 0===n&&(n=0),this.name=e,this.path=t,this.sourceReference=n,r&&(this.origin=r),i&&(this.adapterData=i)};s.Source=r;var i=function(e,t,n){void 0===n&&(n=!1),this.name=e,this.variablesReference=t,this.expensive=n};s.Scope=i;var o=function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this.id=e,this.source=n,this.line=r,this.column=i,this.name=t};s.StackFrame=o;var a=function(e,t){this.id=e,this.name=t||"Thread #"+e};s.Thread=a;var u=function(e,t,n,r,i){void 0===n&&(n=0),this.name=e,this.value=t,this.variablesReference=n,"number"==typeof i&&(this.namedVariables=i),"number"==typeof r&&(this.indexedVariables=r)};s.Variable=u;var c=function(e,t,n,r){this.verified=e,"number"==typeof t&&(this.line=t),"number"==typeof n&&(this.column=n),r&&(this.source=r)};s.Breakpoint=c;var l=function(e,t){this.id=e,this.name=t};s.Module=l;var f=function(e,t,n){void 0===n&&(n=0),this.label=e,this.start=t,this.length=n};s.CompletionItem=f;var p=function(i){function e(e,t,n){void 0===n&&(n=null);var r=i.call(this,"stopped")||this;(r.body={reason:e,threadId:t},n)&&(r.body.text=n);return r}return __extends(e,i),e}(n);s.StoppedEvent=p;var d=function(r){function e(e,t){var n=r.call(this,"continued")||this;return n.body={threadId:e},"boolean"==typeof t&&(n.body.allThreadsContinued=t),n}return __extends(e,r),e}(n);s.ContinuedEvent=d;var h=function(e){function t(){return e.call(this,"initialized")||this}return __extends(t,e),t}(n);s.InitializedEvent=h;var g=function(n){function e(e){var t=n.call(this,"terminated")||this;"boolean"==typeof e&&(t.body={restart:e});return t}return __extends(e,n),e}(n);s.TerminatedEvent=g;var m=function(i){function e(e,t,n){void 0===t&&(t="console");var r=i.call(this,"output")||this;return r.body={category:t,output:e},void 0!==n&&(r.body.data=n),r}return __extends(e,i),e}(n);s.OutputEvent=m;var v=function(r){function e(e,t){var n=r.call(this,"thread")||this;return n.body={reason:e,threadId:t},n}return __extends(e,r),e}(n);s.ThreadEvent=v;var b=function(r){function e(e,t){var n=r.call(this,"breakpoint")||this;return n.body={reason:e,breakpoint:t},n}return __extends(e,r),e}(n);s.BreakpointEvent=b;var y=function(r){function e(e,t){var n=r.call(this,"module")||this;return n.body={reason:e,module:t},n}return __extends(e,r),e}(n);s.ModuleEvent=y;var x=function(){function e(){this._pendingRequests={}}return e.prototype.start=function(e){var r=this;this._sequence=1,this.host=e,this.host.onData(function(e){if("request"===e.type)r.dispatchRequest(e);else if("response"===e.type){var t=e,n=r._pendingRequests[t.seq];n&&(delete r._pendingRequests[t.seq],n(t))}})},e.prototype.stop=function(){this.host&&this.host.close()},e.prototype.sendEvent=function(e){this.send("event",e)},e.prototype.sendResponse=function(e){0<e.seq?console.error("attempt to send more than one response for command "+e.command):this.send("response",e)},e.prototype.sendRequest=function(e,t,n,r){var i=this,o={command:e};if(t&&0<Object.keys(t).length&&(o.arguments=t),this.send("request",o),r){this._pendingRequests[o.seq]=r;var a=setTimeout(function(){clearTimeout(a);var e=i._pendingRequests[o.seq];e&&(delete i._pendingRequests[o.seq],e(new s.Response(o,"timeout")))},n)}},e.prototype.send=function(e,t){if(t.type=e,t.seq=this._sequence++,this.host){var n=JSON.stringify(t);this.host.send(n)}},e.prototype.dispatchRequest=function(e){},e}(),w=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._debuggerLinesStartAt1=!1,e._debuggerColumnsStartAt1=!1,e._clientLinesStartAt1=!0,e._clientColumnsStartAt1=!0,e}return __extends(o,t),o.prototype.shutdown=function(){},o.prototype.dispatchRequest=function(e){var t=new s.Response(e);try{if("initialize"===e.command){var n=e.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null);else{var r=t;r.body={},this.initializeRequest(r,n)}}else"launch"===e.command?this.launchRequest(t,e.arguments):"attach"===e.command?this.attachRequest(t,e.arguments):"disconnect"===e.command?this.disconnectRequest(t,e.arguments):"setBreakpoints"===e.command?this.setBreakPointsRequest(t,e.arguments):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(t,e.arguments):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(t,e.arguments):"configurationDone"===e.command?this.configurationDoneRequest(t,e.arguments):"continue"===e.command?this.continueRequest(t,e.arguments):"next"===e.command?this.nextRequest(t,e.arguments):"stepIn"===e.command?this.stepInRequest(t,e.arguments):"stepOut"===e.command?this.stepOutRequest(t,e.arguments):"stepBack"===e.command?this.stepBackRequest(t,e.arguments):"restartFrame"===e.command?this.restartFrameRequest(t,e.arguments):"goto"===e.command?this.gotoRequest(t,e.arguments):"pause"===e.command?this.pauseRequest(t,e.arguments):"stackTrace"===e.command?this.stackTraceRequest(t,e.arguments):"scopes"===e.command?this.scopesRequest(t,e.arguments):"variables"===e.command?this.variablesRequest(t,e.arguments):"setVariable"===e.command?this.setVariableRequest(t,e.arguments):"source"===e.command?this.sourceRequest(t,e.arguments):"threads"===e.command?this.threadsRequest(t):"evaluate"===e.command?this.evaluateRequest(t,e.arguments):"stepInTargets"===e.command?this.stepInTargetsRequest(t,e.arguments):"gotoTargets"===e.command?this.gotoTargetsRequest(t,e.arguments):"completions"===e.command?this.completionsRequest(t,e.arguments):this.customRequest(e.command,t,e.arguments)}catch(e){this.sendErrorResponse(t,1104,"{_stack}",{_exception:e.message,_stack:e.stack})}},o.prototype.initializeRequest=function(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,this.sendResponse(e)},o.prototype.disconnectRequest=function(e,t){this.sendResponse(e),this.shutdown()},o.prototype.launchRequest=function(e,t){this.sendResponse(e)},o.prototype.attachRequest=function(e,t){this.sendResponse(e)},o.prototype.setBreakPointsRequest=function(e,t){this.sendResponse(e)},o.prototype.setFunctionBreakPointsRequest=function(e,t){this.sendResponse(e)},o.prototype.setExceptionBreakPointsRequest=function(e,t){this.sendResponse(e)},o.prototype.configurationDoneRequest=function(e,t){this.sendResponse(e)},o.prototype.continueRequest=function(e,t){this.sendResponse(e)},o.prototype.nextRequest=function(e,t){this.sendResponse(e)},o.prototype.stepInRequest=function(e,t){this.sendResponse(e)},o.prototype.stepOutRequest=function(e,t){this.sendResponse(e)},o.prototype.stepBackRequest=function(e,t){this.sendResponse(e)},o.prototype.restartFrameRequest=function(e,t){this.sendResponse(e)},o.prototype.gotoRequest=function(e,t){this.sendResponse(e)},o.prototype.pauseRequest=function(e,t){this.sendResponse(e)},o.prototype.sourceRequest=function(e,t){this.sendResponse(e)},o.prototype.threadsRequest=function(e){this.sendResponse(e)},o.prototype.stackTraceRequest=function(e,t){this.sendResponse(e)},o.prototype.scopesRequest=function(e,t){this.sendResponse(e)},o.prototype.variablesRequest=function(e,t){this.sendResponse(e)},o.prototype.setVariableRequest=function(e,t){this.sendResponse(e)},o.prototype.evaluateRequest=function(e,t){this.sendResponse(e)},o.prototype.stepInTargetsRequest=function(e,t){this.sendResponse(e)},o.prototype.gotoTargetsRequest=function(e,t){this.sendResponse(e)},o.prototype.completionsRequest=function(e,t){this.sendResponse(e)},o.prototype.customRequest=function(e,t,n){this.sendErrorResponse(t,1014,"unrecognized request",null)},o.prototype.sendErrorResponse=function(e,t,n,r){var i;"number"==typeof t?(i={id:t,format:n},r&&(i.variables=r),i.showUser=!0):i=t,e.success=!1,o.formatPII(i.format,!0,i.variables),e.body||(e.body={}),e.body.error=i,this.sendResponse(e)},o.prototype.convertClientLineToDebugger=function(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e},o.prototype.convertDebuggerLineToClient=function(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e},o.prototype.convertClientColumnToDebugger=function(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e},o.prototype.convertDebuggerColumnToClient=function(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e},o.prototype.convertClientPathToDebugger=function(e){return this._clientPathsAreURIs!=this._debuggerPathsAreURIs?this._clientPathsAreURIs?o.uri2path(e):o.path2uri(e):e},o.prototype.convertDebuggerPathToClient=function(e){return this._debuggerPathsAreURIs!=this._clientPathsAreURIs?this._debuggerPathsAreURIs?o.uri2path(e):o.path2uri(e):e},o.path2uri=function(e){var t=e.replace(/\\/g,"/");return"/"!==t[0]&&(t="/"+t),encodeURI("file://"+t)},o.uri2path=function(e){return e},o.formatPII=function(e,n,r){return e.replace(o._formatPIIRegexp,function(e,t){return n&&0<t.length&&"_"!==t[0]?e:r[t]&&r.hasOwnProperty(t)?r[t]:e})},o._formatPIIRegexp=/{([^}]+)}/g,o}(s.ProtocolServer=x);s.DebugSession=w}(e.protocol||(e.protocol={}))}(pxsim||(pxsim={})),function(e){!function(e){e.injectPolyphils=function(){Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{writable:!0,enumerable:!0,value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),n=t.length>>>0,r=arguments[1]>>0,i=r<0?Math.max(n+r,0):Math.min(r,n),o=arguments[2],a=void 0===o?n:o>>0,s=a<0?Math.max(n+a,0):Math.min(a,n);i<s;)t[i]=e,i++;return t}}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint16Array.prototype.slice||Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint32Array.prototype.slice||Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint8Array.prototype.fill||Object.defineProperty(Uint8Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint16Array.prototype.fill||Object.defineProperty(Uint16Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint32Array.prototype.fill||Object.defineProperty(Uint32Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0})};var t=function(){function e(e){this._func=e,this._evaluated=!1}return Object.defineProperty(e.prototype,"value",{get:function(){return this._evaluated||(this._value=this._func(),this._evaluated=!0),this._value},enumerable:!0,configurable:!0}),e}();function u(e){e=e.replace(/\\/g,"/");var t=[];return e.split("/").forEach(function(e){".."===e&&t.length?t.pop():e&&"."!==e&&t.push(e)}),t}e.Lazy=t,e.getNormalizedParts=u,e.normalizePath=function(e){return u(e).join("/")},e.relativePath=function(e,t){for(var n=u(e),r=u(t),i=0;n[i]===r[i]&&++i!==n.length&&i!==r.length;);for(var o=n.slice(i),a=r.slice(i),s=0;s<o.length;s++)a.unshift("..");return a.join("/")},e.pathJoin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";return e.forEach(function(e){e.replace(/\\/g,"/"),e.lastIndexOf("/")===e.length-1&&(e=e.slice(0,e.length-1)),n+="/"+e}),n},e.toArray=function(e){if(Array.isArray(e))return e;for(var t=[],n=0;n<e.length;++n)t.push(e[n]);return t}}(e.util||(e.util={}))}(pxsim||(pxsim={})),function(u){u.getWarningMessage=function(e){for(var t={type:"debugger",subtype:"warning",breakpointIds:[],message:e},n=u.runtime.currFrame;null!=n;)t.breakpointIds.push(n.lastBrkId),n=n.parent;return t};var e=function(){function e(e){var r=this;for(var t in this.fileMap={},this.idMap={},e.forEach(function(e){var t=e[0],n=e[1];r.fileMap[n.source.path]||(r.fileMap[n.source.path]=[]),r.fileMap[n.source.path].push(e),r.idMap[t]=n}),this.fileMap){var n=this.fileMap[t];this.fileMap[t]=n.sort(function(e,t){var n=e[1],r=t[1];return n.line===r.line?r.endLine===n.endLine?n.column-r.column:r.endLine-n.endLine:n.line-r.line})}}return e.prototype.getById=function(e){return this.idMap[e]},e.prototype.verifyBreakpoint=function(e,t){var n,r=this.fileMap[e];if(r)for(var i=0,o=r;i<o.length;i++){var a=o[i],s=a[0],u=a[1];u.line<=t.line&&u.endLine>=t.line&&(n=[s,u])}return n?(n[1].verified=!0,n):[-1,{verified:!1}]},e}();function o(e,t){function o(e){switch(typeof e){case"string":case"number":case"boolean":return e;case"function":return{text:"(function)"};case"undefined":return null;case"object":return e?e instanceof u.RefObject?{id:(t[e.id]=e).id,preview:u.RefObject.toDebugString(e)}:{text:"(object)"}:null;default:throw new Error}}return function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];!/^__/.test(i)&&/___\d+$/.test(i)&&(t[i.replace(/___\d+$/,"")]=o(e[i]))}return t}(e)}u.BreakpointMap=e,u.dumpHeap=o,u.getBreakpointMsg=function(e,t){for(var n={},r={type:"debugger",subtype:"breakpoint",breakpointId:t,globals:o(u.runtime.globals,n),stackframes:[]};null!=e;){var i=e.fn?e.fn.info:null;i&&r.stackframes.push({locals:o(e,n),funcInfo:i,breakpointId:e.lastBrkId}),e=e.parent}return{msg:r,heap:n}};var t=function(r){function n(e){var t=r.call(this)||this,n={onDebuggerBreakpoint:function(e){return t.onDebuggerBreakpoint(e)},onDebuggerWarning:function(e){return t.onDebuggerWarning(e)},onDebuggerResume:function(){return t.onDebuggerResume()},onStateChanged:function(e){return t.onStateChanged(e)}};return t.driver=new u.SimulatorDriver(e,n),t}return __extends(n,r),n.prototype.runCode=function(e,t,n,r,i){this.breakpoints=r,this.projectDir&&this.fixBreakpoints(),this.sendEvent(new u.protocol.InitializedEvent),this.driver.run(e,{parts:t,fnArgs:n,boardDefinition:i})},n.prototype.stopSimulator=function(e){void 0===e&&(e=!1),this.driver.stop(e)},n.prototype.initializeRequest=function(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsConfigurationDoneRequest=!0,this.sendResponse(e)},n.prototype.disconnectRequest=function(e,t){this.sendResponse(e),this.shutdown()},n.prototype.launchRequest=function(e,t){this.projectDir||(this.projectDir=u.util.normalizePath(t.projectDir),this.breakpoints&&this.fixBreakpoints()),this.sendResponse(e)},n.prototype.setBreakPointsRequest=function(i,o){var a=this;i.body={breakpoints:[]};var s=[];o.breakpoints.forEach(function(e){if(a.breakpoints){var t=a.breakpoints.verifyBreakpoint(u.util.relativePath(a.projectDir,o.source.path),e),n=t[0],r=t[1];i.body.breakpoints.push(r),r.verified&&s.push(n)}else i.body.breakpoints.push({verified:!1})}),this.driver.setBreakpoints(s),this.sendResponse(i)},n.prototype.continueRequest=function(e,t){this.driver.resume(u.SimulatorDebuggerCommand.Resume),this.sendResponse(e)},n.prototype.nextRequest=function(e,t){this.driver.resume(u.SimulatorDebuggerCommand.StepOver),this.sendResponse(e)},n.prototype.stepInRequest=function(e,t){this.driver.resume(u.SimulatorDebuggerCommand.StepInto),this.sendResponse(e)},n.prototype.stepOutRequest=function(e,t){this.driver.resume(u.SimulatorDebuggerCommand.StepOut),this.sendResponse(e)},n.prototype.pauseRequest=function(e,t){this.driver.resume(u.SimulatorDebuggerCommand.Pause),this.sendResponse(e)},n.prototype.threadsRequest=function(e){e.body={threads:[{id:n.THREAD_ID,name:"main"}]},this.sendResponse(e)},n.prototype.stackTraceRequest=function(e,t){if(this.lastBreak){var n=this.state.getFrames();e.body={stackFrames:n}}this.sendResponse(e)},n.prototype.scopesRequest=function(e,t){this.state&&(e.body={scopes:this.state.getScopes(t.frameId)}),this.sendResponse(e)},n.prototype.variablesRequest=function(e,t){this.state&&(e.body={variables:this.state.getVariables(t.variablesReference)}),this.sendResponse(e)},n.prototype.onDebuggerBreakpoint=function(e){if(this.lastBreak=e,this.state=new i(this.lastBreak,this.breakpoints,this.projectDir),e.exceptionMessage){var t=e.exceptionMessage.replace(/___\d+/g,"");this.sendEvent(new u.protocol.StoppedEvent("exception",n.THREAD_ID,t))}else this.sendEvent(new u.protocol.StoppedEvent("breakpoint",n.THREAD_ID))},n.prototype.onDebuggerWarning=function(e){},n.prototype.onDebuggerResume=function(){this.sendEvent(new u.protocol.ContinuedEvent(n.THREAD_ID,!0))},n.prototype.onStateChanged=function(e){switch(e){case u.SimulatorState.Paused:break;case u.SimulatorState.Running:this.sendEvent(new u.protocol.ContinuedEvent(n.THREAD_ID,!0));break;case u.SimulatorState.Stopped:this.sendEvent(new u.protocol.TerminatedEvent);break;case u.SimulatorState.Unloaded:}},n.prototype.fixBreakpoints=function(){for(var e in this.breakpoints.idMap){var t=this.breakpoints.idMap[e];t.source.path=u.util.pathJoin(this.projectDir,t.source.path),t.line=this.convertDebuggerLineToClient(t.line),t.endLine=this.convertDebuggerLineToClient(t.endLine),t.column=this.convertDebuggerColumnToClient(t.column),t.endColumn=this.convertDebuggerColumnToClient(t.endColumn)}},n.THREAD_ID=1,n}(u.protocol.DebugSession);u.SimDebugSession=t;var i=function(){function e(e,t,n){this._message=e,this._map=t,this._dir=n,this._currentId=1,this._frames={},this._vars={};var r=this.nextId();this._vars[r]=this.getVariableValues(this._message.globals),this._globalScope={name:"Globals",variablesReference:r,expensive:!1}}return e.prototype.getFrames=function(){var r=this;return this._message.stackframes.map(function(e,t){var n=r._map.getById(e.breakpointId);if(n)return{id:(r._frames[e.breakpointId]=e).breakpointId,name:e.funcInfo?e.funcInfo.functionName:0===t?"main":"anonymous",line:n.line,column:n.column,endLine:n.endLine,endColumn:n.endLine,source:n.source}}).filter(function(e){return!!e})},e.prototype.getScopes=function(e){var t=this._frames[e];if(t){var n=this.nextId();return this._vars[n]=this.getVariableValues(t.locals),[{name:"Locals",variablesReference:n,expensive:!1},this._globalScope]}return[this._globalScope]},e.prototype.getVariables=function(e){var t=this._vars[e];return t&&t.value||[]},e.prototype.getVariableValues=function(a){var s=this;return new u.util.Lazy(function(){var e=[];for(var t in a){var n=a[t],r=void 0,i=0;null===n?r="null":void 0===n?r="undefined":"object"==typeof n?(r="(object)",i=s.nextId(),s._vars[i]=s.getVariableValues(n)):r=n.toString();var o=t.substr(0,t.lastIndexOf("___"));e.push({name:o,value:r,variablesReference:i})}return e})},e.prototype.nextId=function(){return this._currentId++},e}()}(pxsim||(pxsim={})),function(s){function u(e){function t(){try{window.print()}catch(e){}}void 0===e&&(e=0),e?setTimeout(t,e):t()}function r(e){"undefined"!=typeof window&&window.parent&&window.parent!==window&&window.parent.postMessage(e,"*")}function n(){setInterval(function(){s.Runtime.postMessage({type:"simulator",command:"reload"})},500)}s.print=u,function(e){function t(e){e.origin;var t=e.data||{},n=t.type||"";if(n)switch(n||""){case"run":o(t);break;case"instructions":s.instructions.renderInstructions(t);break;case"stop":i();break;case"mute":a(t.mute);break;case"print":u();break;case"custom":s.handleCustomMessage&&s.handleCustomMessage(t);break;case"pxteditor":break;case"debugger":r&&r.handleDebuggerMsg(t);break;default:!function(e){if(!r||r.dead)return;r.board.receiveMessage(e)}(t)}}var r;function i(){r&&(r.kill(),r.board&&r.board.kill())}function o(e){i(),e.mute&&a(e.mute),e.localizedStrings&&s.localization.setLocalizedStrings(e.localizedStrings),(r=new s.Runtime(e)).board.initAsync(e).done(function(){r.run(function(e){s.dumpLivePointers(),s.Runtime.postMessage({type:"toplevelcodefinished"})})})}function a(e){s.AudioContextManager.mute(e)}e.start=function(){window.addEventListener("message",t,!1);var e=window.location.hash.slice(1);"undefined"!=typeof window&&(window.applicationCache.status===window.applicationCache.UPDATEREADY&&n(),window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status===window.applicationCache.UPDATEREADY&&n()})),s.Runtime.postMessage({type:"ready",frameid:e})},e.stop=i,e.run=o}(s.Embed||(s.Embed={})),s.tickEvent=function(e,t){r({type:"pxtsim",action:"event",tick:e,data:t})},s.reportError=function(e,t,n){r({type:"pxtsim",action:"event",tick:"error",category:e,message:t,data:n})},s.reload=n}(pxsim||(pxsim={})),pxsim.util.injectPolyphils(),"undefined"!=typeof window&&window.addEventListener("load",function(e){pxsim.Embed.start()}),function(M){!function(e){var c=10,r=30,a=function(e){return e+"x"},s=20,R=3,D=5,L=5,l=40,f=50,p=1.5,t=[816*.95,1056*.95],n=[1,1],i=n[0],o=n[1],u=(t[0]-86.4)/o-48*o,d=465,h=400,B=1.7,g=.17,m=.25,v=.3,b=.23,y=u-36,x="\n            .instr-panel {\n                margin: 20px;\n                padding: 24px;\n                border-width: 4px;\n                border-color: gray;\n                border-style: solid;\n                border-radius: 20px;\n                display: inline-block;\n                width: "+u+"px;\n                height: "+((t[1]-86.4)/i-48*i)+"px;\n                position: relative;\n                overflow: hidden;\n                page-break-inside: avoid;\n            }\n            .board-svg {\n                margin: 0 auto;\n                display: block;\n                position: absolute;\n                bottom: 24px;\n                left: "+((u-d)/2+24)+"px;\n            }\n            .panel-num-outer {\n                position: absolute;\n                left: "+-4+"px;\n                top: "+-4+"px;\n                width: 120px;\n                height: 120px;\n                border-width: 4px;\n                border-style: solid;\n                border-color: gray;\n                border-radius: 20px 0 20px 0;\n            }\n            .panel-num {\n                margin: 10px 0;\n                text-align: center;\n                font-size: 80px;\n            }\n            .cmp-div {\n                display: inline-block;\n            }\n            .reqs-div {\n                margin-left: 144px;\n                margin-top: 5px;\n            }\n            .partslist-wire,\n            .partslist-cmp {\n                margin: 10px;\n            }\n            .partslist-wire {\n                display: inline-block;\n            }\n            ";function w(e,t){e.classList?e.classList.add(t):e.className.indexOf(t)<0&&(e.className+=" "+t)}function k(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r={l:0,t:0,w:0,h:0},i=document.createElementNS("http://www.w3.org/2000/svg","svg");n.appendChild(i),i.appendChild(e.el);var o={viewBox:e.x+" "+e.y+" "+e.w+" "+e.h,preserveAspectRatio:"xMidYMid"};r.w=e.w,r.h=e.h;var a=function(e){r.h*=e,r.w*=e,o.width=r.w,o.height=r.h};t.cmpScale&&a(t.cmpScale),t.cmpWidth&&t.cmpWidth<r.w?a(t.cmpWidth/r.w):t.cmpHeight&&t.cmpHeight<r.h&&a(t.cmpHeight/r.h),M.svg.hydrate(i,o);var s=r.l,u=r.t,c=r.w,l=r.h,f=function(e){if(e<r.l){var t=r.l-e;r.l=e,r.w+=t}},p=function(e){var t=r.l+r.w;if(t<e){var n=e-t;r.w+=n}},d=function(e){if(e<r.t){var t=r.t-e;r.t=e,r.h+=t}},h=function(e){var t=r.t+r.h;if(t<e){var n=e-t;r.h+=n}},g=[-.3,.3],m=g[0],v=g[1],b=[1.4,1];if(t&&t.top){var y=(I=t.topSize)/b[0],x=[s+c/2,u-R-(S=I/b[1])/2],w=x[0],k=x[1],A=M.visuals.mkTxt(w,k,I,0,t.top,m,v);M.svg.addClass(A,"cmp-lbl"),n.appendChild(A);var E=y*t.top.length;d(k-S/2),f(w-E/2),p(w+E/2)}if(t&&t.bot){y=(I=t.botSize)/b[0];var C=[s+c/2,u+l+R+(S=I/b[1])/2];w=C[0],k=C[1],A=M.visuals.mkTxt(w,k,I,0,t.bot,m,v);M.svg.addClass(A,"cmp-lbl"),n.appendChild(A);E=y*t.bot.length;h(k+S/2),f(w-E/2),p(w+E/2)}if(t&&t.right){var S=(I=t.rightSize)/b[1],_=(E=(y=I/b[0])*t.right.length,[s+c+D+E/2,u+l/2]),T=(w=_[0],_[1]);A=M.visuals.mkTxt(w,T,I,0,t.right,m,v);M.svg.addClass(A,"cmp-lbl"),n.appendChild(A),d(T-S/2),p(w+E/2),h(T+S/2)}if(t&&t.left){S=(I=t.leftSize)/b[1],E=(y=I/b[0])*t.left.length;var I,P=[s-L-E/2,u+l/2];w=P[0],T=P[1],A=M.visuals.mkTxt(w,T,I,0,t.left,m,v);M.svg.addClass(A,"cmp-lbl"),n.appendChild(A),d(T-S/2),f(w-E/2),h(T+S/2)}var U={viewBox:r.l+" "+r.t+" "+r.w+" "+r.h,width:r.w*B,height:r.h*B,preserveAspectRatio:"xMidYMid"};M.svg.hydrate(n,U);var O=document.createElement("div");return O.appendChild(n),O}function A(e,t){var n,r=M.runtime.board;if("wire"==e)n=M.visuals.mkWirePart([0,0],t.wireClr||"red",t.crocClips);else{var i=e;if("string"==typeof i.builtIn)n=(0,r.builtinPartVisuals[i.builtIn])([0,0]);else n=M.visuals.mkGenericPartSVG(i)}return k(n,t)}function E(e,t,n){void 0===n&&(n=!1);var r={state:M.runtime.board,boardDef:e.boardDef,forceBreadboardLayout:!0,forceBreadboardRender:e.allAlloc.requiresBreadboard,partDefs:e.cmpDefs,maxWidth:t+"px",fnArgs:e.fnArgs,wireframe:n,partsList:[]},i=new M.visuals.BoardHost(M.visuals.mkBoardView({visual:r.boardDef.visual,wireframe:r.wireframe}),r),o=i.getView();return M.svg.addClass(o,"board-svg"),i}function C(){var e=document.createElement("div");return w(e,"instr-panel"),e}function S(i){var e,o=C(),t=k((e=i.boardDef.visual,M.visuals.mkBoardView({visual:e}).getView()),{left:a(1),leftSize:r,cmpScale:g});o.appendChild(t);var n=k(new M.visuals.Breadboard({}).getSVGAndSize(),{left:a(1),leftSize:r,cmpScale:m});return o.appendChild(n),i.allCmps.forEach(function(e){var t=1;"buttonpair"===e.visual.builtIn&&(t=2);var n=A(e.visual,{left:a(t),leftSize:r,cmpScale:v});w(n,"partslist-cmp"),o.appendChild(n)}),i.allWireColors.forEach(function(e){var t=i.colorToWires[e].length,n=i.boardDef.pinStyles[e]||"female",r=A("wire",{left:a(t),leftSize:s,wireClr:e,cmpScale:b,crocClips:"croc"==n});w(r,"partslist-wire"),o.appendChild(r)}),o}function _(e,r){var t=C(),n=E(r,d,!0);!function(r,i,o){var e=r.getView();0<i&&M.svg.addClass(e,"grayed");for(var t=function(n){var e=o.stepToCmps[n];e&&e.forEach(function(e){var t=r.addPart(e);n===i&&(e.breadboardConnections.forEach(function(e){return r.highlightBreadboardPin(e)}),M.svg.addClass(t.element,"notgrayed"))});var t=o.stepToWires[n];t&&t.forEach(function(e){var t=r.addWire(e);n===i&&("breadboard"==e.start.type?r.highlightBreadboardPin(e.start):r.highlightBoardPin(e.start.pin),"breadboard"==e.end.type?r.highlightBreadboardPin(e.end):r.highlightBoardPin(e.end.pin),r.highlightWire(t))})},n=0;n<=i;n++)t(n)}(n,e,r),t.appendChild(n.getView());var i=document.createElement("div");w(i,"panel-num-outer"),w(i,"noselect"),t.appendChild(i);var o=document.createElement("div");w(o,"panel-num"),o.textContent=e+1+"",i.appendChild(o);var a=document.createElement("div");w(a,"reqs-div"),t.appendChild(a);var s=r.stepToWires[e]||[],u=function(e){if("breadboard"===e.type){var t=e;return"("+t.row+","+t.col+")"}return e.pin};return s.forEach(function(e){var t=!1;"dalboard"==e.end.type&&(t="croc"==r.boardDef.pinStyles[e.end.pin]);var n=A("wire",{top:u(e.end),topSize:c,bot:u(e.start),botSize:c,wireClr:e.color,cmpHeight:l,crocClips:t});w(n,"cmp-div"),a.appendChild(n)}),(r.stepToCmps[e]||[]).forEach(function(o){("buttonpair"===o.visual.builtIn?[o.breadboardConnections[0],o.breadboardConnections[2]]:[o.breadboardConnections[0]]).forEach(function(e,t){var n;e?n="("+e.row+","+e.col+")":n="";var r=p;"buttonpair"===o.visual.builtIn&&(r*=.5);var i=A(o.visual,{top:n,topSize:c,cmpHeight:f,cmpScale:r});w(i,"cmp-div"),a.appendChild(i)})}),t}function T(e,t){t.boardDef.pinStyles||(t.boardDef.pinStyles={}),t.configData&&M.setConfigData(t.configData.cfg,t.configData.cfgKey);var n={type:"run",code:"",boardDefinition:t.boardDef,partDefinitions:t.partDefinitions};M.runtime=new M.Runtime(n),M.runtime.board=null,M.initCurrentRuntime(n);var r=document.createElement("style");r.textContent+=x,document.head.appendChild(r);var i,o,a,s=t.partDefinitions,u=new M.visuals.Breadboard({}),c=function(e){var t=M.allocateDefinitions(e),i=[],o=[],a=1;t.partsAndWires.forEach(function(e){var n=e.part,r=e.wires;e.assembly.forEach(function(e,t){e.part&&n&&(o[a+t]=[n]),e.wireIndices&&0<e.wireIndices.length&&r&&(i[a+t]=e.wireIndices.map(function(e){return r[e]}))}),a+=e.assembly.length});var n=a-1,r=t.partsAndWires.map(function(e){return e.part}).filter(function(e){return!!e}),s=t.partsAndWires.map(function(e){return e.wires||[]}).reduce(function(e,t){return e.concat(t)},[]),u={},c=[];return s.forEach(function(e){u[e.color]||(u[e.color]=[],c.push(e.color)),u[e.color].push(e)}),{boardDef:e.boardDef,cmpDefs:e.partDefs,fnArgs:e.fnArgs,allAlloc:t,stepToWires:i,stepToCmps:o,allWires:s,allCmps:r,lastStep:n,colorToWires:u,allWireColors:c}}({boardDef:t.boardDef,partDefs:s,partsList:t.parts,fnArgs:t.fnArgs,getBBCoord:u.getCoord.bind(u)}),l=(i=c,o=document.getElementById("front-panel"),(a=E(i,h,!1)).addAll(i.allAlloc),o.appendChild(a.getView()),S(c));e.appendChild(l);for(var f=0;f<=c.lastStep;f++){var p=_(f,c);e.appendChild(p)}var d=function(e){var t=C();w(t,"back-panel");var n=E(e,y,!1);return n.addAll(e.allAlloc),t.appendChild(n.getView()),t}(c);e.appendChild(d)}e.renderParts=T,e.renderInstructions=function(e){document.getElementById("proj-title").innerText=e.options.name||"",T(document.body,e.options)}}(M.instructions||(M.instructions={}))}(pxsim||(pxsim={})),function(a){function s(e,t){if(void 0===t&&(t="sim: check failed"),!e)throw new Error(t)}a.quiet=!1,a.check=s,a.floatingPoint=!1,a.refCounting=!0,a.title="";var n={},r={};a.noRefCounting=function(){a.refCounting=!1,a.runtime&&(a.runtime.refCounting=!1)},a.getConfig=function(e){return r.hasOwnProperty(e+"")?r[e+""]:null},a.getConfigKey=function(e){return n.hasOwnProperty(e)?n[e]:null},a.getAllConfigKeys=function(){return Object.keys(n)},a.setConfig=function(e,t){r[e]=t},a.setConfigData=function(e,t){r=e,n=t},a.getConfigData=function(){return{cfg:r,cfgKey:n}},a.enableFloatingPoint=function(){a.floatingPoint=!0},a.setTitle=function(e){a.title=e};var i=function(){function e(){this.refcnt=1,a.runtime?this.id=a.runtime.registerLiveObject(this):this.id=0}return e.prototype.destroy=function(){},e.prototype.print=function(){a.runtime&&a.runtime.refCountingDebug&&console.log("RefObject id:"+this.id+" refs:"+this.refcnt)},e.prototype.toDebugString=function(){return"(object)"},e.toAny=function(e){return e&&e.toAny?e.toAny():e},e.toDebugString=function(e){return null===e?"null":void 0===e?"undefined;":e.toDebugString?e.toDebugString():"string"==typeof e?JSON.stringify(e):e.toString()},e}();a.RefObject=i;var o=function(e,t,n,r,i,o){this.func=e,this.caps=t,this.a0=n,this.a1=r,this.a2=i,this.cb=o};a.FnWrapper=o;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields=[],e}return __extends(e,t),e.prototype.destroy=function(){for(var e=this.vtable.refmask,t=0;t<e.length;++t)e[t]&&v(this.fields[t]);this.fields=null,this.vtable=null},e.prototype.isRef=function(e){return s(0<=e&&e<this.fields.length),!!this.vtable.refmask[e]},e.prototype.print=function(){a.runtime&&a.runtime.refCountingDebug&&console.log("RefRecord id:"+this.id+" ("+this.vtable.name+") len:"+this.fields.length)},e}(i);a.RefRecord=u;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields=[],e}return __extends(e,t),e.prototype.isRef=function(e){return s(0<=e&&e<this.fields.length),e<this.reflen},e.prototype.ldclo=function(e){return s(0<=(e>>=2)&&e<this.fields.length),this.fields[e]},e.prototype.destroy=function(){for(var e=0;e<this.reflen;++e)v(this.fields[e]);this.fields=null,this.func=null},e.prototype.print=function(){a.runtime&&a.runtime.refCountingDebug&&console.log("RefAction id:"+this.id+" refs:"+this.refcnt+" len:"+this.fields.length)},e}(i);a.RefAction=c,function(e){function r(e,t,n,r){var i=a.getResume();e instanceof c?(d.incr(e),i(new o(e.func,e.fields,t,n,r,function(){d.decr(e)}))):i(new o(e,null,t,n,r,null))}e.mkAction=function(e,t,n){var r=new c;r.reflen=e,r.func=n;for(var i=0;i<t;++i)r.fields.push(null);return r},e.runAction3=r,e.runAction2=function(e,t,n){r(e,t,n,null)},e.runAction1=function(e,t){r(e,t,null,null)},e.runAction0=function(e){r(e,null,null,null)}}(a.pxtcore||(a.pxtcore={}));var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.v=0,e}return __extends(e,t),e.prototype.print=function(){},e}(i);a.RefLocal=e;var t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.v=null,e}return __extends(e,t),e.prototype.destroy=function(){v(this.v)},e.prototype.print=function(){a.runtime&&a.runtime.refCountingDebug&&console.log("RefRefLocal id:"+this.id+" refs:"+this.refcnt+" v:"+this.v)},e}(i);a.RefRefLocal=t;var l,f,p,d,h,g,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vtable=42,e.data=[],e}return __extends(e,t),e.prototype.findIdx=function(e){for(var t=0;t<this.data.length;++t)if(this.data[t].key>>1==e)return t;return-1},e.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e=0;e<this.data.length;++e)1&this.data[e].key&&v(this.data[e].val),this.data[e].val=0;this.data=[]},e.prototype.print=function(){a.runtime&&a.runtime.refCountingDebug&&console.log("RefMap id:"+this.id+" refs:"+this.refcnt+" size:"+this.data.length)},e.prototype.toAny=function(){var t={};return this.data.forEach(function(e){t[e.keyName]=i.toAny(e.val)}),t},e}(i);function v(e){if(a.runtime&&a.runtime.refCounting&&e instanceof i){var t=e;s(0<t.refcnt),0==--t.refcnt&&(a.runtime.unregisterLiveObject(t),t.destroy())}}function b(e){return e}function y(e){if(!a.runtime||!a.runtime.refCounting)return e;if(e instanceof i){var t=e;s(0<t.refcnt),t.refcnt++}return e}function x(){a.runtime&&a.runtime.dumpLivePointers()}a.RefMap=m,a.decr=v,a.initString=b,a.incr=y,a.dumpLivePointers=x,(l=a.numops||(a.numops={})).toString=function(e){return null===e?"null":void 0===e?"undefined":b(e.toString())},l.toBoolDecr=function(e){return v(e),!!e},l.toBool=function(e){return!!e},(f=a.langsupp||(a.langsupp={})).toInt=function(e){return 0|e},f.toFloat=function(e){return e},f.ignore=function(e){return e},f.ptreqDecr=function(e,t){return a.Number_.eqDecr(e,t)},(p=a.pxtcore||(a.pxtcore={})).incr=a.incr,p.decr=a.decr,p.ptrOfLiteral=function(e){return e},p.debugMemLeaks=function(){x()},p.allocate=function(){a.U.userError("allocate() called in simulator")},p.templateHash=function(){return 0},p.programHash=function(){return 0},p.programSize=function(){return 0},p.afterProgramPage=function(){return 0},p.getConfig=function(e,t){var n=a.getConfig(e);return null==n?t:n},p.toInt=function(e){return e>>0},p.toUInt=function(e){return e>>>0},p.toDouble=function(e){return e},p.toFloat=function(e){return e},p.fromInt=function(e){return e},p.fromUInt=function(e){return e},p.fromDouble=function(e){return e},p.fromFloat=function(e){return e},p.fromBool=function(e){return!!e},function(o){function i(e){null==e&&a.U.userError("Dereferencing null/undefined value.")}o.incr=a.incr,o.decr=a.decr,o.toInt8=function(e){return(255&e)<<24>>24},o.toInt16=function(e){return(65535&e)<<16>>16},o.toInt32=function(e){return 0|e},o.toUInt32=function(e){return e>>>0},o.toUInt8=function(e){return 255&e},o.toUInt16=function(e){return 65535&e},o.nullFix=function(e){return null==e||!1===e?0:!0===e?1:e},o.nullCheck=i,o.panic=function(e){a.U.userError("PANIC! Code "+e)},o.stringToBool=function(e){return o.decr(e),e?1:0},o.ptrToBool=function(e){return o.decr(e),e?1:0},o.emptyToNull=function(e){return""==e?0:e},o.ldfld=function(e,t){i(e),s(!e.isRef(t));var n,r=(n=e.fields[t],a.floatingPoint||void 0!==n?n:0);return o.decr(e),r},o.stfld=function(e,t,n){i(e),s(!e.isRef(t)),e.fields[t]=n,o.decr(e)},o.ldfldRef=function(e,t){i(e),s(e.isRef(t));var n,r=o.incr(void 0===(n=e.fields[t])?null:n);return o.decr(e),r},o.stfldRef=function(e,t,n){i(e),s(e.isRef(t)),o.decr(e.fields[t]),e.fields[t]=n,o.decr(e)},o.ldloc=function(e){return e.v},o.ldlocRef=function(e){return o.incr(e.v)},o.stloc=function(e,t){e.v=t},o.stlocRef=function(e,t){o.decr(e.v),e.v=t},o.mkloc=function(){return new e},o.mklocRef=function(){return new t},o.stclo=function(e,t,n){return s(0<=t&&t<e.fields.length),s(null===e.fields[t]),e.fields[t]=n,e},o.runtimeWarning=function(e){a.Runtime.postMessage(a.getWarningMessage(e))},o.mkMap=function(){return new m},o.mapGet=function(e,t){var n=e.findIdx(t);if(n<0)return o.decr(e),0;var r=e.data[n].val;return o.decr(e),r},o.mapGetRef=function(e,t){var n=e.findIdx(t);if(n<0)return o.decr(e),0;var r=o.incr(e.data[n].val);return o.decr(e),r},o.mapSet=function(e,t,n,r){var i=e.findIdx(t);i<0?e.data.push({key:t<<1,val:n,keyName:r}):(1&e.data[i].key&&(o.decr(e.data[i].val),e.data[i].key=t<<1),e.data[i].val=n,e.data[i].keyName=r),o.decr(e)},o.mapSetRef=function(e,t,n,r){var i=e.findIdx(t);i<0?e.data.push({key:t<<1|1,val:n,keyName:r}):(1&e.data[i].key?o.decr(e.data[i].val):e.data[i].key=t<<1|1,e.data[i].val=n,e.data[i].keyName=r),o.decr(e)}}(d=a.pxtrt||(a.pxtrt={})),(h=a.pxtcore||(a.pxtcore={})).mkClassInstance=function(e){s(!!e.methods),s(!!e.refmask);for(var t=new u,n=(t.vtable=e).refmask.length,r=0;r<n;++r)t.fields.push(a.floatingPoint?void 0:0);return t},h.switch_eq=function(e,t){return e==t&&(h.decr(t),!0)},(g=a.thread||(a.thread={})).panic=d.panic,g.pause=function(e){var t=a.getResume();setTimeout(function(){t()},e)},g.runInBackground=function(e){a.runtime.runFiberAsync(e).done()},g.forever=function(t){d.nullCheck(t),y(t),function e(){a.runtime.runFiberAsync(t).then(function(){return Promise.delay(20)}).then(e).done()}()}}(pxsim||(pxsim={})),function(u){var e,t,n,r,o=function(t){function e(){var e=t.call(this)||this;return e.data=[],e}return __extends(e,t),e.prototype.toArray=function(){return this.data.slice(0)},e.prototype.toAny=function(){return this.data.map(function(e){return u.RefObject.toAny(e)})},e.prototype.toDebugString=function(){for(var e="[",t=0;t<this.data.length;++t)if(0<t&&(e+=","),15<(e+=u.RefObject.toDebugString(this.data[t])).length){e+="...";break}return e+="]"},e.prototype.destroy=function(){for(var e=this.data,t=0;t<e.length;++t)u.decr(e[t]),e[t]=0;this.data=[]},e.prototype.isValidIndex=function(e){return 0<=e&&e<this.data.length},e.prototype.push=function(e){this.data.push(e)},e.prototype.pop=function(){var e=this.data.pop();return null==e?0:e},e.prototype.getLength=function(){return this.data.length},e.prototype.setLength=function(e){this.data.length=e},e.prototype.getAt=function(e){return null!=this.data[e]?this.data[e]:0},e.prototype.setAt=function(e,t){this.data[e]=t},e.prototype.insertAt=function(e,t){this.data.splice(e,0,t)},e.prototype.removeAt=function(e){var t=this.data.splice(e,1);return null==t[0]?0:t[0]},e.prototype.indexOf=function(e,t){if(0!=e)return this.data.indexOf(e,t);for(var n=this.data.indexOf(e,t),r=-1,i=t;i<this.data.length;i++)if(null==this.data[i]){r=i;break}return n<r||-1==r?n:r},e.prototype.print=function(){},e}(u.RefObject);function i(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0}u.RefCollection=o,function(e){function r(e,t){if(u.pxtrt.nullCheck(e),e.isValidIndex(t))return e.removeAt(t)}function i(e,t,n){return u.pxtrt.nullCheck(e),e.indexOf(t,n)}e.mk=function(){return new o},e.length=function(e){return u.pxtrt.nullCheck(e),e.getLength()},e.setLength=function(e,t){u.pxtrt.nullCheck(e),e.setLength(t)},e.push=function(e,t){u.pxtrt.nullCheck(e),u.incr(t),e.push(t)},e.pop=function(e,t){return u.pxtrt.nullCheck(e),e.pop()},e.getAt=function(e,t){u.pxtrt.nullCheck(e);var n=e.getAt(t);return u.incr(n),n},e.removeAt=r,e.insertAt=function(e,t,n){u.pxtrt.nullCheck(e),u.incr(n),e.insertAt(t,n)},e.setAt=function(e,t,n){u.pxtrt.nullCheck(e),e.isValidIndex(t)&&u.decr(e.getAt(t)),u.incr(n),e.setAt(t,n)},e.indexOf=i,e.removeElement=function(e,t){u.pxtrt.nullCheck(e);var n=i(e,t,0);return 0<=n?(r(e,n),1):0}}(u.Array_||(u.Array_={})),(e=u.Math_||(u.Math_={})).imul=function(e,t){return i(e,t)},e.idiv=function(e,t){return e/t>>0},e.round=function(e){return Math.round(e)},e.ceil=function(e){return Math.ceil(e)},e.floor=function(e){return Math.floor(e)},e.sqrt=function(e){return Math.sqrt(e)},e.pow=function(e,t){return u.floatingPoint?Math.pow(e,t):0|Math.pow(e,t)},e.clz32=function(e){return Math.clz32(e)},e.log=function(e){return Math.log(e)},e.log10=function(e){return Math.log10(e)},e.log2=function(e){return Math.log2(e)},e.exp=function(e){return Math.exp(e)},e.sin=function(e){return Math.sin(e)},e.sinh=function(e){return Math.sinh(e)},e.cos=function(e){return Math.cos(e)},e.cosh=function(e){return Math.cosh(e)},e.tan=function(e){return Math.tan(e)},e.tanh=function(e){return Math.tanh(e)},e.asin=function(e){return Math.asin(e)},e.asinh=function(e){return Math.asinh(e)},e.acos=function(e){return Math.acos(e)},e.acosh=function(e){return Math.acosh(e)},e.atan=function(e){return Math.atan(e)},e.atanh=function(e){return Math.atanh(e)},e.atan2=function(e,t){return Math.atan2(e,t)},e.trunc=function(e){return 0<e?Math.floor(e):Math.ceil(e)},e.random=function(){return Math.random()},e.randomRange=function(e,t){if(e==t)return e;if(t<e){var n=e;e=t,t=n}return Math.floor(e)==e&&Math.floor(t)==t?e+Math.floor(Math.random()*(t-e+1)):e+Math.random()*(t-e)},function(e){function n(e,t){return u.pxtrt.nullFix(e)==u.pxtrt.nullFix(t)}e.lt=function(e,t){return e<t},e.le=function(e,t){return e<=t},e.neq=function(e,t){return!n(e,t)},e.eq=n,e.eqDecr=function(e,t){return u.pxtrt.nullFix(e)==u.pxtrt.nullFix(t)&&(u.decr(t),!0)},e.gt=function(e,t){return t<e},e.ge=function(e,t){return t<=e},e.div=function(e,t){return 0|Math.floor(e/t)},e.mod=function(e,t){return e%t},e.bnot=function(e){return~e},e.toString=function(e){return u.initString(e+"")}}(u.Number_||(u.Number_={})),(t=u.thumb||(u.thumb={})).adds=function(e,t){return e+t|0},t.subs=function(e,t){return e-t|0},t.divs=function(e,t){return 0|Math.floor(e/t)},t.muls=function(e,t){return i(e,t)},t.ands=function(e,t){return e&t},t.orrs=function(e,t){return e|t},t.eors=function(e,t){return e^t},t.lsls=function(e,t){return e<<t},t.lsrs=function(e,t){return e>>>t},t.asrs=function(e,t){return e>>t},t.bnot=function(e){return~e},t.ignore=function(e){return e},function(e){function n(e){return e<<16>>16}e.adds=function(e,t){return n(e+t)},e.subs=function(e,t){return n(e-t)},e.divs=function(e,t){return n(Math.floor(e/t))},e.muls=function(e,t){return n(i(e,t))},e.ands=function(e,t){return n(e&t)},e.orrs=function(e,t){return n(e|t)},e.eors=function(e,t){return n(e^t)},e.lsls=function(e,t){return n(e<<t)},e.lsrs=function(e,t){return(65535&e)>>>t},e.asrs=function(e,t){return n(e>>t)},e.bnot=function(e){return~e},e.ignore=function(e){return e}}(u.avr||(u.avr={})),(n=u.String_||(u.String_={})).mkEmpty=function(){return""},n.fromCharCode=function(e){return u.initString(String.fromCharCode(e))},n.toNumber=function(e){return parseInt(e)},n.concat=function(e,t){return u.initString(e+t)},n.substring=function(e,t,n){return u.pxtrt.nullCheck(e),u.initString(e.slice(t,t+n))},n.equals=function(e,t){return e==t},n.compare=function(e,t){return e==t?0:e<t?-1:1},n.compareDecr=function(e,t){return e==t?(u.decr(t),0):e<t?-1:1},n.length=function(e){return e.length},n.isEmpty=function(e){return null==e||0==e.length},n.substr=function(e,t,n){return u.initString(e.substr(t,n))},n.charAt=function(e,t){return u.initString(e.charAt(t))},n.charCodeAt=function(e,t){return u.pxtrt.nullCheck(e),n=e,r=t,u.pxtrt.nullCheck(n),0<=r&&r<n.length?e.charCodeAt(t):0;var n,r},(r=u.Boolean_||(u.Boolean_={})).toString=function(e){return e?"true":"false"},r.bang=function(e){return!e};var f=function(n){function e(e){var t=n.call(this)||this;return t.data=e,t}return __extends(e,n),e.prototype.print=function(){},e}(u.RefObject);u.RefBuffer=f,function(e){var i,t;function c(e){var t=function(e){switch(e){case i.Int8LE:return-1;case i.UInt8LE:return 1;case i.Int16LE:return-2;case i.UInt16LE:return 2;case i.Int32LE:return-4;case i.UInt32LE:return 4;case i.Int8BE:return-10;case i.UInt8BE:return 10;case i.Int16BE:return-20;case i.UInt16BE:return 20;case i.Int32BE:return-40;case i.UInt32BE:return 40;case i.Float32LE:return 4;case i.Float32BE:return 40;case i.Float64LE:return 8;case i.Float64BE:return 80;default:throw u.U.userError("bad format")}}(e),n=!1;t<0&&(n=!0,t=-t);var r=!1;return 10<=t&&(r=!0,t/=10),{size:t,signed:n,swap:r,isFloat:e>=i.Float32LE}}function r(e){return new f(new Uint8Array(e))}function o(e,t){return 0<=t&&t<e.data.length}function a(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=-1),n<0||n>e.data.length||(r<0&&(r=e.data.length),r=Math.min(r,e.data.length-n),e.data.fill(t,n,n+r))}function s(e,t,n,r,i){if(n.buffer===e.buffer)s(e,t,n.slice(r,r+i),0,i);else for(var o=0;o<i;++o)e[t+o]=n[r+o]}(t=i=e.NumberFormat||(e.NumberFormat={}))[t.Int8LE=1]="Int8LE",t[t.UInt8LE=2]="UInt8LE",t[t.Int16LE=3]="Int16LE",t[t.UInt16LE=4]="UInt16LE",t[t.Int32LE=5]="Int32LE",t[t.Int8BE=6]="Int8BE",t[t.UInt8BE=7]="UInt8BE",t[t.Int16BE=8]="Int16BE",t[t.UInt16BE=9]="UInt16BE",t[t.Int32BE=10]="Int32BE",t[t.UInt32LE=11]="UInt32LE",t[t.UInt32BE=12]="UInt32BE",t[t.Float32LE=13]="Float32LE",t[t.Float64LE=14]="Float64LE",t[t.Float32BE=15]="Float32BE",t[t.Float64BE=16]="Float64BE",e.getNumber=function(e,t,n){var r=c(t);if(r.isFloat){var i=e.data.buffer.slice(n,n+r.size);return r.swap&&new Uint8Array(i).reverse(),4==r.size?new Float32Array(i)[0]:new Float64Array(i)[0]}for(var o=0,a=0;a<r.size;++a){o<<=8;var s=r.swap?n+a:n+r.size-a-1;o|=e.data[s]}if(r.signed){var u=32-8*r.size;o=o<<u>>u}else o>>>=0;return o},e.setNumber=function(e,t,n,r){var i=c(t);if(i.isFloat){var o=new Uint8Array(i.size);4==i.size?new Float32Array(o.buffer)[0]=r:new Float64Array(o.buffer)[0]=r,i.swap&&o.reverse();for(var a=0;a<i.size;++a)e.data[n+a]=o[a]}else for(a=0;a<i.size;++a){var s=i.swap?n+i.size-a-1:n+a;e.data[s]=255&r,r>>=8}},e.createBuffer=r,e.createBufferFromHex=function(e){for(var t=r(e.length>>1),n=0;n<e.length;n+=2)t.data[n>>1]=parseInt(e.slice(n,n+2),16);return t},e.getBytes=function(e){return e.data},e.getByte=function(e,t){return o(e,t)?e.data[t]:0},e.setByte=function(e,t,n){o(e,t)&&(e.data[t]=n)},e.length=function(e){return e.data.length},e.fill=a,e.slice=function(e,t,n){return t=Math.min(e.data.length,t),n<0&&(n=e.data.length),n=Math.min(n,e.data.length-t),new f(e.data.slice(t,t+n))},e.toHex=function(e){for(var t="0123456789abcdef",n="",r=0;r<e.data.length;++r)n+=t[e.data[r]>>4],n+=t[15&e.data[r]];return n};var l=-2147483648;e.shift=function(e,t,n,r){r<0&&(r=e.data.length-n),n<0||n+r>e.data.length||n+r<n||0==r||0==t||t==l||0!=r&&0!=t&&t!=l&&(t<=-r||r<=t?a(e,0):t<0?(t=-t,s(e.data,n+t,e.data,n,r-t),e.data.fill(0,n,n+t)):(r-=t,s(e.data,n,e.data,n+t,r),e.data.fill(0,n+r,n+r+t)))},e.rotate=function(e,t,n,r){if(r<0&&(r=e.data.length-n),!(n<0||n+r>e.data.length||n+r<n||0==r||0==t||t==l)){t<0&&(t+=r<<8),(t%=r)<0&&(t+=r);for(var i=e.data,o=t,a=0,s=o,u=r;a!=s;){var c=i[a+n];i[a+++n]=i[s+n],i[s+++n]=c,s==u?s=o:a==o&&(o=s)}}},e.write=function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=-1),i<0&&(i=n.data.length),r<0||t<0||t>e.data.length||(i=Math.min(n.data.length-r,e.data.length-t))<0||s(e.data,t,n.data,r,i)}}(u.BufferMethods||(u.BufferMethods={}))}(pxsim||(pxsim={})),function(e){var t,n;t=e.localization||(e.localization={}),n={},t.setLocalizedStrings=function(e){n=e||{}},t.lf=function(e){return n[e]||e}}(pxsim||(pxsim={})),function(pxsim){var U;function getResume(){return pxsim.runtime.getResume()}!function(e){function t(e){for(;e.firstChild;)e.removeChild(e.firstChild)}e.addClass=function(r,e){r&&e&&0!=e.length&&e.split(" ").forEach(function(e){var t,n;n=e,(t=r).classList?t.classList.add(n):t.className.indexOf(n)<0&&(t.className+=" "+n)})},e.removeClass=function(r,e){r&&e&&0!=e.length&&e.split(" ").forEach(function(e){var t,n;n=e,(t=r).classList?t.classList.remove(n):t.className=t.className.replace(n,"").replace(/\s{2,}/," ")})},e.remove=function(e){e.parentElement.removeChild(e)},e.removeChildren=t,e.clear=function(e){t(e)},e.assert=function(e,t){if(void 0===t&&(t="Assertion failed"),!e)throw new Error(t)},e.repeatMap=function(e,t){e=e||0;for(var n=[],r=0;r<e;++r)n.push(t(r));return n},e.userError=function(e){var t=new Error(e);throw t.isUserError=!0,t},e.now=function(){return Date.now()},e.nextTick=function(e){Promise._async._schedule(e)}}(U=pxsim.U||(pxsim.U={})),pxsim.getResume=getResume;var SERIAL_BUFFER_LENGTH=16,BaseBoard=function(){function e(){this.serialOutBuffer=""}return e.prototype.updateView=function(){},e.prototype.receiveMessage=function(e){},e.prototype.initAsync=function(e){return this.runOptions=e,Promise.resolve()},e.prototype.kill=function(){},e.prototype.writeSerial=function(e){e&&(this.serialOutBuffer+=e,(/\n/.test(this.serialOutBuffer)||this.serialOutBuffer.length>SERIAL_BUFFER_LENGTH)&&(Runtime.postMessage({type:"serial",data:this.serialOutBuffer,id:pxsim.runtime.id,sim:!0}),this.serialOutBuffer=""))},e}();pxsim.BaseBoard=BaseBoard;var CoreBoard=function(t){function e(){var e=t.call(this)||this;return e.id="b"+Math.round(2147483647*Math.random()),e.bus=new pxsim.EventBus(pxsim.runtime),e.updateSubscribers=[],e.updateView=function(){e.updateSubscribers.forEach(function(e){return e()})},e.builtinParts={},e.builtinVisuals={},e.builtinPartVisuals={},e}return __extends(e,t),e.prototype.kill=function(){t.prototype.kill.call(this),pxsim.AudioContextManager.stop()},e}(BaseBoard);pxsim.CoreBoard=CoreBoard;var BareBoard=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(BaseBoard);function initBareRuntime(){pxsim.runtime.board=new BareBoard;var e=pxsim;e.basic={pause:pxsim.thread.pause,showNumber:function(e){var t=getResume();console.log("SHOW NUMBER:",e),U.nextTick(t)}},e.serial={writeString:function(e){return pxsim.runtime.board.writeSerial(e)}},e.pins={createBuffer:pxsim.BufferMethods.createBuffer},e.control={inBackground:pxsim.thread.runInBackground}}pxsim.initBareRuntime=initBareRuntime;var EventQueue=function(){function e(e,t){this.runtime=e,this.valueToArgs=t,this.max=5,this.events=[],this.awaiters=[]}return e.prototype.push=function(e,t){if(0<this.awaiters.length)if(t){var n=this.awaiters.shift();n&&n()}else{var r=this.awaiters.slice();this.awaiters=[],r.forEach(function(e){return e()})}!this.handler||this.events.length>this.max||(this.events.push(e),1!=this.events.length||this.lock||this.poke())},e.prototype.poke=function(){var e=this;this.lock=!0;var t,n=this.events.shift();(t=this.runtime).runFiberAsync.apply(t,[this.handler].concat(this.valueToArgs?this.valueToArgs(n):[n])).done(function(){0<e.events.length?e.poke():e.lock=!1})},Object.defineProperty(e.prototype,"handler",{get:function(){return this._handler},set:function(e){this._handler&&pxsim.pxtcore.decr(this._handler),this._handler=e,this._handler&&pxsim.pxtcore.incr(this._handler)},enumerable:!0,configurable:!0}),e.prototype.addAwaiter=function(e){this.awaiters.push(e)},e}();function _leave(e,t){return e.parent.retval=t,e.finalCallback&&e.finalCallback(t),e.parent}function syntheticRefAction(t){return pxsim.pxtcore.mkAction(0,0,function(e){return _leave(e,t(e))})}pxsim.EventQueue=EventQueue,pxsim.initCurrentRuntime=void 0,pxsim.handleCustomMessage=void 0,pxsim.syntheticRefAction=syntheticRefAction;var Runtime=function(){function Runtime(msg){var _this=this;this.numGlobals=1e3,this.dead=!1,this.running=!1,this.startTime=0,this.globals={},this.loopLock=null,this.loopLockWaitList=[],this.refCountingDebug=!1,this.refCounting=!0,this.refObjId=1,this.liveRefObjs={},this.stringRefCounts={},this.numDisplayUpdates=0,U.assert(!!pxsim.initCurrentRuntime),this.id=msg.id,this.refCountingDebug=!!msg.refCountingDebug;var yieldMaxSteps=100,entryPoint,pxtrt=pxsim.pxtrt,breakpoints=null,breakAlways=!1,globals=this.globals,yieldSteps=yieldMaxSteps,currResume,dbgHeap,dbgResume,breakFrame=null,lastYield=Date.now(),__this=this,tracePauseMs=0;function oops(e){throw new Error("sim error: "+e)}function doNothing(e){return e.pc=-1,leave(e,e.parent.retval)}function flushLoopLock(){for(;0<__this.loopLockWaitList.length&&!__this.loopLock;){__this.loopLockWaitList.shift()()}}function maybeYield(e,t,n){yieldSteps=yieldMaxSteps;var r=Date.now();if(20<=r-lastYield){lastYield=r,e.pc=t,e.r0=n;var i=new Object;__this.loopLock=i;return setTimeout(function(){__this.dead||(U.assert(e.pc==t),U.assert(__this.loopLock===i),__this.loopLock=null,loop(e),flushLoopLock())},5),!0}return!1}function setupDebugger(e){breakpoints=new Uint8Array(e)}function isBreakFrame(e){if(!breakFrame)return!0;for(var t=breakFrame;t;t=t.parent)if(t==e)return!0;return!1}function breakpoint(t,n,e,r){U.assert(!dbgResume),U.assert(!dbgHeap),t.pc=n,t.r0=r;var i=pxsim.getBreakpointMsg(t,e),o=i.msg,a=i.heap;return dbgHeap=a,Runtime.postMessage(o),dbgResume=function(e){if(dbgHeap=dbgResume=null,!__this.dead){switch(pxsim.runtime=__this,U.assert(t.pc==n),breakAlways=!1,breakFrame=null,e.subtype){case"resume":break;case"stepover":breakAlways=!0,breakFrame=t;break;case"stepinto":breakAlways=!0;break;case"stepout":breakAlways=!0,breakFrame=t.parent||t}return loop(t)}},null}function trace(e,t,n,r){setupResume(t,n),"<main>"===r.functionName||"main.ts"===r.fileName?(Runtime.postMessage({type:"debugger",subtype:"trace",breakpointId:e}),pxsim.thread.pause(tracePauseMs)):pxsim.thread.pause(0),checkResumeConsumed()}function handleDebuggerMsg(e){switch(e.subtype){case"config":var t=e;if(t.setBreakpoints){breakpoints.fill(0);for(var n=0,r=t.setBreakpoints;n<r.length;n++){var i=r[n];breakpoints[i]=1}}break;case"traceConfig":tracePauseMs=e.interval;break;case"pause":breakAlways=!0,breakFrame=null;break;case"resume":case"stepover":case"stepinto":case"stepout":dbgResume&&dbgResume(e);break;case"variables":var o=void 0;if(dbgHeap){var a=dbgHeap[e.variablesReference];void 0!==a&&(o=pxsim.dumpHeap(a,dbgHeap))}Runtime.postMessage({type:"debugger",subtype:"variables",req_seq:e.seq,variables:o})}}function loop(t){if(__this.dead)console.log("Runtime terminated");else{U.assert(!__this.loopLock);try{for(pxsim.runtime=__this;t;)__this.currFrame=t,__this.currFrame.overwrittenPC=!1,t=t.fn(t),__this.maybeUpdateDisplay(),__this.currFrame.overwrittenPC&&(t=__this.currFrame)}catch(e){if(__this.errorHandler)__this.errorHandler(e);else{console.error("Simulator crashed, no error handler",e.stack);var n=pxsim.getBreakpointMsg(t,t.lastBrkId).msg;n.exceptionMessage=e.message,n.exceptionStack=e.stack,Runtime.postMessage(n),__this.postError&&__this.postError(e)}}}}function actionCall(e,t){return t&&(e.finalCallback=t),e.depth=e.parent.depth+1,1e3<e.depth&&U.userError("Stack overflow"),e.pc=0,e}var leave=_leave;function setupTop(e){var t=setupTopCore(e);return setupResume(t,0),t}function setupTopCore(e){var t={parent:null,pc:0,depth:0,fn:function(){return e&&e(t.retval),null}};return t}function topCall(e,t){U.assert(!!__this.board),U.assert(!__this.running),__this.setRunning(!0),loop(actionCall({parent:setupTopCore(t),fn:e,depth:0,pc:0}))}function checkResumeConsumed(){currResume&&oops("getResume() not called")}function setupResume(e,t){currResume=buildResume(e,t)}function buildResume(o,a){currResume&&oops("already has resume"),o.pc=a;var s=Date.now(),u=function(e){if(!__this.dead){if(!__this.loopLock){pxsim.runtime=__this;var t=Date.now();if(3<t-s&&(lastYield=t),U.assert(o.pc==a),e instanceof pxsim.FnWrapper){var n=e,r={parent:o,fn:n.func,lambdaArgs:[n.a0,n.a1,n.a2],pc:0,caps:n.caps,depth:o.depth+1,finalCallback:n.cb},i={};return __this.loopLock=i,U.nextTick(function(){U.assert(__this.loopLock===i),__this.loopLock=null,loop(actionCall(r)),flushLoopLock()})}return o.retval=e,loop(o)}__this.loopLockWaitList.push(function(){return u(e)})}};return u}eval(msg.code),this.refCounting=pxsim.refCounting,this.run=function(e){return topCall(entryPoint,e)},this.getResume=function(){currResume||oops("noresume");var e=currResume;return currResume=null,e},this.setupTop=setupTop,this.handleDebuggerMsg=handleDebuggerMsg,this.entry=entryPoint,this.overwriteResume=function(e){currResume=null,0<=e&&(_this.currFrame.pc=e),_this.currFrame.overwrittenPC=!0},pxsim.runtime=this,pxsim.initCurrentRuntime(msg)}return Runtime.prototype.registerLiveObject=function(e){var t=this.refObjId++;return this.refCounting&&(this.liveRefObjs[t+""]=e),t},Runtime.prototype.unregisterLiveObject=function(e,t){t||U.assert(0==e.refcnt,"ref count is not 0"),delete this.liveRefObjs[e.id+""]},Runtime.prototype.runningTime=function(){return U.now()-this.startTime},Runtime.prototype.runFiberAsync=function(n,r,i,o){var a=this;return pxsim.incr(n),new Promise(function(e,t){return U.nextTick(function(){(pxsim.runtime=a).setupTop(e),pxsim.pxtcore.runAction3(n,r,i,o),pxsim.decr(n)})})},Runtime.postMessage=function(e){e&&("undefined"!=typeof window&&window.parent&&window.parent.postMessage&&window.parent.postMessage(e,"*"),Runtime.messagePosted&&Runtime.messagePosted(e))},Runtime.prototype.kill=function(){this.dead=!0,this.setRunning(!1)},Runtime.prototype.updateDisplay=function(){this.board.updateView()},Runtime.prototype.queueDisplayUpdate=function(){this.numDisplayUpdates++},Runtime.prototype.maybeUpdateDisplay=function(){this.numDisplayUpdates&&(this.numDisplayUpdates=0,this.updateDisplay())},Runtime.prototype.setRunning=function(e){this.running!=e&&(this.running=e,this.running?(this.startTime=U.now(),Runtime.postMessage({type:"status",runtimeid:this.id,state:"running"})):Runtime.postMessage({type:"status",runtimeid:this.id,state:"killed"}),this.stateChanged&&this.stateChanged())},Runtime.prototype.dumpLivePointers=function(){var n=this;if(this.refCounting&&this.refCountingDebug){var e=Object.keys(this.liveRefObjs),t=Object.keys(this.stringRefCounts);console.log("Live objects: "+e.length+" objects, "+t.length+" strings"),e.forEach(function(e){return n.liveRefObjs[e].print()}),t.forEach(function(e){var t=n.stringRefCounts[e];console.log("Live String:",JSON.stringify(e),"refcnt=",t)})}},Runtime}();pxsim.Runtime=Runtime}(pxsim||(pxsim={})),function(i){var o,e,n,t;(e=o=i.SimulatorState||(i.SimulatorState={}))[e.Unloaded=0]="Unloaded",e[e.Stopped=1]="Stopped",e[e.Running=2]="Running",e[e.Paused=3]="Paused",(t=n=i.SimulatorDebuggerCommand||(i.SimulatorDebuggerCommand={}))[t.StepInto=0]="StepInto",t[t.StepOver=1]="StepOver",t[t.StepOut=2]="StepOut",t[t.Resume=3]="Resume",t[t.Pause=4]="Pause";var r=function(){function e(e,t){void 0===t&&(t={}),this.container=e,this.options=t,this.themes=["blue","red","green","yellow"],this.runId="",this.nextFrameId=0,this.frameCounter=0,this.traceInterval=0,this.runOptions={},this.state=o.Unloaded,this.frameCleanupTimeout=0,this.debuggerSeq=1,this.debuggerResolvers={}}return e.prototype.setHwDebugger=function(e){e?(this.hwdbg=e,this.setState(o.Running),this.container.style.opacity="0.3"):(delete this.container.style.opacity,this.hwdbg=null,this.setState(o.Running),this.stop())},e.prototype.handleHwDebuggerMsg=function(e){this.hwdbg&&this.handleMessage(e)},e.prototype.setThemes=function(e){i.U.assert(e&&0<e.length),this.themes=e},e.prototype.setState=function(e){this.state!=e&&(this.state=e,this.freeze(this.state==o.Paused),this.options.onStateChanged&&this.options.onStateChanged(this.state))},e.prototype.freeze=function(e){var n="pause-overlay";e?i.util.toArray(this.container.querySelectorAll("div.simframe")).forEach(function(e){if(!e.querySelector("div."+n)){var t=document.createElement("div");t.className=n,t.onclick=function(e){return e.preventDefault(),!1},e.appendChild(t)}}):i.util.toArray(this.container.querySelectorAll("div.simframe div."+n)).forEach(function(e){return e.parentElement.removeChild(e)})},e.prototype.postMessage=function(e,t){if(this.hwdbg)this.hwdbg.postMessage(e);else{var n=this.container.getElementsByTagName("iframe");!t||"eventbus"!==e.type&&"radiopacket"!=e.type&&"irpacket"!=e.type||(n.length<2?(this.container.appendChild(this.createFrame()),n=this.container.getElementsByTagName("iframe")):n[1].dataset.runid!=this.runId&&this.startFrame(n[1]));for(var r=0;r<n.length;++r){var i=n[r];t&&i.contentWindow==t||i.contentWindow.postMessage(e,"*")}}},e.prototype.createFrame=function(e){var t=document.createElement("div");t.className="simframe";var n=document.createElement("iframe");n.id="sim-frame-"+this.nextId(),n.allowFullscreen=!0,n.setAttribute("allow","autoplay"),n.setAttribute("sandbox","allow-same-origin allow-scripts"),n.sandbox.value="allow-scripts allow-same-origin";var r=this.options.simUrl||(window.pxtConfig||{}).simUrl||"/sim/simulator.html";return n.className="no-select",this.runOptions.aspectRatio&&(t.style.paddingBottom=100/this.runOptions.aspectRatio+"%"),n.src=r+"#"+n.id,n.frameBorder="0",n.dataset.runid=this.runId,t.appendChild(n),t},e.prototype.stop=function(e){if(void 0===e&&(e=!1),this.clearDebugger(),this.postMessage({type:"stop"}),this.setState(o.Stopped),e)this.unload();else{for(var t=this.container.getElementsByTagName("iframe"),n=0;n<t.length;++n){var r=t[n];i.U.addClass(r,this.getStoppedClass())}this.scheduleFrameCleanup()}},e.prototype.unload=function(){this.cancelFrameCleanup(),i.U.removeChildren(this.container),this.setState(o.Unloaded)},e.prototype.mute=function(e){this.postMessage({type:"mute",mute:e})},e.prototype.cancelFrameCleanup=function(){this.frameCleanupTimeout&&(clearTimeout(this.frameCleanupTimeout),this.frameCleanupTimeout=0)},e.prototype.scheduleFrameCleanup=function(){var e=this;this.cancelFrameCleanup(),this.frameCleanupTimeout=setTimeout(function(){e.frameCleanupTimeout=0,e.cleanupFrames()},5e3)},e.prototype.applyAspectRatio=function(){for(var e=this.container.getElementsByTagName("iframe"),t=0;t<e.length;++t)e[t].parentElement.style.paddingBottom=100/this.runOptions.aspectRatio+"%"},e.prototype.cleanupFrames=function(){for(var e=this.container.getElementsByTagName("iframe"),t=1;t<e.length;++t){var n=e[t];this.state!=o.Stopped&&n.dataset.runid==this.runId||(this.options.removeElement?this.options.removeElement(n.parentElement):n.parentElement.remove())}},e.prototype.hide=function(e){if(this.options.removeElement){for(var t=this.container.getElementsByTagName("iframe"),n=0;n<t.length;++n){var r=t[n];this.options.removeElement(r.parentElement,e)}0==t.length&&e&&e()}},e.prototype.unhide=function(){if(this.options.unhideElement)for(var e=this.container.getElementsByTagName("iframe"),t=0;t<e.length;++t){var n=e[t];this.options.unhideElement(n.parentElement)}},e.prototype.run=function(e,t){void 0===t&&(t={}),this.clearDebugger(),this.runOptions=t,this.runId=this.nextId(),this.addEventListeners(),this.currentRuntime={type:"run",boardDefinition:t.boardDefinition,parts:t.parts,fnArgs:t.fnArgs,code:e,partDefinitions:t.partDefinitions,mute:t.mute,highContrast:t.highContrast,light:t.light,cdnUrl:t.cdnUrl,localizedStrings:t.localizedStrings,refCountingDebug:t.refCountingDebug,version:t.version},this.applyAspectRatio(),this.scheduleFrameCleanup();var n=this.container.getElementsByTagName("iframe").item(0);if(n)this.startFrame(n);else{var r=this.createFrame(t.light);this.container.appendChild(r),n=r.firstElementChild}this.setState(o.Running),this.setTraceInterval(this.traceInterval)},e.prototype.startFrame=function(e){var t=JSON.parse(JSON.stringify(this.currentRuntime)),n="",r=/player=([A-Za-z0-9]+)/i.exec(window.location.href);r&&(n=r[1]),t.frameCounter=++this.frameCounter,t.options={theme:this.themes[this.nextFrameId++%this.themes.length],player:n},t.id=t.options.theme+"-"+this.nextId(),e.dataset.runid=this.runId,e.contentWindow.postMessage(t,"*"),i.U.removeClass(e,this.getStoppedClass())},e.prototype.removeEventListeners=function(){this.listener&&(window.removeEventListener("message",this.listener,!1),this.listener=void 0)},e.prototype.handleMessage=function(e,t){switch(e.type||""){case"ready":var n=e.frameid,r=document.getElementById(n);r&&(this.startFrame(r),this.options.revealElement&&this.options.revealElement(r));break;case"simulator":this.handleSimulatorCommand(e);break;case"serial":break;case"pxteditor":case"custom":break;case"debugger":this.handleDebuggerMessage(e);break;case"toplevelcodefinished":this.options.onTopLevelCodeEnd&&this.options.onTopLevelCodeEnd();break;default:"radiopacket"==e.type&&(e.rssi=10),this.postMessage(e,t)}},e.prototype.addEventListeners=function(){var t=this;this.listener||(this.listener=function(e){t.hwdbg||t.handleMessage(e.data,e.source)},window.addEventListener("message",this.listener,!1))},e.prototype.resume=function(e){var t;switch(e){case n.Resume:t="resume",this.setState(o.Running);break;case n.StepInto:t="stepinto",this.setState(o.Running);break;case n.StepOut:t="stepout",this.setState(o.Running);break;case n.StepOver:t="stepover",this.setState(o.Running);break;case n.Pause:t="pause";break;default:return void console.debug("unknown command")}this.postMessage({type:"debugger",subtype:t})},e.prototype.setBreakpoints=function(e){this.postDebuggerMessage("config",{setBreakpoints:e})},e.prototype.setTraceInterval=function(e){this.traceInterval=e,this.postDebuggerMessage("traceConfig",{interval:e})},e.prototype.variablesAsync=function(e){return this.postDebuggerMessageAsync("variables",{variablesReference:e}).then(function(e){return e},function(e){})},e.prototype.handleSimulatorCommand=function(e){this.options.onSimulatorCommand&&this.options.onSimulatorCommand(e)},e.prototype.clearDebugger=function(){var t=this,n=new Error("Debugging cancelled");Object.keys(this.debuggerResolvers).forEach(function(e){(0,t.debuggerResolvers[e].reject)(n)}),this.debuggerResolvers={},this.debuggerSeq++},e.prototype.handleDebuggerMessage=function(e){("trace"!==e.subtype&&console.log("DBG-MSG",e.subtype,e),e.seq)&&((n=this.debuggerResolvers[e.seq].resolve)&&n(e));switch(e.subtype){case"warning":this.options.onDebuggerWarning&&this.options.onDebuggerWarning(e);break;case"breakpoint":var t=e;this.state==o.Running?(t.exceptionMessage?this.stop():this.setState(o.Paused),this.options.onDebuggerBreakpoint&&this.options.onDebuggerBreakpoint(t)):console.error("debugger: trying to pause from "+this.state);break;case"trace":this.options.onTraceMessage&&this.options.onTraceMessage(e);break;default:var n,r=e.req_seq;if(r)(n=this.debuggerResolvers[r].resolve)&&(delete this.debuggerResolvers[r],n(e))}},e.prototype.postDebuggerMessageAsync=function(r,i){var o=this;return void 0===i&&(i={}),new Promise(function(e,t){var n=o.debuggerSeq++;o.debuggerResolvers[n.toString()]={resolve:e,reject:t},o.postDebuggerMessage(r,i,n)})},e.prototype.postDebuggerMessage=function(e,t,n){void 0===t&&(t={});var r=JSON.parse(JSON.stringify(t));r.type="debugger",r.subtype=e,n&&(r.seq=n),this.postMessage(r)},e.prototype.nextId=function(){return this.nextFrameId+++(Math.random()+""+Math.random()).replace(/[^\d]/,"")},e.prototype.getStoppedClass=function(){return this.options&&this.options.stoppedClass?this.options.stoppedClass:"grayscale"},e}();i.SimulatorDriver=r}(pxsim||(pxsim={})),function(o){o.mkRange=function(e,t){for(var n=[];e<t;e++)n.push(e);return n};var e=function(){function e(e,t){this.runtime=e,this.valueToArgs=t,this.queues={},this.nextNotifyEvent=1024}return e.prototype.setNotify=function(e,t){this.notifyID=e,this.notifyOneID=t},e.prototype.start=function(e,t,n){var r=e+":"+t,i=this.queues[r];return i||(i=this.queues[r]=new o.EventQueue(this.runtime,this.valueToArgs)),i},e.prototype.listen=function(e,t,n){this.start(e,t,!0).handler=n},e.prototype.queue=function(e,t,n){void 0===n&&(n=null);var r=this.notifyID&&this.notifyOneID&&e==this.notifyOneID;r&&(e=this.notifyID);var i=this.start(e,t,!1);i&&i.push(n,r)},e.prototype.wait=function(e,t,n){this.start(e,t,!0).addAwaiter(n)},e}(),t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(o.EventBusGeneric=e);o.EventBus=t;var n=function(){function e(n){var r=this;this.runtime=n,this.queue=[],this.process=function(){var e=r.queue[0];if(e&&!r.runtime.dead){n=r.runtime;var t=e.frame();n.queueDisplayUpdate(),n.maybeUpdateDisplay(),!1===t?(r.queue.shift(),r.queue[0]&&(r.queue[0].setTimeoutHandle=setTimeout(r.process,r.queue[0].interval)),e.whenDone(!1)):e.setTimeoutHandle=setTimeout(r.process,e.interval)}}}return e.prototype.cancelAll=function(){var e=this.queue;this.queue=[];for(var t=0,n=e;t<n.length;t++){var r=n[t];r.whenDone(!0),r.setTimeoutHandle&&clearTimeout(r.setTimeoutHandle)}},e.prototype.cancelCurrent=function(){var e=this.queue[0];e&&(this.queue.shift(),e.whenDone(!0),e.setTimeoutHandle&&clearTimeout(e.setTimeoutHandle))},e.prototype.enqueue=function(e){e.whenDone||(e.whenDone=function(){}),this.queue.push(e),1==this.queue.length&&this.process()},e.prototype.executeAsync=function(n){var r=this;return o.U.assert(!n.whenDone),new Promise(function(e,t){n.whenDone=e,r.enqueue(n)})},e}();function r(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function i(){return"undefined"!=typeof window&&!!window.PointerEvent}o.AnimationQueue=n,function(e){var t,r,i,o,a=0,s=!1;function u(){return t||(t=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}return}()),t}function n(){i&&(i.gain.value=0),a=0,o&&o.pause()}e.mute=function(e){s=e,n()},e.stop=n,e.frequency=function(){return a},e.tone=function(e,t){if(!(s||e<=0)){a=e;var n=u();if(n){r&&(r.stop(),r.disconnect(),r=void 0),t=Math.max(0,Math.min(1,t));try{r=n.createOscillator(),i=n.createGain(),r.type="triangle",r.connect(i),i.connect(n.destination),i.gain.value=t,r.start(0)}catch(e){return void(i=r=void 0)}r.frequency.value=e,i.gain.value=t}}},e.playBufferAsync=function(r){return r?new Promise(function(e){function t(){e&&e(),e=void 0}var n="data:audio/wav;base64,"+window.btoa(function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n}(r.data));o=new Audio(n),s&&(o.volume=0),o.onended=function(){return t()},o.onpause=function(){return t()},o.onerror=function(){return t()},o.play()}):Promise.resolve()}}(o.AudioContextManager||(o.AudioContextManager={})),o.isTouchEnabled=r,o.hasPointerEvents=i,o.pointerEvents=i()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:r()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"}}(pxsim||(pxsim={})),function(U){!function(t){function o(t,n){return function(e){return e*(n/t)}}function n(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}t.translateEl=function(e,t){U.svg.hydrate(e,{transform:"translate("+t[0]+" "+t[1]+")"})},t.composeSVG=function(e){var t=[e.el1,e.el2],n=t[0],r=t[1];U.U.assert(0==n.x&&0==n.y&&0==r.x&&0==r.y,"el1 and el2 x,y offsets not supported");var i=function(e,t,n){return U.svg.hydrate(e,{x:t,y:n})},o=function(e,t,n){return U.svg.hydrate(e,{width:t+"px",height:n+"px"})},a=e.scaleUnit2,s=e.scaleUnit2/e.scaleUnit1,u=n.w*s,c=n.h*s;o(n.el,u,c);var l=1*r.w,f=1*r.h;o(r.el,l,f);var p=e.margin,d=p[0],h=p[1],g=p[2],m=p[3],v=e.middleMargin,b=Math.max(u,l),y=h+(b-u)/2,x=d;i(n.el,y,x);var w=h+(b-l)/2,k=x+c+v;i(r.el,w,k);var A,E,C,S=[x,x+c,k,k+f],_=h+b+m,T=d+c+v+f+g,I=U.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+_+" "+T,class:"sim-bb"});A=I,E=e.maxWidth,C=e.maxHeight,E&&U.svg.hydrate(A,{width:E}),C&&U.svg.hydrate(A,{height:C}),i(I,0,0);var P=U.svg.child(I,"g");return I.appendChild(n.el),I.appendChild(r.el),{under:P,over:U.svg.child(I,"g"),host:I,edges:S,scaleUnit:a,toHostCoord1:function(e){var t=e[0],n=e[1];return[t*s+y,n*s+x]},toHostCoord2:function(e){var t=e[0],n=e[1];return[1*t+w,1*n+k]}}},t.mkScaleFn=o,t.mkImageSVG=function(e){var t=o(e.imageUnitDist,e.targetUnitDist),n=t(e.width),r=t(e.height),i=U.svg.elt("image",{width:n,height:r});return i.setAttributeNS("http://www.w3.org/1999/xlink","href",""+e.image),{el:i,w:n,h:r,x:0,y:0}},t.findDistSqrd=n,t.findClosestCoordIdx=function(t,e){return e.map(function(e){return n(t,e)}).reduce(function(e,t,n,r){return t<r[e]?n:e},0)},t.mkTxt=function(e,t,n,r,i,o,a){var s=U.svg.elt("text");a=a||.3;var u=(o=o||-.33333)*n*i.length,c=a*n;return U.svg.hydrate(s,{style:"font-size:"+n+"px;",transform:"translate("+e+" "+t+") rotate("+r+") translate("+u+" "+c+")"}),U.svg.addClass(s,"noselect"),s.textContent=i,s},t.GPIO_WIRE_COLORS=["pink","orange","yellow","green","purple"],t.WIRE_COLOR_MAP={black:"#514f4d",white:"#fcfdfc",gray:"#acabab",purple:"#a772a1",blue:"#01a6e8",green:"#3cce73",yellow:"#ece600",orange:"#fdb262",red:"#f44f43",brown:"#c89764",pink:"#ff80fa"},t.mapWireColor=function(e){return t.WIRE_COLOR_MAP[e]||e},t.PIN_DIST=15,t.rgbToHsl=function(e){var t,n,r,i=[e[0]/255,e[1]/255,e[2]/255],o=i[0],a=i[1],s=i[2],u=Math.min(o,a,s),c=Math.max(o,a,s),l=c-u,f=c+u;return r=f/2*100,0===l?n=t=0:(c===o?t=(a-s)/l%6*60:c===a?t=60*((s-o)/l+2):c===s&&(t=60*((o-a)/l+4)),n=50<r?l/(2-f)*100:l/f*100),[Math.floor(t),Math.floor(n),Math.floor(r)]}}(U.visuals||(U.visuals={}))}(pxsim||(pxsim={})),function(s){var a;!function(e){function o(e,t,n){var r={class:e,d:t};n&&(r.title=n);var i=a.elt("path");return a.hydrate(i,r),i}function i(e,t){void 0===t&&(t=!1);var n=a.elt("linearGradient");a.hydrate(n,{id:e,x1:"0%",y1:"0%",x2:t?"100%":"0%",y2:t?"0%":"100%"});a.child(n,"stop",{offset:"0%"}),a.child(n,"stop",{offset:"100%"}),a.child(n,"stop",{offset:"100%"}),a.child(n,"stop",{offset:"100%"});return n}function r(e){var t=a.elt("title");return t.textContent=e,t}e.parseString=function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").getElementsByTagName("svg").item(0)},e.toDataUri=function(e){return"data:image/svg+xml,"+encodeURI(e)},e.cursorPoint=function(e,t,n){return e.x=n.clientX,e.y=n.clientY,e.matrixTransform(t.getScreenCTM().inverse())},e.rotateElement=function(e,t,n,r){e.setAttribute("transform","translate("+t+","+n+") rotate("+(r+90)+") translate("+-t+","+-n+")")},e.hasClass=function(e,t){return e.classList?e.classList.contains(t):-1<e.className.baseVal.indexOf(t)},e.addClass=function(e,t){e.classList?e.classList.add(t):e.className.baseVal.indexOf(t)<0&&(e.className.baseVal+=" "+t)},e.removeClass=function(e,t){e.classList?e.classList.remove(t):e.className.baseVal=e.className.baseVal.replace(t,"").replace(/\s{2,}/," ")},e.hydrate=function(e,t){for(var n in t)"title"==n?a.title(e,t[n]):e.setAttributeNS(null,n,t[n])},e.elt=function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&a.hydrate(n,t),n},e.child=function(e,t,n){var r=a.elt(t,n);return e.appendChild(r),r},e.mkPath=o,e.path=function(e,t,n,r){var i=o(t,n,r);return e.appendChild(i),i},e.fill=function(e,t){e.style.fill=t},e.filter=function(e,t){e.style.filter=t},e.fills=function(e,t){e.forEach(function(e){return e.style.fill=t})},e.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},e.onClick=function(t,n){var r=!1;s.pointerEvents.down.forEach(function(e){return t.addEventListener(e,function(e){return r=!0},!1)}),t.addEventListener(s.pointerEvents.up,function(e){return!r||(r=!1,n(e),e.preventDefault(),!1)},!1)},e.buttonEvents=function(t,n,r,i,o){var a=!1;s.pointerEvents.down.forEach(function(e){return t.addEventListener(e,function(e){return a=!0,r&&r(e),!0},!1)}),t.addEventListener(s.pointerEvents.move,function(e){return!a||(n&&n(e),e.preventDefault(),!1)},!1),t.addEventListener(s.pointerEvents.up,function(e){a=!1,i&&i(e)},!1),t.addEventListener(s.pointerEvents.leave,function(e){a=!1,i&&i(e)},!1),t.addEventListener("keydown",function(e){a=!1,o&&o(e)})},e.mkLinearGradient=i,e.linearGradient=function(e,t,n){void 0===n&&(n=!1);var r=i(t,n);return e.appendChild(r),r},e.setGradientColors=function(e,t,n){e&&(e.childNodes[0].style.stopColor=t,e.childNodes[1].style.stopColor=t,e.childNodes[2].style.stopColor=n,e.childNodes[3].style.stopColor=n)},e.setGradientValue=function(e,t){e.childNodes[1].getAttribute("offset")!=t&&(e.childNodes[1].setAttribute("offset",t),e.childNodes[2].setAttribute("offset",t))},e.animate=function(e,t){a.addClass(e,t);var n=e.parentElement;n&&(n.removeChild(e),n.appendChild(e))},e.mkTitle=r,e.title=function(e,t){var n=r(t);return e.appendChild(n),n},e.toHtmlColor=function(e){return"rgba("+(e>>16&255)+", "+(e>>8&255)+", "+(255&e)+", "+(e>>24&1)+")"}}(a=s.svg||(s.svg={}))}(pxsim||(pxsim={})),function(e){var t=function(e){this.id=e};e.Button=t;var n=function(e){this.props=e,this.usesButtonAB=!1,this.aBtn=new t(this.props.ID_BUTTON_A),this.bBtn=new t(this.props.ID_BUTTON_B),this.abBtn=new t(this.props.ID_BUTTON_AB),this.abBtn.virtual=!0};e.ButtonPairState=n}(pxsim||(pxsim={})),function(e){var t=function(){this.usesHeading=!1,this.heading=90};(pxsim||(pxsim={})).CompassState=t}(),function(e){var t=function(){function e(){this.files={}}return e.prototype.append=function(e,t){this.files[e]=(this.files[e]||"")+t},e.prototype.remove=function(e){delete this.files[e]},e}();e.FileSystemState=t}(pxsim||(pxsim={})),function(e){var t=function(){this.usesLightLevel=!1,this.lightLevel=128};(pxsim||(pxsim={})).LightSensorState=t}(),function(e){var f,t;(t=f=e.NeoPixelMode||(e.NeoPixelMode={}))[t.RGB=0]="RGB",t[t.RGBW=1]="RGBW";var n=function(){function e(){this.buffers={},this.colors={},this.dirty={}}return e.prototype.updateBuffer=function(e,t){this.buffers[t]=e,this.dirty[t]=!0},e.prototype.getColors=function(e,t){var n=this.colors[e]||(this.colors[e]=[]);if(this.dirty[e]){var r=this.buffers[e]||(this.buffers[e]=new Uint8Array([]));this.readNeoPixelBuffer(r,n,t),this.dirty[e]=!1}return n},e.prototype.readNeoPixelBuffer=function(e,t,n){for(var r=e,i=n===f.RGBW?4:3,o=Math.floor(r.length/i),a=0;a<o;a++){var s=r[a*i+1],u=r[a*i+0],c=r[a*i+2],l=0;4===i&&(l=r[a*i+3]),t[a]=[s,u,c,l]}},e}();e.NeoPixelState=n}(pxsim||(pxsim={})),function(d){!function(p){p.mkBoardView=function(e){var t=e.visual;return new p.GenericBoardSvg({visualDef:t,wireframe:e.wireframe})};var e=function(){function e(e,t){var n=this;this.parts=[],this.boardView=e,(this.opts=t).boardDef.pinStyles||(t.boardDef.pinStyles={}),this.state=t.state;var r=t.partsList;if(0<r.length||t.forceBreadboardLayout){this.breadboard=new p.Breadboard({wireframe:t.wireframe});var i=t.boardDef.marginWhenBreadboarding||[0,0,40,0],o=p.composeSVG({el1:this.boardView.getView(),scaleUnit1:this.boardView.getPinDist(),el2:this.breadboard.getSVGAndSize(),scaleUnit2:this.breadboard.getPinDist(),margin:[i[0],i[1],20,i[3]],middleMargin:i[2],maxWidth:t.maxWidth,maxHeight:t.maxHeight}),a=o.under,s=o.over;this.view=o.host;var u=o.edges;this.fromMBCoord=o.toHostCoord1,this.fromBBCoord=o.toHostCoord2;o.scaleUnit;this.partGroup=s,this.partOverGroup=d.svg.child(this.view,"g"),this.style=d.svg.child(this.view,"style",{}),this.defs=d.svg.child(this.view,"defs",{}),this.wireFactory=new p.WireFactory(a,s,u,this.style,this.getLocCoord.bind(this),this.getPinStyle.bind(this));var c=d.allocateDefinitions({boardDef:t.boardDef,partDefs:t.partDefs,fnArgs:t.fnArgs,getBBCoord:this.breadboard.getCoord.bind(this.breadboard),partsList:r});this.addAll(c),c.requiresBreadboard||t.forceBreadboardRender||this.breadboard.hide()}else{var l=this.boardView.getView().el;this.view=l,this.partGroup=d.svg.child(this.view,"g"),this.partOverGroup=d.svg.child(this.view,"g"),t.maxWidth&&d.svg.hydrate(this.view,{width:t.maxWidth}),t.maxHeight&&d.svg.hydrate(this.view,{height:t.maxHeight})}this.state.updateSubscribers.push(function(){return n.updateState()})}return e.prototype.highlightBoardPin=function(e){this.boardView.highlightPin(e)},e.prototype.highlightBreadboardPin=function(e){this.breadboard.highlightLoc(e)},e.prototype.highlightWire=function(e){e.wires.forEach(function(e){d.svg.addClass(e,"highlight"),e.style.visibility="visible"}),d.svg.addClass(e.endG,"highlight")},e.prototype.getView=function(){return this.view},e.prototype.updateState=function(){this.parts.forEach(function(e){return e.updateState()})},e.prototype.getBBCoord=function(e){var t=this.breadboard.getCoord(e);return this.fromBBCoord(t)},e.prototype.getPinCoord=function(e){var t=this.boardView.getCoord(e);return d.U.assert(!!t,"Unable to find coord for pin: "+e),this.fromMBCoord(t)},e.prototype.getLocCoord=function(e){var t;if("breadboard"===e.type){var n=e;t=this.getBBCoord(n)}else{var r=e.pin;t=this.getPinCoord(r)}return t||(console.error("Unknown location: "+name),[0,0])},e.prototype.getPinStyle=function(e){return"breadboard"==e.type?"female":this.opts.boardDef.pinStyles[e.pin]||"female"},e.prototype.addPart=function(e){var t=this,n=null;if(e.simulationBehavior){var r=e.simulationBehavior,i=this.state.builtinVisuals[r],o=this.state.builtinParts[r];(n=i()).init(this.state.bus,o,this.view,e.params)}else{var a=e.visual;n=new p.GenericPart(a)}this.parts.push(n),this.partGroup.appendChild(n.element),n.overElement&&this.partOverGroup.appendChild(n.overElement),n.defs&&n.defs.forEach(function(e){return t.defs.appendChild(e)}),this.style.textContent+=n.style||"";var s=e.startColumnIdx,u=e.startRowIdx,c={type:"breadboard",row:p.getRowName(u),col:p.getColumnName(s),xOffset:e.bbFit.xOffset/e.visual.pinDistance,yOffset:e.bbFit.yOffset/e.visual.pinDistance},l=this.getBBCoord(c);n.moveToCoord(l);var f="sim-"+e.name+"-cmp";return d.svg.addClass(n.element,f),d.svg.addClass(n.element,"sim-cmp"),n.updateTheme(),n.updateState(),n},e.prototype.addWire=function(e){return this.wireFactory.addWire(e.start,e.end,e.color)},e.prototype.addAll=function(e){var r=this;e.partsAndWires.forEach(function(e){var t=e.part;t&&r.addPart(t);var n=e.wires;n&&n.forEach(function(e){return r.addWire(e)})})},e}();p.BoardHost=e}(d.visuals||(d.visuals={}))}(pxsim||(pxsim={})),function(K){!function(P){P.BREADBOARD_MID_ROWS=10,P.BREADBOARD_MID_COLS=30;var U=[4,4],e=P.BREADBOARD_MID_ROWS+U.length,O=[4,9,14,19],t=25+O.length,R=15*(P.BREADBOARD_MID_COLS+3),D=15*(e+4+5.5),L=D*(2/3),B=D*(.5*(1-2/3)),n=15*(P.BREADBOARD_MID_COLS-1),M=(R-n)/2,F=B+(L-15*(e-1))/2,N=15*(t-1),j=(R-N)/2,G=(B-15)/2,W=j,q=G+B+L,r=1.3,i=6,o=2,c=1.3,a="abcdefghij".split("").reverse();function H(e){return""+(e+1)}function V(e){return a[e]}function z(h){for(var g=h.xOffset||0,r=h.yOffset||0,m=[],v=K.svg.elt("g"),b=h.colStartIdx||0,i=h.rowStartIdx||0,o=function(e){return e?e.slice(0,e.length):[]},y=function(e,t){for(var n,r=0;0<=(n=e.indexOf(t));)e.splice(n,1),r+=1;return r},a=0,s=o(h.rowIdxsWithGap),e=function(e){for(var l=0,f=o(h.colIdxsWithGap),p=r+e*h.pinDist+a*h.pinDist,d=e+i,t=function(e){var r=g+e*h.pinDist+l*h.pinDist,t=e+b,n=function(e){var t=r-.5*e.w,n=p-.5*e.h;return K.svg.hydrate(e.el,{x:t,y:n}),v.appendChild(e.el),e.el},i=n(h.mkPin()),o=n(h.mkHoverPin()),a=h.getRowName(d),s=h.getColName(t),u=h.getGroupName?h.getGroupName(d,t):null,c={el:i,hoverEl:o,cx:r,cy:p,row:a,col:s,group:u};m.push(c),l+=y(f,t)},n=0;n<h.colCount;n++)t(n);a+=y(s,d)},t=0;t<h.rowCount;t++)e(t);return{g:v,allPins:m}}function J(){var e=K.svg.elt("rect"),t=i;return K.svg.hydrate(e,{class:"sim-bb-pin",rx:o,ry:o,width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}}function $(){var e=K.svg.elt("rect"),t=i*r;return K.svg.hydrate(e,{class:"sim-bb-pin-hover",rx:o,ry:o,width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}}function Y(e,t,n,r,i,o,a){var s=P.mkTxt(e,t,n,r,i);K.svg.addClass(s,"sim-bb-label"),a&&a.forEach(function(e){return K.svg.addClass(s,e)});var u=P.mkTxt(e,t,n*c,r,i);return K.svg.addClass(u,"sim-bb-label-hover"),a&&a.forEach(function(e){return K.svg.addClass(u,e)}),{el:s,hoverEl:u,txt:i,group:o}}P.getColumnName=H,P.getRowName=V,P.mkGrid=z;var s=function(){function e(e){this.allPins=[],this.allLabels=[],this.allPowerBars=[],this.rowColToPin={},this.rowColToLbls={},this.buildDom(),e.wireframe&&K.svg.addClass(this.bb,"sim-bb-outline")}return e.prototype.hide=function(){this.bb.style.display="none"},e.prototype.updateLocation=function(e,t){K.svg.hydrate(this.bb,{x:e+"px",y:t+"px"})},e.prototype.getPin=function(e,t){var n=this.rowColToPin[e];if(!n)return null;var r=n[t];return r||null},e.prototype.getCoord=function(e){var t=e.row,n=e.col,r=e.xOffset,i=e.yOffset,o=this.getPin(t,n);if(!o)return null;var a=15*(r||0),s=15*(i||0);return[o.cx+a,o.cy+s]},e.prototype.getPinDist=function(){return 15},e.prototype.buildDom=function(){var s=this;this.bb=K.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+R+" "+D,class:"sim-bb",width:R+"px",height:D+"px"}),this.styleEl=K.svg.child(this.bb,"style",{}),this.styleEl.textContent+='\n        /* bread board */\n        .sim-bb-background {\n            fill:#E0E0E0;\n        }\n        .sim-bb-pin {\n            fill:#999;\n        }\n        .sim-bb-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width: 7.5px;\n            stroke: transparent;\n            fill: #777;\n        }\n        .sim-bb-pin-hover:hover {\n            visibility: visible;\n            fill:#444;\n        }\n        .sim-bb-group-wire {\n            stroke: #999;\n            stroke-width: 3.75px;\n            visibility: hidden;\n        }\n        .sim-bb-pin-group {\n            pointer-events: all;\n        }\n        .sim-bb-label,\n        .sim-bb-label-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            fill:#555;\n            pointer-events: all;\n            stroke-width: 0;\n            cursor: default;\n        }\n        .sim-bb-label-hover {\n            visibility: hidden;\n            fill:#000;\n            font-weight: bold;\n        }\n        .sim-bb-bar {\n            stroke-width: 0;\n        }\n        .sim-bb-blue {\n            fill:#1AA5D7;\n            stroke:#1AA5D7\n        }\n        .sim-bb-red {\n            fill:#DD4BA0;\n            stroke:#DD4BA0;\n        }\n        .sim-bb-pin-group:hover .sim-bb-pin-hover,\n        .sim-bb-pin-group:hover .sim-bb-group-wire,\n        .sim-bb-pin-group:hover .sim-bb-label-hover {\n            visibility: visible;\n        }\n        .sim-bb-pin-group:hover .sim-bb-label {\n            visibility: hidden;\n        }\n        /* outline mode */\n        .sim-bb-outline .sim-bb-background {\n            stroke-width: 2.142857142857143px;\n            fill: #FFF;\n            stroke: #000;\n        }\n        .sim-bb-outline .sim-bb-mid-channel {\n            fill: #FFF;\n            stroke: #888;\n            stroke-width: 2px;\n        }\n        /* grayed out */\n        .grayed .sim-bb-background {\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-red,\n        .grayed .sim-bb-blue {\n            fill: #BBB;\n        }\n        .grayed .sim-bb-bar {\n            fill: #FFF;\n        }\n        .grayed .sim-bb-pin {\n            fill: #000;\n            stroke: #FFF;\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-label {\n            fill: none;\n        }\n        .grayed .sim-bb-background {\n            stroke-width: 7.5px;\n            stroke: #555;\n        }\n        .grayed .sim-bb-group-wire {\n            stroke: #DDD;\n        }\n        .grayed .sim-bb-channel {\n            visibility: hidden;\n        }\n        /* highlighted */\n        .sim-bb-label.highlight {\n            visibility: hidden;\n        }\n        .sim-bb-label-hover.highlight {\n            visibility: visible;\n        }\n        .sim-bb-blue.highlight {\n            fill:#1AA5D7;\n        }\n        .sim-bb-red.highlight {\n            fill:#DD4BA0;\n        }\n        .sim-bb-bar.highlight {\n            stroke-width: 0px;\n        }\n        ',this.defs=K.svg.child(this.bb,"defs",{}),K.svg.child(this.bb,"rect",{class:"sim-bb-background",width:R,height:D,rx:4.5,ry:4.5});var i="sim-bb-channel-grad",e=K.svg.elt("linearGradient");K.svg.hydrate(e,{id:i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),this.defs.appendChild(e);K.svg.child(e,"stop",{offset:"0%",style:"stop-color: #AAA;"}),K.svg.child(e,"stop",{offset:"20%",style:"stop-color: #CCC;"}),K.svg.child(e,"stop",{offset:"80%",style:"stop-color: #CCC;"}),K.svg.child(e,"stop",{offset:"100%",style:"stop-color: #AAA;"});var t=function(e,t,n){var r=K.svg.child(s.bb,"rect",{class:"sim-bb-channel "+(n||""),y:e-t/2,width:R,height:t});return r.setAttribute("fill","url(#"+i+")"),r};t(B+L/2,15,"sim-bb-mid-channel"),t(B,.75,"sim-bb-sml-channel"),t(B+L,.75,"sim-bb-sml-channel");var n=function(e,t){return""+(e<P.BREADBOARD_MID_ROWS/2?"b":"t")+H(t)},r=function(e){return 0===e?"-":"+"},o=function(e,t){var n=t<25?"b":"t";return""+r(e)+n},a=z({xOffset:M,yOffset:F,rowCount:P.BREADBOARD_MID_ROWS,colCount:P.BREADBOARD_MID_COLS,pinDist:15,mkPin:J,mkHoverPin:$,getRowName:V,getColName:H,getGroupName:n,rowIdxsWithGap:U});a.g;this.allPins=this.allPins.concat(a.allPins);var u=z({xOffset:W,yOffset:q,rowCount:2,colCount:25,pinDist:15,mkPin:J,mkHoverPin:$,getRowName:r,getColName:H,getGroupName:o,colIdxsWithGap:O});u.g;this.allPins=this.allPins.concat(u.allPins);var c=z({xOffset:j,yOffset:G,rowCount:2,colCount:25,colStartIdx:25,pinDist:15,mkPin:J,mkHoverPin:$,getRowName:r,getColName:H,getGroupName:o,colIdxsWithGap:O.map(function(e){return e+25})});c.g;this.allPins=this.allPins.concat(c.allPins),this.allPins.forEach(function(e){var t=e.el,n=e.row,r=e.col,i=e.hoverEl,o="("+n+","+r+")";K.svg.hydrate(t,{title:o}),K.svg.hydrate(i,{title:o})}),this.allPins.forEach(function(e){var t=s.rowColToPin[e.row];t||(t=s.rowColToPin[e.row]={}),t[e.col]=e});for(var l=function(e,t,n,r,i,o){var a=s.getCoord({type:"breadboard",row:e,col:t});return Y(a[0]+n,a[1]+r,10.5,-90,i,o)},f=0;f<P.BREADBOARD_MID_COLS;f++){var p=H(f),d=l(V(0),p,0,-15,p,n(0,f));this.allLabels.push(d);var h=P.BREADBOARD_MID_ROWS-1,g=l(V(h),p,0,15,p,n(h,f));this.allLabels.push(g)}for(var m=0;m<P.BREADBOARD_MID_ROWS;m++){var v=V(m);d=l(v,H(0),-15,0,v);this.allLabels.push(d);g=l(v,H(P.BREADBOARD_MID_COLS-1),15,0,v);this.allLabels.push(g)}var b=[Y(13.05,B+L+12,30,-90,"-",o(0,0),["sim-bb-blue"]),Y(12,B+L+B-12,25.5,-90,"+",o(1,0),["sim-bb-red"]),Y(R-12+1.05,B+L+12,30,-90,"-",o(0,24),["sim-bb-blue"]),Y(R-12,B+L+B-12,25.5,-90,"+",o(1,24),["sim-bb-red"])];this.allLabels=this.allLabels.concat(b);var y=[Y(13.05,12,30,-90,"-",o(0,25),["sim-bb-blue"]),Y(12,B-12,25.5,-90,"+",o(1,25),["sim-bb-red"]),Y(R-12+1.05,12,30,-90,"-",o(0,49),["sim-bb-blue"]),Y(R-12,B-12,25.5,-90,"+",o(1,49),["sim-bb-red"])];this.allLabels=this.allLabels.concat(y);var x={};this.allLabels.forEach(function(e){e.el;var t=e.txt;(x[t]=x[t]||[]).push(e)});this.allPins.forEach(function(t){var e,n=t.row,r=t.col,i=(t.group,s.rowColToLbls[n]||(s.rowColToLbls[n]={})),o=i[r]||(i[r]=[]);"-"===(e=t).row||"+"===e.row?Number(r)<=25?b.filter(function(e){return e.group==t.group}).forEach(function(e){return o.push(e)}):y.filter(function(e){return e.group==t.group}).forEach(function(e){return o.push(e)}):(x[n].forEach(function(e){return o.push(e)}),x[r].forEach(function(e){return o.push(e)}))});var w=N+22.5,k=(w-N)/2,A=function(e,t,n,r){var i=K.svg.elt("rect");return K.svg.hydrate(i,{class:"sim-bb-bar "+r,x:e,y:t-1.5,width:w,height:3}),{el:i,group:n}},E=[A(W-k,q-9,o(0,49),"sim-bb-blue"),A(W-k,q+15+9,o(1,49),"sim-bb-red"),A(j-k,G-9,o(0,0),"sim-bb-blue"),A(j-k,G+15+9,o(1,0),"sim-bb-red")];this.allPowerBars=this.allPowerBars.concat(E),this.allPowerBars.forEach(function(e){return s.bb.appendChild(e.el)});var C=this.allPins.map(function(e){return e.group}).filter(function(e,t,n){return n.indexOf(e)==t}),S=C.map(function(e){return K.svg.elt("g")});S.forEach(function(e){return K.svg.addClass(e,"sim-bb-pin-group")}),S.forEach(function(e,t){return K.svg.addClass(e,"group-"+C[t])});var _={};C.forEach(function(e,t){return _[e]=S[t]});var T={};this.allPins.forEach(function(e,t){var n=e.group;(T[n]||(T[n]=[])).push(e)}),C.forEach(function(e){var t=T[e],n=[t.map(function(e){return e.cx}),t.map(function(e){return e.cy})],r=n[0],i=n[1],o=function(e){return e.reduce(function(e,t){return e<t?e:t})},a=function(e){return e.reduce(function(e,t){return t<e?e:t})},s=[o(r),a(r),o(i),a(i)],u=s[0],c=s[1],l=s[2],f=s[3],p=K.svg.elt("rect"),d=Math.max(c-u,1e-4),h=Math.max(f-l,1e-4);K.svg.hydrate(p,{x:u,y:l,width:d,height:h}),K.svg.addClass(p,"sim-bb-group-wire"),_[e].appendChild(p)}),this.allPins.forEach(function(e){var t=_[e.group];t.appendChild(e.el),t.appendChild(e.hoverEl)});var I=K.svg.elt("g");K.svg.hydrate(I,{class:"sim-bb-group-misc"}),S.push(I),this.allLabels.forEach(function(e){if(e.group){var t=_[e.group];t.appendChild(e.el),t.appendChild(e.hoverEl)}else I.appendChild(e.el),I.appendChild(e.hoverEl)}),S.forEach(function(e){return s.bb.appendChild(e)})},e.prototype.getSVGAndSize=function(){return{el:this.bb,y:0,x:0,w:R,h:D}},e.prototype.highlightLoc=function(e){var t=e.row,n=e.col,r=this.rowColToPin[t][n];r.cx,r.cy;this.rowColToLbls[t][n].forEach(function(e){K.svg.addClass(e.el,"highlight"),K.svg.addClass(e.hoverEl,"highlight")})},e}();P.Breadboard=s}(K.visuals||(K.visuals={}))}(pxsim||(pxsim={})),function(b){!function(p){p.BOARD_SYTLE="\n        .noselect {\n            -webkit-touch-callout: none; /* iOS Safari */\n            -webkit-user-select: none;   /* Chrome/Safari/Opera */\n            -khtml-user-select: none;    /* Konqueror */\n            -moz-user-select: none;      /* Firefox */\n            -ms-user-select: none;       /* Internet Explorer/Edge */\n            user-select: none;           /* Non-prefixed version, currently\n                                            not supported by any browser */\n        }\n\n        .sim-board-pin {\n            fill:#999;\n            stroke:#000;\n            stroke-width:"+p.PIN_DIST/3+"px;\n        }\n        .sim-board-pin-lbl {\n            fill: #333;\n        }\n        .gray-cover {\n            fill:#FFF;\n            opacity: 0.3;\n            stroke-width:0;\n            visibility: hidden;\n        }\n        .sim-board-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width:"+p.PIN_DIST/6+'px;\n        }\n        .sim-board-pin-hover:hover {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-lbl {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            fill: #555;\n        }\n        .sim-board-pin-lbl-hover {\n            fill: red;\n        }\n        .sim-board-outline .sim-board-pin-lbl-hover {\n            fill: black;\n        }\n        .sim-board-pin-lbl,\n        .sim-board-pin-lbl-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            pointer-events: all;\n            stroke-width: 0;\n        }\n        .sim-board-pin-lbl-hover {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + .sim-board-pin-lbl,\n        .sim-board-pin-lbl.highlight {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + * + .sim-board-pin-lbl-hover,\n        .sim-board-pin-lbl-hover.highlight {\n            visibility: visible;\n        }\n        /* Graying out */\n        .grayed .sim-board-pin-lbl:not(.highlight) {\n            fill: #AAA;\n        }\n        .grayed .sim-board-pin:not(.highlight) {\n            fill:#BBB;\n            stroke:#777;\n        }\n        .grayed .gray-cover {\n            visibility: inherit;\n        }\n        .grayed .sim-cmp:not(.notgrayed) {\n            opacity: 0.3;\n        }\n        /* Highlighting */\n        .sim-board-pin-lbl.highlight {\n            fill: #000;\n            font-weight: bold;\n        }\n        .sim-board-pin.highlight {\n            fill:#999;\n            stroke:#000;\n        }\n        ';var d=.7*p.PIN_DIST,h=1.5*d,g=.66666*p.PIN_DIST,m=.66666*p.PIN_DIST+p.PIN_DIST/3,v=0,e=function(){function e(e){var r=this;this.props=e,this.allPins=[],this.allLabels=[],this.pinNmToLbl={},this.pinNmToPin={},this.id=v++;var i=e.visualDef,t=e.wireframe&&i.outlineImage?i.outlineImage:i.image,n=p.mkImageSVG({image:t,width:i.width,height:i.height,imageUnitDist:i.pinDist,targetUnitDist:p.PIN_DIST}),a=p.mkScaleFn(i.pinDist,p.PIN_DIST);this.width=n.w,this.height=n.h;var o=n.el;this.element=b.svg.elt("svg"),b.svg.hydrate(this.element,{version:"1.0",viewBox:"0 0 "+this.width+" "+this.height,class:"sim sim-board-id-"+this.id,x:"0px",y:"0px"}),e.wireframe&&b.svg.addClass(this.element,"sim-board-outline"),this.style=b.svg.child(this.element,"style",{}),this.style.textContent+=p.BOARD_SYTLE,this.defs=b.svg.child(this.element,"defs",{}),this.g=b.svg.elt("g"),this.element.appendChild(this.g),this.g.appendChild(o),this.background=o,b.svg.hydrate(o,{class:"sim-board"});var s=function(){var e=b.svg.elt("rect"),t=g;return b.svg.hydrate(e,{class:"sim-board-pin",width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}},u=function(){var e=b.svg.elt("rect"),t=m;return b.svg.hydrate(e,{class:"sim-board-pin-hover",width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}},c=i.pinBlocks.map(function(t,e){var n=a(t.x)+p.PIN_DIST/2,r=a(t.y)+p.PIN_DIST/2,i=t.labels.length,o=p.mkGrid({xOffset:n,yOffset:r,rowCount:1,colCount:i,pinDist:p.PIN_DIST,mkPin:s,mkHoverPin:u,getRowName:function(){return""+(e+1)},getColName:function(e){return t.labels[e]},getGroupName:function(){return t.labels.join(" ")}});o.allPins,o.g;return b.svg.addClass(o.g,"sim-board-pin-group"),o}),l=[];c.forEach(function(e,n){return e.allPins.forEach(function(e,t){r.allPins.push(e),l.push(i.pinBlocks[n])})}),this.allPins.forEach(function(e){var t=e.col;b.svg.hydrate(e.el,{title:t}),b.svg.hydrate(e.hoverEl,{title:t})}),this.allPins.forEach(function(e){r.pinNmToPin[e.col]=e});var f=function(e,t,n,r,i){var o,a;"below"===i?(a=e,o=t+12+.25*n*r.length):(a=e,o=t-11-.32*n*r.length);return p.mkTxt(a,o,n,-90,r)};this.allLabels=this.allPins.map(function(e,t){var n=l[t];return function(e,t,n,r){var i=f(e,t,d,n,r);b.svg.addClass(i,"sim-board-pin-lbl");var o=f(e,t,h,n,r);return b.svg.addClass(o,"sim-board-pin-lbl-hover"),{el:i,hoverEl:o,txt:n}}(e.cx,e.cy,e.col,n.labelPosition)}),this.allPins.forEach(function(e,t){var n=r.allLabels[t];r.pinNmToLbl[e.col]=n}),this.allPins.forEach(function(e,t){var n=r.allLabels[t];r.g.appendChild(e.el),r.g.appendChild(e.hoverEl),r.g.appendChild(n.el),r.g.appendChild(n.hoverEl)})}return e.prototype.getCoord=function(e){var t=this.pinNmToPin[e];return t?[t.cx,t.cy]:null},e.prototype.mkGrayCover=function(e,t,n,r){var i=b.svg.elt("rect");return b.svg.hydrate(i,{x:e,y:t,width:n,height:r,class:"gray-cover"}),i},e.prototype.getView=function(){return{el:this.element,w:this.width,h:this.height,x:0,y:0}},e.prototype.getPinDist=function(){return p.PIN_DIST},e.prototype.highlightPin=function(e){var t=this.pinNmToLbl[e],n=this.pinNmToPin[e];t&&n&&(b.svg.addClass(t.el,"highlight"),b.svg.addClass(t.hoverEl,"highlight"),b.svg.addClass(n.el,"highlight"),b.svg.addClass(n.hoverEl,"highlight"))},e}();p.GenericBoardSvg=e}(b.visuals||(b.visuals={}))}(pxsim||(pxsim={})),function(r){!function(t){function n(e){return t.mkImageSVG({image:e.image,width:e.width,height:e.height,imageUnitDist:e.pinDistance,targetUnitDist:t.PIN_DIST})}t.mkGenericPartSVG=n;var e=function(){function e(e){this.style="",this.defs=[];var t=n(e).el;this.element=r.svg.elt("g"),this.element.appendChild(t)}return e.prototype.moveToCoord=function(e){t.translateEl(this.element,e)},e.prototype.init=function(e,t,n){},e.prototype.updateState=function(){},e.prototype.updateTheme=function(){},e}();t.GenericPart=e}(r.visuals||(r.visuals={}))}(pxsim||(pxsim={})),function(B){!function(P){var e,s=P.PIN_DIST/2.5,S=15,_=100;function U(e){return e.replace(/\#/g,"-").replace(/\(/g,"-").replace(/\)/g,"-").replace(/\,/g,"-").replace(/\./g,"-").replace(/\s/g,"")}function O(e,t,n,r){var i=function(e){return e[0]+", "+e[1]},o=e[0],a=e[1],s=t[0],u=t[1],c=u-a,l=[o,a+c*n],f=[s,u-c*n],p=B.svg.mkPath("sim-bb-wire","M"+i(e)+" C"+i(l)+" "+i(f)+" "+i(t));return B.svg.addClass(p,"wire-stroke-"+r),p}function R(e,t,n){var r=function(e){return e[0]+", "+e[1]},i=B.svg.mkPath("sim-bb-wire","M"+r(e)+" L"+r(t));return B.svg.addClass(i,"wire-stroke-"+n),i}function D(e,t){var n=P.PIN_DIST/4,r=B.svg.elt("circle"),i=e[0],o=e[1],a=s/2+n/2;return B.svg.hydrate(r,{cx:i,cy:o,r:a,class:"sim-bb-wire-end"}),B.svg.addClass(r,"wire-fill-"+t),r.style["stroke-width"]=n+"px",r}function T(e,t,n){var r=.24*P.PIN_DIST,i=10*r,o=2*r,a=6*r,s=r,u=P.PIN_DIST/4,c=e[0],l=e[1],f=t?-1:1,p=B.svg.elt("g"),d=B.svg.elt("rect"),h=i,g=o,m=c-g/2,v=l-h/2;B.svg.hydrate(d,{x:m,y:v,width:g,height:h,rx:.5,ry:.5,class:"sim-bb-wire-end"}),d.style["stroke-width"]=u+"px";var b=B.svg.elt("rect"),y=a,x=s,w=c-x/2,k=l+f*(h/2+y/2)-y/2;return B.svg.hydrate(b,{x:w,y:k,width:x,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",p.appendChild(b),p.appendChild(d),{el:p,x:m-u,y:Math.min(v,k),w:g+2*u,h:h+y}}function L(e,t,n){var r=.24*P.PIN_DIST,i=4*r,o=10*r,a=3.5*r,s=3.5*r,u=P.PIN_DIST/4,c=e[0],l=e[1],f=t?-1:1,p=B.svg.elt("g"),d=B.svg.elt("polygon"),h=o,g=i,m=c-g/2,v=l-h/2,b=t?.15:.3,y=t?.7:1-.7,x=t?.3:.15;B.svg.hydrate(d,{points:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.map(function(e){return(t=e)[0]+","+t[1];var t}).join(" ")}([m+g*b,v],[m+g*(1-b),v],[m+g,v+h*y],[m+g*(1-x),v+h],[m+g*x,v+h],[m,v+h*y])}),B.svg.hydrate(d,{rx:.5,ry:.5,class:"sim-bb-wire-end"}),d.style["stroke-width"]=u+"px";var w=B.svg.elt("rect"),k=a,A=s,E=c-A/2,C=l+f*(h/2+k/2)-k/2;return B.svg.hydrate(w,{x:E,y:C,width:A,height:k,class:"sim-bb-wire-bare-end"}),p.appendChild(w),p.appendChild(d),{el:p,x:m-u,y:Math.min(v,C),w:g+2*u,h:h+k}}P.WIRES_CSS="\n        .sim-bb-wire {\n            fill:none;\n            stroke-linecap: round;\n            stroke-width:"+s+"px;\n            pointer-events: none;\n        }\n        .sim-bb-wire-end {\n            stroke:#333;\n            fill:#333;\n        }\n        .sim-bb-wire-bare-end {\n            fill: #ccc;\n        }\n        .sim-bb-wire-hover {\n            stroke-width: "+s+"px;\n            visibility: hidden;\n            stroke-dasharray: "+P.PIN_DIST/10+","+P.PIN_DIST/1.5+";\n            /*stroke-opacity: 0.4;*/\n        }\n        .grayed .sim-bb-wire-ends-g:not(.highlight) .sim-bb-wire-end {\n            stroke: #777;\n            fill: #777;\n        }\n        .grayed .sim-bb-wire:not(.highlight) {\n            stroke: #CCC;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-end {\n            stroke: red;\n            fill: red;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-bare-end {\n            stroke: #FFF;\n            fill: #FFF;\n        }\n        ",(e=P.WireEndStyle||(P.WireEndStyle={}))[e.BBJumper=0]="BBJumper",e[e.OpenJumper=1]="OpenJumper",e[e.Croc=2]="Croc",P.mkWirePart=function(e,t,n){void 0===n&&(n=!1);var r,i=B.svg.elt("g"),o=e[0],a=e[1],s=[o-S,a-_/2],u=[o+S,a+_/2];t=P.mapWireColor(t),r=n?L(s,!0,t):T(s,!0,t);var c,l,f,p,d,h,g,m,v,b,y,x,w=(l=u,f=t,p=function(e){return e[0]+", "+e[1]},d=(c=s)[0],h=c[1],g=l[0],m=l[1],b=[d,h+.8*(v=m-h)],y=[g,m-.8*v],(x=B.svg.mkPath("sim-bb-wire","M"+p(c)+" C"+p(b)+" "+p(y)+" "+p(l))).style.stroke=f,{el:x,x:Math.min(d,g),y:Math.min(h,m),w:Math.abs(d-g),h:Math.abs(h-m)}),k=T(u,!1,t);i.appendChild(w.el),i.appendChild(r.el),i.appendChild(k.el);var A=Math.min(r.x,k.x),E=Math.max(r.x+r.w,k.x+k.w),C=Math.min(r.y,k.y);return{el:i,x:A,y:C,w:E-A,h:Math.max(r.y+r.h,k.y+k.h)-C}};var t=function(){function e(e,t,n,r,i,o){this.nextWireId=0,this.styleEl=r,this.styleEl.textContent+=P.WIRES_CSS,this.underboard=e,this.overboard=t,this.boardEdges=n,this.getLocCoord=i,this.getPinStyle=o}return e.prototype.indexOfMin=function(e){for(var t=0,n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r],t=r);return t},e.prototype.closestEdgeIdx=function(t){var e=this.boardEdges.map(function(e){return Math.abs(t[1]-e)});return this.indexOfMin(e)},e.prototype.closestEdge=function(e){return this.boardEdges[this.closestEdgeIdx(e)]},e.prototype.drawWire=function(e,t,n){var i=this,r=[],o=B.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),a=function(e){var t,n=P.PIN_DIST/2,r=i.closestEdge(e);return t=r-e[1]<0?r-n:r+n,[e[0],t]},s=this.nextWireId++,u=U(n),c=D(e,u),l=D(t,u),f=B.svg.child(o,"g",{class:"sim-bb-wire-ends-g"});f.appendChild(c),f.appendChild(l);var p=this.closestEdgeIdx(e),d=this.closestEdgeIdx(t);if(p==d){var h=R(e,t,u);o.appendChild(h),r.push(h)}else{var g=a(e),m=a(t),v=R(e,g,u),b=R(t,m,u),y=void 0,x=void 0;!(1!=p&&2!=p||1!=d&&2!=d)?(y=O(g,m,.7,u),x=O(g,m,.7,u)):(y=R(g,m,u),x=R(g,m,u)),B.svg.addClass(x,"sim-bb-wire-hover"),o.appendChild(v),r.push(v),o.appendChild(b),r.push(b),this.underboard.appendChild(y),r.push(y),o.appendChild(x),r.push(x);var w="sim-bb-wire-id-"+s,k=function(e){return B.svg.addClass(e,w)};k(f),k(x),this.styleEl.textContent+="\n                    ."+w+":hover ~ ."+w+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}var A="\n                .wire-stroke-"+u+" {\n                    stroke: "+P.mapWireColor(n)+";\n                }\n                .wire-fill-"+u+" {\n                    fill: "+P.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=A,{endG:f,end1:c,end2:l,wires:r}},e.prototype.drawWireWithCrocs=function(e,t,n,r){var i=this;void 0===r&&(r=!1);var o=[],a=B.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),s=this.nextWireId++,u=U(n),c=D(e,u),l=t,f=t[0],p=t[1],d=[f=(t=[f,p+40])[0],(p=t[1])+-17],h=(r?function(e,t,n){var r=.24*P.PIN_DIST,i=4*r,o=1.2*r,a=10*r,s=r,u=P.PIN_DIST/4,c=e[0],l=e[1],f=t?-1:1,p=B.svg.elt("g"),d=B.svg.elt("rect"),h=i,g=o,m=c-g/2,v=l+10-h/2;B.svg.hydrate(d,{x:m,y:v,width:g,height:h,rx:.5,ry:.5,class:"sim-bb-wire-end"}),d.style["stroke-width"]=u+"px";var b=B.svg.elt("rect"),y=a,x=s,w=c-x/2,k=l+10+f*(h/2+y/2)-y/2;return B.svg.hydrate(b,{x:w,y:k,width:x,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",p.appendChild(b),p.appendChild(d),{el:p,x:m-u,y:Math.min(v,k),w:g+2*u,h:h+y}}(d,!0):L(d,!0)).el,g=B.svg.child(a,"g",{class:"sim-bb-wire-ends-g"});g.appendChild(c);var m,v,b,y,x=this.closestEdgeIdx(e),w=this.closestEdgeIdx(l);if(x==w){var k=R(e,t,u);a.appendChild(k),o.push(k)}else{var A=(m=e,b=P.PIN_DIST/2,y=i.closestEdge(m),v=y-m[1]<0?y-b:y+b,[m[0],v]),E=R(e,A,u),C=void 0,S=void 0;!(1!=x&&2!=x||1!=w&&2!=w)?(C=O(A,t,.7,u),S=O(A,t,.7,u)):(C=R(A,t,u),S=R(A,t,u)),B.svg.addClass(S,"sim-bb-wire-hover"),a.appendChild(E),o.push(E),this.underboard.appendChild(C),o.push(C);var _="sim-bb-wire-id-"+s,T=function(e){return B.svg.addClass(e,_)};T(g),T(S),this.styleEl.textContent+="\n                    ."+_+":hover ~ ."+_+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}g.appendChild(h);var I="\n                .wire-stroke-"+u+" {\n                    stroke: "+P.mapWireColor(n)+";\n                }\n                .wire-fill-"+u+" {\n                    fill: "+P.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=I,{endG:g,end1:c,end2:h,wires:o}},e.prototype.addWire=function(e,t,n){var r=this.getLocCoord(e),i=this.getLocCoord(t),o=(this.getPinStyle(e),this.getPinStyle(t));return"dalboard"==t.type&&"croc"==o?this.drawWireWithCrocs(r,i,n):this.drawWire(r,i,n)},e}();P.WireFactory=t}(B.visuals||(B.visuals={}))}(pxsim||(pxsim={}));