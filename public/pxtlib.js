var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();pxt||(pxt={}),function(s){!function(e){function t(){return"undefined"!=typeof mscc&&!mscc.hasConsent()}e.enable=function(){if(s.aiTrackException&&s.aiTrackEvent){s.debug("setting up app insights");var a=s.tickEvent;s.tickEvent=function(e,t,n){if(a&&a(e,t,n),n&&n.interactiveConsent&&"undefined"!=typeof mscc&&!mscc.hasConsent()&&mscc.setConsent(),t){var r={},i={};for(var o in t)"string"==typeof t[o]?r[o]=t[o]:i[o]=t[o];s.aiTrackEvent(e,r,i)}else s.aiTrackEvent(e)};var r=s.reportException;s.reportException=function(e,t){r&&r(e,t);var n={target:s.appTarget.id,version:s.appTarget.versions.target};t&&s.Util.jsonMergeFrom(n,t),s.aiTrackException(e,"exception",n)};var e=s.reportError;s.reportError=function(t,n,r){e&&e(t,n,r);try{throw n}catch(e){var i={target:s.appTarget.id,version:s.appTarget.versions.target,category:t,message:n};r&&s.Util.jsonMergeFrom(i,r),s.aiTrackException(e,"error",i)}}}},e.isCookieBannerVisible=t,e.enableCookies=function(){t()&&mscc.setConsent()}}(s.analytics||(s.analytics={}))}(pxt||(pxt={})),pxt||(pxt={}),(pxt||(pxt={})).tickEvent=function(e){},function(e){(e.pxtc||(e.pxtc={})).__dummy=42}(ts||(ts={}));var pxtc=ts.pxtc;!function(e){var t;(function(f){function t(e){return e.replace(/[^\w .!?\-$]/g,function(e){var t=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-t.length)+t})}f.assert=function(e,t){if(void 0===t&&(t="Assertion failed"),!e)throw new Error(t)},f.flatClone=function(t){if(null==t)return null;var n={};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n},f.clone=function(e){return null==e?null:JSON.parse(JSON.stringify(e))},f.htmlEscape=function(e){return e?e.replace(/([^\w .!?\-$])/g,function(e){return"&#"+e.charCodeAt(0)+";"}):e},f.jsStringQuote=t,f.jsStringLiteral=function(e){return'"'+t(e)+'"'};var n="en",r={},e={};f.localizeLive=!1;var i=function(){function e(){this.translations={}}return e.prototype.key=function(e,t,n){return e+"|"+t+"|"+(n||"")},e.prototype.getAsync=function(e,t,n){return Promise.resolve(this.translations[this.key(e,t,n)])},e.prototype.setAsync=function(e,t,n,r,i){return this.translations[this.key(e,t,n)]={etag:r,strings:i,cached:!0},Promise.resolve()},e}();function o(){return n}function a(e,u){return 0==u.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,n){var r=u[parseInt(t)],i="",o=/^:f(\d*)\.(\d+)/.exec(n);if(o){var a=parseInt(o[2]),s=parseInt(o[1])||0,c=/^0/.test(o[1])?"0":" ",l=r.toFixed(a);if(0<s&&0<a&&(s+=a+1),0<s)for(;l.length<s;)l=c+l;i=l}else i=":x"==n?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==n?/^\s*[euioah]/.test(i.toLowerCase())?i="an "+i:/^\s*[bcdfgjklmnpqrstvwxz]/.test(i.toLowerCase())&&(i="a "+i):":s"==n?i=1==r?"":"s":":q"==n?i=f.htmlEscape(i):":jq"==n?i=f.jsStringQuote(i):":uri"==n?i=encodeURIComponent(i).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==n?i=encodeURI(i).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==n&&(i=(100*r).toFixed(1).toString()+"%"),i})}f.translationDb=new i,f.localeInfo=function(){return(f.localizeLive?"live-":"")+o()},f.userLanguage=o,f.setUserLanguage=function(e){n=e},f.isUserLanguageRtl=function(){return/^ar|dv|fa|ha|he|ks|ku|ps|ur|yi/i.test(n)},f._localize=function(e){return r[e]||e},f.getLocalizedStrings=function(){return r},f.setLocalizedStrings=function(e){r=e},f.translationsCache=function(){return e},f.fmt_va=a,f.fmt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return a(e,t)};var s={};f.dumpLocStats=function(){var t={};Object.keys(s).sort(function(e,t){return s[t]-s[e]}).forEach(function(e){return t[e]=e}),console.log("prioritized list of strings:"),console.log(JSON.stringify(t,null,2))};var c=!0;function l(e,t){s[e]=(s[e]||0)+1;var n=f._localize(e);return!c&&n!=e&&/\d:s\}/.test(n)&&(n=n.replace(/\{\d+:s\}/g,"")),a(n=n.replace(/\{(id|loc):[^\}]+\}/g,""),t)}f.lf_va=l,f.lf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return l(e,t)},f.rlf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return l(e,t)},f.lookup=function(e,t){return e.hasOwnProperty(t)?e[t]:null},f.isoTime=function(e){var t=new Date(1e3*e);return f.fmt("{0}-{1:f02.0}-{2:f02.0} {3:f02.0}:{4:f02.0}:{5:f02.0}",t.getFullYear(),t.getMonth()+1,t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},f.userError=function(e){var t=new Error(e);throw t.isUserError=!0,t}})((t=e.pxtc||(e.pxtc={})).Util||(t.Util={}))}(ts||(ts={}));var ts,pxt,lf=ts.pxtc.Util.lf;!function(e){var t;(t=e.pxtc||(e.pxtc={})).decodeBase64=function(e){return atob(e)},t.encodeBase64=function(e){return btoa(e)}}(ts||(ts={})),function(e){var v;(function(p){function r(e,t){for(var n=0;n<t.length;++n)e.push(t[n])}function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function l(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=n.length-r);for(var o=0;o<i;++o)e[t+o]=n[r+o]}function o(e,t){return e==t?0:e<t?-1:1}function t(n,r){var i={};return function(e){var t=n(e);return i.hasOwnProperty(t)?i[t]:i[t]=r(e)}}function n(e){return e&&(e=e.replace(/\\/g,"/")),e}function a(r){return p.httpRequestCoreAsync(r).then(function(e){if(200!=e.statusCode&&304!=e.statusCode&&!r.allowHttpErrors){var t=p.lf("Bad HTTP status code: {0} at {1}; message: {2}",e.statusCode,r.url,(e.text||"").slice(0,500)),n=new Error(t);return n.statusCode=e.statusCode,Promise.reject(n)}return e.text&&/application\/json/.test(e.headers["content-type"])&&(e.json=JSON.parse(e.text)),e})}function s(e){var t="";if(!e)return t;for(var n=0;n<e.length;++n){var r=e.charCodeAt(n);if(r<=127)t+=e.charAt(n);else if(r<=2047)t+=String.fromCharCode(192|r>>6,128|63&r);else{if(55296<=r&&r<=56319){var i=e.charCodeAt(++n);isNaN(i)||(r=65536+(r-55296<<10)+(i-56320))}t+=r<=65535?String.fromCharCode(224|r>>12,128|r>>6&63,128|63&r):String.fromCharCode(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}}return t}p.bufferSerial=function(e,t,n,r){void 0===t&&(t=""),void 0===n&&(n="?"),void 0===r&&(r=255);for(var i=0;i<t.length;++i){var o=t[i];if(e[n]=(e[n]||"")+o,"\n"===o||e[n].length>r){var a=e[n];e[n]="",window.postMessage({type:"serial",id:n,data:a},"*")}}},p.fileReadAsBufferAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(new Uint8Array(n.result))},n.readAsArrayBuffer(r)}):Promise.resolve(null)},p.fileReadAsTextAsync=function(r){return r?new Promise(function(t,e){var n=new FileReader;n.onerror=function(e){return t(null)},n.onload=function(e){return t(n.result)},n.readAsText(r)}):Promise.resolve(null)},p.repeatMap=function(e,t){e=e||0;for(var n=[],r=0;r<e;++r)n.push(t(r));return n},p.listsEqual=function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},p.oops=function(e){throw void 0===e&&(e="OOPS"),new Error(e)},p.reversed=function(e){return(e=e.slice(0)).reverse(),e},p.iterMap=function(t,n){Object.keys(t).forEach(function(e){return n(e,t[e])})},p.mapMap=function(t,n){var r={};return Object.keys(t).forEach(function(e){return r[e]=n(e,t[e])}),r},p.mapStringMapAsync=function(e,n){var r={};return Promise.all(Object.keys(e).map(function(t){return n(t,e[t]).then(function(e){return r[t]=e})})).then(function(){return r})},p.values=function(t){return Object.keys(t||{}).map(function(e){return t[e]})},p.pushRange=r,p.concat=function(e){for(var t=[],n=0;n<e.length;++n)r(t,e[n]);return t},p.memcpy=l,p.uint8ArrayConcat=function(e){for(var t=0,n=0,r=e;n<r.length;n++)t+=(c=r[n]).length;for(var i=new Uint8Array(t),o=0,a=0,s=e;a<s.length;a++){var c;l(i,o,c=s[a]),o+=c.length}return i},p.jsonMergeFrom=function t(n,r){r&&Object.keys(r).forEach(function(e){i(n[e])&&i(r[e])?t(n[e],r[e]):n[e]=p.clone(r[e])})},p.jsonCopyFrom=function(e,t){for(var n=p.clone(t),r=0,i=Object.keys(t);r<i.length;r++){var o=i[r];e[o]=n[o]}},p.jsonFlatten=function(e){var o={},a=function(e,t){if(null!==t&&"object"==typeof t){p.assert(!Array.isArray(t)),e&&(e+=".");for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];a(e+i,t[i])}}else o[e]=t};return a("",e),o},p.jsonUnFlatten=function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++)for(var i=r[n],o=t,a=i.split("."),s=0;s<a.length;++s){var c=a[s];s==a.length-1?o[c]=e[i]:("object"!=typeof o[c]&&(o[c]={}),o=o[c])}return t},p.strcmp=o,p.stringMapEq=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!t.hasOwnProperty(a))return!1;if(e[a]!==t[a])return!1}return!0},p.endsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(-t.length)!=t)},p.startsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(0,t.length)!=t)},p.contains=function(e,t){return!(e.length<t.length)&&(0==t.length||-1<e.indexOf(t))},p.replaceAll=function(e,t,n){return t?e.split(t).join(n):e},p.sortObjectFields=function(t){var e=Object.keys(t);e.sort(o);var n={};return e.forEach(function(e){return n[e]=t[e]}),n},p.chopArray=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n},p.unique=function(e,n){var r=[],i={};return e.forEach(function(e){var t=n(e);i.hasOwnProperty(t)||(i[t]=null,r.push(e))}),r},p.groupBy=function(e,n){var r={};return e.forEach(function(e){var t=n(e);r.hasOwnProperty(t)||(r[t]=[]),r[t].push(e)}),r},p.toDictionary=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=e}),n},p.toArray=function(e){if(Array.isArray(e))return e;for(var t=[],n=0;n<e.length;++n)t.push(e[n]);return t},p.indexOfMatching=function(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1},p.nextTick=function(e){Promise._async._schedule(e)},p.memoizeString=function(e){return t(function(e){return e},e)},p.memoize=t,p.debounce=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||r.apply(e,t)},i),n&&r.apply(e,t)}},p.throttle=function(r,i,o){var a;return function(){var e=this,t=arguments,n=o&&!a;a||(a=setTimeout(function(){a=null,o||r.apply(e,t)},i)),n&&r.apply(e,t)}},p.randomPermute=function(e){for(var t=0;t<e.length;++t){var n=f()%e.length,r=e[t];e[t]=e[n],e[n]=r}},p.randomPick=function(e){return 0==e.length?null:e[f()%e.length]},p.timeSince=function(e){var t=(Date.now()-(e*=1e3))/1e3;return isNaN(t)?"":t<-30?(t=-t)<60?p.lf("in a few seconds"):t<120?p.lf("in a minute"):t<3600?p.lf("in {0} minute{0:s}",Math.floor(t/60)):t<7200?p.lf("in an hour"):t<86400?p.lf("in {0} hour{0:s}",Math.floor(t/60/60)):t<2592e3?p.lf("in {0} day{0:s}",Math.floor(t/60/60/24)):t<31536e3?p.lf("in {0} month{0:s}",Math.floor(t/60/60/24/30)):p.lf("in {0} year{0:s}",Math.floor(t/60/60/24/365)):t<0?p.lf("now"):t<10?p.lf("a few seconds ago"):t<60?p.lf("{0} second{0:s} ago",Math.floor(t)):t<120?p.lf("a minute ago"):t<3600?p.lf("{0} minute{0:s} ago",Math.floor(t/60)):t<7200?p.lf("an hour ago"):t<86400?p.lf("{0} hour{0:s} ago",Math.floor(t/60/60)):t<2592e3?p.lf("{0} day{0:s} ago",Math.floor(t/60/60/24)):t<31536e3?p.lf("{0} month{0:s} ago",Math.floor(t/60/60/24/30)):p.lf("{0} year{0:s} ago",Math.floor(t/60/60/24/365))},p.unicodeToChar=function(e){return e.replace(/\\u([\d\w]{4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})},p.escapeForRegex=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},p.stripUrlProtocol=function(e){return e.replace(/.*?:\/\//g,"")},p.normalizePath=n,p.pathJoin=function(e,t){if(n(e),n(t),e||t)return e?t?("/"!==e.charAt(e.length-1)&&(e+="/"),"/"==t.charAt(0)&&(t=t.substring(1)),e+t):e:t},p.isNodeJS=!1,p.requestAsync=a,p.httpGetTextAsync=function(e){return a({url:e}).then(function(e){return e.text})},p.httpGetJsonAsync=function(e){return a({url:e}).then(function(e){return e.json})},p.httpPostJsonAsync=function(e,t){return a({url:e,data:t||{}}).then(function(e){return e.json})},p.stringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n},p.uint8ArrayToString=function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n},p.fromUTF8=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e.charCodeAt(n);t+=37==r||127<r?"%"+r.toString(16):e.charAt(n)}return decodeURIComponent(t)},p.toUTF8=s,p.toHex=function(e){for(var t="",n=0;n<e.length;++n)t+=("0"+e[n].toString(16)).slice(-2);return t},p.fromHex=function(e){for(var t=new Uint8Array(e.length>>1),n=0;n<e.length;n+=2)t[n>>1]=parseInt(e.slice(n,n+2),16);return t};var e=function(){function e(){this.promises={}}return e.prototype.enqueue=function(r,i){var o=this;return new Promise(function(e,t){var n=o.promises[r];n||(n=o.promises[r]=[]),n.push(function(){return i().finally(function(){n.shift(),0==n.length?delete o.promises[r]:n[0]()}).then(e,t)}),1==n.length&&n[0]()})},e}();p.PromiseQueue=e;var c=function(){function e(){this.waiting=[],this.available=[]}return e.prototype.drain=function(){for(var e=0,t=this.waiting;e<t.length;e++)(0,t[e])(new Error("Promise Buffer Reset"));this.waiting=[],this.available=[]},e.prototype.pushError=function(e){this.push(e)},e.prototype.push=function(e){var t=this.waiting.shift();t?t(e):this.available.push(e)},e.prototype.shiftAsync=function(e){var i=this;if(void 0===e&&(e=0),0<this.available.length){var t=this.available.shift();return t instanceof Error?Promise.reject(t):Promise.resolve(t)}return new Promise(function(t,n){var r=function(e){e instanceof Error?n(e):t(e)};i.waiting.push(r),0<e&&Promise.delay(e).then(function(){var e=i.waiting.indexOf(r);0<=e&&(i.waiting.splice(e,1),n(new Error("Timeout")))})})},e}();function u(){return Date.now()}function f(){var e=new Uint8Array(4);return p.getRandomBuf(e),new Uint32Array(e.buffer)[0]}function h(n,r,i,o){function t(){var t="https://makecode.com/api/translations?lang="+encodeURIComponent(n)+"&filename="+encodeURIComponent(r)+"&approved=true";i&&(t+="&branch="+encodeURIComponent(i));var e={};return o&&(e["If-None-Match"]=o),a({url:t,headers:e}).then(function(e){if(304!=e.statusCode)return 200==e.statusCode?(o=e.headers.ETag||"",p.translationDb.setAsync(n,r,i,o,e.json).then(function(){return e.json})):e.json},function(e){console.log("failed to load translations from "+t)})}return p.translationDb.getAsync(n,r,i).then(function(e){return e?(o=e.etag,e.cached||t().done(),e.strings):t()})}function d(e){return/^(es|pt|si|sv|zh)/i.test(e)||(e=e.split("-")[0]),e}function g(e){return e=d(e),pxt.appTarget.appTheme&&pxt.appTarget.appTheme.availableLocales&&-1<pxt.appTarget.appTheme.availableLocales.indexOf(e)}function m(e,t,n,r,i,o,a){var s=(r=d(r))+"/"+a+"/"+t;if(p.translationsCache()[s])return Promise.resolve(p.translationsCache()[s]);var c,l=t?[{branch:o,path:e+"/sim-strings.json"}]:[{branch:i,path:"strings.json"},{branch:o,path:e+"/target-strings.json"}];function u(t){t&&(c||(c={}),Object.keys(t).filter(function(e){return!!t[e]}).forEach(function(e){return c[e]=t[e]}))}if(a){var f=0;return Promise.mapSeries(l,function(e){return h(r,e.path,e.branch).then(u,function(e){console.log(e.message),++f})}).then(function(){return f&&(p.translationsCache()[s]=c),f!==l.length&&c?Promise.resolve(c):(pxt.tickEvent("translations.livetranslationsfailed"),m(e,t,n,r,i,o,!1))})}return p.httpGetJsonAsync(n+"locales/"+r+"/strings.json").then(function(e){e&&(c=e,p.translationsCache()[s]=c)},function(e){console.error("failed to load localizations")}).then(function(){return c})}p.PromiseBuffer=c,p.now=u,p.nowSeconds=function(){return Math.round(u()/1e3)},p.getMime=function(e){var t=/\.([a-zA-Z0-9]+)$/.exec(e);if(!t)return"application/octet-stream";switch(t[1].toLowerCase()){case"txt":return"text/plain";case"html":case"htm":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"ico":return"image/x-icon";case"manifest":return"text/cache-manifest";case"webmanifest":return"application/manifest+json";case"json":return"application/json";case"svg":return"image/svg+xml";case"eot":return"application/vnd.ms-fontobject";case"ttf":return"font/ttf";case"woff":return"application/font-woff";case"woff2":return"application/font-woff2";case"md":return"text/markdown";case"xml":return"application/xml";case"m4a":return"audio/m4a";case"mp3":return"audio/mp3";default:return"application/octet-stream"}},p.randomUint32=f,p.guidGen=function(){function e(){return(65536|f()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()},p.downloadLiveTranslationsAsync=h,p.isLocaleEnabled=g,p.updateLocalizationAsync=function(e,t,n,r,i,o,a,s){return(r=d(r))===p.userLanguage()||!g(r)&&!s?Promise.resolve():m(e,t,n,r,i,o,a).then(function(e){return e&&(p.setUserLanguage(r),p.setLocalizedStrings(e),a&&(p.localizeLive=!0)),Promise.resolve()})},p.downloadSimulatorLocalizationAsync=function(e,t,n,r,i,o,a){return(n=d(n))===p.userLanguage()||!g(n)&&!a?Promise.resolve(void 0):m(e,!0,t,n,r,i,o)},p.downloadTranslationsAsync=m,p.capitalize=function(e){return e?e[0].toLocaleUpperCase()+e.slice(1):e},p.uncapitalize=function(e){return(e||"").split(/(?=[A-Z])/g).join(" ").toLowerCase()},p.range=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},p.multipartPostAsync=function(e,r,t,n){void 0===r&&(r={}),void 0===t&&(t=null),void 0===n&&(n=null);var i,o,a,s="--------------------------0461489f461126c5",c="";Object.keys(r).forEach(function(e){return n=r[t=e],c+=s+"\r\n",c+='Content-Disposition: form-data; name="'+t+'"\r\n\r\n',void(c+=n+"\r\n");var t,n}),t&&(o=n,a=(i=t).split("/").reverse()[0],c+=s+"\r\n",c+='Content-Disposition: form-data; name="files['+i+']"; filename="'+a+'"\r\n',c+="\r\n",c+=o+"\r\n"),c+=s+"--\r\n";var l={url:e,method:"POST",headers:{"Content-Type":"multipart/form-data; boundary="+s.slice(2)},data:c};return p.httpRequestCoreAsync(l)},p.toDataUri=function(e,t){return/^https?:/i.test(e)?e:/^data:/i.test(e)?e:(t||/^<svg/i.test(e)&&(t="image/svg+xml"),/xml|svg/.test(t)?"data:"+t+","+encodeURIComponent(e):"data:"+(t||"image/png")+";base64,"+v.encodeBase64(s(e)))}})((v=e.pxtc||(e.pxtc={})).Util||(v.Util={}))}(ts||(ts={})),function(e){var v;(function(e){v.Util.httpRequestCoreAsync=function(c){return new Promise(function(e,t){var r,i=!1,n=v.Util.clone(c.headers)||{};r=new XMLHttpRequest,c.responseArrayBuffer&&(r.responseType="arraybuffer"),r.onreadystatechange=function(){if(!i&&4==r.readyState){i=!0;var n={statusCode:r.status,headers:{},buffer:r.responseBody||r.response,text:c.responseArrayBuffer?void 0:r.responseText};r.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t=/^\s*([^:]+): (.*)/.exec(e);t&&(n.headers[t[1].toLowerCase()]=t[2])}),e(n)}};var o,a=c.data,s=c.method||(null==a?"GET":"POST");null==a?o=null:a instanceof Uint8Array?o=a:"object"==typeof a?(o=JSON.stringify(a),n["content-type"]="application/json; charset=utf8"):"string"==typeof a?o=a:v.Util.oops("bad data"),r.open(s,c.url),Object.keys(n).forEach(function(e){r.setRequestHeader(e,n[e])}),null==o?r.send():r.send(o)})},v.Util.sha256=n,v.Util.getRandomBuf=function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())};var g=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function m(e,t){return e>>>t|e<<32-t}function p(e,t){v.Util.assert(8==e.length),v.Util.assert(64==t.length);for(var n=16;n<64;++n){var r=m(t[n-15],7)^m(t[n-15],18)^t[n-15]>>>3,i=m(t[n-2],17)^m(t[n-2],19)^t[n-2]>>>10;t[n]=t[n-16]+r+t[n-7]+i|0}var o=e[0],a=e[1],s=e[2],c=e[3],l=e[4],u=e[5],f=e[6],p=e[7];for(n=0;n<64;++n){var h=p+(i=m(l,6)^m(l,11)^m(l,25))+(l&u^~l&f)+g[n]+t[n]|0,d=o&a^o&s^a&s;p=f,f=u,u=l,l=c+h|0,c=s,s=a,o=h+((r=m(a=o,2)^m(o,13)^m(o,22))+d|0)|0}e[0]+=o,e[1]+=a,e[2]+=s,e[3]+=c,e[4]+=l,e[5]+=u,e[6]+=f,e[7]+=p}function t(e){var o=new Uint32Array(8);o[0]=1779033703,o[1]=3144134277,o[2]=1013904242,o[3]=2773480762,o[4]=1359893119,o[5]=2600822924,o[6]=528734635,o[7]=1541459225;var a=new Uint32Array(64),s=64;function t(e){for(var t=e.length-(s-1),n=0;n<t;n+=s){for(var r=0;r<16;r++){var i=(r<<2)+n;a[r]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]}p(o,a)}}t(e);var n=64-(e.length+9)%64;64==n&&(n=0);for(var r=e.length-e.length%s,i=new Uint8Array(e.length-r+1+n+8),c=0;r<e.length;)i[c++]=e[r++];for(i[c++]=128;0<n--;)i[c++]=0;var l=8*e.length;for(c=i.length;0<l;)i[--c]=255&l,l>>=8;t(i);for(var u="",f=0;f<o.length;++f)u+=("000000000"+o[f].toString(16)).slice(-8);return u.toLowerCase()}function n(e){return t(v.Util.stringToUint8Array(v.Util.toUTF8(e)))}e.sha256buffer=t,e.sha256string=n})((v=e.pxtc||(e.pxtc={})).BrowserImpl||(v.BrowserImpl={}))}(ts||(ts={})),function(i){var o;i.U=pxtc.Util,i.Util=pxtc.Util,i.setAppTarget=function(e){i.appTarget=e||{};var t=i.appTarget.compile;t||(t=i.appTarget.compile={isNative:!1,hasHex:!1}),t.hasHex&&void 0===t.jsRefCounting&&(t.jsRefCounting=!0),t.hasHex||void 0!==t.floatingPoint||(t.floatingPoint=!0),t.hasHex&&!t.nativeType&&(t.nativeType=pxtc.NATIVE_TYPE_THUMB),t.nativeType!=pxtc.NATIVE_TYPE_AVR&&t.nativeType!=pxtc.NATIVE_TYPE_AVRVM||(t.shortPointers=!0,t.flashCodeAlign=16),t.nativeType==pxtc.NATIVE_TYPE_CS&&(t.floatingPoint=!0,t.needsUnboxing=!0,t.jsRefCounting=!1),t.taggedInts&&(t.floatingPoint=!0,t.needsUnboxing=!0),t.vtableShift||(t.vtableShift=2),t.useUF2||t.useELF||null!=t.noSourceInFlash||(t.noSourceInFlash=!0),i.appTarget.appTheme||(i.appTarget.appTheme={}),i.appTarget.appTheme.embedUrl||(i.appTarget.appTheme.embedUrl=i.appTarget.appTheme.homeUrl);var n=i.appTarget.compileService;n&&n.yottaTarget&&!n.yottaBinary&&(n.yottaBinary="pxt-microbit-app-combined.hex");var r=i.appTarget.appTheme;Object.keys(r).filter(function(e){return/(logo|hero)$/i.test(e)&&/^@cdnUrl@/.test(r[e])}).forEach(function(e){return r[e]=i.BrowserUtils.patchCdn(r[e])}),o=i.U.clone(i.appTarget)},i.setAppTargetVariant=function(e){if(i.appTargetVariant=e,i.appTarget=i.U.clone(o),e){if(i.appTarget.variants){var t=i.appTarget.variants[e];if(t)return void i.U.jsonMergeFrom(i.appTarget,t)}i.U.userError(lf("Variant '{0}' not defined in pxtarget.json",e))}},i.options={},i.debug="undefined"!=typeof console&&console.debug?function(e){i.options.debug&&console.debug(e)}:function(){},i.log="undefined"!=typeof console&&console.log?function(e){console.log(e)}:function(){},i.reportException=function(e,t){if(console&&(console.error(e),t))try{console.log(t)}catch(e){}},i.reportError=function(e,t,n){if(console&&(console.error(e+": "+t),n))try{i.log(JSON.stringify(n,null,2))}catch(e){}};var n={},r=i.Util.debounce(function(){i.tickEvent("activity",n),n={}},1e4,!1);function t(){return{relprefix:"/--",workerjs:"/worker.js",monacoworkerjs:"/monacoworker.js",pxtVersion:"local",pxtRelId:"",pxtCdnUrl:"/cdn/",commitCdnUrl:"/cdn/",blobCdnUrl:"/blb/",cdnUrl:"/cdn/",targetUrl:"",targetVersion:"local",targetRelId:"",targetId:i.appTarget?i.appTarget.id:"",simUrl:"/sim/simulator.html",partsUrl:"/sim/siminstructions.html"}}i.tickActivity=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.filter(function(e){return!!e}).map(function(e){return e.slice(0,64)}).forEach(function(e){return n[e]=(n[e]||0)+1}),r()},i.localWebConfig=t,i.getOnlineCdnUrl=function(){if(!i.webConfig)return null;var e=/^(https:\/\/[^\/]+)/.exec(i.webConfig.commitCdnUrl);return e?e[1]:null},i.setupWebConfig=function(e){e?i.webConfig=e:i.webConfig||(i.webConfig=t())},i.getEmbeddedScript=function(e){return i.U.lookup(i.appTarget.bundledpkgs||{},e)};var e=void 0;function a(){return e||(e=i.Cloud.downloadTargetConfigAsync().then(function(e){return e||{}},function(e){return{}})),e}function s(e){return void 0===e&&(e=null),e||(e=i.appTarget.compile),e.nativeType==ts.pxtc.NATIVE_TYPE_CS?ts.pxtc.BINARY_CS:e.useUF2?ts.pxtc.BINARY_UF2:e.useELF?ts.pxtc.BINARY_ELF:ts.pxtc.BINARY_HEX}i.targetConfigAsync=a,i.packagesConfigAsync=function(){return a().then(function(e){return e?e.packages:void 0})},i.CONFIG_NAME="pxt.json",i.SERIAL_EDITOR_FILE="serial.txt",i.CLOUD_ID="pxt/",i.BLOCKS_PROJECT_NAME="blocksprj",i.JAVASCRIPT_PROJECT_NAME="tsprj",i.outputName=s,i.isOutputText=function(e){return void 0===e&&(e=null),s(e)==ts.pxtc.BINARY_HEX||s(e)==ts.pxtc.BINARY_CS}}(pxt||(pxt={})),function(r){!function(i){var t,m="this";function n(){(t={device_while:{name:r.Util.lf("a loop that repeats while the condition is true"),tooltip:r.Util.lf("Run the same sequence of actions while the condition is met."),url:"/blocks/loops/while",category:"loops",block:{message0:r.Util.lf("while %1"),appendField:r.Util.lf("{id:while}do")}},pxt_controls_for:{name:r.Util.lf("a loop that repeats the number of times you say"),tooltip:r.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:r.Util.lf("for %1 from 0 to %2"),variable:r.Util.lf("{id:var}index"),appendField:r.Util.lf("{id:for}do")}},controls_simple_for:{name:r.Util.lf("a loop that repeats the number of times you say"),tooltip:r.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:r.Util.lf("for %1 from 0 to %2"),variable:r.Util.lf("{id:var}index"),appendField:r.Util.lf("{id:for}do")}},pxt_controls_for_of:{name:r.Util.lf("a loop that repeats for each value in an array"),tooltip:r.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:r.Util.lf("for element %1 of %2"),variable:r.Util.lf("{id:var}value"),appendField:r.Util.lf("{id:for_of}do")}},controls_for_of:{name:r.Util.lf("a loop that repeats for each value in an array"),tooltip:r.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:r.Util.lf("for element %1 of %2"),variable:r.Util.lf("{id:var}value"),appendField:r.Util.lf("{id:for_of}do")}},math_op2:{name:r.Util.lf("minimum or maximum of 2 numbers"),tooltip:{min:r.Util.lf("smaller value of 2 numbers"),max:r.Util.lf("larger value of 2 numbers")},url:"/blocks/math",operators:{op:["min","max"]},category:"math"},math_op3:{name:r.Util.lf("absolute number"),tooltip:r.Util.lf("absolute value of a number"),url:"/reference/math",category:"math",block:{message0:r.Util.lf("absolute of %1")}},math_number:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.appTarget&&r.appTarget.compile&&r.appTarget.compile.floatingPoint?r.Util.lf("a decimal number"):r.Util.lf("an integer number")},math_integer:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.Util.lf("an integer number")},math_whole_number:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.Util.lf("an whole number")},math_number_minmax:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math"},math_arithmetic:{name:r.Util.lf("arithmetic operation"),url:"/blocks/math",tooltip:{ADD:r.Util.lf("Return the sum of the two numbers."),MINUS:r.Util.lf("Return the difference of the two numbers."),MULTIPLY:r.Util.lf("Return the product of the two numbers."),DIVIDE:r.Util.lf("Return the quotient of the two numbers."),POWER:r.Util.lf("Return the first number raised to the power of the second number.")},operators:{OP:["ADD","MINUS","MULTIPLY","DIVIDE","POWER"]},category:"math",block:{MATH_ADDITION_SYMBOL:r.Util.lf("{id:op}+"),MATH_SUBTRACTION_SYMBOL:r.Util.lf("{id:op}-"),MATH_MULTIPLICATION_SYMBOL:r.Util.lf("{id:op}×"),MATH_DIVISION_SYMBOL:r.Util.lf("{id:op}÷"),MATH_POWER_SYMBOL:r.Util.lf("{id:op}**")}},math_modulo:{name:r.Util.lf("division remainder"),tooltip:r.Util.lf("Return the remainder from dividing the two numbers."),url:"/blocks/math",category:"math",block:{MATH_MODULO_TITLE:r.Util.lf("remainder of %1 ÷ %2")}},math_js_op:{name:r.Util.lf("math function"),tooltip:{sin:r.Util.lf("Returns the sine of the argument"),cos:r.Util.lf("Returns the cosine of the argument"),tan:r.Util.lf("Returns the tangent of the argument"),sqrt:r.Util.lf("Returns the square root of the argument"),ceil:r.Util.lf("Returns the lowest integer value greater than or equal to the argument"),floor:r.Util.lf("Returns the highest integer value lesser than or equal to the argument"),atan2:r.Util.lf("Returns the arctangent of the quotient of the two arguments")},url:"/blocks/math",operators:{OP:["sqrt","sin","cos","tan","ceil","floor","atan2"]},category:"math",block:{sin:r.Util.lf("{id:op}sin"),cos:r.Util.lf("{id:op}cos"),tan:r.Util.lf("{id:op}tan"),sqrt:r.Util.lf("{id:op}square root"),ceil:r.Util.lf("{id:op}ceiling"),floor:r.Util.lf("{id:op}floor"),atan2:r.Util.lf("{id:op}atan2")}},variables_change:{name:r.Util.lf("update the value of a number variable"),tooltip:r.Util.lf("Changes the value of the variable by this amount"),url:"/blocks/variables/change",category:"variables",block:{message0:r.Util.lf("change %1 by %2")}},controls_repeat_ext:{name:r.Util.lf("a loop that repeats and increments an index"),tooltip:r.Util.lf("Do some statements several times."),url:"/blocks/loops/repeat",category:"loops",block:{CONTROLS_REPEAT_TITLE:r.Util.lf("repeat %1 times"),CONTROLS_REPEAT_INPUT_DO:r.Util.lf("{id:repeat}do")}},variables_get:{name:r.Util.lf("get the value of a variable"),tooltip:r.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:r.Util.lf("Create 'set %1'")}},variables_get_reporter:{name:r.Util.lf("get the value of a variable"),tooltip:r.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:r.Util.lf("Create 'set %1'")}},variables_set:{name:r.Util.lf("assign the value of a variable"),tooltip:r.Util.lf("Sets this variable to be equal to the input."),url:"/blocks/variables/assign",category:"variables",block:{VARIABLES_SET:r.Util.lf("set %1 to %2")}},controls_if:{name:r.Util.lf("a conditional statement"),tooltip:{CONTROLS_IF_TOOLTIP_1:r.Util.lf("If a value is true, then do some statements."),CONTROLS_IF_TOOLTIP_2:r.Util.lf("If a value is true, then do the first block of statements. Otherwise, do the second block of statements."),CONTROLS_IF_TOOLTIP_3:r.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements."),CONTROLS_IF_TOOLTIP_4:r.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.")},tooltipSearch:"CONTROLS_IF_TOOLTIP_2",url:"/blocks/logic/if",category:"logic",block:{CONTROLS_IF_MSG_IF:r.Util.lf("{id:logic}if"),CONTROLS_IF_MSG_THEN:r.Util.lf("{id:logic}then"),CONTROLS_IF_MSG_ELSE:r.Util.lf("{id:logic}else"),CONTROLS_IF_MSG_ELSEIF:r.Util.lf("{id:logic}else if")}},lists_create_with:{name:r.Util.lf("create an array"),tooltip:r.Util.lf("Creates a new array."),url:"/reference/arrays/create",category:"arrays",blockTextSearch:"LISTS_CREATE_WITH_INPUT_WITH",block:{LISTS_CREATE_EMPTY_TITLE:r.Util.lf("empty array"),LISTS_CREATE_WITH_INPUT_WITH:r.Util.lf("array of"),LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:r.Util.lf("array"),LISTS_CREATE_WITH_ITEM_TITLE:r.Util.lf("value")}},lists_length:{name:r.Util.lf("array length"),tooltip:r.Util.lf("Returns the number of items in an array."),url:"/reference/arrays/length",category:"arrays",block:{LISTS_LENGTH_TITLE:r.Util.lf("length of array %1")}},lists_index_get:{name:r.Util.lf("get a value in an array"),tooltip:r.Util.lf("Returns the value at the given index in an array."),url:"/reference/arrays/get",category:"arrays",block:{message0:r.Util.lf("%1 get value at %2")}},lists_index_set:{name:r.Util.lf("set a value in an array"),tooltip:r.Util.lf("Sets the value at the given index in an array"),url:"/reference/arrays/set",category:"arrays",block:{message0:r.Util.lf("%1 set value at %2 to %3")}},logic_compare:{name:r.Util.lf("comparing two numbers"),tooltip:{LOGIC_COMPARE_TOOLTIP_EQ:r.Util.lf("Return true if both inputs equal each other."),LOGIC_COMPARE_TOOLTIP_NEQ:r.Util.lf("Return true if both inputs are not equal to each other."),LOGIC_COMPARE_TOOLTIP_LT:r.Util.lf("Return true if the first input is smaller than the second input."),LOGIC_COMPARE_TOOLTIP_LTE:r.Util.lf("Return true if the first input is smaller than or equal to the second input."),LOGIC_COMPARE_TOOLTIP_GT:r.Util.lf("Return true if the first input is greater than the second input."),LOGIC_COMPARE_TOOLTIP_GTE:r.Util.lf("Return true if the first input is greater than or equal to the second input.")},url:"/blocks/logic/boolean",category:"logic",block:{search:"= ≠ < ≤ > ≥"}},logic_operation:{name:r.Util.lf("boolean operation"),tooltip:{LOGIC_OPERATION_TOOLTIP_AND:r.Util.lf("Return true if both inputs are true."),LOGIC_OPERATION_TOOLTIP_OR:r.Util.lf("Return true if at least one of the inputs is true.")},url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_OPERATION_AND:r.Util.lf("{id:op}and"),LOGIC_OPERATION_OR:r.Util.lf("{id:op}or")}},logic_negate:{name:r.Util.lf("logical negation"),tooltip:r.Util.lf("Returns true if the input is false. Returns false if the input is true."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_NEGATE_TITLE:r.Util.lf("not %1")}},logic_boolean:{name:r.Util.lf("a `true` or `false` value"),tooltip:r.Util.lf("Returns either true or false."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_BOOLEAN_TRUE:r.Util.lf("{id:boolean}true"),LOGIC_BOOLEAN_FALSE:r.Util.lf("{id:boolean}false")}},text:{name:r.Util.lf("a piece of text"),tooltip:r.Util.lf("A letter, word, or line of text."),url:"types/string",category:"text",block:{search:r.Util.lf("a piece of text")}},text_length:{name:r.Util.lf("number of characters in the string"),tooltip:r.Util.lf("Returns the number of letters (including spaces) in the provided text."),url:"reference/text/length",category:"text",block:{TEXT_LENGTH_TITLE:r.Util.lf("length of %1")}},text_join:{name:r.Util.lf("join items to create text"),tooltip:r.Util.lf("Create a piece of text by joining together any number of items."),url:"reference/text/join",category:"text",block:{TEXT_JOIN_TITLE_CREATEWITH:r.Util.lf("join")}},procedures_defnoreturn:{name:r.Util.lf("define the function"),tooltip:r.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{PROCEDURES_DEFNORETURN_TITLE:r.Util.lf("function"),PROCEDURE_ALREADY_EXISTS:r.Util.lf("A function named '%1' already exists.")}},procedures_callnoreturn:{name:r.Util.lf("call the function"),tooltip:r.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{PROCEDURES_CALLNORETURN_TITLE:r.Util.lf("call function")}}})[pxtc.ON_START_TYPE]={name:r.Util.lf("on start event"),tooltip:r.Util.lf("Run code when the program starts"),url:"/blocks/on-start",category:"loops",block:{message0:r.Util.lf("on start %1 %2")}},t[pxtc.PAUSE_UNTIL_TYPE]={name:r.Util.lf("pause until"),tooltip:r.Util.lf("Pause execution of code until the given boolean expression is true"),url:"/blocks/pause-until",category:"loops",block:{message0:r.Util.lf("pause until %1")}}}i.MATH_FUNCTIONS={unary:["sqrt","sin","cos","tan","ceil","floor"],binary:["atan2"]},i.builtinFunctionInfo={"Math.abs":{blockId:"math_op3",params:["x"]},"Math.min":{blockId:"math_op2",params:["x","y"]},"Math.max":{blockId:"math_op2",params:["x","y"]}},i.normalizeBlock=function(e){if(!e)return e;var t=e.replace(/%\s+/g,"%");return t!=e?(r.log("block has extra spaces: "+e),e):t=t.replace(/\s*\|\s*/g,"|")},i.compileInfo=function(n){var o={parameters:[],actualNameToParam:{},definitionNameToParam:{},handlerArgs:[]},e=(n.kind==ts.pxtc.SymbolKind.Method||n.kind==ts.pxtc.SymbolKind.Property)&&!n.attributes.defaultInstance,a=!!n.attributes._def,s=a?n.attributes._def.parameters.slice(0):void 0,c=a?s.length:n.parameters?n.parameters.length:0,l=i.builtinFunctionInfo[n.qName];a&&n.attributes._expandedDef&&s.push.apply(s,n.attributes._expandedDef.parameters);var u={},f=s?s.filter(function(e){return!e.ref||(u[e.name]=e,!1)}):[];if(e&&a&&s.length){var t=u[m]||s[0],r=t.name;o.thisParameter={actualName:m,definitionName:r,shadowBlockId:t.shadowBlockId,type:n.namespace,fieldEditor:h(r,m),fieldOptions:d(r,m),shadowOptions:g(r,m)}}if(n.parameters){var p=e&&!u[m]?1:0;n.parameters.forEach(function(e,t){var n;if(u[e.name]?n=u[e.name]:p<f.length&&(n=f[p],++p),n||!a){var r=void 0;e.options&&e.options.min&&e.options.max&&(r={min:e.options.min.value,max:e.options.max.value});var i=n?n.name:l?l.params[p++]:e.name;o.parameters.push({actualName:e.name,type:e.type,defaultValue:e.default,definitionName:i,shadowBlockId:n&&n.shadowBlockId,isOptional:!!s&&s.indexOf(n)>=c,fieldEditor:h(i,e.name),fieldOptions:d(i,e.name),shadowOptions:g(i,e.name),range:r})}e.handlerParameters&&e.handlerParameters.forEach(function(t){o.handlerArgs.push({name:t.name,type:t.type,inBlockDef:!!s&&s.some(function(e){return e.ref&&e.name===t.name})})})})}return o.parameters.forEach(function(e){o.actualNameToParam[e.actualName]=e,o.definitionNameToParam[e.definitionName]=e}),o;function h(e,t){return n.attributes.paramFieldEditor&&(n.attributes.paramFieldEditor[e]||n.attributes.paramFieldEditor[t])}function d(e,t){return n.attributes.paramFieldEditorOptions&&(n.attributes.paramFieldEditorOptions[e]||n.attributes.paramFieldEditorOptions[t])}function g(e,t){return n.attributes.paramShadowOptions&&(n.attributes.paramShadowOptions[e]||n.attributes.paramShadowOptions[t])}},i.parseFields=function(e){return e.split("|").map(function(e,t){var n=/([^%]*)\s*%([a-zA-Z0-9_]+)/.exec(e);if(!n)return{n:e,ni:t};var r=n[1];return r&&(r=r.trim()),{n:e,ni:t,pre:r,p:n[2]}})},i.blockDefinitions=function(){return t||n(),t},i.getBlockDefinition=function(e){return t||n(),t[e]}}(r.blocks||(r.blocks={}))}(pxt||(pxt={})),function(U){!function(e){function t(){return"undefined"!=typeof navigator}function n(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)}function f(){return t()&&/mobi/i.test(navigator.userAgent)}function r(){return t()&&/Mac/i.test(navigator.platform)}function u(){return!!navigator&&/Linux/i.test(navigator.platform)}function p(){return t()&&/arm/i.test(navigator.platform)}function h(){return t()&&/Edge/i.test(navigator.userAgent)}function d(){return t()&&/Trident/i.test(navigator.userAgent)}function g(){return!h()&&!d()&&!!navigator&&(/Chrome/i.test(navigator.userAgent)||/Chromium/i.test(navigator.userAgent))}function m(){return!g()&&!h()&&!!navigator&&/(Safari|iPod|iPhone|iPad)/i.test(navigator.userAgent)}function v(){return!m()&&!!navigator&&(/Firefox/i.test(navigator.userAgent)||/Seamonkey/i.test(navigator.userAgent))}function y(){return t()&&/Opera|OPR/i.test(navigator.userAgent)}function b(){return t()&&/Midori/i.test(navigator.userAgent)}function x(){return t()&&/Epiphany/i.test(navigator.userAgent)}function A(){return n()?"windows":r()?"mac":u()&&p()?"rpi":u()?"linux":"unknown"}function k(){return h()?"edge":x()?"epiphany":b()?"midori":y()?"opera":d()?"ie":g()?"chrome":m()?"safari":v()?"firefox":"unknown"}function w(){if(!t())return null;var e=[];return y()&&(e=/(Opera|OPR)\/([0-9\.]+)/i.exec(navigator.userAgent)),x()?e=/Epiphany\/([0-9\.]+)/i.exec(navigator.userAgent):b()?e=/Midori\/([0-9\.]+)/i.exec(navigator.userAgent):m()?(e=/Version\/([0-9\.]+)/i.exec(navigator.userAgent))||(e=/(iPod|iPhone|iPad); CPU .*?OS (\d+)/i.exec(navigator.userAgent)):e=g()?/(Chrome|Chromium)\/([0-9\.]+)/i.exec(navigator.userAgent):h()?/Edge\/([0-9\.]+)/i.exec(navigator.userAgent):d()?/(MSIE |rv:)([0-9\.]+)/i.exec(navigator.userAgent):/(Firefox|Seamonkey)\/([0-9\.]+)/i.exec(navigator.userAgent),e&&0!=e.length?e[e.length-1]:null}e.isIFrame=function(){try{return window&&window.self!==window.top}catch(e){return!0}},e.hasNavigator=t,e.isWindows=n,e.isWindows10=function(){return t()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)&&/Windows NT 10/i.test(navigator.userAgent)},e.isMobile=f,e.isMac=r,e.isLinux=u,e.isARM=p,e.isUwpEdge=function(){return"undefined"!=typeof window&&!!window.Windows},e.isEdge=h,e.isIE=d,e.isChrome=g,e.isSafari=m,e.isFirefox=v,e.isOpera=y,e.isMidori=b,e.isEpiphany=x,e.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},e.hasPointerEvents=function(){return"undefined"!=typeof window&&!!window.PointerEvent},e.hasSaveAs=function(){return h()||d()||v()},e.os=A,e.browser=k,e.browserVersion=w;var i,E=!1;function T(){return f()&&m()&&!/downloadWindowOpen=0/i.test(window.location.href)}function c(e,t,n){var r=T(),i=w(),o=parseInt(i||"0");if(r)n?n.location.href=e:window.open(e,"_self");else if(U.BrowserUtils.isSafari()&&(o<10||0==i.indexOf("10.0")||f())){var a=document.getElementById("downloader");a||(U.debug("injecting downloader iframe"),(a=document.createElement("iframe")).id="downloader",a.style.position="absolute",a.style.right="0",a.style.bottom="0",a.style.zIndex="-1",a.style.width="1px",a.style.height="1px",document.body.appendChild(a)),a.src=e}else if(U.BrowserUtils.isEdge()||U.BrowserUtils.isIE()){var s=atob(e.split(",")[1]),c=U.Util.stringToUint8Array(s),l=new Blob([c],{type:"img/png"});window.navigator.msSaveOrOpenBlob(l,t)}else{var u=window.document.createElement("a");"string"==typeof u.download?(u.href=e,u.download=t,document.body.appendChild(u),u.click(),document.body.removeChild(u)):document.location.href=e}}function l(e,t){var n="data";f()&&m()&&U.appTarget.appTheme.mobileSafariDownloadProtocol&&(n=U.appTarget.appTheme.mobileSafariDownloadProtocol);var r=/downloadProtocol=([a-z0-9:/?]+)/i.exec(window.location.href);return r&&(n=r[1]),n+":"+t+";base64,"+e}function o(e,t,n,r,i){void 0===n&&(n="application/octet-stream"),U.debug("trigger download");var o=window.navigator.msSaveOrOpenBlob&&!U.BrowserUtils.isMobile(),a=l(e,t);try{if(o){var s=new Blob([U.Util.stringToUint8Array(atob(e))],{type:n});window.navigator.msSaveOrOpenBlob(s,t)}else c(a,t,r)}catch(e){i&&i(e),U.debug("saving failed")}return a}function a(e){if(/^https?:\/\//i.test(e))return e;var t=(window.MonacoPaths||{})[e];return t||(U.U.startsWith(e,U.webConfig.commitCdnUrl)?e:U.webConfig.commitCdnUrl+e)}function _(e){return e&&U.getOnlineCdnUrl()?e.replace("@cdnUrl@",U.getOnlineCdnUrl()):e}e.isBrowserSupported=function(){if(!navigator)return!0;if(/bot|crawler|spider|crawling/i.test(navigator.userAgent))return!0;var e=w(),t=parseInt(e||"0"),n=g()&&38<=t,r=v()&&31<=t,i=h(),o=m()&&9<=t,a=y()&&g()&&21<=t,s=d()&&11<=t,c=n||r||i||o||a||s,l=b()||u()&&p()&&x();return c=(c=c&&!l)||/anybrowser=(true|1)/.test(window.location.href),E||(U.log("Browser: "+k()+" "+e+" on "+A()),c||U.tickEvent("browser.unsupported."+navigator.userAgent),E=!0),c},e.devicePixelRatio=function(){return"undefined"!=typeof window&&window.screen?void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?window.screen.systemXDPI/window.screen.logicalXDPI:window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1:1},e.browserDownloadBinText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),o(ts.pxtc.encodeBase64(e),t,n,r,i)},e.browserDownloadText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),o(ts.pxtc.encodeBase64(U.Util.toUTF8(e)),t,n,r,i)},e.isBrowserDownloadInSameWindow=T,e.isBrowserDownloadWithinUserContext=function(){var e=w(),t=parseInt(e||"0");return f()&&m()&&11<=t||/downloadUserContext=1/i.test(window.location.href)},e.browserDownloadDataUri=c,e.browserDownloadUInt8Array=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),o(ts.pxtc.encodeBase64(U.Util.uint8ArrayToString(e)),t,n,r,i)},e.toDownloadDataUri=l,e.browserDownloadBase64=o,e.loadImageAsync=function(n){var r=document.createElement("img");return new Promise(function(e,t){r.onload=function(){return e(r)},r.onerror=function(){return e(void 0)},r.crossOrigin="anonymous",r.src=n})},e.loadStyleAsync=function(e,t){t&&(e="rtl"+e);var r="style-"+e;if(document.getElementById(r))return Promise.resolve();var i=a(e),n=U.Util.toArray(document.head.getElementsByTagName("link")).filter(function(e){return e.getAttribute("href")==i})[0];return n?(n.id||(n.id=r),Promise.resolve()):new Promise(function(e,t){var n=document.createElement("link");n.href=i,n.rel="stylesheet",n.type="text/css",n.id=r,n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){return t(e)}),document.head.appendChild(n)})},e.loadScriptAsync=function(e){var r=a(e);return U.debug("script: loading "+r),new Promise(function(e,t){var n=document.createElement("script");n.type="text/javascript",n.src=r,n.async=!0,n.addEventListener("load",function(){return e()}),n.addEventListener("error",function(e){return t(e)}),document.body.appendChild(n)})},e.loadAjaxAsync=function(r){return new Promise(function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(200==n.status?e(n.responseText):t(n.status))},n.open("GET",r,!0),n.send()})},e.loadBlocklyAsync=function(){if(!i){U.debug("blockly: delay load");var e=U.BrowserUtils.loadStyleAsync("blockly.css",ts.pxtc.Util.isUserLanguageRtl());"undefined"==typeof Blockly&&(e=e.then(function(){return U.BrowserUtils.loadScriptAsync("pxtblockly.js")})),e=e.then(function(){U.debug("blockly: loaded")}),i=e}return i},e.patchCdn=_,e.initTheme=function(){var e=U.appTarget.appTheme;if(e&&e.accentColor){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(".ui.accent { color: "+e.accentColor+"; }\n                .ui.inverted.menu .accent.active.item, .ui.inverted.accent.menu  { background-color: "+e.accentColor+"; }")),document.getElementsByTagName("head")[0].appendChild(t)}if(U.Util.isUserLanguageRtl()){U.debug("rtl layout"),document.body.classList.add("rtl"),document.body.style.direction="rtl";var n=U.Util.toArray(document.head.getElementsByTagName("link")),r=n.filter(function(e){return U.Util.endsWith(e.getAttribute("href"),"semantic.css")})[0];if(r){var i=r.getAttribute("data-rtl");i&&(U.debug("swapping to "+i),r.setAttribute("href",i))}var o=n.filter(function(e){return U.Util.endsWith(e.getAttribute("href"),"blockly.css")})[0];if(o){var a=o.getAttribute("data-rtl");a&&(U.debug("swapping to "+a),o.setAttribute("href",a),o.removeAttribute("data-rtl"))}}var s=U.appTarget.simulator;if(s&&s.boardDefinition&&s.boardDefinition.visual){var c=s.boardDefinition.visual;c.image&&(c.image=_(c.image),c.outlineImage&&(c.outlineImage=_(c.outlineImage)))}Object.keys(U.appTarget.bundledpkgs).forEach(function(e){var t=U.appTarget.bundledpkgs[e],n=JSON.parse(t[U.CONFIG_NAME]);n.icon&&(n.icon=_(n.icon)),t[U.CONFIG_NAME]=JSON.stringify(n,null,4)})},e.changeHash=function(e,t){"#"!=e.charAt(0)&&(e="#"+e),t?window.location.hash=e:window.history.replaceState("","",e)}}(U.BrowserUtils||(U.BrowserUtils={}))}(pxt||(pxt={})),function(e){var t;(t=e.commands||(e.commands={})).deployCoreAsync=void 0,t.browserDownloadAsync=void 0,t.saveOnlyAsync=void 0,t.showUploadInstructionsAsync=void 0,t.saveProjectAsync=void 0}(pxt||(pxt={})),function(i){function e(){var e;return e||(e=i.U.isNodeJS?Promise.resolve(require("lzma")):Promise.resolve(window.LZMA)).then(function(e){return e||i.reportError("lzma","failed to load"),e}),e}i.lzmaDecompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.decompress(r,function(e,t){t&&i.debug("lzma decompression failed"),n(t?void 0:e)})}catch(e){e&&i.debug("lzma decompression failed"),n(void 0)}})})},i.lzmaCompressAsync=function(r){return e().then(function(t){return new Promise(function(n,e){try{t.compress(r,7,function(e,t){t&&i.reportException(t),n(t?void 0:new Uint8Array(e))})}catch(e){i.reportException(e),n(void 0)}})})}}(pxt||(pxt={})),function(Ie){!function(e){var Te,_e,Ue=pxtc.Util,Se=Ue.lf;function Ce(n){void 0===n&&(n="namespace");var r="",i="",e=function(e,t){void 0===t&&(t=""),i!=e&&(i&&(r+="}\n"),e&&(r+=t||n+" "+e+" {\n"),i=e)},t="    ";return{setNs:e,clear:function(){i=r=""},write:function(e){e.trim()?(e=e.trim().replace(/^\s*/gm,t).replace(/^(\s*)\*/gm,function(e,t){return t+" *"}),r+=e+"\n"):r+="\n"},incrIndent:function(){t+="    "},decrIndent:function(){t=t.slice(4)},finish:function(){return e(""),r}}}function Pe(e){if(!e)return null;e=e.trim();var t=/^\((.*)\)/.exec(e);return t&&(e=t[1]),/^-?(\d+|0[xX][0-9a-fA-F]+)$/.test(e)?parseInt(e):null}e.nsWriter=Ce,e.parseCppInt=Pe;var Oe=function(n){function e(e){var t=n.call(this,e)||this;return t.isUserError=!0,t.message=e,t}return __extends(e,n),e}(Error);function l(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e[n];t+=37==r||127<r?"%"+r.toString(16):String.fromCharCode(r)}return decodeURIComponent(t)}function u(e){for(var t="",n=0;n<e.length;n+=2)t=e[n]+e[n+1]+t;return Ie.Util.assert(n==e.length),t}function o(e){var t=[65,20,14,47,184,47,162,187];e:for(var n=0;n<e.length;n+=16)if(e[n]==t[0]){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;var i=e[n+8]|e[n+9]<<8,o=e[n+10]|e[n+11]<<8|e[n+12]<<16|e[n+13]<<24,a=(n+=16)+i+o;if(!(a>e.length)){var s=e.slice(n,n+i),c=e.slice(n+i,a);return{meta:l(s),text:c}}}return null}function t(e){function t(e){return Ie.debug(e),Promise.reject(new Error(e))}var n;if(Ie.HF2.read32(e,0)==ts.pxtc.UF2.UF2_MAGIC_START0){var r=ts.pxtc.UF2.toBin(e);r&&(n=o(r.buf))}(1179403647==Ie.HF2.read32(e,0)&&(n=o(e)),58==e[0])&&(n=function(e){if(e){var r,i=0,o=0,a=0,s=0;if(e.split(/\r?\n/).forEach(function(e){var t=/^:10....0041140E2FB82FA2BB(....)(....)(....)(....)(..)/.exec(e);if(t)i=parseInt(u(t[1]),16),o=parseInt(u(t[2]),16),a=i+o,r=new Uint8Array(a);else if(0<a){if(!(t=/^:10....00(.*)(..)$/.exec(e)))return;for(var n=t[1];0<a&&0<n.length;)r[s++]=parseInt(n[0]+n[1],16),n=n.slice(2),a--}}),r&&0==a&&s==r.length){for(var t=new Uint8Array(i),n=new Uint8Array(o),c=0;c<i;++c)t[c]=r[c];for(c=0;c<o;++c)n[c]=r[i+c];return{meta:l(t),text:n}}}}(l(e)||""));if(!n||!n.meta||!n.text)return t("This .hex file doesn't contain source.");var i=JSON.parse(n.meta);return i?"LZMA"==i.compression?Ie.lzmaDecompressAsync(n.text).then(function(e){if(!e)return null;var t=e.slice(0,i.headerSize||i.metaSize||0),n=e.slice(t.length);return t&&Ie.Util.jsonCopyFrom(i,JSON.parse(t)),{meta:i,source:n}}):i.compression?t("Compression type "+i.compression+" not supported."):Promise.resolve({source:l(n.text)}):t("This .hex file is not valid.")}e.PkgConflictError=Oe,e.getExtensionInfo=function(e){for(var t={},n="dal.d.ts",r="/source/",i=0,o=e.sortedDeps();i<o.length;i++)(ie=o[i]).addSnapshot(t,[n,".h",".cpp"]);if(_e&&Ue.stringMapEq(t,_e))return Ie.debug("Using cached extinfo"),Te;Ie.debug("Generating new extinfo");var k=pxtc.emptyExtInfo(),a=Ie.appTarget.compileService;a||(a={gittag:"none",serviceId:"nocompile"}),a=Ue.clone(a);var s=Ie.appTarget.compile;s||(s={isNative:!1,hasHex:!1});var c=s.nativeType==pxtc.NATIVE_TYPE_CS,l=!!a.platformioIni,u="codal"==a.buildEngine,f="dockermake"==a.buildEngine,w=!(c||l||u||f);l?r="/src/":(u||f)&&(r="/pxtapp/");var p="// Configuration defines\n",E="\nPXT_SHIMS_BEGIN\n",T="",h='#include "pxt.h"\n',d="",g="",_=function(e){return g+="   "+m+"("+U+"): "+e+"\n"},U=0,m="",S=Ce("namespace"),C=Ce("declare namespace"),P=Ce("declare namespace"),v="",O={},y={true:"1",false:"0",null:"0",NULL:"0"};function I(e){return e.trim().replace(/[\_\*]$/,"")}for(var b="",x=0,A=e.sortedDeps();x<A.length;x++){if(0<=(ie=A[x]).getFiles().indexOf(n)){var N=ie.host().readFile(ie,n);Ie.Util.assert(!!N,n+" not found in "+ie.id),N.split(/\r?\n/).forEach(function(e){var t=/^\s*(\w+) = (.*),/.exec(e);t&&(y[t[1]]=t[2])})}!b&&0<=ie.getFiles().indexOf("Makefile")&&(b=ie.host().readFile(ie,"Makefile"))}function F(e){return e.replace(/\/\/.*/,"").replace(/\/\*/,"")}var L=0,M=!1,R="",D="",B="",j=!1,G="";function H(e){return M?(G+=e+"\n",!0):/^\s*\/\*\*/.test(e)?(j=!0,D=e+"\n",/\*\//.test(e)&&(j=!1),G+="//\n",!0):j?(D+=e+"\n",/\*\//.test(e)&&(j=!1),G+="//\n",!0):/^\s*\/\/%/.test(e)?(B+=e+"\n",G+="//\n",!0):(G+=e+"\n",!1)}function z(e,t){M=!0,L=-1,P.write(""),P.write(""),(B||D)&&(P.write(D),P.write(B),D=B=""),P.write("declare const enum "+I(e)+" "+t),O[e]=!0}function J(e){var t=F(e);if(M&&0<=t.indexOf("}")&&(M=!1,P.write("}")),M){var n=/^\s*(\w+)\s*(=\s*(.*?))?,?\s*$/.exec(t);if(n){var r=n[1],i=n[3],o="";if(i){i=i.trim();var a=Ue.lookup(y,i);null!=a&&(o="  // "+i,i=a),null==(L=Pe(i))&&_("cannot determine value of "+t)}else i=++L+"";P.write("    "+I(r)+" = "+i+","+o)}else P.write(e)}}function $(){C.setNs(""),C.write(""),C.write(""),(B||D)&&(C.write(D),C.write(B),D=B="")}function V(e,t){t=t.trim();var n=/(.*)=\s*(-?\w+)$/.exec(t),r="",i="";if(n&&(r=n[2],i="?",t=n[1].trim()),!(n=/^(.*?)(\w+)$/.exec(t)))return _("invalid argument: "+t),{name:"???",type:"int"};var o=n[2];e.paramDefl[o]&&(r=e.paramDefl[o],i="?");var a=r?Ue.lookup(y,r):null;return null!=a&&(r=a),r&&(null==Pe(r)&&_("Invalid default value (non-integer): "+r),B+=" "+o+".defl="+r),{name:o+i,type:n[1]}}function W(e,m){var v;B=D=R="",j=!1;var y=-1;function b(){var e=R.replace(/Methods$/,"");return e==R?null:e}function x(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int32_t":case"int":return"int32";case"uint32_t":case"unsigned":return"uint32";case"TNumber":case"float":case"double":return"number";case"uint16_t":return"uint16";case"int16_t":case"short":return"int16";case"uint8_t":case"byte":return"uint8";case"int8_t":case"sbyte":return"int8";case"bool":return s.shortPointers&&_("use 'boolean' not 'bool' on 8 bit targets"),"boolean";case"StringData*":case"String":case"ImageLiteral_":case"ImageLiteral":return"string";case"Action":return"() => void";case"TValue":return"any";default:return I(e)}}function A(e){switch(e=e.replace(/\s+/g,"")){case"int32_t":case"uint32_t":case"unsigned":case"uint16_t":case"int16_t":case"short":case"uint8_t":case"byte":case"int8_t":case"sbyte":case"int":return"I";case"void":return"V";case"float":return"F";case"TNumber":return"N";case"TValue":return"T";case"bool":return"B";case"double":return"D";case"ImageLiteral_":return"T";default:return Ue.lookup(O,e)?"I":"_"}}return e=e.replace(/^\s*#\s*if\s+0\s*$[^]*?^\s*#\s*endif\s*$/gm,function(e){return e.replace(/[^\n]/g,"")}),G="",M=!1,L=U=0,P.setNs(""),C.setNs(""),e.split(/\r?\n/).forEach(function(e){++U;var t=F(e);J(e);var n=/^\s*enum\s+(|class\s+|struct\s+)(\w+)\s*({|$)/.exec(t);if(n&&(z(n[2],n[3]),m||(S.setNs(R),S.write("enum "+n[2]+" : int;"))),!H(e)){/^typedef.*;\s*$/.test(e)&&(S.setNs(R),S.write(e));var r=/^\s*namespace\s+(\w+)/.exec(e);if(!r){if((r=/^PXT_ABI\((\w+)\)/.exec(e))&&(E+="PXT_FNPTR(::"+r[1]+"),\n",T+='extern "C" void '+r[1]+"();\n",k.functions.push({name:r[1],argsFmt:"",value:0})),(r=/^#define\s+PXT_COMM_BASE\s+([0-9a-fx]+)/.exec(e))&&(k.commBase=parseInt(r[1])),r=/^\s*(\w+)([\*\&]*\s+[\*\&]*)(\w+)\s*\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),B&&r){v=null;var i=pxtc.parseCommentString(B);R||_("missing namespace declaration");var o=(r[1]+r[2]).replace(/\s+/g,""),a=r[3],s=r[4];B=B.trim().replace(/ \w+\.defl=\w+/g,"");var c=A(o),l=s.split(/,/).filter(function(e){return!!e}).map(function(e){var t=V(i,e);return c+=A(t.type),t.name+": "+x(t.type)}),u=(l.length,{name:R+"::"+a,argsFmt:c,value:null});if(D)if(C.setNs(I(R)),C.write(""),C.write(D),/ImageLiteral/.test(r[4])&&!/imageLiteral=/.test(B)&&(B+=" imageLiteral=1"),B+=" shim="+u.name,C.write(B),a=I(a),b()){var f=(l[0]||"").replace(/^.*:\s*/,"").trim();f.toLowerCase()!=b().toLowerCase()&&_(Se("Invalid first argument; should be of type '{0}', but is '{1}'",b(),f)),l.shift(),0==l.length&&/\bproperty\b/.test(B)?C.write(a+": "+x(o)+";"):C.write(a+"("+l.join(", ")+"): "+x(o)+";")}else C.write("function "+a+"("+l.join(", ")+"): "+x(o)+";");return B=D="",m||(S.setNs(R),S.write(o+" "+a+"("+s+");")),k.functions.push(u),void(E+=w?"(uint32_t)(void*)::"+u.name+",\n":"PXT_FNPTR(::"+u.name+"),\n")}if(r=/^\s*(\w+)\s+(\w+)\s*;/.exec(e),B&&r){var p=pxtc.parseCommentString(B);p.indexedInstanceNS&&(v=p,C.setNs(p.indexedInstanceNS),y=0);var h=r[1],d=r[2];if(v)return B=B.trim(),B+=" fixedInstance shim="+v.indexedInstanceShim+"("+y+++")",C.write(""),C.write(D),C.write(B),C.write("const "+d+": "+x(h)+";"),void(B=D="")}return B&&e.trim()?(_("declaration not understood: "+e),void(D=B="")):void 0}if(R=r[1],b()){$();var g=b();C.setNs(R,"declare interface "+g+" {")}else(B||D)&&($(),C.setNs(I(R)),P.setNs(I(R)))}}),G}function q(e){function y(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int":return"int32";case"uint":return"uint32";case"float":case"double":return"number";case"ushort":return"uint16";case"short":return"int16";case"byte":return"uint8";case"sbyte":return"int8";case"bool":return"boolean";case"string":case"String":return"string";case"Function":return"() => void";case"object":return"any";default:return I(e)}}function b(e){return function(e){if(e=e.replace(/\s+/g,""),Ue.lookup(O,e))return!0;var t=y(e);return!("number"!=t&&!/^u?int\d+$/.test(t))}(e=e.replace(/\s+/g,""))&&(e="#"+e),e+";"}return B=D=R="",j=!1,e=e.replace(/^\s*#\s*if\s+false\s*$[^]*?^\s*#\s*endif\s*$/gm,function(e){return e.replace(/[^\n]/g,"")}),G="",M=!1,L=U=0,P.setNs(""),C.setNs(""),e.split(/\r?\n/).forEach(function(e){++U;var t=F(e);J(e);var n=/^\s*(public) enum\s+(\w+)\s*({|$)/.exec(t);if(n&&z(n[2],n[3]),!H(e)){var r=/^\s*public (static\s+|partial\s+)*class\s+(\w+)/.exec(e);if(r)return R=r[2],void((B||D)&&($(),C.setNs(I(R)),P.setNs(I(R))));if(r=/^\s*public static (async\s+)*([\w\[\]<>]+)\s+(\w+)\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),B&&r){var i=pxtc.parseCommentString(B);R||_("missing namespace declaration");var o=r[2],a=r[3],s=r[4],c=!1;if(B=B.trim().replace(/ \w+\.defl=\w+/g,""),"Task"==o)o="void",c=!0;else{var l=/^Task<(.*)>$/.exec(o);l&&(c=!0,o=l[1])}var u=b(o);c&&(u="async;"+u,B+=" async");for(var f=[],p=0,h=s.split(/,/);p<h.length;p++){var d=h[p];if(d){var g=V(i,d),m=b(g.type);u+=m,"CTX;"!=m&&f.push(g.name+": "+y(g.type))}}var v={name:R+"::"+a,argsFmt:u,value:null};return D&&(C.setNs(I(R)),C.write(""),C.write(D),B+=" shim="+v.name,C.write(B),a=I(a),C.write("function "+a+"("+f.join(", ")+"): "+y(o)+";")),B=D="",void k.functions.push(v)}return B&&e.trim()?(_("declaration not understood: "+e),void(D=B="")):void 0}}),G}var X=Ue.clone(a.yottaConfig||{}),Y={},K={};function Z(e){var t=e.config.platformio;t&&t.dependencies&&Ue.jsonCopyFrom(k.platformio.dependencies,t.dependencies),k.npmDependencies&&e.config.npmDependencies&&Ue.jsonCopyFrom(k.npmDependencies,e.config.npmDependencies);var n=e.config.yotta;if(n){if(n.dependencies&&Ue.jsonCopyFrom(k.yotta.dependencies,n.dependencies),n.config)for(var r=Ue.jsonFlatten(n.config),i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=Ue.lookup(K,a),c=r[a];if(!s||s.config.yotta.configIsJustDefaults)K[a]=e,X[a]=c;else if(X[a]===c);else if(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts){var l=new Oe(Se("conflict on yotta setting {0} between packages {1} and {2}",a,e.id,s.id));throw l.pkg0=s,l.pkg1=e,l.settingName=a,l}}if(n.optionalConfig){r=Ue.jsonFlatten(n.optionalConfig);for(var u=0,f=Object.keys(r);u<f.length;u++)c=r[a=f[u]],Y[a]=c}}}if(w&&s.hasHex){var Q=a;Ue.assert(!!Q.yottaCorePackage),Ue.assert(!!Q.githubCorePackage),Ue.assert(!!Q.gittag);var ee=Q.githubCorePackage+"#"+a.gittag;k.yotta.dependencies[Q.yottaCorePackage]=ee}if(e)for(var te=!1,ne=0,re=e.sortedDeps();ne<re.length;ne++){var ie=re[ne];g="",Z(ie),ie==e?(te=!0,C.clear(),P.clear()):Ue.assert(!te);for(var oe=c?".cs":".cpp",ae=0,se=ie.getFiles();ae<se.length;ae++){var ce=se[ae],le=!c&&Ue.endsWith(ce,".h");if(le||Ue.endsWith(ce,oe)){var ue=ie.config.name+"/"+ce;"base"!=ie.config.name&&"core"!=ie.config.name||!le||(ue=ce),le&&(h+='#include "'+(w?r.slice(1):"")+ue+'"\n'),null==(N=ie.readFile(ce))&&Ue.userError(Se("C++ file {0} is missing in package {1}.",ce,ie.config.name)),m=ue,c?(Ie.debug("Parse C#: "+ue),q(N),d+='\n\n\n#line 1 "'+ue+'"\n'+N):(Ie.debug("Parse C++: "+ue),N=W(N,le),k.extensionFiles[r+ue]=N),0==ie.level&&(k.onlyPublic=!1),ie.verProtocol()&&"pub"!=ie.verProtocol()&&"embed"!=ie.verProtocol()&&(k.onlyPublic=!1)}!c&&(Ue.endsWith(ce,".c")||Ue.endsWith(ce,".S")||Ue.endsWith(ce,".s"))&&(N=ie.readFile(ce),k.extensionFiles[r+ie.config.name+"/"+ce.replace(/\.S$/,".s")]=N)}g&&(v+=Se("Package {0}:\n",ie.id)+g)}v&&Ue.userError(v),d+="\n#line default\n",Ue.jsonCopyFrom(Y,X);var fe=Ue.jsonUnFlatten(Y);if(c)k.extensionFiles["/lib.cs"]=d,k.generatedFiles["/module.json"]="{}";else if(f){var pe={name:"pxt-app",private:!0,dependencies:k.npmDependencies};k.generatedFiles["/package.json"]=JSON.stringify(pe,null,4)+"\n"}else if(u){Q=a;var he=Ue.clone(Q.codalDefinitions)||{},de=Q.codalTarget;"string"==typeof de&&(de+=".json");var ge={target:de,definitions:he,config:he,application:"pxtapp",output_folder:"build",pxt_gitrepo:Q.githubCorePackage,pxt_gittag:Q.gittag};Ue.iterMap(Ue.jsonFlatten(fe),function(e,t){e=e.replace(/^codal\./,"device.").toUpperCase().replace(/\./g,"_"),he[e]=t}),k.generatedFiles["/codal.json"]=JSON.stringify(ge,null,4)+"\n"}else if(l){var me=a.platformioIni.slice();me.push("lib_deps ="),Ue.iterMap(k.platformio.dependencies,function(e,t){var n=/[@#\/]/.test(t)?t:e+"@"+t;me.push("  "+n)}),k.generatedFiles["/platformio.ini"]=me.join("\n")+"\n"}else{k.yotta.config=fe;var ve="pxt-app";a.yottaBinary&&(ve=a.yottaBinary.replace(/-combined/,"").replace(/\.hex$/,""));var ye={name:ve,version:"0.0.0",description:"Auto-generated. Do not edit.",license:"n/a",dependencies:k.yotta.dependencies,targetDependencies:{},bin:"./source"};k.generatedFiles["/module.json"]=JSON.stringify(ye,null,4)+"\n"}if(s.boxDebug&&(p+="#define PXT_BOX_DEBUG 1\n",p+="#define PXT_MEMLEAK_DEBUG 1\n"),s.vtableShift&&(p+="#define PXT_VTABLE_SHIFT "+s.vtableShift+"\n"),s.nativeType==pxtc.NATIVE_TYPE_AVRVM?p+="#define PXT_VM 1\n":p+="#define PXT_VM 0\n",c||(k.generatedFiles[r+"pointers.cpp"]=h+S.finish()+T+E+"\nPXT_SHIMS_END\n",k.generatedFiles[r+"pxtconfig.h"]=p,w&&(k.generatedFiles["/config.json"]=JSON.stringify(fe,null,4)+"\n"),k.generatedFiles[r+"main.cpp"]='\n#include "pxt.h"\n#ifdef PXT_MAIN\nPXT_MAIN\n#else\nint main() {\n    uBit.init();\n    pxt::start();\n    while (1) uBit.sleep(10000);\n    return 0;\n}\n#endif\n'),b){var be=Object.keys(k.extensionFiles).concat(Object.keys(k.generatedFiles)),xe="",Ae=function(e,t){var n=be.filter(function(e){return Ue.endsWith(e,t)}).map(function(e){return e.slice(1)});xe+=e+" = "+n.join(" ")+"\n"};Ae("PXT_C",".c"),Ae("PXT_CPP",".cpp"),Ae("PXT_S",".s"),Ae("PXT_HEADERS",".h"),xe+="PXT_SOURCES = $(PXT_C) $(PXT_S) $(PXT_CPP)\n",xe+="PXT_OBJS = $(addprefix bld/, $(PXT_C:.c=.o) $(PXT_S:.s=.o) $(PXT_CPP:.cpp=.o))\n",k.generatedFiles["/Makefile"]=b,k.generatedFiles["/Makefile.inc"]=xe}var ke=k.extensionFiles;Ue.jsonCopyFrom(ke,k.generatedFiles);var we={config:a.serviceId,tag:a.gittag,replaceFiles:ke,dependencies:w?k.yotta.dependencies:null},Ee=JSON.stringify(we);return k.sha=Ue.sha256(Ee),k.compileData=ts.pxtc.encodeBase64(Ue.toUTF8(Ee)),k.shimsDTS=C.finish(),k.enumsDTS=P.finish(),_e=t,Te=k},e.unpackSourceFromHexFileAsync=function(e){if(e)return Ie.Util.fileReadAsBufferAsync(e).then(function(e){return t(new Uint8Array(e))})},e.unpackSourceFromHexAsync=t}(Ie.cpp||(Ie.cpp={}))}(pxt||(pxt={})),function(d){!function(s){var c,l={};function o(t){var n,i,e,r,o,a=Promise.resolve();return l.hasOwnProperty(t.sha)||(a=(n=t,i="",s.showLoading(d.U.lf("Compiling (this may take a minute)...")),(e=n,d.webConfig&&d.webConfig.isStatic?d.Util.requestAsync({url:d.webConfig.cdnUrl+"hexcache/"+e.sha+".hex"}).then(function(e){if(e.text){var t={enums:[],functions:[],hex:e.text.split(/\r?\n/)};return Promise.resolve(t)}return d.log("Hex info not found in bundled hex cache"),Promise.resolve()}).catch(function(e){return d.log("Error fetching hex info from bundled hex cache"),Promise.resolve()}):d.Cloud.localToken&&window&&d.Cloud.isLocalHost()?(r="compile/"+e.sha,d.Cloud.localRequestAsync(r,o).then(function(e){return e.json})).then(function(e){return e&&!e.notInOfflineCache&&e.hex?(e.hex=e.hex.split(/\r?\n/),e):Promise.resolve()}).catch(function(e){return Promise.resolve()}):Promise.resolve()).then(function(e){return e||function(){if(c)return c;var e=d.getOnlineCdnUrl();if(e)return c=Promise.resolve(e);var t=d.webConfig&&d.webConfig.isStatic;return c=d.Cloud.privateGetAsync("clientconfig",t).then(function(e){return e.primaryCdnUrl})}().then(function(e){return i=e+"/compile/"+n.sha,d.U.httpGetTextAsync(i+".hex")}).then(function(e){return e},function(e){return d.Cloud.privatePostAsync("compile/extension",{data:n.compileData}).then(function(r){return new Promise(function(t,e){var n=function(){var e=r.hex.replace(/\.hex/,".json");return d.log("polling at "+e),d.Util.httpGetJsonAsync(e).then(function(e){e.success?(d.log("fetching "+i+".hex"),t(d.U.httpGetTextAsync(i+".hex"))):d.U.userError(JSON.stringify(e,null,1))},function(e){return setTimeout(n,1e3),null})};n()})})}).then(function(e){return s.hideLoading(),{enums:[],functions:[],hex:e.split(/\r?\n/)}})}).finally(function(){s.hideLoading()})).then(function(e){l[t.sha]=e})),a.then(function(){return l[t.sha]})}function a(r,i,o,e,a){return void 0===a&&(a=10),r.cacheStoreAsync(o,e).then(function(){return r.cacheGetAsync(i)}).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){console.error("invalid cache entry, clearing entry"),t=[]}(t=t.filter(function(e){return e!=o})).unshift(o);var n=t.slice(a);return t=t.slice(0,a),Promise.map(n,function(e){return r.cacheStoreAsync(e,null)}).then(function(){return r.cacheStoreAsync(i,JSON.stringify(t))})})}function u(n,r,i){return n.cacheGetAsync(r).then(function(e){var t;try{t=JSON.parse(e||"[]")}catch(e){return console.error("invalid cache entry, clearing entry"),n.cacheStoreAsync(r,"[]")}return t[0]!=i?((t=t.filter(function(e){return e!=i})).unshift(i),n.cacheStoreAsync(r,JSON.stringify(t))):null})}s.showLoading=function(e){},s.hideLoading=function(){},s.storeWithLimitAsync=a,s.recordGetAsync=u,s.getHexInfoAsync=function(r,n,e){if(!n.sha)return Promise.resolve(null);if(pxtc.hex.isSetupFor(n))return Promise.resolve(pxtc.hex.currentHexInfo);d.debug("get hex info: "+n.sha);var i="hex-"+n.sha;return r.cacheGetAsync(i).then(function(e){var t;try{t=e?JSON.parse(e):null}catch(e){console.log("invalid cache entry, clearing entry"),t=null}return t&&t.hex?(d.debug("cache hit, size="+e.length),t.hex=function(e){for(var t=[],n=0;n<e.length;n++){var r=/^([@!])(....)$/.exec(e[n]);if(r){var i=parseInt(r[2],16),o=e[++n],a="";if("@"==r[1]){a="";for(var s=parseInt(o,16);0<s--;)a+="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}else a=ts.pxtc.decodeBase64(o);d.Util.assert(0<a.length),d.Util.assert(a.length%16==0);for(var c=0;c<a.length;){var l=[16,i>>8&255,255&i,0];i+=16;for(var u=0;u<16;++u)l.push(a.charCodeAt(c++));for(var f=0,u=0;u<l.length;++u)f+=l[u];l.push(255&-f);for(var p=":",u=0;u<l.length;++u){var h=255&l[u];h<=15&&(p+="0"),p+=h.toString(16)}t.push(p.toUpperCase())}}else t.push(e[n])}return t}(t.hex),u(r,"hex-keys",i).then(function(){return t})):o(n).then(function(e){var t=e.hex;e.hex=function(e){for(var t=[],n=0,r=0;r<e.length;r+=n){var i=-1,o="";n=0;for(var a=!1;n<500;){var s=/^:10(....)00(.{32})(..)$/.exec(e[r+n]);if(!s)break;var c=s[2],l=/^0+$/.test(c),u=parseInt(s[1],16);if(-1==i)a=l,t.push((a?"@":"!")+s[1]),i=u-16;else{if(l!=a)break;if(i+16!=u)break}a||(o+=c),i=u,n++}if(0==n)t.push(e[r]),n=1;else if(a)t.push(n.toString(16));else{for(var f="",p=0;p<o.length;p+=2)f+=String.fromCharCode(parseInt(o.slice(p,p+2),16));t.push(ts.pxtc.encodeBase64(f))}}return t}(e.hex);var n=JSON.stringify(e);return e.hex=t,a(r,"hex-keys",i,n).then(function(){return e})}).catch(function(e){return d.reportException(e,{sha:n.sha}),Promise.resolve(null)})})}}(d.hex||(d.hex={}))}(pxt||(pxt={})),function(d){!function(e){function p(e,t,n,r,i){d.Util.assert(!!t&&!!n&&!!r);var o="https://api.crowdin.com/api/project/"+t+"/",a="?key="+n;return e&&(i||(i={}),i.branch=e),i&&(a+="&"+Object.keys(i).map(function(e){return e+"="+encodeURIComponent(i[e])}).join("&")),o+r+a}function t(e){var t=0;return function(){if(10<t++)throw new Error("Too many API calls for "+e)}}function u(r,i,o,a,s){return a=h(a),d.debug("create directory "+(r||"")+"/"+a),s||(s=t(a)),d.Util.multipartPostAsync(p(r,i,o,"add-directory"),{json:"true",name:a}).then(function(e){if(d.debug("crowdin resp: "+e.statusCode),200==e.statusCode||400==e.statusCode)return Promise.resolve();if(500==e.statusCode&&e.text&&50===JSON.parse(e.text).error.code)return d.log("directory already exists"),Promise.resolve();var t=e.json||JSON.parse(e.text)||{error:{}};if(404==e.statusCode&&17==t.error.code){d.log("parent directory missing for "+a);var n=a.replace(/\/[^\/]+$/,"");if(n!=a)return u(r,i,o,n,s).then(function(){return u(r,i,o,a,s)})}throw new Error("cannot create directory "+(r||"")+"/"+a+": "+e.statusCode+" "+JSON.stringify(t))})}function h(e){return e.replace(/\\/g,"/")}function i(e,t){var n=d.appTarget.versions.pxtCrowdinBranch||"",r=d.appTarget.versions.targetCrowdinBranch||"",i=[];if(e.forEach(function(e){return function t(n,r,i,e){var o=r.name,a=i?i+"/"+o:o;switch(r.fullName=a,r.branch=e||"",r.node_type){case"file":n.push(r);break;case"directory":(r.files||[]).forEach(function(e){return t(n,e,a)});break;case"branch":(r.files||[]).forEach(function(e){return t(n,e,i,r.name)})}}(i,e,"")}),i=i.filter(function(e){return e.fullName.indexOf("/")<0?e.branch==n:e.branch==r}),t&&(i=i.filter(function(e){return 0==e.fullName.indexOf(t)})),"core"!=d.appTarget.id){var o=d.appTarget.id+"/";i=i.filter(function(e){return e.fullName.indexOf("/")<0||e.fullName.substr(0,o.length)==o||0<=e.fullName.indexOf("common-docs")})}return i}function r(e,t){var n=p("",e,t,"info",{json:"true"});return d.Util.httpGetTextAsync(n).then(function(e){return JSON.parse(e)})}e.KEY_VARIABLE="CROWDIN_KEY",e.downloadTranslationsAsync=function(a,s,c,l,u){void 0===u&&(u={});var e=p(a,s,c,"info",{json:"true"}),f={};return l=h(l),d.Util.httpGetTextAsync(e).then(function(e){var t=JSON.parse(e);if(!t)throw new Error("info failed");var i=t.languages;d.log("languages: "+i.map(function(e){return e.code}).join(", "));var o=function(){var n=i.pop();if(!n)return Promise.resolve();var r=p(a,s,c,"export-file",{file:l,language:n.code,export_translated_only:u.translatedOnly?"1":"0",export_approved_only:u.validatedOnly?"1":"0"});return d.log("downloading "+n.name+" - "+n.code+" ("+i.length+" more)"),d.Util.httpGetTextAsync(r).then(function(e){try{var t=JSON.parse(e);t&&(f[n.code]=t)}catch(e){d.log(r+" "+e)}return o()}).delay(1e3)};return o()}).then(function(){return f})},e.createDirectoryAsync=u,e.uploadTranslationAsync=function(r,i,o,a,n){d.Util.assert(!!i),d.Util.assert(!!o);var s=t(a=h(a));function c(){return l("update-file",{update_option:"update_as_unapproved"})}function l(e,t){return t.type="auto",t.json="",t.escape_quotes="0",s(),d.Util.multipartPostAsync(p(r,i,o,e),t,a,n).then(function(e){return function(e){var t=e.statusCode,n=JSON.parse(e.text);if(d.debug("upload result: "+t),404==t&&8==n.error.code)return d.log("create new translation file: "+a),l("add-file",{});if(404==t&&17==n.error.code)return u(r,i,o,a.replace(/\/[^\/]+$/,""),s).then(function(){return c()});if(200==t)return Promise.resolve();throw new Error("Error, upload translation: "+a+", "+e+", "+JSON.stringify(n))}(e)})}return c()},e.projectInfoAsync=r,e.listFilesAsync=function(e,t,n){return d.log("crowdin: listing files under "+n),r(e,t).then(function(e){if(!e)throw new Error("info failed");var t=i(e.files,n);return d.debug("crowdin: found "+t.length+" under "+n),t.map(function(e){return{fullName:e.fullName,branch:e.branch||""}})})},e.languageStatsAsync=function(e,t,n){var r=p("",e,t,"language-status",{language:n,json:"true"});return d.Util.httpGetJsonAsync(r).then(function(e){return i(e.files)})}}(d.crowdin||(d.crowdin={}))}(pxt||(pxt={})),function(l){!function(w){var E,C=pxtc.Util,P={},O={},e="\x3c!-- @CMD@ @ARGS@ --\x3e",I={parent:e,short:e,description:"\x3c!-- desc --\x3e"};function t(e,t,n){return e.split(t).join(n)}function n(e){return e=t(e=t(e=t(e=t(e=t(e,"&","&amp;"),"<","&lt;"),">","&gt;"),'"',"&quot;"),"'","&#39;")}function N(e){return e?n(e.replace(/\&([#a-z0-9A-Z]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1))):e}})):e}w.htmlQuote=n,w.html2Quote=N;var T=[{rx:/^vimeo\.com\/(\d+)/i,cmd:"### @vimeo $1"},{rx:/^(www\.youtube\.com\/watch\?v=|youtu\.be\/)([\w\-]+(\#t=([0-9]+m[0-9]+s|[0-9]+m|[0-9]+s))?)/i,cmd:"### @youtube $2"}];w.requireMarked=function(){return"undefined"!=typeof marked?marked:"undefined"!=typeof require?require("marked"):void 0};var F=function(e){return"<div class='ui negative message'>"+n(e)+"</div>"};function _(i){var o=C.clone(P),a=C.clone(O),s=C.clone(I),c={},l={},e=i.params,t=i.theme;i.boxes=o,i.macros=a,i.settings=s,i.html=i.html.replace(/<aside\s+([^<>]+)>([^]*?)<\/aside>/g,function(e,t,n){var r=function(e){for(var t={};e.trim();){var n=/\s*([^=\s]+)=("([^"]*)"|'([^']*)'|(\S*))/.exec(e);if(n){var r=n[3]||n[4]||n[5]||"";t[n[1].toLowerCase()]=r}else t[(n=/^\s*(\S+)/.exec(e))[1]]="true";e=e.slice(n[0].length)}return t}(t),i=r["data-name"]||r.id;return i?(/box/.test(r.class)?o[i]=n:/aside/.test(r.class)?o[i]="\x3c!-- BEGIN-ASIDE "+i+" --\x3e"+n+"\x3c!-- END-ASIDE --\x3e":/setting/.test(r.class)?s[i]=n:/menu/.test(r.class)?c[i]=n:/toc/.test(r.class)?l[i]=n:a[i]=n,"\x3c!-- macro "+i+" --\x3e"):F("id or data-name missing on macro")});var u,f=function(e,t){var n=c.item,r={NAME:e.name};if(e.subitems)n=0==t?c["top-dropdown"]:c["inner-dropdown"],r.ITEMS=e.subitems.map(function(e){return f(e,t+1)}).join("\n");else{if(/^-+$/.test(e.name)&&(n=c.divider),e.path&&!/^(https?:|\/)/.test(e.path))return F("Invalid link: "+e.path);r.LINK=e.path}return L(n,r,["ITEMS"])},p=[{name:lf("Docs"),href:"/docs"}],h=[],d=function(e){for(var t=0,n=e.subitems||[];t<n.length;t++){var r=n[t];if(d(r))return h.push(e),!0}return!(!i.filepath||0!=i.filepath.indexOf(e.path))&&(h.push(e),!0)};(t.TOC||[]).forEach(d);var g=function(e,t){var n=l.item,r={NAME:e.name};return e.path&&!/^(https?:|\/)/.test(e.path)?F("Invalid link: "+e.path):(/^\//.test(e.path)&&i.versionPath&&(e.path="/"+i.versionPath+e.path),r.LINK=e.path,0<=h.indexOf(e)?(r.ACTIVE="active",r.EXPANDED="true",u=e,p.push({name:e.name,href:e.path})):r.EXPANDED="false",e.subitems&&0<e.subitems.length?(n=0==t?""!==e.name?l["top-dropdown"]:l["top-dropdown-noHeading"]:1==t?l["inner-dropdown"]:l["nested-dropdown"],r.ITEMS=e.subitems.map(function(e){return g(e,t+1)}).join("\n")):/^-+$/.test(e.name)&&(n=l.divider),L(n,r,["ITEMS"]))};e.menu=(t.docMenu||[]).map(function(e){return f(e,0)}).join("\n"),e.TOC=(t.TOC||[]).map(function(e){return g(e,0)}).join("\n"),t.appStoreID&&(e.appstoremeta='<meta name="apple-itunes-app" content="app-id='+C.htmlEscape(t.appStoreID)+'"/>');var n="";1<p.length&&(n='\n            <nav class="ui breadcrumb" aria-label="'+lf("Breadcrumb")+'">\n                '+p.map(function(e,t){return'<a class="'+(t==p.length-1?"active":"")+' section"\n                        href="'+N(e.href)+'" aria-current="'+(t==p.length-1?"page":"")+'">'+N(e.name)+"</a>"}).join('<i class="right chevron icon divider"></i>')+"\n            </nav>"),e.breadcrumb=n,u&&(u.prevPath&&(e.prev='<a href="'+u.prevPath+'" class="navigation navigation-prev " title="'+u.prevName+'">\n                                    <i class="icon angle left"></i>\n                                </a>'),u.nextPath&&(e.next='<a href="'+u.nextPath+'" class="navigation navigation-next " title="'+u.nextName+'">\n                                    <i class="icon angle right"></i>\n                                </a>')),t.boardName&&(e.boardname=N(t.boardName)),t.boardNickname&&(e.boardnickname=N(t.boardNickname)),t.driveDisplayName&&(e.drivename=N(t.driveDisplayName)),t.homeUrl&&(e.homeurl=N(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.targetlogo=t.docsLogo?'<img aria-hidden="true" role="presentation" class="ui mini image" src="'+t.docsLogo+'" />':"";var r=i.ghEditURLs||[];if(r.length){for(var m='<p style="margin-top:1em">\n',v=lf("Edit this page on GitHub"),y=0,b=r;y<b.length;y++){m+='<a href="'+b[y]+'"><i class="write icon"></i>'+v+"</a><br>\n",v=lf("Edit template of this page on GitHub")}m+="</p>\n",e.github=m}else e.github="";var x='\n            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">'+lf("Skip to main content")+"</a>\n        ";e.accMenu=x;var A='\n            <button id="printbtn" class="circular ui icon right floated button hideprint" title="'+lf("Print this page")+'">\n                <i class="icon print"></i>\n            </button>\n        ';e.printBtn=A;var k='\n            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="'+lf("Side menu")+'" role="menu" aria-expanded="false">\n                <i class="content icon"></i>\n            </a>\n        ';e.sidebarToggle=k;var w=["tocsearch1","tocsearch2"].map(function(e){return'\n                <input type="search" name="q" placeholder="'+lf("Search...")+'" aria-label="'+lf("Search Documentation")+'">\n                <i onclick="document.getElementById(\''+e+'\').submit();" tabindex="0" class="search link icon" aria-label="'+lf("Search")+'" role="button"></i>\n            '});e.searchBar1=w[0],e.searchBar2=w[1];var E="";t.accentColor&&(E+="\n.ui.accent { color: "+t.accentColor+"; }\n.ui.inverted.accent { background: "+t.accentColor+"; }\n"),e.targetstyle=E;for(var T=0,_=Object.keys(t);T<_.length;T++){var U=_[T],S=t[U];void 0===e[U]&&"string"==typeof S&&(e[U]=S)}i.finish=function(){return L(i.html,e,["body","menu","accMenu","TOC","prev","next","printBtn","breadcrumb","targetlogo","github","JSON","appstoremeta","sidebarToggle","searchBar1","searchBar2"])}}function L(e,r,i){return void 0===i&&(i=[]),e?e.replace(/@(\w+)@/g,function(e,t){var n=C.lookup(r,t)||"";return n+="",i.indexOf(t)<0&&(n=N(n)),n}):""}w.prepTemplate=_,w.renderMarkdown=function(u){var e=!0;u.pubinfo||(e=!1,u.pubinfo={});var f=u.pubinfo;if(u.theme||(u.theme={}),delete u.pubinfo.private,f.time){var t=parseInt(f.time);f.timems||(f.timems=1e3*t+""),f.humantime||(f.humantime=C.isoTime(t))}f.name&&(f.dirname=f.name.replace(/[^A-Za-z0-9_]/g,"-"),f.title=f.name),e&&(f.JSON=JSON.stringify(f,null,4).replace(/</g,"\\u003c"));var n=u.template;n=(n=n.replace(/<!--\s*@include\s+(\S+)\s*-->/g,function(e,t){return"\x3c!-- include "+t+" --\x3e\n"+((u.theme.htmlDocIncludes||{})[t]||"")+"\n\x3c!-- end include --\x3e\n"})).replace(/<!--\s*@(ifn?def)\s+(\w+)\s*-->([^]*?)<!--\s*@endif\s*-->/g,function(e,t,n,r){return"ifdef"==t&&f[n]||"ifndef"==t&&!f[n]?"\x3c!-- "+t+" "+n+" --\x3e"+r+"\x3c!-- endif --\x3e":"\x3c!-- "+t+" "+n+" endif --\x3e"}),u.locale&&(n=U(n,u.locale).text);var p={html:n,theme:u.theme,filepath:u.filepath,versionPath:u.versionPath,ghEditURLs:u.ghEditURLs,params:f};if(_(p),!E){var o=new((E=w.requireMarked()).Renderer);o.image=function(e,t,n){var r='<img class="ui centered image" src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=this.options.xhtml?"/>":">"},o.listitem=function(e){var t=/^\s*\[( |x)\]/i.exec(e);return t?'<li class="'+(" "==t[1]?"unchecked":"checked")+'">'+e.slice(t[0].length)+"</li>\n":"<li>"+e+"</li>\n"};var a=o.link;o.link=function(e,t,n){var r=0==e.indexOf("/"),i=r?"":"_blank";return r&&p.versionPath&&(e="/"+p.versionPath+e),a.call(o,e,t,n).replace(/^<a /,"<a "+(i?'target="'+i+'"':"")+' rel="nofollow noopener" ')},o.heading=function(e,t,n){var r=/(.*)#([\w\-]+)\s*$/.exec(e),i="";return r?(e=r[1],i=r[2]):i=n.toLowerCase().replace(/[^\w]+/g,"-"),"<h"+t+' id="'+this.options.headerPrefix+i+'">'+e+"</h"+t+">"},E.setOptions({renderer:o,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!0})}var r=u.markdown;u.repo&&(r+="\n```package\n"+u.repo.name.replace(/^pxt-/,"")+"=github:"+u.repo.fullName+"#"+(u.repo.tag||"master")+"\n```\n"),r=(r=r.replace(/^\s*https?:\/\/(\S+)\s*$/gm,function(e,t){for(var n=function(e){var n=e.rx.exec(t);if(n)return{value:e.cmd.replace(/\$(\d+)/g,function(e,t){return n[parseInt(t)]||""})+"\n"}},r=0,i=T;r<i.length;r++){var o=n(i[r]);if("object"==typeof o)return o.value}return e})).replace(/@([a-z]+)@/gi,function(e,t){var n=f[t];return!n&&u.throwOnError&&C.userError("unknown macro "+t),n||"unknown macro"});var i=E(r);i=i.replace(/&lt;br\s*\/&gt;/gi,"<br/>");var h="";if(i=i.replace(/<h\d[^>]+>\s*([~@])\s*(.*?)<\/h\d>/g,function(e,t,n){var r=/^(\w+)\s+(.*)/.exec(n),i=r?r[1]:n,o=r?r[2]:"";if(o=N(o),i=N(i),"@"==t){var a=C.lookup(p.settings,i);if(null!=a)f[i]=o;else if(null==(a=C.lookup(p.macros,i)))return u.throwOnError&&C.userError("Unknown command: @"+i),F("Unknown command: @"+i);return L(a,{ARGS:o,CMD:i},["ARGS","CMD"])}if(!i){var s=h;return h="",s}var c=C.lookup(p.boxes,i);if(c){var l=c.split("@BODY@");return h=l[1],l[0].replace("@ARGS@",o)}return u.throwOnError&&C.userError("Unknown box: ~ "+i),F("Unknown box: ~ "+i)}),!f.title){var s=/<h1[^<>]*>([^<>]+)<\/h1>/.exec(i);s&&(f.title=N(s[1]))}if(!f.description){var c=/<p>([^]+?)<\/p>/.exec(i);c&&(f.description=N(c[1]))}var l=/<div class="ui embed mdvid"[^<>]+?data-placeholder="([^"]+)"[^>]*\/?>/i.exec(i)||/<img class="ui [^"]*image" src="([^"]+)"[^>]*\/?>/i.exec(i);l&&(f.cardLogo=N(l[1])),f.twitter=N(u.theme.twitter||"@msmakecode");var d,g,m={main:""};i=(i=i.replace(/<!-- BEGIN-ASIDE (\S+) -->([^]*?)<!-- END-ASIDE -->/g,function(e,t,n){var r=C.lookup(m,t);return m[t]=(r||"")+n,"\x3c!-- aside --\x3e"})).replace(/\n<\/code>/g,"</code>"),m.main=i,i="";for(var v=0,y=Object.keys(m);v<y.length;v++){var b=y[v];i+=(d=b+"-container",g=m[b],L(p.boxes[d]||"@BODY@",{BODY:g},["BODY"]))}f.body=i,f.name=f.title+" - "+f.targetname;for(var x=0,A=Object.keys(u.theme);x<A.length;x++){b=A[x];var k=u.theme[b];"string"==typeof k&&(f["theme_"+b]=k)}return p.finish()},w.embedUrl=function(e,t,n,r){return'<div style="position:relative;height:0;padding-bottom:70%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"#"+t+":"+n+'" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>'},w.runUrl=function(e,t,n){return'<div style="position:relative;height:0;padding-bottom:'+t+';overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"?id="+encodeURIComponent(n)+'" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div>'},w.codeEmbedUrl=function(e,t,n){var r=e+"---codeembed#pub:"+t;return'<div style="position:relative;height:calc('+(n=Math.ceil(n||300))+'px + 5em);width:100%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+r+'" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-scripts allow-same-origin"></iframe></div>'};var c={b:1,strong:1,em:1};function U(e,i){var o={};function a(e){var t=/^(\s*)([^]*?)(\s*)$/.exec(e),n=t[2].replace(/\s+/g," ");if(""==n||/^((IE=edge,.*|width=device-width.*|(https?:\/\/|\/)[\w@\/\.]+|@[\-\w]+@|\{[^\{\}]+\}|[^a-zA-Z]*|(&nbsp;)+)\s*)+$/.test(n))return null;var r=C.lookup(i,n);return r?n=r:o[n]="",t[1]+n+t[3]}function s(e){return e.replace(/&llt;/g,"<").replace(/&ggt;/g,">")}return{text:e=(e=(e=(e="<start>"+(e=e.replace(/<([\/\w]+)([^<>]*)>/g,function(e,t,n){var r=t.replace(/^\//,"").toLowerCase();return 1===c[r]?"&llt;"+t+n+"&ggt;":e}))).replace(/(<([\/\w]+)([^<>]*)>)([^<>]+)/g,function(e,t,n,r,i){if("script"==n||"style"==n)return s(e);var o=a(s(i));return null==o?s(e):t+o})).replace(/(<[^<>]*)(content|placeholder|alt|title)="([^"]+)"/g,function(e,t,n,r){return null==a(r)?e:t+n+'="'+r.replace(/"/g,"''")+'"'})).replace(/^<start>/g,""),missing:o}}function v(e,a){for(var s=0,c=[{level:0,id:"",title:"",start:s,text:"",children:[]}],t=(e=e.replace(/\r/g,"")).split(/\n/),l={},n=function(e){var t=/^\s*(#+)\s*(.*?)(#(\S+)\s*)?$/.exec(e),n=null;if(a&&t)if(t[4])if(l[t[4]])t=null;else{n=function e(t,n){if(t.id==n)return t;for(var r=0,i=t.children;r<i.length;r++){var o=e(i[r],n);if(o)return o}return null}(a,t[4]);var r=function(e){e.id&&(l[e.id]=!0),e.children.forEach(r)};n&&r(n)}else t=null;if(t){var i={level:a?1:t[1].length,title:t[2].trim(),id:t[4]||"",start:s,text:"",children:[]};if(n){e="";for(var o=0;o<n.level;++o)e+="#";e+=" ",e+=i.title||n.title,e+=" #"+i.id}for(;c[c.length-1].level>=i.level;)c.pop();c[c.length-1].children.push(i),c.push(i)}c[c.length-1].text+=e+"\n",s++},r=0,i=t;r<i.length;r++){n(i[r])}return c[0]}w.translate=U,w.buildTOC=function(e){if(!e)return null;var t=l.docs.requireMarked(),n={renderer:new t.Renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,smartypants:!1},r={name:"dummy",subitems:[]},i=[];i.push(r),t.lexer(e,n).forEach(function(e){switch(e.type){case"heading":e.depth;break;case"list_start":break;case"list_item_start":case"loose_item_start":i.push({name:"",subitems:[]});break;case"text":e.text.replace(/^\[(.*)\]\((.*)\)$/i,function(e,t,n){i[i.length-1].name=t,i[i.length-1].path=n.replace(".md","")});break;case"list_item_end":case"loose_item_end":var t=i.pop();i[i.length-1].subitems.push(t)}});var o,a=r.subitems;if(!a||0==a.length)return null;var s=function(e){o&&(e.prevName=o.name,e.prevPath=o.path,o.nextName=e.name,o.nextPath=e.path),e.path&&(o=e),e.subitems.forEach(function(e,t){s(e)})};return a.forEach(function(e,t){s(e)}),a};var y=!(w.visitTOC=function(e,t){e.forEach(function(e){t(e),e.subitems&&e.subitems.forEach(t)})});function b(e,t){if(y||function(){function e(e,t,n){var r=b(e,t).trim();if(n=n.trim(),r!=n)throw console.log("*** Template:\n"+e+"\n*** Input:\n"+t+"\n*** Expected:\n"+n+"\n*** Output:\n"+r),new Error("augment docs test fail")}y=!0;var t="\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nTEx2\n### Example 3\nTEx3\n\n## See also #also\nTAlso\n";e(t,"",t),e(t," ",t),e(t,"\n# @extends\n# #ex2\nMy example\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nMy example\n### Example 3\nTEx3\n\n## See Also These! #also\nMy links\n"),e(t,"\n# @extends\n### #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n")}(),!t)return e;for(var n=v(e,null),r=v(t,n),i={},o={},a=0,s=r.children;a<s.length;a++){var c=s[a];C.assert(0==c.children.length),C.assert(!!c.id),i[c.id]=c.text}var l=function(e){e.id&&void 0!==i[e.id]&&(o[e.id]=!0,e.text=i[e.id],e.children=[]),e.children.forEach(l)};l(n);var u="",f=function(e){u+=e.text,e.children.forEach(f)};f(n);var p="",h=r.text.replace(/^\s*#+\s*@extends.*/gm,"").replace(/^\s*\n/gm,"");h.trim()&&(p+=h.trim()+"\n");for(var d=0,g=r.children;d<g.length;d++){var m=g[d];o[m.id]||(p+=m.text)}return p&&(u+="## Couldn't apply replacement logic to:\n"+p),u}w.augmentDocs=b}(l.docs||(l.docs={}))}(pxt||(pxt={})),function(a){!function(e){function n(e,t){if(t){var n=/```(blocks?|typescript)\s+((.|\s)+?)\s*```/i.exec(t);if(n){var r=/```package\s+((.|\s)+?)\s*```/i.exec(t),i=void 0;r&&(i={},r[1].split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).map(function(e){return e.split("=")}).forEach(function(e){return i[e[0]]=e[1]||"*"}));var o=n[2],a=t.substring(0,n.index).replace(/^(#+.*|\s*)$/gim,"").trim();return a&&(o="/**\n"+a.split("\n").map(function(e){return"* "+e}).join("\n")+"\n*/\n"+o),{name:e,filesOverride:{"main.blocks":'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',"main.ts":o},dependencies:i}}}}function t(e){if(!e)return[];var n=[],r=!1,i=void 0,o="";return e.split(/\r?\n/).forEach(function(e){if(/^##/.test(e))i=e.substr(2).trim();else if(/^```codecard$/.test(e))r=!0;else if(/^```$/.test(e)){if(r=!1,i&&o)try{var t=JSON.parse(o);t&&0<t.length&&n.push({name:i,cards:t})}catch(e){a.log("invalid card format in gallery")}o="",i=void 0}else r&&(o+=e+"\n")}),n}e.parseExampleMarkdown=n,e.parseGalleryMardown=t,e.loadGalleryAsync=function(e){return a.Cloud.downloadMarkdownAsync(e,a.Util.userLanguage(),a.Util.localizeLive).then(function(e){return t(e)})},e.loadExampleAsync=function(t,e){return a.Cloud.downloadMarkdownAsync(e,a.Util.userLanguage(),a.Util.localizeLive).then(function(e){return n(t,e)})}}(a.gallery||(a.gallery={}))}(pxt||(pxt={})),function(m){!function(r){function s(){return!m.U.isNodeJS&&!(m.appTarget&&m.appTarget.cloud&&m.appTarget.cloud.noGithubProxy)}r.useProxy=s;var a,e,t=function(){function e(){this.configs={},this.packages={}}return e.prototype.proxyLoadPackageAsync=function(e,t){var n=this,r=e+"/"+t,i=this.packages[r];return i?(m.debug("github cache "+e+"/"+t+"/text"),Promise.resolve(i)):m.U.httpGetJsonAsync(m.Cloud.apiRoot+"gh/"+e+"/"+t+"/text").then(function(e){return n.packages[r]={files:e}})},e.prototype.loadConfigAsync=function(e,t){var n=this;t||(t="master");var r=e+"/"+t,i=this.configs[r];if(i)return m.debug("github cache "+e+"/"+t+"/config"),Promise.resolve(m.U.clone(i));var o=function(e){var t=JSON.parse(e);return n.configs[r]=t,m.U.clone(t)};if(s())return this.proxyLoadPackageAsync(e,t).then(function(e){return o(e.files[m.CONFIG_NAME])});var a="https://raw.githubusercontent.com/"+e+"/"+t+"/"+m.CONFIG_NAME;return m.U.httpGetTextAsync(a).then(function(e){return o(e)})},e.prototype.loadPackageAsync=function(n,o){var a=this;return o||(o="master"),s()?this.proxyLoadPackageAsync(n,o).then(function(e){return m.U.clone(e)}):c(n,o).then(function(e){var r=n+"/"+e,t=a.packages[r];if(t)return m.debug("github cache "+n+"/"+o+"/text"),Promise.resolve(m.U.clone(t));var i="https://raw.githubusercontent.com/"+n+"/"+e+"/";return m.log("Downloading "+n+"/"+o+" -> "+e),m.U.httpGetTextAsync(i+m.CONFIG_NAME).then(function(e){var n={files:{}};n.files[m.CONFIG_NAME]=e;var t=JSON.parse(e);return Promise.map(t.files.concat(t.testFiles||[]),function(t){return m.U.httpGetTextAsync(i+t).then(function(e){n.files[t]=e})}).then(function(){return a.packages[r]=n,m.U.clone(n)})})})},e}();function i(e,n){void 0===n&&(n="tags");var o=null,t=m.U.httpGetJsonAsync(m.Cloud.apiRoot+"gh/"+e+"/refs").then(function(t){var e=Object.keys(t.refs).filter(function(e){return m.U.startsWith(e,"refs/"+n+"/")}).map(function(e){return{ref:e,object:{sha:t.refs[e]}}});return o=t.refs.HEAD,e}),a=function(e){return e.replace(/^refs\/[^\/]+\//,"")};return t.then(function(e){e.sort(function(e,t){return m.semver.strcmp(a(e.ref),a(t.ref))});for(var t={},n=0,r=e;n<r.length;n++){var i=r[n];t[a(i.ref)]=i.object.sha}return{refs:t,head:o}},function(e){return 404==e.statusCode?{refs:{}}:Promise.reject(e)})}function o(e){return"commit"==e.object.type?Promise.resolve(e.object.sha):"tag"==e.object.type?m.U.httpGetJsonAsync(e.object.url).then(function(e){return"commit"==e.object.type?e.object.sha:Promise.reject(new Error("Bad type (2nd order) "+e.object.type))}):Promise.reject(new Error("Bad type "+e.object.type))}function c(t,n){return/^[a-f0-9]{40}$/.test(n)?Promise.resolve(n):m.U.httpGetJsonAsync("https://api.github.com/repos/"+t+"/git/refs/tags/"+n).then(o,function(e){return m.U.httpGetJsonAsync("https://api.github.com/repos/"+t+"/git/refs/heads/"+n).then(o)})}function n(e){return m.Cloud.apiRoot+"gh/"+e.fullName+"/icon"}function l(e,t,n){if(e){var r={owner:e.owner.login.toLowerCase(),fullName:e.full_name.toLowerCase(),name:e.name,description:e.description,defaultBranch:e.default_branch,tag:n};return r.status=u(r,t),r}}function u(e,t){return f(e,t)?a.Banned:(o=r=t,(i=n=e)&&o&&i.owner&&o.approvedOrgs&&o.approvedOrgs.some(function(e){return e.toLowerCase()==i.owner.toLowerCase()})||n&&r&&n.fullName&&r.approvedRepos&&r.approvedRepos.some(function(e){return e.toLowerCase()==n.fullName.toLowerCase()})?a.Approved:a.Unknown);var n,r,i,o}function f(t,e){return n=t,!(!(r=e)||n&&n.owner&&(!r.bannedOrgs||!r.bannedOrgs.some(function(e){return e.toLowerCase()==n.owner.toLowerCase()})))||!!e&&(!t||!t.fullName||!(!e.bannedRepos||!e.bannedRepos.some(function(e){return e.toLowerCase()==t.fullName.toLowerCase()})));var n,r}function p(e,t){var n=d(e),r=u(n,t);return r==a.Banned?Promise.resolve(void 0):s()?m.Util.httpGetJsonAsync(m.Cloud.apiRoot+"gh/"+n.fullName).then(function(e){if(e)return{github:!0,owner:n.owner,fullName:n.fullName,name:e.name,description:e.description,defaultBranch:"master",tag:n.tag,status:r}}):m.U.httpGetJsonAsync("https://api.github.com/repos/"+n.fullName).then(function(e){return l(e,t,n.tag)})}function h(e){if(e){var t=/^((https:\/\/)?github.com\/)?([^/]+\/[^/#]+)(#(\w+))?$/i.exec(e.trim());if(t){var n={repo:t?t[3].toLowerCase():null,tag:t?t[5]:null};return n.path=n.repo+(n.tag?"#"+n.tag:""),n}}}function d(e){if(e){e=e.replace(/^github:/i,"");var t=/([^#]+)(#(.*))?/.exec(e);return{owner:t?t[1].split("/")[0].toLowerCase():void 0,fullName:t?t[1].toLowerCase():e.toLowerCase(),tag:t?t[3]:null}}}function g(e){return e?"github:"+e.fullName.toLowerCase()+"#"+(e.tag||"master"):void 0}r.MemoryGithubDb=t,r.db=new t,r.listRefsAsync=function(e,t){return void 0===t&&(t="tags"),i(e,t).then(function(e){return Object.keys(e.refs)})},r.listRefsExtAsync=i,r.pkgConfigAsync=function(e,t){return void 0===t&&(t="master"),r.db.loadConfigAsync(e,t)},r.downloadPackageAsync=function(e,t){var n=d(e);return n?f(n,t)?(m.tickEvent("github.download.banned"),m.log("Github repo is banned"),Promise.resolve(void 0)):r.db.loadPackageAsync(n.fullName,n.tag):(m.log("Unknown github syntax"),Promise.resolve(void 0))},(e=a=r.GitRepoStatus||(r.GitRepoStatus={}))[e.Unknown=0]="Unknown",e[e.Approved=1]="Approved",e[e.Banned=2]="Banned",r.repoIconUrl=function(e){if(e.status==a.Approved)return n(e)},r.mkRepoIconUrl=n,r.repoStatus=u,r.repoAsync=p,r.searchAsync=function(e,t){if(!t)return Promise.resolve([]);var n=e.split("|").map(h).filter(function(e){return!!e});return 0<n.length?Promise.all(n.map(function(e){return p(e.path,t)})).then(function(e){return e.filter(function(e){return e.status!=a.Banned})}):(e+=' in:name,description,readme "for PXT/'+(m.appTarget.platformid||m.appTarget.id)+'"',m.U.httpGetJsonAsync("https://api.github.com/search/repositories?q="+encodeURIComponent(e)).then(function(e){return e.items.map(function(e){return l(e,t)}).filter(function(e){return e.status==a.Approved||t.allowUnapproved&&e.status==a.Unknown})}).catch(function(e){return[]}))},r.parseRepoUrl=h,r.parseRepoId=d,r.isGithubId=function(e){return"github:"==e.slice(0,7)},r.stringifyRepo=g,r.noramlizeRepoId=function(e){return g(d(e))},r.latestVersionAsync=function(e,t){var n=d(e);return n?p(n.fullName,t).then(function(n){if(n)return i(n.fullName,"tags").then(function(e){var t=Object.keys(e.refs);return t.reverse(),(t=t.filter(function(e){return/^v\d+(\.\d+(\.\d+)?)?$/i.test(e)}))[0]?Promise.resolve(t[0]):e.head||c(n.fullName,n.defaultBranch)})}):Promise.resolve(null)},r.publishGistAsync=function(e,t,n,r,i){var o,a={description:r,public:!1,files:n},s={},c="https://api.github.com/gists";return e&&(s.Authorization="token "+e),i&&e&&!t?(o="PATCH",c+="/"+i):o="POST",m.U.requestAsync({url:c,allowHttpErrors:!0,headers:s,method:o,data:a}).then(function(e){return 200!=e.statusCode&&201!=e.statusCode||!e.json.id?404==e.statusCode&&"PATCH"==o?Promise.reject(e.statusCode):404==e.statusCode?Promise.reject("Make sure to add the ``gist`` scope to your token. "+e.text):Promise.reject(e.text):Promise.resolve(e.json.id)})}}(m.github||(m.github={}))}(pxt||(pxt={})),function(m){!function(g){function c(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function l(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function u(e,t){return e[t]|e[t+1]<<8}function n(e){for(var t=new Uint8Array(4*e.length),n=0;n<e.length;++n)c(t,4*n,e[n]);return t}g.HF2_CMD_BININFO=1,g.HF2_MODE_BOOTLOADER=1,g.HF2_MODE_USERSPACE=2,g.HF2_CMD_INFO=2,g.HF2_CMD_RESET_INTO_APP=3,g.HF2_CMD_RESET_INTO_BOOTLOADER=4,g.HF2_CMD_START_FLASH=5,g.HF2_CMD_WRITE_FLASH_PAGE=6,g.HF2_CMD_CHKSUM_PAGES=7,g.HF2_CMD_READ_WORDS=8,g.HF2_CMD_WRITE_WORDS=9,g.HF2_CMD_DMESG=16,g.HF2_FLAG_SERIAL_OUT=128,g.HF2_FLAG_SERIAL_ERR=192,g.HF2_FLAG_CMDPKT_LAST=64,g.HF2_FLAG_CMDPKT_BODY=0,g.HF2_FLAG_MASK=192,g.HF2_SIZE_MASK=63,g.HF2_STATUS_OK=0,g.HF2_STATUS_INVALID_CMD=1,g.HF2_STATUS_EXEC_ERR=2,g.HF2_STATUS_EVENT=128,g.HF2_EV_MASK=8388608,g.write32=c,g.write16=l,g.read32=o,g.read16=u,g.encodeU32LE=n;var t=!(g.decodeU32LE=function(e){for(var t=[],n=0;n<e.length;n+=4)t.push(o(e,n));return t});function f(e){t?m.log("HF2: "+e):m.debug("HF2: "+e)}g.enableLog=function(){t=!0};var e=function(){function e(p){var h=this;this.io=p,this.cmdSeq=m.U.randomUint32(),this.lock=new m.U.PromiseQueue,this.rawMode=!1,this.maxMsgSize=63,this.bootloaderMode=!1,this.reconnectTries=0,this.autoReconnect=!1,this.msgs=new m.U.PromiseBuffer,this.eventHandlers={},this.onSerial=function(e,t){};var d=[];p.onSerial=function(e,t){return h.onSerial(e,t)},p.onData=function(e){var t=e[0]&g.HF2_FLAG_MASK,n=63&e[0],r=new Uint8Array(n);if(m.U.memcpy(r,0,e,1,n),t&g.HF2_FLAG_SERIAL_OUT)h.onSerial(r,t==g.HF2_FLAG_SERIAL_ERR);else if(d.push(r),t!=g.HF2_FLAG_CMDPKT_BODY){m.U.assert(t==g.HF2_FLAG_CMDPKT_LAST);for(var i=0,o=0,a=d;o<a.length;o++){i+=(f=a[o]).length}for(var s=new Uint8Array(i),c=0,l=0,u=d;l<u.length;l++){var f=u[l];m.U.memcpy(s,c,f),c+=f.length}d=[],s[2]&g.HF2_STATUS_EVENT?p.onEvent(s):h.msgs.push(s)}},p.onEvent=function(e){var t=o(e,0),n=m.U.lookup(h.eventHandlers,t+"");n?n(e.slice(4)):f("unhandled event: "+t.toString(16))},p.onError=function(e){f("recv error: "+e.message),h.autoReconnect&&(h.autoReconnect=!1,h.reconnectAsync().then(function(){h.autoReconnect=!0},function(e){f("reconnect error: "+e.message)}))}}return e.prototype.resetState=function(){this.lock=new m.U.PromiseQueue,this.info=null,this.infoRaw=null,this.pageSize=null,this.flashSize=null,this.maxMsgSize=63,this.bootloaderMode=!1,this.msgs.drain()},e.prototype.onEvent=function(e,t){m.U.assert(!!(e&g.HF2_EV_MASK)),this.eventHandlers[e+""]=t},e.prototype.reconnectAsync=function(e){var t=this;return void 0===e&&(e=!1),this.resetState(),e?this.initAsync():(f("reconnect raw="+this.rawMode),this.io.reconnectAsync().then(function(){return t.initAsync()}).catch(function(e){if(t.reconnectTries<5)return t.reconnectTries++,f("error "+e.message+"; reconnecting attempt #"+t.reconnectTries),Promise.delay(500).then(function(){return t.reconnectAsync()});throw e}))},e.prototype.disconnectAsync=function(){return f("disconnect"),this.io.disconnectAsync()},e.prototype.error=function(e){return this.io.error(e)},e.prototype.talkAsync=function(e,t){var n=this;if(this.io.talksAsync)return this.io.talksAsync([{cmd:e,data:t}]).then(function(e){return e[0]});var r=8;t&&(r+=t.length);var i=new Uint8Array(r),o=65535&++this.cmdSeq;c(i,0,e),l(i,4,o),l(i,6,0),t&&m.U.memcpy(i,8,t,0,t.length);var a=0,s=function(){return n.msgs.shiftAsync(1e3).then(function(e){if(u(e,0)!=o){if(a<3)return a++,f("message out of sync, ("+o+" vs "+u(e,0)+"); will re-try"),s();n.error("out of sync")}var t="";switch(e[3]&&(t="; info="+e[3]),e[2]){case g.HF2_STATUS_OK:return e.slice(4);case g.HF2_STATUS_INVALID_CMD:n.error("invalid command"+t);break;case g.HF2_STATUS_EXEC_ERR:n.error("execution error"+t);break;default:n.error("error "+e[2]+t)}return null})};return this.sendMsgAsync(i).then(s)},e.prototype.sendMsgAsync=function(e){return this.sendMsgCoreAsync(e)},e.prototype.sendSerialAsync=function(e,t){return void 0===t&&(t=!1),this.io.sendSerialAsync?this.io.sendSerialAsync(e,t):this.sendMsgCoreAsync(e,t?2:1)},e.prototype.sendMsgCoreAsync=function(r,i){var o=this;void 0===i&&(i=0);var a=new Uint8Array(64),s=function(e){var t=r.length-e;if(t<=0)return Promise.resolve();63<t?(t=63,a[0]=g.HF2_FLAG_CMDPKT_BODY):a[0]=g.HF2_FLAG_CMDPKT_LAST,i&&(a[0]=1==i?g.HF2_FLAG_SERIAL_OUT:g.HF2_FLAG_SERIAL_ERR),a[0]|=t;for(var n=0;n<t;++n)a[n+1]=r[e+n];return o.io.sendPacketAsync(a).then(function(){return s(e+t)})};return this.lock.enqueue("out",function(){return s(0)})},e.prototype.switchToBootloaderAsync=function(){var e=this;return this.bootloaderMode?Promise.resolve():(f("Switching into bootloader mode"),this.io.isSwitchingToBootloader&&this.io.isSwitchingToBootloader(),this.maybeReconnectAsync().then(function(){return e.talkAsync(g.HF2_CMD_START_FLASH)}).then(function(){return e.initAsync()}).then(function(){e.bootloaderMode||e.error("cannot switch into bootloader mode")}))},e.prototype.reflashAsync=function(e){var t=this;return f("reflash"),this.flashAsync(e).then(function(){return Promise.delay(100)}).then(function(){return t.reconnectAsync()})},e.prototype.writeWordsAsync=function(e,t){return m.U.assert(t.length<=64),this.talkAsync(g.HF2_CMD_WRITE_WORDS,n([e,t.length].concat(t))).then(function(){})},e.prototype.readWordsAsync=function(e,t){var n=new Uint8Array(8);return c(n,0,e),c(n,4,t),m.U.assert(t<=64),this.talkAsync(g.HF2_CMD_READ_WORDS,n)},e.prototype.pingAsync=function(){return this.rawMode?Promise.resolve():this.talkAsync(g.HF2_CMD_BININFO).then(function(e){})},e.prototype.maybeReconnectAsync=function(){var t=this;return this.pingAsync().catch(function(e){return t.reconnectAsync().then(function(){return t.pingAsync()})})},e.prototype.flashAsync=function(r){var i=this,o=Date.now(),a=0,s=function(e){if(e>=r.length)return Promise.resolve();var t=r[e];m.U.assert(t.payloadSize==i.pageSize);var n=new Uint8Array(4+t.payloadSize);return c(n,0,t.targetAddr),m.U.memcpy(n,4,t.data,0,t.payloadSize),i.talkAsync(g.HF2_CMD_WRITE_FLASH_PAGE,n).then(function(){return s(e+1)})};return this.switchToBootloaderAsync().then(function(){var e=r.length*i.pageSize;return f("Starting flash ("+Math.round(e/1024)+"kB)."),a=Date.now(),p(r,function(e,t){return i.readWordsAsync(e,t)})}).then(function(e){if(e.length!=r.length){var t=(r=e).length*i.pageSize;f("Performing partial flash ("+Math.round(t/1024)+"kB).")}}).then(function(){return s(0)}).then(function(){var e=Date.now(),t=e-o,n=e-a;f("Flashing done at "+Math.round(r.length*i.pageSize/n*1e3/1024)+" kB/s in "+t+"ms (reset "+(t-n)+"ms). Resetting.")}).then(function(){return i.talkAsync(g.HF2_CMD_RESET_INTO_APP).catch(function(e){})}).then(function(){})},e.prototype.initAsync=function(){var n=this;return this.rawMode?Promise.resolve():Promise.resolve().then(function(){return n.talkAsync(g.HF2_CMD_BININFO)}).then(function(e){return n.bootloaderMode=e[0]==g.HF2_MODE_BOOTLOADER,n.pageSize=o(e,4),n.flashSize=o(e,8)*n.pageSize,n.maxMsgSize=o(e,12),f("Connected; msgSize "+n.maxMsgSize+"B; flash "+n.flashSize/1024+"kB; "+(n.bootloaderMode?"bootloader":"application")+" mode"),n.talkAsync(g.HF2_CMD_INFO)}).then(function(e){n.infoRaw=m.U.fromUTF8(m.U.uint8ArrayToString(e));var r={};("Header: "+n.infoRaw).replace(/^([\w\-]+):\s*([^\n\r]*)/gm,function(e,t,n){return r[t.replace(/-/g,"")]=n,""}),n.info=r;var t=/v(\d\S+)\s+(\S+)/.exec(n.info.Header);n.info.Parsed={Version:t[1],Features:t[2]},f("Board-ID: "+n.info.BoardID+" v"+n.info.Parsed.Version+" f"+n.info.Parsed.Features)}).then(function(){n.reconnectTries=0})},e}();function p(r,e){if(!m.appTarget.compile.flashChecksumAddr)return Promise.resolve(r);var n,t=pxtc.UF2.readBytes(r,m.appTarget.compile.flashChecksumAddr,48),i=pxtc.hex.parseChecksumBlock(t);return i?(n=e,m.appTarget.compile.flashChecksumAddr?n(m.appTarget.compile.flashChecksumAddr,12).then(function(e){var t=pxtc.hex.parseChecksumBlock(e);return t?n(t.endMarkerPos,1).then(function(e){return o(e,0)!=t.endMarker?(m.log("end-marker mismatch"),null):t}):null}):Promise.resolve(null)).then(function(e){if(!e)return r;var n=e.regions.filter(function(t){return i.regions.some(function(e){return t.checksum==e.checksum&&t.length==e.length&&t.start==e.start})});if(0==n.length)return r;f("skipping flash at: "+n.map(function(e){return pxtc.assembler.tohex(e.start)+" ("+e.length/1024+"kB)"}).join(", "));var t=function(t){return n.some(function(e){return e.start<=t&&t<e.start+e.length})};return r.filter(function(e){return!(t(e.targetAddr)&&t(e.targetAddr+e.payloadSize-1))})}):Promise.resolve(r)}g.Wrapper=e,g.onlyChangedBlocksAsync=p}(m.HF2||(m.HF2={}))}(pxt||(pxt={})),function(e){e.REF_TAG_STRING=1,e.REF_TAG_BUFFER=2,e.REF_TAG_IMAGE=3,e.REF_TAG_NUMBER=32,e.REF_TAG_ACTION=33}(pxt||(pxt={})),function(C){!function(t){var g,e,f,n,m,v,a,p,y=C.Util,h=C.HF2,r=1409050336,i=665147697,o=287358355,d=1888490768,s=915601917,c=h.read32,b=!1;function l(e){return e<<2|2}function x(e){return 1&e?e>>1:0!=e?2&e?e==t.taggedNull?null:e!=t.taggedFalse&&(e==t.taggedTrue||{tagged:e>>2}):{ptr:e}:void 0}function u(e,t){if(y.assert(!(3&e)),y.assert(0<=e),e<2097152){var n=new Uint8Array(t);return e-=a.start,y.memcpy(n,0,a.buf,e,t),Promise.resolve(n)}var r=p.maxMsgSize-32;if(r<t){for(var i=[];0<t;){var o=Math.min(r,t);i.push(u(e,o)),t-=o,e+=o}return Promise.all(i).then(y.uint8ArrayConcat)}return p.readWordsAsync(e,Math.ceil(t/4)).then(function(e){return e.length>t?e.slice(0,t):e})}function A(n){if("object"!=typeof n||!n)return Promise.resolve(n);if("number"==typeof n.ptr){if(3&n.ptr)return Promise.resolve({unalignedPtr:n.ptr});var r=0;return u(n.ptr,56).then(function(t){r=h.read16(t,2);var e=t.length;return r==C.REF_TAG_STRING||r==C.REF_TAG_BUFFER?e=h.read16(t,4)+6:r==C.REF_TAG_IMAGE?e=h.read16(t,4)*h.read16(t,8)+8:r==C.REF_TAG_NUMBER&&(e=12),e>t.length?u(n.ptr+t.length,e-t.length).then(function(e){return y.uint8ArrayConcat([t,e])}):e<t.length?t.slice(0,e):t}).then(function(e){return r==C.REF_TAG_STRING?y.uint8ArrayToString(e.slice(6)):r==C.REF_TAG_STRING?{type:"buffer",data:e.slice(6)}:r==C.REF_TAG_IMAGE?{type:"image",data:e.slice(8),width:h.read16(e,4),height:h.read16(e,8)}:r==C.REF_TAG_NUMBER?new Float64Array(e.buffer.slice(4))[0]:{type:"unknown",tag:r,refcnt:h.read16(e,0),data:e.slice(4)}})}return Promise.resolve(n)}function k(n){for(var e=[],t=function(t){e.push(A(n[t]).then(function(e){n[t]=e}))},r=0,i=Object.keys(n);r<i.length;r++){t(i[r])}return Promise.all(e).then(function(){})}function w(e){for(var t=g.breakpoints,n=t[0],r=1/0,i=0,o=t;i<o.length;i++){var a=o[i],s=e-a.binAddr;0<=s&&s<r&&(r=s,n=a)}return n}function E(l){return b?Promise.resolve():(b=!0,S().then(function(e){for(var t,n,r,i=h.decodeU32LE(l)[0],o={},a=0,s=g.procDebugInfo[0].locals;a<s.length;a++){var c=s[a];t=c,r=void 0,n=e.globals,null===(r=function(){switch(t.type){case"uint32":return h.read32(n,t.index);case"int32":return 0|h.read32(n,t.index);case"uint16":return h.read16(n,t.index);case"int16":return h.read16(n,t.index)<<16>>16;case"uint8":return n[t.index];case"int8":return n[t.index]<<24>>24;default:return null}}())&&(y.assert(0==(3&t.index)),r=x(h.read32(n,t.index))),o[t.name]=r}return m=w(i),u={type:"debugger",subtype:"breakpoint",breakpointId:m.id,globals:o,stackframes:[]},f(),p.talkAsync(d)}).then(function(e){!function(e,t){for(var n=m.binAddr,r=0,i=g.procDebugInfo.filter(function(e){return e.codeStartLoc<=n&&n<=e.codeEndLoc})[0];i&&i!=g.procDebugInfo[0];){var o=w(n),a=y.clone(o);a.functionName=i.name,t.stackframes.push({locals:{},funcInfo:a,breakpointId:o.id});for(var s=t.stackframes[t.stackframes.length-1],c=0,l=0,u=i.locals;l<u.length;l++){var f=u[l];y.assert(f.index==c++),s.locals[f.name]=x(e[r++])}n=2147483646&e[r++];for(var p=v[n+""],h=0,d=i.args;h<d.length;h++)f=d[h],s.locals[f.name]=x(e[r+(i.args.length-1-f.index)]);if(!p)break;i=p.from,r+=p.stack-i.localsMark}}(h.decodeU32LE(e),u);var t=[u.globals].concat(u.stackframes.map(function(e){return e.locals}));return Promise.map(t,k)}).then(function(){return t.postMessage(u)}));var u}function T(){b=!1,e=new Promise(function(e,t){f=e})}function _(e){return void 0===e&&(e=!1),Promise.resolve().then(function(){return p.talkAsync(i,h.encodeU32LE([e?1:3]))}).then(T)}function U(){return e||(e=Promise.resolve()),e}function S(){return(n?Promise.resolve(n):p.talkAsync(r).then(function(e){return n={numGlobals:c(e,0),globalsPtr:c(e,4)}})).then(function(e){return p.readWordsAsync(e.globalsPtr,e.numGlobals)}).then(function(e){return{staticState:n,globals:e}})}t.taggedUndefined=0,t.taggedNull=l(1),t.taggedFalse=l(2),t.taggedTrue=l(16),t.postMessage=function(e){return console.log(e)},t.decodeValue=x,t.heapExpandAsync=A,t.heapExpandMapAsync=k,t.startDebugAsync=function(l,e){return(p=e).onEvent(s,E),(b=!1,n=g=null,Promise.resolve()).then(function(){v={};for(var e=[],t=0,n=(g=l).procDebugInfo;t<n.length;t++)e[(o=n[t]).idx]=o;for(var r=0,i=l.procDebugInfo;r<i.length;r++)for(var o,a=0,s=(o=i[r]).calls;a<s.length;a++){var c=s[a];v[c.addr+""]={from:o,to:e[c.procIndex],stack:c.stack}}}).then(function(){var e=g.outfiles[pxtc.BINARY_UF2],t=y.stringToUint8Array(atob(e));a=pxtc.UF2.toBin(t);var n=pxtc.UF2.parseFile(t);return p.reflashAsync(n)}).then(function(){return p.talkAsync(o).catch(function(e){})}).then(function(){return Promise.delay(200)}).then(function(){return p.reconnectAsync()}).then(T).then(U)},t.handleMessage=function(e){if(console.log("HWDBGMSG",e),"debugger"==e.type){var t=!1;switch(e.subtype){case"stepinto":t=!0;case"stepover":_(t)}}},t.resumeAsync=_,t.waitForHaltAsync=U,t.getHwStateAsync=S}(C.HWDBG||(C.HWDBG={}))}(pxt||(pxt={})),function(b){!function(e){var d,t,g,n;(t=d=e.NT||(e.NT={}))[t.Prefix=0]="Prefix",t[t.Infix=1]="Infix",t[t.Block=2]="Block",t[t.NewLine=3]="NewLine",(n=g=e.GlueMode||(e.GlueMode={}))[n.None=0]="None",n[n.WithSpace=1]="WithSpace",n[n.NoSpace=2]="NoSpace";var r,i=["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"];function o(e){return 20<e.length&&/\n/.test(e)?"`"+e.replace(/[\\`${}]/g,function(e){return"\\"+e})+"`":JSON.stringify(e)}function a(e,t,n){return{type:e,op:t,children:n}}function s(){return a(d.NewLine,"",[])}function c(e,t){return a(d.Prefix,e,t)}function l(e,t,n){return a(d.Infix,t,null==e?[n]:[e,n])}function m(e){return c(e,[])}function u(e){return a(d.Block,"",e)}function v(e){return c("",e)}function f(e,t){void 0===t&&(t=!1);for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];t?(0<n.length&&n.push(m(",")),n.push(s())):0<n.length&&n.push(m(", ")),n.push(o)}return t&&n.push(s()),v(n)}e.stringLit=o,e.mkNode=a,e.mkNewLine=s,e.mkPrefix=c,e.mkInfix=l,e.mkText=m,e.mkBlock=u,e.mkGroup=v,e.mkStmt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return n&&n.type==d.Block||e.push(s()),v(e)},e.mkCommaSep=f,function(e){function i(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),v(r?[l(t[0],".",m(e)),m("("),f(t.slice(1),n),m(")")]:[m(e),m("("),f(t,n),m(")")])}function n(e,t,n,r){return i(e+"."+t,n,r)}function r(e,t){return b.U.assert(2==t.length),l(t[0],e,t[1])}e.mkArrayLiteral=function(e){return v([m("["),f(e,!1),m("]")])},e.mkNumberLiteral=function(e){return m(e.toString())},e.mkBooleanLiteral=function(e){return m(e?"true":"false")},e.mkStringLiteral=function(e){return m(o(e))},e.mkPropertyAccess=function(e,t){return v([l(t,".",m(e))])},e.mkCall=i,e.stdCall=function(e,t,n){return i(e,t,n)},e.extensionCall=function(e,t,n){return i(e,t,n,!0)},e.namespaceCall=n,e.mathCall=function(e,t){return n("Math",e,t,!1)},e.mkGlobalRef=function(e){return m(e)},e.mkSimpleCall=r,e.mkWhile=function(e,t){return v([m("while ("),e,m(")"),u(t)])},e.mkComment=function(e){return m("// "+e)},e.mkMultiComment=function(e){var r=[m("/**"),s()];return e.split("\n").forEach(function(e,t,n){e&&(r.push(m(" * "+e)),r.push(s()),t<n.length-1&&(r.push(m(" * ")),r.push(s())))}),v(r.concat([m(" */"),s()]))},e.mkAssign=function(e,t){return r("=",[e,t])},e.mkParenthesizedExpression=function(e){return v([m("("),e,m(")")])}}(r=e.Helpers||(e.Helpers={})),e.H=r;var y={"=":3,"+=":3,"-=":3,"?":4,":":4,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,">>":12,">>>":12,"<<":12,"+":13,"-":13,"*":14,"/":14,"%":14,"**":15,"!":16,"~":16,"P-":16,"P+":16,"++":16,"--":16,".":18};e.flattenNode=function(e){var o=[],a={},s="",c="",l=[{}],t=v(e);return function e(t,n){if(t.type==d.Infix){var r=[],i=b.U.lookup(y,t.op);if(null==i&&b.U.oops("bad infix op: "+t.op),i<n&&c("("),1==t.children.length)c(t.op),e(t.children[0],i),r.push(t.children[0]);else{var o=3!=i&&"**"!=t.op;e(t.children[0],o?i:i+.1),r.push(t.children[0]),"."==t.op?c("."):c(" "+t.op+" "),e(t.children[1],o?i+.1:i),r.push(t.children[1])}i<n&&c(")"),t.type=d.Prefix,t.op="",t.children=r}else for(var a=0,s=t.children;a<s.length;a++)e(s[a],-1);function c(e){"P"==e[0]&&(e=e.slice(1)),r.push(m(e))}}(t,-1),u(t),s||(s+="\n"),{output:s,sourceMap:o};function u(e){e.glueToBlock&&(h(),e.glueToBlock==g.WithSpace&&(s+=" "));var t=f();switch(e.type){case d.Infix:b.U.oops("no infix should be left");break;case d.NewLine:s+="\n"+c;break;case d.Block:!function(e){var t=e.noFinalNewline?"":"\n";if(0==e.children.length)return p(" {\n\t\n}"+t);var n=b.U.clone(l[l.length-1]||{});l.push(n),c+="    "," "!=s[s.length-1]&&p(" "),p("{\n");for(var r=0,i=e.children;r<i.length;r++){var o=i[r];u(o)}c=c.slice(4),h(),p("\n}"+t),l.pop()}(e);break;case d.Prefix:e.canIndentInside?s+=e.op.replace(/\n/g,"\n"+c+"    "):s+=e.op,e.children.forEach(u)}var n=f();if(e.id)if(a[e.id]){var r=a[e.id];r.start=Math.min(r.start,t),r.end=Math.max(r.end,n)}else{var i={id:e.id,start:t,end:n};a[e.id]=i,o.push(i)}}function f(){var t=0;return s.replace(/\n/g,function(e){return t++,e}),t}function p(e){s+=e.replace(/\n/g,"\n"+c)}function h(){s=s.replace(/\n *$/,"")}},e.isReservedWord=function(e){return-1!==i.indexOf(e)}}(b.blocks||(b.blocks={}))}(pxt||(pxt={})),function(g){var e=function(){function i(e,t,n,r){this.id=e,this._verspec=t,this.parent=n,this.level=-1,this.isLoaded=!1,r&&(this.level=r.level+1),this.addedBy=[r]}return i.getConfigAsync=function(r,i,o){return Promise.resolve().then(function(){if(g.github.isGithubId(o)){var t=g.github.parseRepoId(o);return g.packagesConfigAsync().then(function(e){return g.github.repoAsync(t.fullName,e)}).then(function(e){return e?g.github.pkgConfigAsync(t.fullName,t.tag):null})}var e=g.patching.upgradePackageReference(r,i,o),n=g.appTarget.bundledpkgs[e];return JSON.parse(n[g.CONFIG_NAME])})},i.corePackages=function(){var t=g.appTarget.bundledpkgs;return Object.keys(t).map(function(e){return JSON.parse(t[e][g.CONFIG_NAME])}).filter(function(e){return!!e})},i.prototype.version=function(){return this.resolvedVersion||this._verspec},i.prototype.verProtocol=function(){var e=this.version().split(":");return 1<e.length?e[0]:""},i.prototype.verArgument=function(){var e=this.verProtocol();return e?this.version().slice(e.length+1):this.version()},i.prototype.targetVersion=function(){return this.parent&&this.parent!=this?this.parent.targetVersion():this.config.targetVersions?this.config.targetVersions.target:void 0},i.prototype.commonDownloadAsync=function(){var t=this,e=this.verProtocol();if("pub"==e)return g.Cloud.downloadScriptFilesAsync(this.verArgument());if("github"==e)return g.packagesConfigAsync().then(function(e){return g.github.downloadPackageAsync(t.verArgument(),e)}).then(function(e){return e.files});if("embed"==e){var n=g.getEmbeddedScript(this.verArgument());return Promise.resolve(n)}return Promise.resolve(null)},i.prototype.host=function(){return this.parent._host},i.prototype.readFile=function(e){return this.host().readFile(this,e)},i.prototype.resolveDep=function(e){return this.parent.deps.hasOwnProperty(e)?this.parent.deps[e]:null},i.prototype.saveConfig=function(){var e=JSON.stringify(this.config,null,4)||"\n";this.host().writeFile(this,g.CONFIG_NAME,e)},i.prototype.parseJRes=function(e){void 0===e&&(e={});for(var t=0,n=this.getFiles();t<n.length;t++){var r=n[t];if(g.U.endsWith(r,".jres"))for(var i=JSON.parse(this.readFile(r)),o=i["*"],a=0,s=Object.keys(i);a<s.length;a++){var c=s[a];if("*"!=c){var l=i[c];"string"==typeof l&&(l={data:l});var u=l.namespace||o.namespace||"";u&&(u+=".");var f=l.id||u+c,p=l.icon,h=l.mimeType||o.mimeType,d=l.dataEncoding||o.dataEncoding||"base64";p||"base64"!=d||"image/png"!=h&&"image/jpeg"!=h||(p="data:"+h+";base64,"+l.data),e[f]={id:f,data:l.data,dataEncoding:l.dataEncoding||o.dataEncoding||"base64",icon:p,namespace:u,mimeType:h}}}}return e},i.prototype.resolveVersionAsync=function(){var e=this._verspec;return g.getEmbeddedScript(this.id)?this.resolvedVersion=e="embed:"+this.id:e&&"*"!=e||g.U.userError(lf("version not specified for {0}",this.id)),Promise.resolve(e)},i.prototype.downloadAsync=function(){var t=this;return this.resolveVersionAsync().then(function(e){if(/^embed:/.test(e)||!t.config||t.config.installedVersion!=e)return g.debug("downloading "+e),t.host().downloadPackageAsync(t).then(function(){var e=t.readFile(g.CONFIG_NAME);e||g.U.userError("package "+t.id+" is missing "+g.CONFIG_NAME),t.parseConfig(e),0!=t.level&&(t.config.installedVersion=t.version()),t.saveConfig()}).then(function(){g.debug("installed "+t.id+" /"+e)})})},i.prototype.validateConfig=function(){this.config.dependencies||g.U.userError("Missing dependencies in config of: "+this.id),Array.isArray(this.config.files)||g.U.userError("Missing files in config of: "+this.id),("string"!=typeof this.config.name||!this.config.name||this.config.public&&!/^[a-z][a-z0-9\-_]+$/i.test(this.config.name))&&g.U.userError("Invalid package name: "+this.config.name),this.config.targetVersions&&this.config.targetVersions.target&&0<g.semver.majorCmp(this.config.targetVersions.target,g.appTarget.versions.target)&&g.U.userError(lf("Package {0} requires target version {1} (you are running {2})",this.config.name,this.config.targetVersions.target,g.appTarget.versions.target))},i.prototype.isPackageInUse=function(n,e){void 0===e&&(e=this.readFile("main.ts"));var r=null,t=g.patching.computePatches(this.targetVersion(),"missingPackage");return t&&t.forEach(function(t){Object.keys(t.map).forEach(function(e){t.map[e]===n&&(r=new RegExp(e,"g"))})}),r||(r=new RegExp(n+"\\.","g")),r.test(e)},i.prototype.getMissingPackages=function(i,o){var e=g.patching.computePatches(this.targetVersion(),"missingPackage"),a={};return o&&e&&e.forEach(function(r){Object.keys(r.map).forEach(function(e){var t=new RegExp(e,"g"),n=r.map[e];o.replace(t,function(e){return i.dependencies[n]||(a[n]="*"),""})})}),a},i.prototype.findConflictsAsync=function(e,f){var p,n=this,h=[];return Promise.resolve().then(function(){return"string"==typeof e?i.getConfigAsync(n.targetVersion(),e,f):Promise.resolve(e)}).then(function(e){if(p=e){var u=p.yotta?g.U.jsonFlatten(p.yotta.config):null;n.parent.sortedDeps().forEach(function(e){if(p.core&&e.config.core)return(a=new g.cpp.PkgConflictError(lf("conflict between core packages {0} and {1}",p.name,e.id))).pkg0=e,void h.push(a);var t=!1;if(u){var n=e.config||JSON.parse(e.readFile(g.CONFIG_NAME));if(!!n&&!!n.yotta&&!!e.config.yotta.config)for(var r=g.U.jsonFlatten(n.yotta.config),i=0,o=Object.keys(u);i<o.length;i++){var a,s=o[i],c=r[s],l=p.yotta.configIsJustDefaults||n.yotta.configIsJustDefaults;if(r.hasOwnProperty(s)&&c!==u[s]&&!l&&(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts))(a=new g.cpp.PkgConflictError(lf("conflict on yotta setting {0} between packages {1} and {2}",s,p.name,e.id))).pkg0=e,a.settingName=s,h.push(a),t=!0}}t||p.name!==e.id||e._verspec==f||/^file:/.test(e._verspec)||/^file:/.test(f)||((a=new g.cpp.PkgConflictError(lf("version mismatch for package {0} (installed: {1}, installing: {2})",e,e._verspec,f))).pkg0=e,a.isVersionConflict=!0,h.push(a))})}return Object.keys(p.dependencies).reduce(function(e,t){return e.then(function(){return n.findConflictsAsync(t,p.dependencies[t])}).then(function(e){return h.push.apply(h,e)})},Promise.resolve())}).then(function(){var r=function(e){var t=[];return e.addedBy.forEach(function(e){e.id!==n.id&&(t.push.apply(r(e)),t.push(e))}),t},e=[];return h.forEach(function(n){e.push.apply(e,r(n.pkg0).map(function(e){var t=new g.cpp.PkgConflictError(n.isVersionConflict?lf("a dependency of {0} has a version mismatch with package {1} (installed: {1}, installing: {2})",e.id,p.name,n.pkg0._verspec,f):lf("conflict on yotta setting {0} between packages {1} and {2}",n.settingName,p.name,n.pkg0.id));return t.pkg0=e,t}))}),h.push.apply(h,e),h=h.filter(function(e,t){for(var n=0;n<t;++n)if(e.pkg0.id===h[n].pkg0.id)return!1;return!0})})},i.prototype.upgradeFile=function(e,t){var n=g.patching.patchJavaScript(this.targetVersion(),t);return n!=t&&(g.debug("patching javascript in "+e+" (size="+t.length+")..."),this.host().writeFile(this,e,n,!0)),n},i.prototype.parseConfig=function(e,t){var n=JSON.parse(e);this.config=n;var r=JSON.stringify(this.config);for(var i in this.config.dependencies){var o=g.patching.upgradePackageReference(this.targetVersion(),i,this.config.dependencies[i]);o!=i&&(delete this.config.dependencies[i],o&&(this.config.dependencies[o]="*"))}t&&(this.config.targetVersions={target:t}),JSON.stringify(this.config)!=r&&this.saveConfig(),this.validateConfig()},i.prototype.patchCorePackage=function(){var t=this;g.Util.assert(g.appTarget.simulator&&g.appTarget.simulator.dynamicBoardDefinition),g.Util.assert(0==this.level);var e=Object.keys(this.config.dependencies).filter(function(e){return!!e&&JSON.parse((g.appTarget.bundledpkgs[e]||{})[g.CONFIG_NAME]||"{}").core});if(0==e.length){var n=g.Package.corePackages();n.length&&this.config.dependencies[n[0].name]}else 1<e.length&&(e.pop(),e.forEach(function(e){g.log("removing core package "+e),delete t.config.dependencies[e]}))},i.prototype.dependencies=function(){if(!this.config)return{};var e=g.Util.clone(this.config.dependencies||{});return 0==this.level&&this.config.testDependencies&&g.Util.jsonMergeFrom(e,this.config.testDependencies),e},i.prototype.loadAsync=function(r,e){var s=this;if(void 0===r&&(r=!1),this.isLoaded)return Promise.resolve();var t=Promise.resolve();this.isLoaded=!0;var n=this.readFile(g.CONFIG_NAME);null==n?r||g.U.userError("Package not installed: "+this.id+", did you forget to run `pxt install`?"):t=t.then(function(){return s.parseConfig(n)}),r&&(t=t.then(function(){return s.downloadAsync()})),r&&0==this.level&&(t=t.then(function(){g.debug("upgrading files, target version "+s.targetVersion()),s.getFiles().filter(function(e){return/\.ts$/.test(e)}).forEach(function(e){return s.upgradeFile(e,s.readFile(e))})})),g.appTarget.simulator&&g.appTarget.simulator.dynamicBoardDefinition&&(0==this.level&&(t=t.then(function(){return s.patchCorePackage()})),t=t.then(function(){if(!(s.config.files.indexOf("board.json")<0)){g.setAppTargetVariant(s.config.compileServiceVariant);var e=g.appTarget.simulator.boardDefinition=JSON.parse(s.readFile("board.json"));e.id=s.config.name,g.appTarget.appTheme.boardName=e.boardName||lf("board"),g.appTarget.appTheme.driveDisplayName=e.driveDisplayName||lf("DRIVE");var t=function(e){var t=/^pkg:\/\/(.*)/.exec(e);if(t){var n=t[1],r=s.readFile(n);return g.U.toDataUri(r,g.U.getMime(n))}return e},n=g.appTarget.simulator.boardDefinition;if("object"==typeof n.visual){var r=n.visual;r.image=t(r.image),r.outlineImage=t(r.outlineImage)}}}));var c=function(e){return g.U.mapStringMapAsync(e,function(e,t){var n=s.resolveDep(e);return t=t||"*",n?(n._verspec==t||/^file:/.test(n._verspec)||/^file:/.test(t)||g.U.userError("Version spec mismatch on "+e),n.level=Math.min(n.level,s.level+1),n.addedBy.push(s),Promise.resolve()):(n=new i(e,t,s.parent,s),s.parent.deps[e]=n,(s.parent.deps[e.replace(/---.*/,"")]=n).loadAsync(r))})};return t.then(function(){return c(s.dependencies())}).then(function(){if(s.config.palette&&g.appTarget.runtime&&(g.appTarget.runtime.palette=g.U.clone(s.config.palette)),s.config.screenSize&&g.appTarget.runtime&&(g.appTarget.runtime.screenSize=g.U.clone(s.config.screenSize)),0===s.level){var e=s.readFile("main.ts");if(!e)return Promise.resolve(null);var o=s.getMissingPackages(s.config,e),a=!1;Promise.resolve();Object.keys(o).reduce(function(e,i){return e.then(function(){return s.findConflictsAsync(i,o[i])}).then(function(e){if(e.length){var t=e.map(function(e){return e.pkg0.id}).join(", "),n=e.map(function(e){return e.settingName}).filter(function(e){return!!e}).join(", ");return g.log("skipping missing package "+i+" because it conflicts with the following packages: "+t+" (conflicting settings: "+n+")"),Promise.resolve(null)}g.log("adding missing package "+i),a=!0,s.config.dependencies[i]="*";var r={};return r[i]=o[i],c(r)})},Promise.resolve(null)).then(function(){return a&&(s.saveConfig(),s.validateConfig()),Promise.resolve(null)})}return Promise.resolve(null)}).then(function(){return null})},i.prototype.getFiles=function(){return 0==this.level?this.config.files.concat(this.config.testFiles||[]):this.config.files.slice(0)},i.prototype.addSnapshot=function(e,n){void 0===n&&(n=[""]);for(var t=function(t){n.some(function(e){return g.U.endsWith(t,e)})&&(e[r.id+"/"+t]=r.readFile(t))},r=this,i=0,o=this.getFiles();i<o.length;i++){t(o[i])}e[this.id+"/"+g.CONFIG_NAME]=this.readFile(g.CONFIG_NAME)},i.prototype.packageLocalizationStringsAsync=function(n){var r=this,i=g.appTarget.id,e=[this.id+"-jsdoc",this.id],o={},a=g.appTarget.appTheme||{};if(g.Util.localizeLive&&"this"!=this.id&&g.appTarget.bundledpkgs[this.id]){g.log("loading live translations for "+this.id);var s=g.Util.userLanguage();return Promise.all(e.map(function(t){return g.Util.downloadLiveTranslationsAsync(s,i+"/"+t+"-strings.json",a.crowdinBranch).then(function(e){e&&Object.keys(e).length?g.Util.jsonMergeFrom(o,e):(g.tickEvent("translations.livetranslationsfailed",{filename:t}),g.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t)))}).catch(function(e){g.tickEvent("translations.livetranslationsfailed",{filename:t}),g.log("error while downloading "+i+"/"+t+"-strings.json"),g.Util.jsonMergeFrom(o,r.bundledStringsForFile(n,t))})})).then(function(){return o})}return e.map(function(e){return r.bundledStringsForFile(n,e)}).filter(function(e){return!!e}).forEach(function(e){return g.Util.jsonMergeFrom(o,e)}),Promise.resolve(o)},i.prototype.bundledStringsForFile=function(e,t){var n={},r=this.config.files,i="_locales/"+e.toLowerCase()+"/"+t+"-strings.json";return-1<r.indexOf(i)&&(n=JSON.parse(this.readFile(i))),2<e.length&&(i="_locales/"+e.substring(0,2).toLowerCase()+"/"+t+"-strings.json",-1<r.indexOf(i)&&(n=JSON.parse(this.readFile(i)))),n},i}(),t=function(n){function e(e){var t=n.call(this,"this","file:.",null,null)||this;return t._host=e,t.deps={},(t.parent=t).addedBy=[t],t.level=0,t.deps[t.id]=t}return __extends(e,n),e.prototype.installAllAsync=function(e){return this.loadAsync(!0,e)},e.prototype.sortedDeps=function(){var r=this,i={},o=[],a=function(e){if(e&&!g.U.lookup(i,e.id)){i[e.id]=!0;var t=e.dependencies(),n=Object.keys(t);n.sort(function(e,t){return g.U.strcmp(e,t)}),n.forEach(function(e){return a(r.resolveDep(e))}),o.push(e.id)}};return a(this),o.map(function(e){return r.resolveDep(e)})},e.prototype.localizationStringsAsync=function(t){var n={};return Promise.all(g.Util.values(this.deps).map(function(e){return e.packageLocalizationStringsAsync(t).then(function(t){t&&Object.keys(t).forEach(function(e){n[e]||(n[e]=t[e])})})})).then(function(){return n})},e.prototype.getTargetOptions=function(){var e=g.U.clone(g.appTarget.compile);return g.U.assert(!!e),e},e.prototype.getJRes=function(){if(!this._jres){this._jres={};for(var e=0,t=this.sortedDeps();e<t.length;e++){t[e].parseJRes(this._jres)}if(g.appTarget.runtime&&g.appTarget.runtime.palette){var n=g.appTarget.runtime.palette.map(function(e){return("000000"+parseInt(e.replace(/#/,""),16).toString(16)).slice(-6)}).join("");this._jres.__palette={id:"__palette",data:n,dataEncoding:"hex",mimeType:"application/x-palette"}}}return this._jres},e.prototype.getCompileOptionsAsync=function(r){var s=this;void 0===r&&(r=this.getTargetOptions());var c={sourceFiles:[],fileSystem:{},target:r,hexinfo:{hex:[]},name:this.config?this.config.name:""},e=function(e,t){s.config.files.indexOf(e)<0&&g.U.userError(lf("please add '{0}' to \"files\" in {1}",e,g.CONFIG_NAME)),t="// Auto-generated. Do not edit.\n"+t+"\n// Auto-generated. Do not edit. Really.\n",s.host().readFile(s,e,!0)!==t&&(g.debug("updating "+e+" (size="+t.length+")..."),s.host().writeFile(s,e,t,!0))};return this.loadAsync().then(function(){g.debug("building: "+s.sortedDeps().map(function(e){return e.config.name}).join(", "));var t=g.cpp.getExtensionInfo(s);return t.shimsDTS&&e("shims.d.ts",t.shimsDTS),t.enumsDTS&&e("enums.d.ts",t.enumsDTS),(r.isNative?s.host().getHexInfoAsync(t):Promise.resolve(null)).then(function(e){delete(t=g.U.flatClone(t)).compileData,delete t.generatedFiles,delete t.extensionFiles,c.extinfo=t,c.hexinfo=e})}).then(function(){return s.config.binaryonly||g.appTarget.compile.shortPointers||!c.target.isNative?null:s.filesToBePublishedAsync(!0)}).then(function(e){if(e){e=g.U.mapMap(e,function(e,t){return s.upgradeFile(e,t)});var t=JSON.stringify({name:s.config.name,comment:s.config.description,status:"unpublished",scriptId:s.config.installedVersion,cloudId:g.CLOUD_ID+g.appTarget.id,editor:r.preferredEditor?r.preferredEditor:g.U.lookup(e,"main.blocks")?g.BLOCKS_PROJECT_NAME:g.JAVASCRIPT_PROJECT_NAME,targetVersions:g.appTarget.versions}),n=JSON.stringify(e);return g.lzmaCompressAsync(t+n).then(function(e){e&&(c.embedMeta=JSON.stringify({compression:"LZMA",headerSize:t.length,textSize:n.length,name:s.config.name,eURL:g.appTarget.appTheme.embedUrl,eVER:g.appTarget.versions?g.appTarget.versions.target:"",pxtTarget:g.appTarget.id}),c.embedBlob=ts.pxtc.encodeBase64(g.U.uint8ArrayToString(e)))})}return Promise.resolve()}).then(function(){for(var e=0,t=s.sortedDeps();e<t.length;e++)for(var n=t[e],r=0,i=n.getFiles();r<i.length;r++){var o=i[r];if(/\.(ts|asm)$/.test(o)){var a=o;0<n.level&&(a="pxt_modules/"+n.id+"/"+o),c.sourceFiles.push(a),c.fileSystem[a]=n.readFile(o)}}return c.jres=s.getJRes(),c})},e.prototype.filesToBePublishedAsync=function(o){var a=this;void 0===o&&(o=!1);var s={};return this.loadAsync().then(function(){o||a.config.public||g.U.userError('Only packages with "public":true can be published');var n=g.U.clone(a.config);delete n.installedVersion,delete n.additionalFilePath,n.targetVersions||(n.targetVersions=g.appTarget.versions),g.U.iterMap(n.dependencies,function(e,t){(!t||/^file:/.test(t)||/^workspace:/.test(t))&&(n.dependencies[e]="*")}),s[g.CONFIG_NAME]=JSON.stringify(n,null,4);for(var e=0,t=a.getFiles();e<t.length;e++){var r=t[e],i=a.readFile(r);null==i&&g.U.userError("referenced file missing: "+r),s[r]=i}return g.U.sortObjectFields(s)})},e.prototype.saveToJsonAsync=function(t){var n=this;return this.filesToBePublishedAsync(!0).then(function(e){return{meta:{cloudId:g.CLOUD_ID+g.appTarget.id,targetVersions:g.appTarget.versions,editor:t||g.BLOCKS_PROJECT_NAME,name:n.config.name},source:JSON.stringify(e,null,2)}})},e.prototype.compressToFileAsync=function(e){return this.saveToJsonAsync(e).then(function(e){return g.lzmaCompressAsync(JSON.stringify(e,null,2))})},e.prototype.computePartDefinitions=function(o){if(!o||!o.length)return{};var a={};return this.sortedDeps().forEach(function(r){var e=r.readFile("pxtparts.json");if(e)try{var i=JSON.parse(e);Object.keys(i).forEach(function(e){if(0<=o.indexOf(e)){var t=a[e]=i[e];if("string"==typeof t.visual.image&&/\.svg$/i.test(t.visual.image)){var n=r.readFile(t.visual.image);n||g.reportError("parts","invalid part definition",{error:"missing visual "+t.visual.image}),t.visual.image="data:image/svg+xml,"+encodeURIComponent(n)}}})}catch(e){g.reportError("parts","invalid pxtparts.json file")}}),a},e}(g.Package=e);g.MainPackage=t}(pxt||(pxt={})),function(o){var e;(e=o.patching||(o.patching={})).computePatches=function(e,t){var n=o.appTarget.compile?o.appTarget.compile.patches:void 0;if(n){var r=o.semver.tryParse(e||"0.0.0")||o.semver.tryParse("0.0.0"),i=[];return Object.keys(n).filter(function(e){return o.semver.inRange(e,r)}).forEach(function(e){return i=i.concat(n[e])}),t&&(i=i.filter(function(e){return e.type==t})),i.length?i:void 0}},e.upgradePackageReference=function(e,t,n){if("*"!=n)return t;var r=o.patching.computePatches(e,"package"),i=t;return r&&r.forEach(function(t){Object.keys(t.map).forEach(function(e){i==e&&(i=t.map[e])})}),i},e.patchJavaScript=function(e,t){var n=o.patching.computePatches(e,"api"),r=t;return n&&n.forEach(function(e){for(var t in e.map){var n=new RegExp(t,"g");r=r.replace(n,e.map[t])}}),r}}(pxt||(pxt={})),function(f){!function(e){function s(e,t){if(e){if(t){var n=e.major-t.major||e.minor-t.minor||e.patch-t.patch;if(n)return n;if(0==e.pre.length&&0<t.pre.length)return 1;if(0<e.pre.length&&0==t.pre.length)return-1;for(var r=0;r<e.pre.length+1;++r){var i=e.pre[r],o=t.pre[r];if(!i)return o?-1:0;if(!o)return 1;if(/^\d+$/.test(i)){if(!/^\d+$/.test(o))return-1;if(n=parseInt(i)-parseInt(o))return n}else{if(/^\d+$/.test(o))return 1;if(n=f.U.strcmp(i,o))return n}}return 0}return-1}return t?1:0}function a(e){var t=c(e);return t||f.U.userError(f.U.lf("'{0}' doesn't look like a semantic version number",e)),t}function c(e){/^v\d/i.test(e)&&(e=e.slice(1));var t=/^(\d+)\.(\d+)\.(\d+)(-([0-9a-zA-Z\-\.]+))?(\+([0-9a-zA-Z\-\.]+))?$/.exec(e);return t?{major:parseInt(t[1]),minor:parseInt(t[2]),patch:parseInt(t[3]),pre:t[5]?t[5].split("."):[],build:t[7]?t[7].split("."):[]}:null}function l(e){var t=e.major+"."+e.minor+"."+e.patch;return e.pre.length&&(t+="-"+e.pre.join(".")),e.build.length&&(t+="+"+e.build.join(".")),t}function u(e,t){var n=e.split(" - ");if(2!=n.length)return!1;var r=c(n[0]),i=c(n[1]);if(!r||!i)return!1;if(!t)return!0;var o=s(r,t),a=s(t,i);return o<=0&&a<0}e.cmp=s,e.parse=a,e.tryParse=c,e.normalize=function(e){return l(a(e))},e.stringify=l,e.majorCmp=function(e,t){var n=c(e),r=c(t);return n.major-r.major},e.strcmp=function(e,t){var n=c(e),r=c(t);return n||r?s(n,r):f.U.strcmp(e,t)},e.inRange=u,e.test=function(){console.log("Test semver");for(var e=["0.9.0","1.0.0-0.3.7","1.0.0-alpha","1.0.0-alpha.1","1.0.0-alpha.beta","1.0.0-beta","1.0.0-beta.2","1.0.0-beta.11","1.0.0-rc.1","1.0.0-x.7.z.92","1.0.0","1.0.1","1.9.0","1.10.0","1.11.0"],t=0;t<e.length;++t){var n=a(e[t]);console.log(e[t],n),f.U.assert(l(n)==e[t]);for(var r=0;r<e.length;++r){var i=s(n,a(e[r]));console.log(e[t],e[r],i),t<r?f.U.assert(i<0):r<t?f.U.assert(0<i):f.U.assert(0==i)}}var o=c("1.2.3");f.U.assert(u("0.1.2 - 2.2.3",o)),f.U.assert(u("1.2.3 - 2.2.3",o)),f.U.assert(!u("0.0.0 - 1.2.3",o)),f.U.assert(!u("1.2.4 - 4.2.3",o)),f.U.assert(!u("0.0.0 - 0.0.1",o))}}(f.semver||(f.semver={}))}(pxt||(pxt={})),function(e){!function(x){var A,e;x.assert=x.Util.assert,x.oops=x.Util.oops,x.U=x.Util,x.ON_START_TYPE="pxt-on-start",x.ON_START_COMMENT=x.U.lf("on start"),x.HANDLER_COMMENT=x.U.lf("code goes here"),x.TS_STATEMENT_TYPE="typescript_statement",x.TS_DEBUGGER_TYPE="debugger_keyword",x.TS_OUTPUT_TYPE="typescript_expression",x.PAUSE_UNTIL_TYPE="pxt_pause_until",x.BINARY_JS="binary.js",x.BINARY_CS="binary.cs",x.BINARY_ASM="binary.asm",x.BINARY_HEX="binary.hex",x.BINARY_UF2="binary.uf2",x.BINARY_ELF="binary.elf",x.NATIVE_TYPE_THUMB="thumb",x.NATIVE_TYPE_AVR="AVR",x.NATIVE_TYPE_CS="C#",x.NATIVE_TYPE_AVRVM="AVRVM",(e=A=x.SymbolKind||(x.SymbolKind={}))[e.None=0]="None",e[e.Method=1]="Method",e[e.Property=2]="Property",e[e.Function=3]="Function",e[e.Variable=4]="Variable",e[e.Module=5]="Module",e[e.Enum=6]="Enum",e[e.EnumMember=7]="EnumMember",e[e.Class=8]="Class",e[e.Interface=9]="Interface",x.computeUsedParts=function(r,e){if(void 0===e&&(e=!1),!r.usedSymbols||!pxt.appTarget.simulator||!pxt.appTarget.simulator.parts)return[];var i=[];if(Object.keys(r.usedSymbols).forEach(function(e){var t=r.usedSymbols[e];if(t&&t.attributes.parts){var n=t.attributes.parts;n&&n.split(/[ ,]+/).forEach(function(e){0<e.length&&i.indexOf(e)<0&&i.push(e)})}}),e){var t=pxt.appTarget.simulator.boardDefinition.onboardComponents;t&&(i=i.filter(function(e){return t.indexOf(e)<0}))}return i.sort(),i=i.reverse()},x.blocksCategory=function(e){var t=e?e.attributes.blockNamespace||e.namespace:void 0;return t?x.Util.capitalize(t.split(".")[0]):void 0},x.getBlocksInfo=function(e){var g=[],m={},v={},y={};function t(e,t){var n="get"==e,r="set"==e,i="number"==t.retType,o=n?v:r?m:y,a=t.namespace+"."+t.retType,s=x.U.lookup(o,a);if(!s){var c="@"+e+"@",l=void 0,u=void 0;if(t.attributes.blockCombineShadow){var f=t.attributes.blockCombineShadow,p=f.match(/^([^,.]*),?([^,.]*)$/);p&&3==p.length&&(l=p[1].trim(),0!=(u=p[2].trim()).length||x.Util.endsWith(f,",")||(u=l,l=""))}var h=t.namespace.toLowerCase()+"="+(l||""),d="value="+(u||"");(s=o[a]={attributes:{blockId:(i?t.namespace:a)+"_blockCombine_"+e,callingConvention:x.ir.CallingConvention.Plain,group:t.attributes.group,paramDefl:{},jsDoc:n?x.U.lf("Read value of a property on an object"):x.U.lf("Update value of property on an object")},name:c,namespace:t.namespace,qName:a+"."+c,pkg:t.pkg,kind:A.Property,parameters:[{name:"property",description:n?x.U.lf("the name of the property to read"):x.U.lf("the name of the property to change"),isEnum:!0,type:"@combined@"},{name:"value",description:r?x.U.lf("the new value of the property"):x.U.lf("the amount by which to change the property"),type:t.retType}].slice(0,n?1:2),retType:n?t.retType:"void",combinedProperties:[]}).attributes.block=n?"%"+h+" %property":r?"set %"+h+" %property to %"+d:"change %"+h+" %property by %"+d,k(s.attributes),g.push(s)}s.combinedProperties.push(t.qName)}for(var n=0,r=x.Util.values(e.byQName);n<r.length;n++){var i=r[n];if(i.attributes.blockCombine)/@set/.test(i.name)||t("get",i),i.isReadOnly||("number"==i.retType&&t("change",i),t("set",i));else if(i.attributes.block&&!i.attributes.fixedInstance&&i.kind!=x.SymbolKind.EnumMember&&i.kind!=x.SymbolKind.Module&&i.kind!=x.SymbolKind.Interface&&i.kind!=x.SymbolKind.Class){if(i.attributes.blockId||(i.attributes.blockId=i.qName.replace(/\./g,"_")),"true"==i.attributes.block){var o=x.U.uncapitalize(i.name);i.kind!=A.Method&&i.kind!=A.Property||(o+=" %"+i.namespace.toLowerCase());for(var a=0,s=i.parameters||[];a<s.length;a++)o+=" %"+s[a].name;i.attributes.block=o,k(i.attributes)}g.push(i)}}for(var c=0,l=g;c<l.length;c++){o=l[c];var u=x.U.lookup(e.byQName,o.namespace);if(u)for(var f=u.attributes,p=o.attributes,h=0,d=["blockNamespace","color","blockGap"];h<d.length;h++){var b=d[h];void 0===p[b]&&f[b]&&(p[b]=f[b])}}return{apis:e,blocks:g,blocksById:pxt.Util.toDictionary(g,function(e){return e.attributes.blockId})}},x.localizeApisAsync=function(e,t){var n=x.Util.userLanguage();return"en"==x.Util.userLanguage()?Promise.resolve(e):t.localizationStringsAsync(n).then(function(s){return x.Util.values(e.byQName).forEach(function(t){var e=s[t.qName];e&&(t.attributes.jsDoc=e,t.parameters&&t.parameters.forEach(function(e){return e.description=s[t.qName+"|param|"+e.name]||e.description}));var n=s["{id:category}"+x.Util.capitalize(t.qName)],r=s[t.qName+"|block"];if(n)t.attributes.block?t.attributes.block=r||t.attributes.block:t.attributes.block=n;else if(t.attributes.block&&r){var i=pxt.blocks.compileInfo(t),o=t.attributes.block;if(t.attributes.block=pxt.blocks.normalizeBlock(r),o!=t.attributes.block){var a=pxt.blocks.compileInfo(t);JSON.stringify(i)!=JSON.stringify(a)&&(pxt.log("block has non matching arguments: "+o+" vs "+t.attributes.block),t.attributes.block=o)}}k(t.attributes)})}).then(function(){return e})},x.emptyExtInfo=function(){var e=pxt.appTarget.compileService;e||(e={});var t=!!e.platformioIni,n="dockermake"==e.buildEngine,r={functions:[],generatedFiles:{},extensionFiles:{},sha:"",compileData:"",shimsDTS:"",enumsDTS:"",onlyPublic:!0};return t?r.platformio={dependencies:{}}:n?r.npmDependencies={}:r.yotta={config:{},dependencies:{}},r};var t,a=["weight","imageLiteral"],s=["advanced","handlerStatement","afterOnStart","optionalVariableArgs","blockHidden","constantShim","blockCombine","decompileIndirectFixedInstances","draggableParameters"];function k(e){if(e.block){var t=e.block.split("||");e._def=n(t[0]),e._def||pxt.debug("Unable to parse block def for id: "+e.blockId),t[1]&&(e._expandedDef=n(t[1])),t[1]&&!e._expandedDef&&pxt.debug("Unable to parse expanded block def for id: "+e.blockId)}}function n(c){for(var l,u=[],f=0,e=function(){var t=c[f],e=void 0;switch(t){case"*":case"_":var n=y(function(e){return e==t}).length,r="_"===t?2:0;if(1===n)e={kind:1<<r};else if(2===n)e={kind:2<<r};else{if(3!==n)return{value:void 0};e={kind:3<<r}}break;case"`":var i=b("`");if(void 0===i)return{value:void 0};e={kind:256,content:i};break;case"|":e={kind:32};break;case"\\":f<c.length-1&&(e={kind:16,content:c[1+f++]});break;case"[":var o=b("]");if(void 0===o)return{value:void 0};if("("!==c[1+f++])return{value:void 0};var a=b(")");if(void 0===a)return{value:void 0};e={kind:512,content:o,type:a};break;case"$":case"%":var s=y(function(e){return/[a-zA-Z0-9_=]/.test(e)},!0).split("=");if(2<s.length)return{value:void 0};e={kind:"$"===t?1024:64,content:s[0],type:s[1]}}e?(l&&u.push({kind:128,content:l}),l=void 0,u.push(e)):l?l+=t:l=t};f<c.length;f++){var t=e();if("object"==typeof t)return t.value}l&&u.push({kind:128,content:l});for(var n=[],r=[],i=[],o=0,a="",s=0;s<u.length;s++){var p=u[s].kind,h=i[i.length-1],d=!1,g=[];if(10&o&&g.push("bold"),5&o&&g.push("italics"),15&p)if(d=!0,p&o){if(!(h&p))return;i.pop();var m=h&(o^=p)|p&o;m&&i.push(m)}else o|=p,i.push(p);else switch(p){case 16:case 128:a+=u[s].content;break;case 32:case 64:case 1024:if(o)return;case 256:case 512:d=!0}if(d&&a&&(n.push({kind:"label",text:a,style:g}),a=""),64==p){var v={kind:"param",name:u[s].content,shadowBlockId:u[s].type,ref:!1};n.push(v),r.push(v)}else if(1024==p){v={kind:"param",name:u[s].content,shadowBlockId:u[s].type,ref:!0};n.push(v),r.push(v)}else 256==p?n.push({kind:"image",uri:u[s].content}):512==p?n.push({kind:"label",text:u[s].content,cssClass:u[s].type}):32==p&&n.push({kind:"break"})}if(!o)return a&&n.push({kind:"label",text:a,style:[]}),{parts:n,parameters:r};function y(e,t){void 0===t&&(t=!1);var n="";for(t&&f++;f<c.length&&e(c[f]);)n+=c[f],++f;return n&&f--,n}function b(t){var e=y(function(e){return e!==t},!0);if(c[f+1]===t)return++f,e}}x.parseCommentString=function(e){for(var u={paramDefl:{},callingConvention:x.ir.CallingConvention.Plain,_source:e},f=!0;f;)f=!1,e=e.replace(/\/\/%[ \t]*([\w\.]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,function(e,t,n,r,i,o,a){var s=i?JSON.parse(i):n?i||o||a:"true";if(s||(s=""),x.U.endsWith(t,".defl"))-1<s.indexOf(" ")?u.paramDefl[t.slice(0,t.length-5)]='"'+s+'"':u.paramDefl[t.slice(0,t.length-5)]=s;else if(x.U.endsWith(t,".fieldEditor"))u.paramFieldEditor||(u.paramFieldEditor={}),u.paramFieldEditor[t.slice(0,t.length-12)]=s;else if(x.U.contains(t,".fieldOptions.")){u.paramFieldEditorOptions||(u.paramFieldEditorOptions={});var c=t.slice(0,t.indexOf(".fieldOptions.")),l=t.slice(t.indexOf(".fieldOptions.")+14,t.length);u.paramFieldEditorOptions[c]||(u.paramFieldEditorOptions[c]={}),u.paramFieldEditorOptions[c][l]=s}else x.U.contains(t,".shadowOptions.")?(u.paramShadowOptions||(u.paramShadowOptions={}),c=t.slice(0,t.indexOf(".shadowOptions.")),l=t.slice(t.indexOf(".shadowOptions.")+15,t.length),u.paramShadowOptions[c]||(u.paramShadowOptions[c]={}),u.paramShadowOptions[c][l]=s):x.U.endsWith(t,".min")?(u.paramMin||(u.paramMin={}),u.paramMin[t.slice(0,t.length-4)]=s):x.U.endsWith(t,".max")?(u.paramMax||(u.paramMax={}),u.paramMax[t.slice(0,t.length-4)]=s):u[t]=s;return f=!0,"//% "});for(var t=0,n=a;t<n.length;t++){var r=n[t];"string"==typeof u[r]&&(u[r]=parseInt(u[r]))}for(var i=0,o=s;i<o.length;i++)r=o[i],"string"==typeof u[r]&&(u[r]="true"==u[r]||"1"==u[r]);if(u.trackArgs&&(u.trackArgs=u.trackArgs.split(/[ ,]+/).map(function(e){return parseInt(e)||0})),u.blockExternalInputs&&!u.inlineInputMode&&(u.inlineInputMode="external"),u.paramHelp={},u.jsDoc="",e=e.replace(/\/\*\*([^]*?)\*\//g,function(e,t){return t=(t=t.replace(/\n\s*(\*\s*)?/g,"\n")).replace(/^\s*@param\s+(\w+)\s+(.*)$/gm,function(e,t,n){if(u.paramHelp[t]=n,!u.paramDefl[t]){var r=/\beg\.?:\s*(.+)/.exec(n);if(r&&r[1]){var i=/(?:"([^"]*)")|(?:'([^']*)')|(?:([^\s,]+))/g.exec(r[1]);if(i){var o=i[1]||i[2]||i[3];o||(o=""),-1<o.indexOf(" ")?u.paramDefl[t]='"'+o+'"':u.paramDefl[t]=o}}}return""}),u.jsDoc+=t,""}),u.jsDoc=u.jsDoc.trim(),u.async&&(u.callingConvention=x.ir.CallingConvention.Async),u.promise&&(u.callingConvention=x.ir.CallingConvention.Promise),u.jres&&(u.whenUsed=!0),u.subcategories)try{u.subcategories=JSON.parse(u.subcategories)}catch(e){u.subcategories=void 0}if(u.groups)try{u.groups=JSON.parse(u.groups)}catch(e){u.groups=void 0}if(u.groupIcons)try{u.groupIcons=JSON.parse(u.groupIcons)}catch(e){u.groupIcons=void 0}return k(u),u},x.updateBlockDef=k,x.parseBlockDefinition=n,(t=x.hex||(x.hex={})).isSetupFor=function(e){return t.currentSetup==e.sha},t.currentSetup=null,t.parseChecksumBlock=function(e,t){void 0===t&&(t=0);var n=pxt.HF2.read32(e,t);if(133083260!=(2147483647&n))return pxt.log("no checksum block magic"),null;var r=pxt.HF2.read32(e,t+4),i=pxt.HF2.read32(e,t+8);if(3&r)return pxt.log("invalid end marker position"),null;var o=1<<(255&i);if(o!=pxt.appTarget.compile.flashCodeAlign)return pxt.log("invalid page size: "+o),null;for(var a={magic:n,endMarkerPos:r,endMarker:i,regions:[]},s=t+12;s<e.length-7;s+=8){var c={start:o*pxt.HF2.read16(e,s),length:o*pxt.HF2.read16(e,s+2),checksum:pxt.HF2.read32(e,s+4)};if(!c.length||!c.checksum)break;a.regions.push(c)}return a},function(f){function m(t){var e=function(e){return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0};if(!t||512!=t.length||e(0)!=f.UF2_MAGIC_START0||e(4)!=f.UF2_MAGIC_START1||e(t.length-4)!=f.UF2_MAGIC_END)return null;var n=e(8),r=e(16);476<r&&(r=256);var i=null;if(n&f.UF2_FLAG_FILE){var o=t.slice(32+r),a=o.indexOf(0);0<=a&&(o=o.slice(0,a)),i=x.U.fromUTF8(x.U.uint8ArrayToString(o))}return{flags:n,targetAddr:e(12),payloadSize:r,blockNo:e(20),numBlocks:e(24),fileSize:e(28),data:t.slice(32,32+r),filename:i}}function a(e,t){return!!e&&(e.targetAddr<=t&&t<e.targetAddr+e.payloadSize)}function p(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function e(){return{currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0}}function s(e){for(var t=0;t<e.blocks.length;++t)p(e.blocks[t],20,t),p(e.blocks[t],24,e.blocks.length),e.filename&&p(e.blocks[t],28,e.filesize)}function h(e,t,n){var r=e.currBlock,i=t>>8,o=256-(255&t);if(n.length>o){var a=new Uint8Array(n);for(h(e,t,a.slice(0,o));o<n.length;){var s=Math.min(o+256,n.length);h(e,t+o,a.slice(o,s)),o=s}}else{if(i!=e.currPtr){var c=0;r=null;for(var l=0;l<e.ptrs.length;++l)if(e.ptrs[l]==i){r=e.blocks[l];break}r||(p(r=new Uint8Array(512),0,f.UF2_MAGIC_START0),p(r,4,f.UF2_MAGIC_START1),p(r,8,e.filename?f.UF2_FLAG_FILE:f.UF2_FLAG_NONE),p(r,12,i<<8),p(r,16,256),p(r,20,e.blocks.length),p(r,508,f.UF2_MAGIC_END),e.filename&&x.U.memcpy(r,288,x.U.stringToUint8Array(x.U.toUTF8(e.filename))),e.blocks.push(r),e.ptrs.push(i)),e.currPtr=i,e.currBlock=r}var u=32+(255&t);for(c=0;c<n.length;++c)r[u+c]=n[c];e.filesize=Math.max(e.filesize,n.length+t)}}f.UF2_MAGIC_START0=171066965,f.UF2_MAGIC_START1=2656915799,f.UF2_MAGIC_END=179400496,f.UF2_FLAG_NONE=0,f.UF2_FLAG_NOFLASH=1,f.UF2_FLAG_FILE=4096,f.parseBlock=m,f.parseFile=function(e){for(var t=[],n=0;n<e.length;n+=512){var r=m(e.slice(n,n+512));r&&t.push(r)}return t},f.toBin=function(e){if(e.length<512)return null;for(var t=-1,n=-1,r=[],i=0;i<e.length;++i){var o=512*i,a=m(e.slice(o,o+512));if(a){-1==t&&(n=t=a.targetAddr);var s=a.targetAddr-t;s<0||s%4||1048576<s||(0<s&&r.push(new Uint8Array(s)),r.push(e.slice(o+32,o+32+a.payloadSize)),t=a.targetAddr+a.payloadSize)}}for(var c=0,l=0,u=r;l<u.length;l++)c+=(g=u[l]).length;if(0==c)return null;for(var f=new Uint8Array(c),p=0,h=0,d=r;h<d.length;h++){var g=d[h];for(i=0;i<g.length;++i)f[p++]=g[i]}return{buf:f,start:n}},f.readBytes=function(e,t,n){for(var r,i=new Uint8Array(n),o=0;o<n;++o,++t)a(r,t)||(r=e.filter(function(e){return a(e,t)})[0]),r&&(i[o]=r.data[t-r.targetAddr]);return i},f.newBlockFile=e,f.finalizeFile=s,f.concatFiles=function(e){for(var t=0,n=e;t<n.length;t++)s(a=n[t]),a.filename=null;var r={currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0};r.blocks=x.U.concat(e.map(function(e){return e.blocks}));for(var i=0,o=e;i<o.length;i++){var a;(a=o[i]).blocks=[]}return r},f.serializeFile=function(e){s(e);for(var t="",n=0,r=e.blocks;n<r.length;n++){var i=r[n];t+=x.Util.uint8ArrayToString(i)}return t},f.readBytesFromFile=function e(t,n,r){var i,o=n>>8;if(o==t.currPtr)i=t.currBlock;else{for(var a=0;a<t.ptrs.length;++a)if(t.ptrs[a]==o){i=t.blocks[a];break}i&&(t.currPtr=o,t.currBlock=i)}if(!i)return null;var s=new Uint8Array(r),c=Math.min(r,256-(255&n));x.U.memcpy(s,0,i,32+(255&n),c);var l=r-c;if(0<l){var u=e(t,n+c,l);x.U.memcpy(s,c,u)}return s},f.writeBytes=h,f.writeHex=function(e,t){for(var n="0000",r=0;r<t.length;++r){var i=/:02000004(....)/.exec(t[r]);if(i&&(n=i[1]),i=/^:..(....)00(.*)[0-9A-F][0-9A-F]$/.exec(t[r])){for(var o=parseInt(n+i[1],16),a=i[2],s=[],c=0;c<a.length;c+=2)s.push(parseInt(a[c]+a[c+1],16));h(e,o,s)}}}}(x.UF2||(x.UF2={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={})),function(e){var t,n,r;t=e.pxtc||(e.pxtc={}),n=t.ir||(t.ir={}),(r=n.CallingConvention||(n.CallingConvention={}))[r.Plain=0]="Plain",r[r.Async=1]="Async",r[r.Promise=2]="Promise"}(ts||(ts={})),function(n){var e;(e=n.streams||(n.streams={})).createStreamAsync=function(e,t){return n.Cloud.privatePostAsync("streams",{target:e,name:t||"data"}).then(function(e){return e})},e.postPayloadAsync=function(e,t){return n.Util.assert(!!e.privatekey),n.Cloud.privatePostAsync(e.id+"/data?privatekey="+e.privatekey,t)}}(pxt||(pxt={})),function(e){!function(n){var r,e,i,t;(e=r=n.PatternUnits||(n.PatternUnits={}))[e.userSpaceOnUse=0]="userSpaceOnUse",e[e.objectBoundingBox=1]="objectBoundingBox",(t=i=n.LengthUnit||(n.LengthUnit={}))[t.em=0]="em",t[t.ex=1]="ex",t[t.px=2]="px",t[t.in=3]="in",t[t.cm=4]="cm",t[t.mm=5]="mm",t[t.pt=6]="pt",t[t.pc=7]="pc",t[t.percent=8]="percent";var o=function(){function e(e){this.el=E(e)}return e.prototype.attr=function(t){var n=this;return Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),this},e.prototype.setAttribute=function(e,t){return this.el.setAttribute(e,t.toString()),this},e.prototype.id=function(e){return this.setAttribute("id",e)},e.prototype.setClass=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.setAttribute("class",e.join(" "))},e.prototype.appendClass=function(e){var t,n;return t=this.el,n=e,t.classList?t.classList.add(n):t.className.baseVal.indexOf(n)<0&&(t.className.baseVal+=" "+n),this},e.prototype.removeClass=function(e){var t,n;t=this.el,n=e,t.classList?t.classList.remove(n):t.className.baseVal=t.className.baseVal.replace(n,"").replace(/\s{2,}/," ")},e.prototype.title=function(e){this.titleElement||(this.titleElement=E("title"),this.el.firstChild?this.el.insertBefore(this.titleElement,this.el.firstChild):this.el.appendChild(this.titleElement)),this.titleElement.textContent=e},e.prototype.setVisible=function(e){return this.setAttribute("visibility",e?"visible":"hidden")},e}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.draw=function(e){var t=function(e){switch(e){case"text":return new p;case"circle":return new d;case"rect":return new h;case"line":return new g;case"polygon":return new y;case"polyline":return new v;case"path":return new b;default:return new f(e)}}(e);return this.el.appendChild(t.el),t},t.prototype.element=function(e,t){return t(this.draw(e)),this},t.prototype.group=function(){var e=new c;return this.el.appendChild(e.el),e},t.prototype.appendChild=function(e){this.el.appendChild(e.el)},t}(n.BaseElement=o),s=function(n){function e(e){var t=n.call(this,"svg")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.define=function(e){return this.defs||(this.defs=new u(this.el)),e(this.defs),this},e}(n.DrawContext=a);n.SVG=s;var c=function(n){function e(e){var t=n.call(this,"g")||this;return e&&e.appendChild(t.el),t}return __extends(e,n),e.prototype.translate=function(e,t){return this.left=e,this.top=t,this.updateTransform()},e.prototype.scale=function(e){return this.scaleFactor=e,this.updateTransform()},e.prototype.updateTransform=function(){var e="";return null!=this.left&&(e+="translate("+this.left+" "+this.top+")"),null!=this.scaleFactor&&(e+=" scale("+this.scaleFactor+")"),this.setAttribute("transform",e),this},e}(a);n.Group=c;var l=function(e){function t(){return e.call(this,"pattern")||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("patternUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.contentUnits=function(e){return this.setAttribute("patternContentUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.size=function(e,t){return this.setAttribute("width",e),this.setAttribute("height",t),this},t}(a);n.Pattern=l;var u=function(n){function e(e){var t=n.call(this,"defs")||this;return e.appendChild(t.el),t}return __extends(e,n),e.prototype.create=function(e,t){var n;switch(e){case"path":n=new b;break;case"pattern":n=new l;break;case"radialGradient":n=new w;break;case"linearGradient":n=new k;break;default:n=new o(e)}return n.id(t),this.el.appendChild(n.el),n},e}(o);n.DefsElement=u;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("x",e),this.setAttribute("y",t),this},t.prototype.moveTo=function(e,t){return this.at(e,t)},t.prototype.fill=function(e,t){return this.setAttribute("fill",e),null!=t&&this.opacity(t),this},t.prototype.opacity=function(e){return this.setAttribute("fill-opacity",e)},t.prototype.stroke=function(e,t){return this.setAttribute("stroke",e),null!=t&&this.strokeWidth(t),this},t.prototype.strokeWidth=function(e){return this.setAttribute("stroke-width",e)},t.prototype.strokeOpacity=function(e){return this.setAttribute("stroke-opacity",e)},t.prototype.onDown=function(e){return n.events.down(this.el,e),this},t.prototype.onUp=function(e){return n.events.up(this.el,e),this},t.prototype.onMove=function(e){return n.events.move(this.el,e),this},t.prototype.onEnter=function(e){return n.events.enter(this.el,e),this},t.prototype.onLeave=function(e){return n.events.leave(this.el,e),this},t.prototype.onClick=function(e){return n.events.click(this.el,e),this},t}(a),p=function(n){function e(e){var t=n.call(this,"text")||this;return null!=e&&t.text(e),t}return __extends(e,n),e.prototype.text=function(e){return this.el.textContent=e,this},e.prototype.fontFamily=function(e){return this.setAttribute("font-family",e)},e.prototype.fontSize=function(e,t){return this.setAttribute("font-size",_(e,t))},e.prototype.offset=function(e,t,n){return 0!==e&&this.setAttribute("dx",_(e,n)),0!==t&&this.setAttribute("dy",_(t,n)),this},e.prototype.anchor=function(e){return this.setAttribute("text-anchor",e)},e}(n.Drawable=f);n.Text=p;var h=function(e){function t(){return e.call(this,"rect")||this}return __extends(t,e),t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",_(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",_(e,t))},t.prototype.corner=function(e){return this.corners(e,e)},t.prototype.corners=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(f);n.Rect=h;var d=function(e){function t(){return e.call(this,"circle")||this}return __extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(f);n.Circle=d;!function(e){function t(){return e.call(this,"ellipse")||this}__extends(t,e),t.prototype.at=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.radius=function(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this}}(f);var g=function(e){function t(){return e.call(this,"line")||this}return __extends(t,e),t.prototype.at=function(e,t,n,r){return this.from(e,t),null!=n&&null!=r&&this.to(n,r),this},t.prototype.from=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.to=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(f);n.Line=g;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.points=function(e){return this.setAttribute("points",e)},t.prototype.with=function(e){return this.points(e.map(function(e){return e.x+" "+e.y}).join(","))},t}(f),v=function(e){function t(){return e.call(this,"polyline")||this}return __extends(t,e),t}(n.PolyElement=m);n.Polyline=v;var y=function(e){function t(){return e.call(this,"polygon")||this}return __extends(t,e),t}(m);n.Polygon=y;var b=function(t){function e(){var e=t.call(this,"path")||this;return e.d=new T,e}return __extends(e,t),e.prototype.update=function(){return this.setAttribute("d",this.d.toAttribute())},e.prototype.path=function(e){return e(this.d),this.update()},e}(f);n.Path=b;var x=function(e){function t(){return e.call(this,"image")||this}return __extends(t,e),t.prototype.src=function(e){return this.setAttribute("href",e)},t.prototype.width=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("width",_(e,t))},t.prototype.height=function(e,t){return void 0===t&&(t=i.px),this.setAttribute("height",_(e,t))},t.prototype.size=function(e,t,n){return void 0===n&&(n=i.px),this.width(e,n),this.height(t,n),this},t}(f);n.Image=x;var A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.units=function(e){return this.setAttribute("gradientUnits",e===r.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")},t.prototype.stop=function(e,t,n){var r=E("stop");return r.setAttribute("offset",e+"%"),null!=t&&r.setAttribute("stop-color",t),null!=n&&r.setAttribute("stop-opacity",n),this.el.appendChild(r),this},t}(o),k=function(e){function t(){return e.call(this,"linearGradient")||this}return __extends(t,e),t.prototype.start=function(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this},t.prototype.end=function(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this},t}(n.Gradient=A);n.LinearGradient=k;var w=function(e){function t(){return e.call(this,"radialGradient")||this}return __extends(t,e),t.prototype.center=function(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this},t.prototype.focus=function(e,t,n){return this.setAttribute("fx",e),this.setAttribute("fy",t),this.setAttribute("fr",n),this},t.prototype.radius=function(e){return this.setAttribute("r",e)},t}(A);function E(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}n.RadialGradient=w;var T=function(){function e(){this.ops=[]}return e.prototype.clear=function(){this.ops=[]},e.prototype.moveTo=function(e,t){return this.op("M",e,t)},e.prototype.moveBy=function(e,t){return this.op("m",e,t)},e.prototype.lineTo=function(e,t){return this.op("L",e,t)},e.prototype.lineBy=function(e,t){return this.op("l",e,t)},e.prototype.cCurveTo=function(e,t,n,r,i,o){return this.op("C",e,t,n,r,i,o)},e.prototype.cCurveBy=function(e,t,n,r,i,o){return this.op("c",e,t,n,r,i,o)},e.prototype.qCurveTo=function(e,t,n,r){return this.op("Q",e,t,n,r)},e.prototype.qCurveBy=function(e,t,n,r){return this.op("q",e,t,n,r)},e.prototype.sCurveTo=function(e,t,n,r){return this.op("S",e,t,n,r)},e.prototype.sCurveBy=function(e,t,n,r){return this.op("s",e,t,n,r)},e.prototype.tCurveTo=function(e,t){return this.op("T",e,t)},e.prototype.tCurveBy=function(e,t){return this.op("t",e,t)},e.prototype.arcTo=function(e,t,n,r,i,o,a){return this.op("A",e,t,n,r?1:0,i?1:0,o,a)},e.prototype.close=function(){return this.op("z")},e.prototype.toAttribute=function(){return this.ops.map(function(e){return e.op+" "+e.args.join(" ")}).join(" ")},e.prototype.op=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.ops.push({op:e,args:t}),this},e}();function _(e,t){switch(t){case i.em:return e+"em";case i.ex:return e+"ex";case i.px:return e+"px";case i.in:return e+"in";case i.cm:return e+"cm";case i.mm:return e+"mm";case i.pt:return e+"pt";case i.pc:return e+"pc";case i.percent:return e+"%";default:return e.toString()}}n.PathContext=T}(e.svgUtil||(e.svgUtil={}))}(pxt||(pxt={})),function(e){var t;(function(e){function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}e.isTouchEnabled=n,e.hasPointerEvents=r,e.down=function(e,t){r()?e.addEventListener("pointerdown",t):n()?(e.addEventListener("mousedown",t),e.addEventListener("touchstart",t)):e.addEventListener("mousedown",t)},e.up=function(e,t){r()?e.addEventListener("pointerup",t):(n(),e.addEventListener("mouseup",t))},e.enter=function(e,t){r()?e.addEventListener("pointerover",function(e){t(!!(1&e.buttons))}):n()?e.addEventListener("touchstart",function(e){t(!0)}):e.addEventListener("mouseover",function(e){t(!!(1&e.buttons))})},e.leave=function(e,t){r()?e.addEventListener("pointerleave",t):n()?e.addEventListener("touchend",t):e.addEventListener("mouseleave",t)},e.move=function(e,t){r()?e.addEventListener("pointermove",t):n()?e.addEventListener("touchmove",t):e.addEventListener("mousemove",t)},e.click=function(e,t){e.addEventListener("click",t)}})((t=e.svgUtil||(e.svgUtil={})).events||(t.events={}))}(pxt||(pxt={})),function(e){var t,n,r;t=e.svgUtil||(e.svgUtil={}),n=t.helpers||(t.helpers={}),r=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.at=function(e,t){return this.cx=e,this.cy=t,this.rePosition(),this},e.prototype.text=function(e,t){return void 0===t&&(t=12),n.prototype.text.call(this,e),this.fontSizePixels=t,this.setAttribute("font-size",t+"px"),this.rePosition(),this},e.prototype.rePosition=function(){null!=this.cx&&null!=this.cy&&null!=this.fontSizePixels&&(this.setAttribute("x",this.cx),this.setAttribute("y",this.cy),this.setAttribute("text-anchor","middle"),this.setAttribute("alignment-baseline","middle"))},e}(t.Text),n.CenteredText=r}(pxt||(pxt={})),function(i){!function(e){e.blockColors={loops:"#107c10",logic:"#006970",math:"#712672",images:"#5C2D91",variables:"#A80000",functions:"#005a9e",text:"#996600",arrays:"#A94400",advanced:"#3c3c3c",addpackage:"#717171",search:"#000",debug:"#e03030",default:"#dddddd"},e.blockIcons={loops:"",logic:"",math:"",variables:"",functions:"",text:"",arrays:"",advancedcollapsed:"",advancedexpanded:"",more:"",addpackage:"",search:"",debug:"",default:""};var r="";e.appendToolboxIconCss=function(e,t){if(!(-1<r.indexOf(e)))if(1===t.length){var n=i.Util.unicodeToChar(t);r+="\n                .blocklyTreeIcon."+e+'::before {\n                    content: "'+n+'";\n                }\n            '}else r+="\n                .blocklyTreeIcon."+e+' {\n                    background-image: url("'+i.Util.pathJoin(i.webConfig.commitCdnUrl,encodeURI(t))+'")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }\n            '},e.getNamespaceColor=function(e){return i.appTarget.appTheme.blockColors&&i.appTarget.appTheme.blockColors[e]?i.appTarget.appTheme.blockColors[e]:i.toolbox.blockColors[e]?i.toolbox.blockColors[e]:""},e.getNamespaceIcon=function(e){return i.appTarget.appTheme.blockIcons&&i.appTarget.appTheme.blockIcons[e]?i.appTarget.appTheme.blockIcons[e]:i.toolbox.blockIcons[e]?i.toolbox.blockIcons[e]:""},e.advancedTitle=function(){return i.Util.lf("{id:category}Advanced")},e.addPackageTitle=function(){return i.Util.lf("{id:category}Extensions")},e.convertColor=function(e){var t=parseInt(e);return isNaN(t)||console.error("hue style color not supported anymore, use #rrggbb"),e},e.fadeColor=function(e,t,n){(e=e.replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);for(var r="#",i=0;i<3;i++){var o=parseInt(e.substr(2*i,2),16),a=(o=Math.round(Math.min(Math.max(0,n?o+o*t:o-o*t),255))).toString(16);r+=("00"+a).substr(a.length)}return r}}(i.toolbox||(i.toolbox={}))}(pxt||(pxt={})),function(c){var e;(e=c.tutorial||(c.tutorial={})).parseTutorialSteps=function(e,t){var n=t.split(/^##[^#].*$/gim),r=!0;if(n.length<=1&&(n=t.split(/^###[^#].*$/gim),r=!1),0==n[0].indexOf("# Not found"))throw c.log("Tutorial not found: "+e),new Error("Tutorial not found: "+e);var i=[];if(t.replace(r?/^##[^#](.*)$/gim:/^###[^#](.*)$/gim,function(e,t){var n={fullscreen:/@(fullscreen|unplugged)/.test(t),unplugged:/@unplugged/.test(t)};return i.push(n),""}),!(n.length<1)){n[0],n=n.slice(1,n.length);for(var o=0;o<n.length;o++){var a=n[o].trim(),s=a.split("\n");i[o].headerContentMd=s[0],i[o].contentMd=a,i[o].hasHint=1<s.length}return i}},e.bundleTutorialCode=function(e){e=e.replace(/((?!.)\s)+/g,"\n");var r="";return e.replace(/```(sim|block|blocks|filterblocks)\s*\n([\s\S]*?)\n```/gim,function(e,t,n){return r+="\n { \n "+n+"\n } \n",""}),r}}(pxt||(pxt={})),function(u){!function(n){var r,e;n.flattenDiagnosticMessageText=function(e,t){if("string"==typeof e)return e;for(var n=e,r="",i=0;n;){if(i){r+=t;for(var o=0;o<i;o++)r+="  "}r+=n.messageText,i++,n=n.next}return r},(e=r=n.ScriptTarget||(n.ScriptTarget={}))[e.ES3=0]="ES3",e[e.ES5=1]="ES5",e[e.ES6=2]="ES6",e[e.ES2015=2]="ES2015",e[e.Latest=2]="Latest",n.isIdentifierStart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||36===e||95===e||127<e&&c(e,t)},n.isIdentifierPart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||36===e||95===e||127<e&&(n=e,t>=r.ES5?l(n,o):l(n,s));var n},n.reservedWords=["abstract","any","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","let","module","namespace","new","null","package","private","protected","public","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","var","void","while","with","yield","async","await","of","Math"],n.escapeIdentifier=function(e){if(!e)return"_";var t=e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_$]/g,function(e){return u.pxtc.isIdentifierPart(e.charCodeAt(0),u.pxtc.ScriptTarget.ES5)?e:""});return t&&u.pxtc.isIdentifierStart(t.charCodeAt(0),u.pxtc.ScriptTarget.ES5)&&-1===n.reservedWords.indexOf(t)||(t="_"+t),t};var t,i=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],o=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],a=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],s=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,768,846,864,866,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1155,1158,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1488,1514,1520,1522,1569,1594,1600,1621,1632,1641,1648,1747,1749,1756,1759,1768,1770,1773,1776,1788,1808,1836,1840,1866,1920,1968,2305,2307,2309,2361,2364,2381,2384,2388,2392,2403,2406,2415,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2524,2525,2527,2531,2534,2545,2562,2562,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2649,2652,2654,2654,2662,2676,2689,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2784,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2876,2883,2887,2888,2891,2893,2902,2903,2908,2909,2911,2913,2918,2927,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3134,3140,3142,3144,3146,3149,3157,3158,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3395,3398,3400,3402,3405,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3805,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3946,3953,3972,3974,3979,3984,3991,3993,4028,4038,4038,4096,4129,4131,4135,4137,4138,4140,4146,4150,4153,4160,4169,4176,4185,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4969,4977,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6099,6112,6121,6160,6169,6176,6263,6272,6313,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8255,8256,8319,8319,8400,8412,8417,8417,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12335,12337,12341,12344,12346,12353,12436,12441,12442,12445,12446,12449,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65056,65059,65075,65076,65101,65103,65136,65138,65140,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65381,65470,65474,65479,65482,65487,65490,65495,65498,65500];function c(e,t){return t>=r.ES5?l(e,i):l(e,a)}function l(e,t){if(e<t[0])return!1;for(var n,r=0,i=t.length;r+1<i;){if(n=r+(i-r)/2,t[n-=n%2]<=e&&e<=t[n+1])return!0;e<t[n]?i=n:r=n+2}return!1}n.isUnicodeIdentifierStart=c,(t=n.DiagnosticCategory||(n.DiagnosticCategory={}))[t.Warning=0]="Warning",t[t.Error=1]="Error",t[t.Message=2]="Message"}(u.pxtc||(u.pxtc={}))}(ts||(ts={})),function(c){!function(o){var t=function(n){function e(e){var t=n.call(this,e)||this;return t.message=e,t}return __extends(e,n),e}(Error);o.USBError=t,o.filters=[{classCode:255,subclassCode:42}],o.setFilters=function(e){o.filters=e};var n,r=function(){function e(e){this.dev=e,this.ready=!1,this.onData=function(e){},this.onError=function(e){},this.onEvent=function(e){},this.readLoop()}return e.prototype.error=function(e){throw new t(c.U.lf("USB error on device {0} ({1})",this.dev.productName,e))},e.prototype.log=function(e){e="WebUSB: "+e,c.debug(e)},e.prototype.disconnectAsync=function(){var e=this;return this.dev?(this.ready=!1,this.log("close device"),this.dev.close().catch(function(e){}).then(function(){return e.dev=null,Promise.delay(500)})):Promise.resolve()},e.prototype.reconnectAsync=function(){var t=this;return this.log("reconnect"),this.disconnectAsync().then(i).then(function(e){return t.log("got device: "+e.manufacturerName+" "+e.productName),t.dev=e,t.initAsync()})},e.prototype.sendPacketAsync=function(e){var t=this;return c.Util.assert(e.length<=64),this.dev.transferOut(this.epOut.endpointNumber,e).then(function(e){"ok"!=e.status&&t.error("USB OUT transfer failed")})},e.prototype.readLoop=function(){var t=this,n=function(){t.ready?t.recvPacketAsync().then(function(e){t.onData(e),n()},function(e){t.onError(e),Promise.delay(300).then(n)}):Promise.delay(300).then(n)};n()},e.prototype.recvPacketAsync=function(){var n=this;return this.dev.transferIn(this.epIn.endpointNumber,64).then(function(e){"ok"!=e.status&&n.error("USB IN transfer failed");var t=new Uint8Array(e.data.buffer);return 0==t.length?n.recvPacketAsync():t})},e.prototype.initAsync=function(){var t=this,n=this.dev;return this.log("open device"),n.open().then(function(){return t.log("select configuration"),n.selectConfiguration(1)}).then(function(){t.log("got "+n.configurations[0].interfaces.length+" interfaces");var e=n.configurations[0].interfaces.filter(function(e){for(var t=e.alternates[0],n=0,r=o.filters;n<r.length;n++){var i=r[n];if((null==i.classCode||t.interfaceClass===i.classCode)&&(null==i.subclassCode||t.interfaceSubclass===i.subclassCode)&&(null==i.protocolCode||t.interfaceProtocol===i.protocolCode)&&2==t.endpoints.length&&t.endpoints.every(function(e){return 64==e.packetSize}))return!0}return!1})[0];return e||t.error("cannot find supported USB interface"),t.altIface=e.alternates[0],t.epIn=t.altIface.endpoints.filter(function(e){return"in"==e.direction})[0],t.epOut=t.altIface.endpoints.filter(function(e){return"out"==e.direction})[0],c.Util.assert(64==t.epIn.packetSize),c.Util.assert(64==t.epOut.packetSize),t.log("claim interface"),n.claimInterface(e.interfaceNumber)}).then(function(){t.log("device ready"),t.ready=!0})},e}();function i(){return navigator.usb.getDevices().then(function(e){return e&&e.length?e[0]:Promise.reject(new t(c.U.lf("No USB device selected or connected; try pairing!")))})}function a(){return n||(n=i().then(function(e){var t=new r(e);return t.initAsync().then(function(){return t})}).catch(function(e){return n=null,Promise.reject(e)})),n}function s(){return!!navigator.usb&&(!c.BrowserUtils.isWindows()||c.BrowserUtils.isWindows10())}o.pairAsync=function(){return navigator.usb.requestDevice({filters:o.filters}).then(function(e){return a()}).then(function(e){return e.reconnectAsync()})},o.mkPacketIOAsync=a,o.isEnabled=!1,o.setEnabled=function(e){s()||(e=!1),o.isEnabled=e},o.isAvailable=s}(c.usb||(c.usb={}))}(pxt||(pxt={})),function(s){!function(e){var n=s.Util,r={};function a(o){var a={},s=0,e=new n.PromiseQueue,t=new Promise(function(e,t){a.ready=e});e.enqueue("main",function(){return t});return{opAsync:function(r,i){return e.enqueue("main",function(){return new Promise(function(t,n){var e=""+s++;a[e]=function(e){e?e.errorMessage?n(new Error(e.errorMessage)):t(e):n(new Error("no response"))},o({id:e,op:r,arg:i})})})},recvHandler:function(e){if(a.hasOwnProperty(e.id)){var t=a[e.id];delete a[e.id],t(e.result)}}}}function i(e){var t=new Worker(e),n=a(function(e){return t.postMessage(e)});return t.onmessage=function(e){n.recvHandler(e.data)},n}e.getWorker=function(e){var t=r[e];return t||(t=r[e]=i(e)),t},e.wrap=a,e.makeWebWorker=i,e.makeWebSocket=function(e,n){void 0===n&&(n=null);var i=new WebSocket(e),o=[],r=a(function(e){var t=JSON.stringify(e);o?o.push(t):i.send(t)});return i.onmessage=function(e){var t=JSON.parse(e.data);n&&null==t.id?n(t):r.recvHandler(t)},i.onopen=function(e){s.debug("socket opened");for(var t=0,n=o;t<n.length;t++){var r=n[t];i.send(r)}o=null},i.onclose=function(e){s.debug("socket closed")},r}}(s.worker||(s.worker={}))}(pxt||(pxt={})),function(e){var v;(function(p){function h(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return e.replace(/{(\d+)}/g,function(e,t){return n[+t]})}p.debug=!1,p.lf=h;var g=m("opcode name doesn't match","<name>"),a=function(){function e(e,t,n,r,i){var o=this;this.opcode=n,this.mask=r,this.is32bit=i,this.canBeShared=!1,v.assert((n&r)==n),this.ei=e,this.code=t.replace(/\s+/g," "),this.friendlyFmt=t.replace(/\$\w+/g,function(e){return o.ei.encoders[e]?o.ei.encoders[e].pretty:e});var a=u(t);this.name=a[0],this.args=a.slice(1)}return e.prototype.emit=function(e){var t=e.words;if(t[0]!=this.name)return g;for(var n=this.opcode,r=1,i=0,o=[],a=null,s=null,c=null,l=0;l<this.args.length;++l){var u=this.args[l],f=t[r++];if("$"==u[0]){var p=this.ei.encoders[u],h=null;if(p.isRegister){if(null==(h=this.ei.registerNo(f)))return m("expecting register name",f);this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--}else if(p.isImmediate){if(f=f.replace(/^#/,""),null==(h=e.bin.parseOneInt(f)))return m("expecting number",f);this.ei.isAddSP(this.opcode)?i=-h/this.ei.wordSize():this.ei.isSubSP(this.opcode)&&(i=h/this.ei.wordSize())}else if(p.isRegList){if("{"!=f)return m("expecting {",f);for(h=0;"}"!=t[r];){if(!(f=t[r++]))return m("expecting }",t[r-2]);var d=this.ei.registerNo(f);if(null==d)return m("expecting register name",f);if(h&1<<d)return m("duplicate register name",f);h|=1<<d,this.ei.isPush(this.opcode)?i++:this.ei.isPop(this.opcode)&&i--,","==t[r]&&r++}f=t[r++]}else if(p.isLabel){if(f=f.replace(/^#/,""),/^[+-]?\d+$/.test(f))a="rel"+(h=parseInt(f,10));else if(/^0x[0-9a-fA-F]+$/.test(f))a="abs"+(h=parseInt(f,16));else if(a=f,null==(h=this.ei.getAddressFromLabel(e.bin,this,f,p.isWordAligned))){if(e.bin.finalEmit)return m("unknown label",f);h=8}if(this.ei.is32bit(this)){s=h,c=f;continue}}else v.oops();if(null==h)return m("didn't understand it",f);if(o.push(h),null==(h=p.encode(h)))return m("argument out of range or mis-aligned",f);v.assert(0==(n&h)),n|=h}else if(u!=f)return m("expecting "+u,f)}return t[r]?m("trailing tokens",t[r]):this.ei.is32bit(this)?this.ei.emit32(n,s,e.bin.normalizeExternalLabel(c)):{stack:i,opcode:n,numArgs:o,labelName:e.bin.normalizeExternalLabel(a)}},e.prototype.toString=function(){return this.friendlyFmt},e}();p.Instruction=a;var l=function(){function e(e,t){this.bin=e,this.text=t}return e.prototype.getOpExt=function(){return this.instruction?this.instruction.code:""},e.prototype.getOp=function(){return this.instruction?this.instruction.name:""},e.prototype.update=function(e){this.bin.peepOps++,(e=e.replace(/^\s*/,""))||this.bin.peepDel++,e&&(e+="      "),e="    "+e,this.text=e+"; WAS: "+this.text.trim(),this.instruction=null,this.numArgs=null,this.words=u(e)||[],0==this.words.length?this.type="empty":"@"==this.words[0][0]&&(this.type="directive")},e}();p.Line=l;var s=function(){function e(e){this.baseOffset=0,this.checkStack=!0,this.inlineMode=!1,this.normalizeExternalLabel=function(e){return e},this.currLineNo=0,this.scope="",this.scopeId=0,this.errors=[],this.labels={},this.stackpointers={},this.stack=0,this.commPtr=0,this.peepOps=0,this.peepDel=0,this.peepCounts={},this.stats="",this.throwOnError=!1,this.disablePeepHole=!1,this.stackAtLabel={},this.currLine=new l(this,"<start>"),this.currLine.lineNo=0,this.ei=e,this.ei.file=this}return e.prototype.emitShort=function(e){v.assert(0<=e&&e<=65535),this.buf.push(e)},e.prototype.emitOpCode=function(e){this.emitShort(e)},e.prototype.location=function(){return 2*this.buf.length},e.prototype.pc=function(){return this.location()+this.baseOffset},e.prototype.parseOneInt=function(e){if(!e)return null;if("0"==e)return 0;var t=1;if(0<=e.indexOf("*"))for(var n=null;n=/^([^\*]*)\*(.*)$/.exec(e);){var r=this.parseOneInt(n[1]);if(null==r)return null;t*=r,e=n[2]}"-"==e[0]?(t*=-1,e=e.slice(1)):"+"==e[0]&&(e=e.slice(1));var i=null;if(v.U.endsWith(e,"|1"))return 1|this.parseOneInt(e.slice(0,e.length-2));if(v.U.endsWith(e,"-1"))return this.parseOneInt(e.slice(0,e.length-2))-1;if(v.U.endsWith(e,"+1"))return this.parseOneInt(e.slice(0,e.length-2))+1;if("0"==e[0])if("x"==e[1]||"X"==e[1]){var o=/^0x([a-f0-9]+)$/i.exec(e);o&&(i=parseInt(o[1],16))}else if("b"==e[1]||"B"==e[1]){var a=/^0b([01]+)$/i.exec(e);a&&(i=parseInt(a[1],2))}var s=/^(\d+)$/i.exec(e);return s&&(i=parseInt(s[1],10)),0<=e.indexOf("@")&&((s=/^(\w+)@(-?\d+)$/.exec(e))&&(1!=t&&this.directiveError(h("multiplication not supported with saved stacks")),this.stackpointers.hasOwnProperty(s[1])?i=this.ei.wordSize()*this.ei.computeStackOffset(s[1],this.stack-this.stackpointers[s[1]]+parseInt(s[2])):this.directiveError(h("saved stack not found"))),(s=/^(.*)@(hi|lo|fn)$/.exec(e))&&this.looksLikeLabel(s[1])&&null!=(i=this.lookupLabel(s[1],!0))&&("fn"==s[2]?i=this.ei.toFnPtr(i,this.baseOffset):0<=(i>>=1)&&i<=65535?"hi"==s[2]?i=i>>8&255:"lo"==s[2]?i&=255:v.oops():(this.directiveError(h("@hi/lo out of range")),i=null))),null==i&&this.looksLikeLabel(e)&&null!=(i=this.lookupLabel(e,!0))&&1==this.ei.postProcessRelAddress(this,1)&&(i+=this.baseOffset),null==i||isNaN(i)?null:i*t},e.prototype.looksLikeLabel=function(e){return!/^(r\d|pc|sp|lr)$/i.test(e)&&/^[\.a-zA-Z_][\.:\w+]*$/.test(e)},e.prototype.scopedName=function(e){return"."==e[0]&&this.scope?this.scope+"$"+e:e},e.prototype.lookupLabel=function(e,t){void 0===t&&(t=!1);var n=null,r=this.scopedName(e);return this.labels.hasOwnProperty(r)?(n=this.labels[r],n=this.ei.postProcessRelAddress(this,n)):this.lookupExternalLabel&&null!=(n=this.lookupExternalLabel(e))&&(n=this.ei.postProcessAbsAddress(this,n)),null==n&&t&&(this.finalEmit?this.directiveError(h("unknown label: {0}",e)):n=33333),n},e.prototype.align=function(e){for(v.assert(2==e||4==e||8==e||16==e);this.location()%e!=0;)this.emitOpCode(0)},e.prototype.pushError=function(e,t){void 0===t&&(t="");var n={scope:this.scope,message:h("  -> Line {2} ('{1}'), error: {0}\n{3}",e,this.currLine.text,this.currLine.lineNo,t),lineNo:this.currLine.lineNo,line:this.currLine.text,coremsg:e,hints:t};if(this.errors.push(n),this.throwOnError)throw new Error(n.message)},e.prototype.directiveError=function(e){this.pushError(e)},e.prototype.emitString=function(e){function t(e,t){return 255&(e.charCodeAt(t)||0)}var n,r=/^\s*([\w\.]+\s*:\s*)?.\w+\s+(".*")\s*$/.exec(e);if(r&&null!=(n=function(e){e=e.replace(/\\\\/g,"\\B").replace(/\\(['\?])/g,function(e,t){return t}).replace(/\\[z0]/g,"\0").replace(/\\x([0-9a-f][0-9a-f])/gi,function(e,t){return"\\u00"+t}).replace(/\\B/g,"\\\\");try{return JSON.parse(e)}catch(e){return null}}(r[2]))){this.align(2);for(var i=0;i<n.length+1;i+=2)this.emitShort(t(n,i+1)<<8|t(n,i))}else this.directiveError(h("expecting string"))},e.prototype.parseNumber=function(e){var t=this.parseOneInt(e.shift());return null==t?null:t},e.prototype.parseNumbers=function(e){e=e.slice(1);for(var t=[];;){var n=this.parseNumber(e);if(null==n){this.directiveError(h("cannot parse number at '{0}'",e[0]));break}if(t.push(n),","!=e[0]){if(null==e[0])break;this.directiveError(h("expecting number, got '{0}'",e[0]));break}if(e.shift(),null==e[0])break}return t},e.prototype.emitSpace=function(e){var t=this.parseNumbers(e);if(1==t.length&&t.push(0),2!=t.length)this.directiveError(h("expecting one or two numbers"));else if(t[0]%2!=0)this.directiveError(h("only even space supported"));else{var n=255&t[1];n|=n<<8;for(var r=0;r<t[0];r+=2)this.emitShort(n)}},e.prototype.emitBytes=function(e){var t=this.parseNumbers(e);t.length%2!=0&&(this.directiveError(".bytes needs an even number of arguments"),t.push(0));for(var n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];0<=r&&i<=255&&0<=i&&r<=255?this.emitShort(255&r|(255&i)<<8):this.directiveError(h("expecting uint8"))}},e.prototype.emitHex=function(e){var r=this;e.slice(1).forEach(function(e){if(","!=e)if(e.length%4!=0)r.directiveError(".hex needs an even number of bytes");else if(/^[a-f0-9]+$/i.test(e))for(var t=0;t<e.length;t+=4){var n=parseInt(e.slice(t,t+4),16);n=(255&n)<<8|n>>8&255,r.emitShort(n)}else r.directiveError(".hex needs a hex number")})},e.prototype.handleDirective=function(e){var t,n=this,r=e.words,i=function(){2!=r.length&&n.directiveError(h("expecting one argument"))};switch(r[0]){case".ascii":case".asciz":case".string":this.emitString(e.text);break;case".align":if(i(),null!=(t=this.parseOneInt(r[1]))){if(0==t)return;t<=4?this.align(1<<t):this.directiveError(h("expecting 1, 2, 3 or 4 (for 2, 4, 8, or 16 byte alignment)"))}else this.directiveError(h("expecting number"));break;case".balign":if(i(),null!=(t=this.parseOneInt(r[1]))){if(1==t)return;2==t||4==t||8==t||16==t?this.align(t):this.directiveError(h("expecting 2, 4, 8, or 16"))}else this.directiveError(h("expecting number"));break;case".p2align":i(),null!=(t=this.parseOneInt(r[1]))?this.align(1<<t):this.directiveError(h("expecting number"));break;case".byte":this.emitBytes(r);break;case".hex":this.emitHex(r);break;case".hword":case".short":case".2bytes":this.parseNumbers(r).forEach(function(e){-32768<=e&&e<=65535?n.emitShort(65535&e):n.directiveError(h("expecting int16"))});break;case".word":case".4bytes":case".long":this.parseNumbers(r).forEach(function(e){-2147483648<=e&&e<=4294967295?(n.emitShort(65535&e),n.emitShort(e>>16&65535)):n.directiveError(h("expecting int32"))});break;case".skip":case".space":this.emitSpace(r);break;case".startaddr":this.location()&&this.directiveError(h(".startaddr can be only be specified at the beginning of the file")),i(),this.baseOffset=this.parseOneInt(r[1]);break;case"@stackmark":i(),this.stackpointers[r[1]]=this.stack;break;case"@stackempty":this.checkStack&&(null==this.stackpointers[r[1]]?this.directiveError(h("no such saved stack")):this.stackpointers[r[1]]!=this.stack&&this.directiveError(h("stack mismatch")));break;case"@scope":this.scope=r[1]||"",this.currLineNo=this.scope?0:this.realCurrLineNo;break;case".syntax":case"@nostackcheck":this.checkStack=!1;break;case"@dummystack":i(),this.stack+=this.parseOneInt(r[1]);break;case".section":case".global":this.stackpointers={},this.stack=0,this.scope="$S"+this.scopeId++;break;case".comm":(r=r.filter(function(e){return","!=e})).shift();var o=this.parseOneInt(r[1]),a=0;if(a=r[2]?this.parseOneInt(r[2]):4,null==this.lookupLabel(r[0])){for(this.commPtr||(this.commPtr=this.lookupExternalLabel("_pxt_comm_base")||0,this.commPtr||this.directiveError(h("PXT_COMM_BASE not defined")));this.commPtr&a-1;)this.commPtr++;this.labels[this.scopedName(r[0])]=this.commPtr-this.baseOffset,this.commPtr+=o}break;case".file":case".text":case".cpu":case".fpu":case".eabi_attribute":case".code":case".thumb_func":case".type":case".fnstart":case".save":case".size":case".fnend":case".pad":case".globl":case".local":case"@":break;default:/^\.cfi_/.test(r[0])||this.directiveError(h("unknown directive"))}},e.prototype.handleOneInstruction=function(e,t){var n=t.emit(e);return!n.error&&(this.stack+=n.stack,this.checkStack&&this.stack<0&&this.pushError(h("stack underflow")),e.location=this.location(),e.opcode=n.opcode,e.stack=n.stack,this.emitOpCode(n.opcode),null!=n.opcode2&&this.emitOpCode(n.opcode2),null!=n.opcode3&&this.emitOpCode(n.opcode3),e.instruction=t,e.numArgs=n.numArgs,!0)},e.prototype.handleInstruction=function(n){var t=this;if(!n.instruction||!this.handleOneInstruction(n,n.instruction)){var e=function(e){return t.ei.instructions.hasOwnProperty(e)?t.ei.instructions[e]:[]};if(!n.instruction)for(var r=e(n.words[0]),i=0;i<r.length;++i)if(this.handleOneInstruction(n,r[i]))return;var o=n.words[0].toLowerCase().replace(/s$/,"").replace(/[^a-z]/g,""),a="",s=e(o).concat(e(o+"s"));0<s.length&&s.forEach(function(e){var t=e.emit(n);a+=h("   Maybe: {0} ({1} at '{2}')\n",e.toString(),t.error,t.errorAt)}),this.pushError(h("assembly error"),a)}},e.prototype.buildLine=function(e,n){var r=this,t=function(e){var t=new l(r,e);return t.scope=r.scope,t.lineNo=r.currLineNo,n.push(t),t},i=t(e),o=u(i.text)||[],a=(i.words=o)[0]||"";if(":"==a.charAt(a.length-1)){var s=/^([\.\w]+):$/.exec(o[0]);if(s){if(i.type="label",i.text=s[1]+":",i.words=[s[1]],!(1<o.length))return;o.shift(),a=((i=t(e.replace(/^[^:]*:/,""))).words=o)[0]||""}}var c=a.charAt(0);"."==c||"@"==c?(i.type="directive","@scope"==i.words[0]&&this.handleDirective(i)):0==i.words.length?i.type="empty":i.type="instruction"},e.prototype.prepLines=function(e){var t=this;this.currLineNo=0,this.realCurrLineNo=0,this.lines=[],e.split(/\r?\n/).forEach(function(e){10<t.errors.length||(t.currLineNo++,t.realCurrLineNo++,t.buildLine(e,t.lines))})},e.prototype.iterLines=function(){var r=this;this.stack=0,this.buf=[],this.scopeId=0,this.lines.forEach(function(e){if(!(10<r.errors.length)&&0!=(r.currLine=e).words.length)if("label"==e.type){var t=r.scopedName(e.words[0]);if(r.prevLabel=t,r.finalEmit){var n=r.labels[t];null==n&&v.oops(),v.assert(0<r.errors.length||n==r.location()),r.reallyFinalEmit&&(r.stackAtLabel[t]=r.stack)}else r.labels.hasOwnProperty(t)?r.directiveError(h("label redefinition")):r.inlineMode&&/^_/.test(t)?r.directiveError(h("labels starting with '_' are reserved for the compiler")):r.labels[t]=r.location();e.location=r.location()}else"directive"==e.type?r.handleDirective(e):"instruction"==e.type?r.handleInstruction(e):"empty"==e.type||v.oops()})},e.prototype.getSource=function(r,e,t){var i=this;void 0===e&&(e=1),void 0===t&&(t=0);var n=this.buf?this.location():0,o=this.labels._program_end||n,a=this.labels._frag_start||0;a&&(a=this.labels._js_end-a);var s=this.labels._program_end;s&&(s-=this.labels._js_end);var c=n+this.baseOffset;t&&t<c&&v.U.userError(h("program too big by {0} bytes!",c-t));var l=h("; total bytes: {0} ({1}% of {2}k flash with {3} free)",c,(100*c/(t=t||131072)).toFixed(1),(t/1024).toFixed(1),t-c),u=h("; code sizes (bytes): {0} (incl. {1} frags, and {2} lits); src size {3}\n",o,a,s,n-o)+h("; assembly: {0} lines; density: {1} bytes/stmt\n",this.lines.length,Math.round(100*(o-s)/e)/100)+l+"\n"+this.stats+"\n\n",f=!1;return this.lines.forEach(function(e,t){if("_stored_program"==e.words[0])return u+='_stored_program: .string "..."\n',void(f=!0);if(f)f=!1;else{var n=e.text;if(r){if("@stackempty"==e.words[0]&&i.lines[t-1].text==e.text)return;if(!(n=n.replace(/; WAS: .*/,"")).trim())return}p.debug&&("label"!=e.type&&"instruction"!=e.type||(n+=" \t; 0x"+(e.location+i.baseOffset).toString(16))),u+=n+"\n"}}),u},e.prototype.peepHole=function(){for(var e=this.lines.filter(function(e){return"empty"!=e.type}),t=0;t<e.length;++t){var n=e[t];if(!/^user/.test(n.scope)){var r=e[t+1];if(r){var i=e[t+2];"instruction"==n.type&&this.ei.peephole(n,r,i)}}}},e.prototype.clearLabels=function(){this.labels={},this.commPtr=0},e.prototype.peepPass=function(e){this.disablePeepHole||(this.peepOps=0,this.peepDel=0,this.peepCounts={},this.peepHole(),this.throwOnError=!0,this.finalEmit=!1,this.clearLabels(),this.iterLines(),v.assert(!this.checkStack||0==this.stack),this.finalEmit=!0,this.reallyFinalEmit=e||0==this.peepOps,this.iterLines(),this.stats+=h("; peep hole pass: {0} instructions removed and {1} updated\n",this.peepDel,this.peepOps-this.peepDel))},e.prototype.getLabels=function(){var n=this;return this.userLabelsCache||(this.userLabelsCache=v.U.mapMap(this.labels,function(e,t){return t+n.baseOffset})),this.userLabelsCache},e.prototype.emit=function(e){if(v.assert(null==this.buf),this.prepLines(e),!(0<this.errors.length||(this.clearLabels(),this.iterLines(),this.checkStack&&0!=this.stack&&this.directiveError(h("stack misaligned at the end of the file")),0<this.errors.length||(this.ei.expandLdlit(this),this.ei.commonalize(this),this.clearLabels(),this.iterLines(),this.finalEmit=!0,this.reallyFinalEmit=this.disablePeepHole,this.iterLines(),0<this.errors.length))))for(var t=0;t<5&&(pxt.debug("Peephole OPT, pass "+t),this.peepPass(5==t),0!=this.peepOps);++t);},e}(),e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.location=function(){return this.buf.length},e.prototype.emitShort=function(e){v.assert(0<=e&&e<=65535),this.buf.push(255&e),this.buf.push(e>>8)},e.prototype.emitOpCode=function(e){v.assert(0<=e&&e<=255),this.buf.push(e)},e}(p.File=s);p.VMFile=e;var t=function(){function e(){var o=this;this.file=null,this.addEnc=function(e,t,n){var r={name:e,pretty:t,encode:n,isRegister:/^\$r\d/.test(e),isImmediate:/^\$i\d/.test(e),isRegList:/^\$rl\d/.test(e),isLabel:/^\$l[a-z]/.test(e)};return o.encoders[e]=r},this.inrange=function(e,t,n){return Math.floor(t)!=t?null:t<0?null:e<t?null:n},this.inminmax=function(e,t,n,r){return Math.floor(n)!=n?null:n<e?null:t<n?null:r},this.inseq=function(e,t){var n=e.indexOf(t);return n<0?null:n},this.inrangeSigned=function(e,t,n){return Math.floor(t)!=t?null:t<-(e+1)?null:e<t?null:n&(e<<1|1)},this.addInst=function(e,t,n,r){var i=new a(o,e,t,n,r);return o.instructions.hasOwnProperty(i.name)||(o.instructions[i.name]=[]),o.instructions[i.name].push(i),i},this.encoders={},this.instructions={}}return e.prototype.toFnPtr=function(e,t){return e},e.prototype.wordSize=function(){return-1},e.prototype.computeStackOffset=function(e,t){return t},e.prototype.is32bit=function(e){return!1},e.prototype.emit32=function(e,t,n){return null},e.prototype.postProcessRelAddress=function(e,t){return t},e.prototype.postProcessAbsAddress=function(e,t){return t},e.prototype.peephole=function(e,t,n){},e.prototype.registerNo=function(e){return null},e.prototype.getAddressFromLabel=function(e,t,n,r){return void 0===r&&(r=!1),null},e.prototype.isPop=function(e){return!1},e.prototype.isPush=function(e){return!1},e.prototype.isAddSP=function(e){return!1},e.prototype.isSubSP=function(e){return!1},e.prototype.testAssembler=function(){v.assert(!1)},e.prototype.commonalize=function(e){},e.prototype.expandLdlit=function(e){},e}();function u(e){var t=[],n="";e:for(var r=0;r<e.length;++r)switch(e[r]){case"[":case"]":case"!":case"{":case"}":case",":n&&(t.push(n),n=""),t.push(e[r]);break;case" ":case"\t":case"\r":case"\n":n&&(t.push(n),n="");break;case";":break e;default:n+=e[r]}return n&&(t.push(n),n=""),t[0]?t:null}function m(e,t){return{stack:null,opcode:null,error:e,errorAt:t}}function c(e){return e<0||65535<e?("0x"+e.toString(16)).toLowerCase():("0x"+("000"+e.toString(16)).slice(-4)).toLowerCase()}p.AbstractProcessor=t,p.emitErr=m,p.expectError=function(e,t){var n=new s(e);n.emit(t),0==n.errors.length&&v.oops("ASMTEST: expecting error for: "+t)},p.tohex=c,p.expect=function(e,t){var n=[],r=t.replace(/^([0-9a-fA-F]{4,8})\s/gm,function(e,t){return n.push(parseInt(t.slice(0,4),16)),8==t.length&&n.push(parseInt(t.slice(4,8),16)),""}),i=new s(e);i.throwOnError=!0,i.disablePeepHole=!0,i.emit(r),0<i.errors.length&&(console.debug(i.errors[0].message),v.oops("ASMTEST: not expecting errors")),i.buf.length!=n.length&&v.oops("ASMTEST: wrong buf len");for(var o=0;o<n.length;++o)i.buf[o]!=n[o]&&v.oops("ASMTEST: wrong buf content at "+o+" , exp:"+c(n[o])+", got: "+c(i.buf[o]))}})((v=e.pxtc||(e.pxtc={})).assembler||(v.assembler={}))}(ts||(ts={})),function(p){!function(c){var l=pxtc.Util;c.apiRoot="https://makecode.com/api/",c.accessToken="";var n=!(c.localToken="");function r(e){var t=new Error(l.lf("Cannot access {0} while offline",e));return t.isOffline=!0,Promise.delay(1e3).then(function(){return Promise.reject(t)})}function u(e,t){return p.U.requestAsync({url:"/api/"+e,headers:{Authorization:c.localToken},method:t?"POST":"GET",data:t||void 0,allowHttpErrors:!0})}function i(t){return t.url=p.webConfig&&p.webConfig.isStatic&&!t.forceLiveEndpoint?p.webConfig.relprefix+t.url:c.apiRoot+t.url,t.allowGzipPost=!0,c.isOnline()?(c.accessToken&&(t.headers||(t.headers={}),t.headers["x-td-access-token"]=c.accessToken),l.requestAsync(t).catch(function(e){return 0==e.statusCode?(n&&(n=!1,c.onOffline()),r(t.url)):Promise.reject(e)})):r(t.url)}function f(e){return i({url:e}).then(function(e){return e.text})}function e(){return navigator&&navigator.onLine}c.onOffline=function(){},c.hasAccessToken=function(){return!!c.accessToken},c.isLocalHost=function(){try{return/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&!/nolocalhost=1/.test(window.location.href)&&!(p.webConfig&&p.webConfig.isStatic)}catch(e){return!1}},c.localRequestAsync=u,c.privateRequestAsync=i,c.privateGetTextAsync=f,c.privateGetAsync=function(e,t){return void 0===t&&(t=!1),i({url:e,forceLiveEndpoint:t}).then(function(e){return e.json})},c.downloadTargetConfigAsync=function(){if(!c.isOnline())return Promise.resolve(void 0);var e=p.appTarget.versions&&p.appTarget.versions.target,t=p.webConfig&&p.webConfig.isStatic?"targetconfig.json":"config/"+p.appTarget.id+"/targetconfig"+(e?"/v"+e:"");return c.isLocalHost()?u(t).then(function(e){return e?e.json:void 0}):c.privateGetAsync(t)},c.downloadScriptFilesAsync=function(e){return i({url:e+"/text",forceLiveEndpoint:!0}).then(function(e){return JSON.parse(e.text)})},c.downloadMarkdownAsync=function(e,t,n){var r,i=p.webConfig&&p.webConfig.isStatic,o=p.appTarget.versions&&p.appTarget.versions.target||"?";if(i){var a=/\/docs\//.test(r=e),s=/\.\w+$/.test(r);a||(r="docs/"+r),s||(r+=".md")}else r="md/"+p.appTarget.id+"/"+e.replace(/^\//,"")+"?targetVersion="+encodeURIComponent(o);return i||"en"==t||(r+="&lang="+encodeURIComponent(l.userLanguage()),n&&(r+="&live=1")),c.isLocalHost()&&!n?u(r).then(function(e){return 404==e.statusCode?f(r):e.text}):f(r)},c.privateDeleteAsync=function(e){return i({url:e,method:"DELETE"}).then(function(e){return e.json})},c.privatePostAsync=function(e,t,n){return void 0===n&&(n=!1),i({url:e,data:t||{},forceLiveEndpoint:n}).then(function(e){return e.json})},c.isLoggedIn=function(){return!!c.accessToken},c.isNavigatorOnline=e,c.isOnline=function(){return"undefined"!=typeof navigator&&e()&&(n=!0),n},c.getServiceUrl=function(){return c.apiRoot.replace(/\/api\/$/,"")},c.getUserId=function(){var e=/^0(\w+)\./.exec(c.accessToken);return e?e[1]:null},c.parseScriptId=function(e){var t=p.appTarget;if(e&&t.appTheme&&t.cloud&&t.cloud.sharing){var n=["makecode.com"];t.appTheme.embedUrl&&n.push(t.appTheme.embedUrl),t.appTheme.shareUrl&&n.push(t.appTheme.shareUrl);var r="^((https://)?(?:"+(n=l.unique(n,function(e){return e}).map(function(e){return l.escapeForRegex(l.stripUrlProtocol(e).replace(/\/$/,"")).toLowerCase()})).join("|")+")/)?(api/oembed?url=.*%2F([^&]*)&.*?|([a-z0-9-_]+))$",i=new RegExp(r,"i").exec(e.trim());return i&&(!i[1]||0<=n.indexOf(l.escapeForRegex(i[1].replace(/https:\/\//,"").replace(/\/$/,"")).toLowerCase()))&&(i[3]||i[4])?i[3]?i[3]:i[4]:null}}}(p.Cloud||(p.Cloud={}))}(pxt||(pxt={}));